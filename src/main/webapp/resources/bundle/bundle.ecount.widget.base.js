window.__define_resource&&__define_resource("LBL08192","LBL07445","MSG01396","LBL09957","BTN00351","LBL10028","LBL01684","LBL05639","LBL08019","MSG00141","LBL12503","LBL14667","LBL03682","LBL00330","LBL90149","LBL02760","LBL11407","LBL03532","LBL17054","LBL17055","LBL06157","LBL20425","LBL20383","LBL20427","LBL20426","MSG00297","MSG06615","MSG00205","LBL09004","LGN00234","LBL00832","LBL10694","LBL03070","LBL02263","MSG08908","BTN00113","BTN00832","BTN00007","BTN00833","BTN00079","LBL07436","BTN00070","LBL19216","MSG05733","BTN00575","LBL01155","LBL00478","LBL35004","LBL02704","LBL01018","LBL04386","MSG03646","MSG03587","MSG03657","MSG04180","MSG03611","MSG05976","LBL02244","LBL02265","LBL02840","LBL04731","LBL01000","BTN00028","BTN00447","LBL01732","BTN00008","LBL80149","MSG10840","MSG11732","LBL19971","LBL19972","MSG03452","LBL08710","LBL08711","LBL04820","LBL08713","LBL08714","LBL08715","LBL08716","LBL08717","LBL08718","LBL08719","LBL08232","LBL01653","LBL10727","LBL08333","LBL08647","LBL03422","LBL03429","BTN00087","LBL02792","LBL05531","LBL01593","LBL85028","LBL10736","LBL10607","LBL11298","LBL05716","LBL70688","LBL70585","LBL70586","LBL70558","LBL70559","LBL09037","LBL70562","LBL70561","LBL70563","LBL70564","LBL10379","LBL05361","LBL05362","LBL05363","LBL70571","LBL70578","LBL70590","LBL70589","LBL80306","LBL70592","LBL70593","LBL70594","LBL70595","LBL70596","LBL17332","LBL70575","LBL01056","MSG02281","MSG05582","MSG09954","LBL70572","LBL70573","LBL70574","LBL70686","LBL70576","LBL70577","LBL70580","LBL70581","LBL70579","MSG07499","MSG07500","MSG07502","MSG07503","MSG07504","LBL00785","LBL00044","MSG01377","MSG05529","MSG09778","MSG02335","MSG01736","MSG00409");ecount.class("ecount.lightControl","ecount.widget",{controlType:null,template:"",cid:null,$el:null,_preventLayerOpenByHover:!1,isLightControl:!0,init:function(n){this._initializeOptions(n);this._onInitComponents(n);this._setTemplate()},_initializeOptions:function(n){_.merge(this,{_isGridCellControl:!0,__type:n.__type,controlType:n.controlType,id:n.id,cid:n.id,pcid:n.pcid,name:n.name,ecPageID:n.ecPageID,isLayerPopup:n.popupType==="layer",containerName:n.containerName,tabID:n.tabId,gridID:n.gridID,css:n.css||"",addCss:n.addCss||"",style:n.style||"",popoverOptions:n.addonPopoverOptions,hidden:n.hidden,inlineIndex:n.inlineIndex,OBSERVE_CHANGE_STATE:n.OBSERVE_CHANGE_STATE,nationalFlagOptions:n.nationalFlagOptions?ecount.control.prototype.getInitNationalFlagProp.call(this,n.nationalFlagOptions):null,__prettyFilter:n.__prettyFilter||null});this.tagOptions=n.tagOptions||{};this.setEcPath();this.setEcIKey();this.initializeOptions(n)},initializeOptions:function(){},getEcPath:function(){return this.ecPath},setEcPath:function(){this.ecPath=[this.ecPageID,this.containerName,this.tabID,"",this.gridID,this.id,this.pcid].join(ecount.separator.ecPath)},getEcIKey:function(){return this.ecIKey},setEcIKey:function(){this.ecIKey=ecount.global.registerEcInstance(this)},_onInitComponents:function(n){var r=n.data||[{}],f=[],i,e,t,o,u;for($.isArray(r)&&r.length<1&&r.push({}),u={},this.style&&this.style.split(";").filter(function(n){return n!=""}).forEach(function(n){var t=n.split(":");u[t[0]]=t[1]}),i=0,e=r.length;i<e;i++){o=_.isArray(n._readOnly)?n._readOnly[i]:n._readOnly;t=Object.clone(r[i],!0);t.id=t.cid=t.cid||this.cid;t.name=t.name||this.name||this.id;t.css=t.css||this.css||"";t.addCss=t.addCss||this.addCss||"";t.ecPath=this.getEcPath();t.index=i;t.option=t.option||[];t["style.inline"]=t.style||"";t["style.bgcolor"]=t.bgColor||u.bgColor||"";t["style.color"]=t.color||u.color||"";t["attr.disabled"]=o==!0?"disabled":"";this.hidden&&(t.css+=" hidden",t["style.display"]=!1);this.onInitComponents(n,t);f.push(t)}this.components=f},onInitComponents:function(){},_setTemplate:function(){var u=[],i="",n,f,t,e,r;for(this.nationalFlagOptions&&this.nationalFlagOptions["style.display"]&&(i=ecount.widget.replaceAttr(ecount.control.template.nationalFlag,this.nationalFlagOptions)+"&nbsp;"),n=0,f=this.components.length;n<f;n++)t=this.components[n],r=this.__prettyFilter?ecount.control.prototype.getConvertPrettyFilter.call(this,this.__prettyFilter,t.label).value:t.label,e=this.onInitTemplate(this.template,t),u.push(ecount.widget.replaceAttr(this.getProcessTag(e),_.merge({},t,{label:n===0&&i?i+r:r})));this.composedDomTemplate=u.join("\n")},onInitTemplate:function(n){return n},render:function(n){this.set$El();n.append(this.$el);this._onMount()},set$El:function(n){if(this.$el=$.isNull(n)?$(this.composedDomTemplate):$(n),this.$el.length>1)for(var t=0,i=this.$el.length;t<i;t++)this.$el[t].ecIKey=this.getEcIKey();else this.$el[0].ecIKey=this.getEcIKey()},destroy$El:function(){this.$el=null},_onMount:function(){this.popoverOptions&&this.setPopover();this.onMount()},onMount:function(){},getComposedDomString:function(){return this.$el?this.$el[0].outerHTML:this.composedDomTemplate},getComponents:function(){return this.components},getComponent:function(n){return _.isNumber(n)?this.components[n||0]:_.isString(n)?this.components.find(function(t){return t.value==n}):void 0},getElements:function(n){var t=this.$el.filter("[data-index="+(n||0)+"]");return t.length>0?t:this.$el.find("[data-index="+(n||0)+"]")},isCombinedControl:function(){return!1},isGridCellControl:function(){return this._isGridCellControl},hasError:function(){return!1},addClass:function(n){this.$el.addClass(n)},removeClass:function(n){this.$el.removeClass(n)},changeInlineStyle:function(n,t){var r,f,u,i,o,e;if($.isNull(t)&&(t=n,n=0),r=this.getElements(n),r&&r.length>0){for(f={},u=t.split(";"),i=0,o=u.length;i<o;i++)u[i]!=""&&(e=u[i].split(":"),f[e[0].trim()]=e[1].trim());r.css(f)}},getValue:function(n){return this.getComponent(n||0).value},getStandardValue:function(){var n=this.getValue();return $.isArray(n)||(n=[n]),n},setValue:function(n,t){arguments.length==1?(t=arguments[0],n=0):arguments.length==2&&(n=n||0);this.getComponent(n).value=t},setStandardValue:function(){var n,t;arguments.length===1?(n=0,t=arguments[0]):(n=arguments[0],t=arguments[1]);this.setValue(n,t)},destroy:function(){this.$el&&this.$el.remove()},setPopover:function(n,t){t&&(this.popoverOptions=t);var u=n,i=(this.popoverOptions.message||"").cr2br(),f=this.popoverOptions.placement||"auto",e=this.popoverOptions.trigger||"manual",o=this.popoverOptions.directShow||!1,s=this.isLayerPopup?$("div[data-ecpageid="+this.ecPageID+"]").closest("div.ui-dialog"):"body",r;$.isEmpty(i)||(r=_.merge({content:i,placement:f,container:s,trigger:e,directShow:o,isClearOnBodyClick:!0,html:!0,animation:!1},this.popoverOptions||{}),ecount.popover.create(u,r))},destroyPopover:function(){var n=this.getErrorTarget();ecount.popover.destroy(n)},resetPopover:function(n,t){var i=this.getErrorTarget();this.destroyPopover();this.setPopover(i,t)},getErrorTarget:function(){return this.$el.parent()},showError:function(n){var t,i;n||(n={});t=n.target?n.target:this.getErrorTarget();this.resetPopover(t,n);t.hasClass("has-error")?t.find("div.validation").length>0&&this.resizeValidation():(i="",(ecount.isIE||ecount.constValue.isEdge||ecount.constValue.isFirefox)&&(i="height:"+t[0].clientHeight+"px; "),t.addClass("has-error"),t.prepend($("<div class='validation' style='"+i+"z-index:2;'>")))},hideError:function(n){var t=n?n:this.getErrorTarget();t.popover("destroy");t.removeClass("has-error");t.find("div.validation").remove();ecount.popover.destroy(t);t=null},resizeValidation:function(){var n=this.getErrorTarget(),t="";(ecount.isIE||ecount.constValue.isEdge||ecount.constValue.isFirefox)&&(t="height:"+n[0].clientHeight+"px; ");n.find("div.validation").attr("style",t+"z-index:2;")},getlayerOptions:function(n,t){return{type:n.ecService.split(".").pop(),ownerKey:this.ecIKey,serviceKey:this.getLayerServiceKey(n,t),ecPageID:this.ecPageID,containerName:this.containerName,tabID:this.tabID,gridID:this.gridID,_commandPrefix:"function",items:this.dropdownOptions||[],boundary:this.getFunctionBoundary("fn")}},getLayerServiceKey:function(n){var t=n.ecPath;return ecount.common.makeServiceKey(t,"fn")},_fixClickedLayer:function(n,t,i){n.ecServiceAttr==ecount.layer.constValue.FIXED?(i.showingUpDelay=0,i._onClicked=!0,ecount.layer.show(i),ecount.layer.setOnClicked(i.serviceKey,!0)):ecount.layer.clearTimer(i.serviceKey)},getFunctionBoundary:function(n){var i,t;return i=['[data-function="'+n+'"]'],t=this.$el.find(i.join("")),t.length?ec$.getZoomedBoundary(t.get(0)):this.getDefaultBoundaryObject()},setFocus:function(n){var t=this.getElements(n);t.length>0&&t.focus()},hide:function(n){var t=[];$.isEmpty(n)?(t=this.components.map(function(n,t){return n.css+=" hidden",this.getElements(t)}.bind(this)),this.hidden=!0):(this.components[n]&&(this.components[n].css+=" hidden",t.push(this.getElements(n))),this.hidden=!this.components.some(function(n){return n.css.indexOf("hidden")<0}));t.forEach(function(n){n.length>0&&n.addClass("hidden")});this.OBSERVE_CHANGE_STATE({self:this,targetID:this.id,key:"UPDATE_IT_SELF",path:"style.display",state:!1})},show:function(n){var t=[];$.isEmpty(n)?(t=this.components.map(function(n,t){return n.css=n.css.replace(/\s*hidden\s*/," "),this.getElements(t)}.bind(this)),this.hidden=!1):(this.components[n]&&(this.components[n].css=this.components[n].css.replace(/\s*hidden\s*/," "),t.push(this.getElements(n))),this.hidden=!this.components.every(function(n){return n.css.indexOf("hidden")<0}));t.forEach(function(n){n.length>0&&n.removeClass("hidden")});this.OBSERVE_CHANGE_STATE({self:this,targetID:this.id,key:"UPDATE_IT_SELF",path:"style.display",state:!0})},hasFocus:function(n){var t=this.getElements(n||0);return document.activeElement==t.get(0)},isReadOnly:function(n){var i=0,t;return isNaN(n)||(i=n),t=this.components[i]||{},t["attr.disabled"]===!0||t["attr.readonly"]===!0},isVisible:function(n){var t=0,i;return isNaN(n)||(t=n),i=this.components[t]||{},i.css.indexOf("hidden")<0},isVisibleElement:function(n){var i=0,t;return isNaN(n)||(i=n),t=this.getElements(i||0),t.length>0?ecount.widget.isVisible(t.get(0)):!1},getAddonTitle:function(){var n=this.components[0]||{};return n["opt.addontitle"]},getProcessTag:function(n){var i=[],f=[],t=this.tagOptions||{},u,r,e;if(Object.keys(t).length==0)return n;if(t.badgeColor&&i.push('<span class="calendar-state" style="background-color:'+t.badgeColor+';" {{tagCid}}><\/span>'),t.notice&&i.push('<span class="text-bold" {{tagCid}}>['+t.notice+"]<\/span>"),t.preLabel)for(u=_.isArray(t.preLabel)?t.preLabel:[t.preLabel],r=0;r<u.length;r++)e=u[r].color>"#dddddd"?"label label-light mr-5":"label mr-5",i.push('<span class="'+e+'" style="background-color:'+u[r].color+';" {{tagCid}}>'+u[r].label+"<\/span>");return t.searchType==2?i.push('<span class="ml-1" {{tagCid}}><\/span>'):t.reply===!0&&i.push('<span class="icon-list-reply ml-1" {{tagCid}}><\/span>'),t.commentCount&&$.isNumber(t.commentCount)&&f.push('<span class="text-bold" {{tagCid}}>['+t.commentCount+"]<\/span>"),t.newWriting===!0&&f.push('<span class = "icon-list-new" {{tagCid}}><\/span>'),ecount.widget.replaceAttr(i.join("")+n+f.join(""),{tagCid:this.cid?'data-cid="'+this.cid+'" data-index="0"':""})},getFocusableIndex:function(){return this._getFocusableIndex()},getReversedFocusableIndex:function(){return this._getFocusableIndex(!0)},_getGridSelectedLabel:function(){var n=this.getGridSelectedLabel&&this.getGridSelectedLabel();return n===undefined?"":n},getGridSelectedLabel:function(){var n=this.components[0]||{};return n.label},_getFocusableIndex:function(n){var t=this.getVisibleComponents(),r,i;return!t||!t.length?-1:(r=t.find(function(t,r){return this.hasFocus(t.index)?(i=r+(n?-1:1),!0):!1}.bind(this)),r)?t[i]?t[i].index:-1:t[n?t.length-1:0].index},getVisibleComponents:function(){return this.components.filter(function(n){return n.css.indexOf("hidden")<0}.bind(this))},getReversedFocusableIndex:function(){var n=this.getVisibleComponents();return n.length-1},getLayerDropdownOption:function(n,t){return _.extend(this.getLayerDefaultOption(n,t),{boundary:this.getContainerBoundary()})},getLayerDefaultOption:function(n,t){return{type:n.ecService.split(".").pop(),items:this.dropdownOptions,tabID:this.tabID,gridID:this.gridID,ownerKey:this.ecIKey,isGridV3:!0,ecPageID:this.ecPageID,serviceKey:this.getLayerServiceKey(n,t),containerName:this.containerName,isSetDropdownSize:this.isSetDropdownSize,hasDropdownLayerIcon:this.hasDropdownLayerIcon}},getContainerBoundary:function(){var n=this.getElements();return this.$el.length?ec$.getZoomedBoundary(n.get(0),{left:0}):this.getDefaultBoundaryObject()},getDefaultBoundaryObject:function(){return{top:0,left:0,width:0,height:0}},_showLayer:function(n,t,i){var f=n.handler.toLowerCase().split(".").slice(1).join("."),e=("get_"+f.replace(/\./g,"_")+"_option").ecCamelize(!0),r,u=ecount.layer.constValue;switch(f){case u.FN:case u.DROPDOWN:case u.RECOMMENDDROPDOWN:case u.SELECTOR:r=ec$.safeCall(this,e,n,t);r!==!1&&r.executeToggle!=!0&&ecount.layer.show(_.extend(r,i||{}));break;case u.TABLE:r=ec$.safeCall(this,e,n,t);ecount.layer.update(_.extend(r,i||{}))}},_hideLayer:function(n,t){var r=n.handler.toLowerCase().split(".").slice(1).join("."),u=this.getLayerServiceKey(n,t),i=ecount.layer.constValue;switch(r){case i.FN:case i.TABLE:case i.DROPDOWN:case i.RECOMMENDDROPDOWN:case i.SELECTOR:ecount.layer.hide(u)}},onFocusOut:function(){},_ON_CHANGE:function(n,t,i){return this.ON_CHANGE(n,t,i),!0},ON_CHANGE:function(){},_ON_CLICK:function(n,t,i,r){if(n.ecPath==this.ecPath&&n.ecService){var e=n.handler.toLowerCase().split(".").slice(1).join("."),o=("get_"+e.replace(/\./g,"_")+"_option").ecCamelize(!0),f=ec$.safeCall(this,o,n,t,i,r),u=ecount.layer.constValue;if(f.executeToggle==!0)return f.showingUpDelay=0,ecount.layer.toggle(f),!1;switch(e){case u.SELECTBOX:ecount.layer.toggle(f);break;case u.FN:case u.DROPDOWN:case u.TABLE:case u.NOTIFICATIONDROPDOWN:case u.SELECTOR:this._fixClickedLayer(n,t,f)}}return this.ON_CLICK(n,t,i,r),!0},ON_CLICK:function(){},_ON_CLICK_SERVICE:function(n,t,i,r){if(r&&_.isEmpty(r.columnID)&&_.isEmpty(r.rowId)){var u=ec$.parseGridElement(this.$el.get(0));_.merge(r,{gridId:u.gridID,tableId:u.gridTableID,rowId:u.dataKey,columnId:u.columnID,sectionType:u.sectionType})}return this.ON_CLICK_SERVICE(n,t,i,r),!0},ON_CLICK_SERVICE:function(){},_ON_FOCUSOUT:function(n,t,i,r){var u=[this.ecPageID,this.tabID,this.gridID].join(ecount.delimiter);return ecount.runtime.notify("control.togglePopover",u,{flag:!1,control:this,gridInfo:{gridDataKey:n.gridDataKey,gridColumnID:n.gridColumnID,gridSectionType:n.gridSectionType}}),this.ON_FOCUSOUT(n,t,i,r),!0},ON_FOCUSOUT:function(){},_ON_MOUSEOVER:function(n,t,i,r){return!n.ecService||n.ecService=="layer.selectbox"||this.hasError()||this._preventLayerOpenByHover||this._showLayer(n,t),this.ON_MOUSEOVER(n,t,i,r)===!1?!1:void 0},ON_MOUSEOVER:function(){},_ON_MOUSEOUT:function(n,t,i,r){return n.ecService&&!this._preventLayerOpenByHover&&this._hideLayer(n,t),this.ON_MOUSEOUT(n,t,i,r)===!1?!1:void 0},ON_MOUSEOUT:function(){}});ecount.class("ecount.lightControl.date","ecount.lightControl",{controlType:null,template:'<span class="{{css}} {{addCss}}" data-ecpath="{{ecPath}}" data-cid="{{cid}}" data-index="{{index}}" sectiontype="{{gridSectionType}}" data-column-id="{{gridColumnID}}" data-key="{{gridDataKey}}" >{{label}}<\/span>',cid:null,$el:null,initializeOptions:function(){this._ERA_LIST=ecount.control.date.getERAList(this.ecPageID);this.dateFormat=ecount.control.date.getDateFormat()},onInitTemplate:function(n){var t=[],i=this.getComponents()[0].dateData||[];return i.map(function(n,i){var r="",u=i==this.dateFormat.length?"~":"",f=n.format=="d"?n.value:n.selectedLabel,e=n.prefixSpace?" ":"",o=n.postfixSpace?" ":"",s=$.isEmpty(n.prefix)?"":n.prefix,h=$.isEmpty(n.postfix)?"":n.postfix;r=u+e+s+f+h+o;t.push(r)}.bind(this)),n.replace("{{label}}",t.join(""))},onInitComponents:function(n,t){t.gridSectionType=n.gridSectionType;t.gridColumnID=n.gridColumnID;t.gridDataKey=n.gridDataKey;t.dateData=n.data&&n.data.length>0&&n.data[0].label&&n.data[0].label!="&nbsp;"?this.getInitDataComponents(n):this.getInitComponents(n)},getDateComponents:function(){return this.dateFormat.map(function(n){return this._getAddonLabel({format:n})}.bind(this))},_getAddonLabel:function(n){if(!ecount.config.company.MYPAGECOMPANY_DATE)return n;var i=ecount.config.company.MYPAGECOMPANY_DATE,t=[],r,u,f,e;switch(n.format){case"y":t.push("YEAR");break;case"m":t.push("MONTH");break;case"d":t.push("DAY");break;case"h1":case"h2":t.push("HOUR");break;case"mi1":case"mi2":t.push("MIN")}return t.push("_INPUT_"),r=i[t.concat(["FRONT_CHAR"]).join("")],u=i[t.concat(["BACK_CHAR"]).join("")],f=i[t.concat(["FRONT_BLANK"]).join("")],e=i[t.concat(["BACK_BLANK"]).join("")],_.merge({prefix:r,postfix:u,prefixSpace:f,postfixSpace:e},n)},getCompInOrder:function(n){var t=this.getDateComponents(n);return t.map(function(n,t){return _.merge(n,{index:t})})},getInitDataComponents:function(n){var t=n.data[0].label.length==8?[n.data[0].label.substring(0,4),n.data[0].label.substring(4,6),n.data[0].label.substring(6,8)]:n.data[0].label.length==10?n.data[0].label.split("-"):["====","==",""],i=t[0],r=t[1],u=t[2];return this.getCompInOrder(n).map(function(n,t){if(!n.format)return n;switch(n.format){case"y":return this._getSelectboxYearComponent(n,i,t);case"m":return this._getSelectboxComponent(n,r,t);case"d":return this._getInputboxComponent(n,u,t);default:return n}}.bind(this))},getInitComponents:function(n){return this.getCompInOrder(n).map(function(n,t){if(!n.format)return n;switch(n.format){case"y":return this._getSelectboxYearComponent(n,"====",t);case"m":return this._getSelectboxComponent(n,"==",t);case"d":return this._getInputboxComponent(n,"",t);default:return n}}.bind(this))},_getSelectboxYearComponent:function(n,t){if(t=="====")return _.extend({selectedValue:t,selectedLabel:t},n);var i=ecount.control.date.getResourceAppliedYear(this._ERA_LIST,{label:t,value:t});return _.extend({selectedValue:t,selectedLabel:i.label},n)},_getSelectboxComponent:function(n,t){if(t=="==")return _.extend({selectedValue:t,selectedLabel:t},n);var r=!1,i="mmm",u;return ecount.config.company.MYPAGECOMPANY_DATE&&(i=ecount.config.company.MYPAGECOMPANY_DATE.MONTH_INPUT_FORMAT.toLowerCase(),i=="mmmm"&&(r=!0)),u=ecount.control.date.setResource(i,r,{label:t,value:t}),_.extend({selectedValue:t,selectedLabel:u.label},n)},_getInputboxComponent:function(n,t){return _.extend({value:t},n)}});require("jquery-validate",function(){ecount.validator=function(){function u(u,e,o){var c=[],s=method=null,l=f(u)?u:u.value,h;e=e?i(e):$.validator.attributeRules(u);for(method in e)s={method:method,parameters:e[method]},n[method]&&(h=n[method].call(t,l,u,s.parameters),h=="dependency-mismatch"||h||(o=o||r[method],c.push({method:method,message:typeof o=="string"?o:o.call(null,s.parameters)})));return c}function s(t){var u=[],r;t=i(t);for(r in t)r==="permission"&&(u=n[r](t[r]));return u}function f(n){return!(n&&n.nodeType&&n.nodeType===1)}function i(n){for(var i=0,t=null,f=n.length,r={},u;i<f;i++)if(t=n[i],typeof t=="string")r[t]=!0;else for(u in t)r[u]=t[u];return r}var r=$.validator.messages,n=$.validator.methods,t=new $.validator,o=$.validator.prototype.optional,e;return n.permission=function(n,t){for(var r=[],i=0,u=n.length;i<u;i++)n[i][0]||r.push({method:"permission",message:n[i][1]||t});return r},$.validator.prototype.optional=function(n){return f(n)?n==""?"dependency-mismatch":!1:o.call(t,n)},e=function(){return function(){var n=[];return{addRule:function(){n.push(Array.prototype.slice.call(arguments))},check:function(){for(var r=[],t=null,i=0,f=n.length;i<f;i++)t=u.apply(null,n[i]),t.length>0&&r.push(t);return r}}}()},{EMPTY:"empty",validate:function(){return arguments.length===2?s.apply(null,arguments):u.apply(null,arguments)},check:function(i,r){var u=n[i].call(t,r);return!(u!="dependency-mismatch"&&!u)},getValidator:e,showError:function(){}}}()});ecount.layout.header=function(n){return n._isCSHeader===!0?(ecount.layout.header.customerSupport._export&&(ecount.layout.header.customerSupport._export().create(),ecount.layout.header.customerSupport._export=null),new ecount.layout.header.customerSupport(n)):n._isBoardHeader===!0?(ecount.layout.header.board._export&&(ecount.layout.header.board._export().create(),ecount.layout.header.board._export=null),new ecount.layout.header.board(n)):n._isUserGroupHeader===!0?(ecount.layout.header.userGroup._export&&(ecount.layout.header.userGroup._export().create(),ecount.layout.header.userGroup._export=null),new ecount.layout.header.userGroup(n)):n._isQnaHeader===!0?(ecount.layout.header.qna._export&&(ecount.layout.header.qna._export().create(),ecount.layout.header.qna._export=null),new ecount.layout.header.qna(n)):(ecount.layout.header.base._export&&(ecount.layout.header.base._export().create(),ecount.layout.header.base._export=null),new ecount.layout.header.base(n))};ecount.class("ecount.layout.header.base","ecount.layout.container",{title:null,searchBtn:{id:"tgHeaderSearch",css:"btn btn-primary btn-title-search",label:ecount.resource.LBL08192+"(F3)"},optionBtn:{id:"tgHeaderOption",css:"btn btn-default btn-title-option dropdown-toggle",label:ecount.resource.LBL07445},buttons:null,dropdownMenu:null,itemList:null,$contents:null,$header:null,favorite:null,enoteTabMenu:null,template:'<div class="wrapper-toolbar"><div class="pull-left"><\/div><div class="pull-right"><\/div><\/div>',init:function(n){var f=widget.generator.control(),e,t,r,u,i;n._useQuickSearch&&(e=this.onQuickSearchHandler.bind(this),t=f.define("widget.search","__headerQuick").handler({keydown:e}).hideButton(),n._maxBytes&&t.filter("maxbyte",{message:n._bytesMessage,max:n._maxBytes}),n._maxLength&&t.filter("maxlength",{message:n._maxMessage||ecount.resource.MSG01396,max:n._maxLength}),n._isShowQuickSearch===!1&&t.hide(),t=t.end(),t.containerName=widget.generator.HEADER,n.btnItems.unshift(t));n._useQuickLabel&&(r=f.define("widget.button.filter","quickLabel").label(ecount.resource.LBL09957).addGroup(n._quickLabelData).setQuickLabelOptions({quickLabelParams:n._quickLabelParams}),n._isShowQuickLabel===!1&&r.hide(),r=r.end(),r.containerName=widget.generator.HEADER,n.btnItems.unshift(r));n._useQuickInactive&&(u=f.define("widget.button","quickInactive").label(ecount.resource.BTN00351).css("btn btn-default btn-sm"),n._isShowQuickInactive===!1&&u.hide(),u=u.end(),u.containerName=widget.generator.HEADER,n.btnItems.unshift(u));n._useQuickSelect&&(i=f.define("widget.select","quickSelect").option(n._quickSelectOption).setOptions(n._quickSelectOptions),n._isShowQuickSelect===!1&&i.hide(),_.isNil(n._quickSelectedValue)||i.select(n._quickSelectedValue),i=i.end(),i.containerName=widget.generator.HEADER,n.btnItems.unshift(i));ecount.layout.container.prototype.init.apply(this,arguments);this.buttons=[];this.itemList=[];this.favorite&&(this.favorite.titleName=this.title);this.useHeader||(this.useHeader=n.useHeader||!0);this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.ecIKey=ecount.global.registerEcInstance(this);ecount.runtime.observe(this.ecPageID,ecount.widget.FORM_LOAD_COMPLETE,this._onFormLoadComplete.bind(this));ecount.runtime.observe(this.ecPageID,ecount.widget.RESIZE_FORM_HEADER,this._onFormLoadComplete.bind(this))},render:function(n){this.hidden&&n.parent().addClass("hidden");ecount.layout.container.prototype.render.apply(this,arguments);!this.useHeader||this.createTitle();this.createButtonList();this.createLayout();this.createContents();this.toolbarOptionsList&&this.createToolbar();this.$el.parent().parent().find(".tab-content").bind("scroll.header."+this.ecPageID,function(n){ecount.runtime.notify("scroll.page.eventContainer","clearLayer",n);ecount.runtime.notify("scroll.page.eventContainer",this.ecPageID,n)}.bind(this))},getLayoutWrapper:function(){return this.$header=this.$el.parent().parent(),this.$header.length?this.$header:this.$el},destroy:function(){this.$el.parent().parent().find(".tab-content").length&&this.$el.parent().parent().find(".tab-content").unbind("scroll.header."+this.ecPageID);ecount.layout.prototype.destroy.call(this);ecount.runtime.stopObserving(this.ecPageID,ecount.widget.FORM_LOAD_COMPLETE);ecount.runtime.stopObserving(this.ecPageID,ecount.widget.RESIZE_FORM_HEADER);this.favorite.isUseFavorites&&this.$title&&this.$title.off()},createTitle:function(){this.$helper=this.createHelper();this.enableEnote?this.independenceEnote?this.$title=$('<span style="font-weight: bold">'+this.title+"<\/span>"):this.setEnoteMenu():this.$title=$('<span id="btn-header-bookmark" class="'+this.defineCss()+'">'+this.title+"<\/span>");this.$el.find(".pull-left").append(this.$helper).append(this.$title).append(this.enoteTabMenu);var n="",t="";this.progressMark&&this.progressMark.progressTitle1&&(n=this.progressMark.progressTitle1,t=this.progressMark.progressTitle2);this.$Progresstitle=$([' <span class="wrapper-title-notification">','<span id="progressMarkF" class="label label-primary title-notification-heading">',n,"<\/span>",'<span id="progressMarkS" class="label label-primary title-notification-contents" style="display:none">',t,"<\/span>","<\/span>"].join(""));this.$Progresstitle.find("#progressMarkF").bind("click",this.clickProgressHandler.bind(this));this.$el.find(".pull-left").append(" ").append(this.$Progresstitle)},setProgressMark:function(n,t){this.$el.find("span#progressMarkF").text(n);this.$el.find("span#progressMarkS").text(t);this.onProgressShow()},setEnoteMenu:function(){var r=this.enoteMenu,i='<ul class="nav-tab-enote">{{items}}<\/ul>',f='<span id="btn-header-enote" data-service="layer.dropdown" data-service-attr="layer.fixed" owner-cid="btn-header-enote" class="'+this.defineCss()+'">'+this.title+"<\/span>",t,n,u;for(li='<li class="{{active}}"><a href="javascript:;" data-label="{{label}}" data-originlabel="{{title}}" data-function="menu" data-function-id="{{value}}">{{title}}<\/a><\/li>',items="",t=0;t<r.length;t++)n=r[t],u=ecount.widget.replaceAttr(li,{title:n.title,label:n.label,value:n.value,active:n.active===undefined?"":"active"}),items+=u;i=i.replace("{{items}}",items)+f;this.enoteTabMenu=i},getEnoteMenu:function(){return this.enoteTabMenu},changeTitle:function(n){n||(n="");this.$title&&this.$title.html(n);this.title=n},getResponsiveEnoteMenu:function(){var n=this.$el;return headerWidth=n.width(),searchWidth=this.$el.find(".pull-right").width(),headerWidth-searchWidth<=350?!0:!1},defineCss:function(){var n=["page-name"];return this.enableEnote?n.push("page-name page-nav"):this.favorite.isUseFavorites&&(this.favorite.isFavoritesAddition?n.push("page-bookmark-added"):n.push("page-bookmark")),n.join(" ")},createHelper:function(){var n="";return this.favorite.isUseFavorites&&this.isUseHelperButton&&(n='<span id="btn-user-help-mark" class="user-help-mark"><\/span>'),$(n)},changeBookmarkCondition:function(n,t){this.favorite.isFavoritesAddition=n;this.favorite.favoritesSeq||t===undefined||(this.favorite.saveFavoritesSeq=t,this.favorite.favoritesSeq=t);this.$title.attr("class",this.defineCss())},createButtonList:function(){var u,s;if(this.btnItems){var f=null,i=widget.generator.control(),e,t,r,n,o=null;for(u=0,s=this.btnItems.length;u<s;u++)t=this.btnItems[u],e=t.controlType,f=this.$el.find(".pull-right"),e?(n=t,n.id=n.id,n.delegator=this.delegator,ecount.widget.createDisplayID(n,"btn",widget.generator.HEADER)):(n=this[t.type+"Btn"],t.type=="option"?(i.define("widget.button.option",n.id).label(n.label).css(n.css),t.items&&i.addGroup(t.items).setOptions({delegator:this.delegator,containerName:this.__type||widget.generator.HEADER}),n=i.end()):(t.items&&t.items.length>0?(i.define("widget.button.option",n.id).label(n.label).setOptions({searchOption:!0}).css(n.css),i.addGroup(t.items).setOptions({delegator:this.delegator,containerName:this.__type||widget.generator.HEADER})):i.define("widget.button",n.id).label(n.label).css(n.css),n=i.end()),t.type=="search"&&this.delegator&&this.delegator.triggerEvent("spacialHotKey.enable",{name:"header.search"})),o=ecount.common.createNamespace(n.controlType),this.initializer&&ecount.control.initializeByUserSetting(this.initializer,n),n.containerName=widget.generator.HEADER,r=new o(n),r.render(f),t.hidden&&r.hide(),this.btnItems[u].type=="option",this.buttons.push(r),n.controlType&&this.itemList.push(r)}},createLayout:function(){var n=this.layout,t=this.$el.parent().parent();n&&(n.containerName=widget.generator.HEADER,this.createItems([n],t))},getOptionLength:function(){var n=this.getButton("tgHeaderOption");return n.getDropdownItemLength()},findOptionItem:function(n){var t=this.getButton("tgHeaderOption");return t.getDropdownItem(n)},hideOptionItem:function(n){var t=this.getButton("tgHeaderOption");t.hideDropdownItem(n)},showOptionItem:function(n){var t=this.getButton("tgHeaderOption");t.showDropdownItem(n)},removeOptionItems:function(){var n=this.getButton("tgHeaderOption");n.removeDropdownItem(null,!0)},addOptionItems:function(n){var t=this.getButton("tgHeaderOption");t.addDropdownItem(n)},removeOptionChildItems:function(n){var t=this.getButton("tgHeaderOption");t.removeDropdownChildItem(n)},insertOptionChildItems:function(n,t){var i=this.getButton("tgHeaderOption");i.addDropdownChildItem(n,t)},hasOption:function(){return this.getOptionLength()>0},changeSearchMode:function(n){var t=this.find(function(n){return n.toolbarType=="header.search"});t.length>0&&t[0].changeMode(n)},changeFilterDropdown:function(n){var t=this.getControl("quickLabel");t&&t.redrawDropdown(n)},createDropDownMenu:function(n,t,i){this.dropdownMenu=new ecount.layout.dropdown({items:t,eventContainer:i,onClick:this.clickDropdownHandler.bind(this)});this.dropdownMenu.render(n)},createContents:function(){this.$contents=this._ORIGIN_WIDTH?$('<div class="wrapper-header-search" style="max-width : '+this._ORIGIN_WIDTH+'px"/>'):$('<div class="wrapper-header-search"/>');this.$header.append(this.$contents);this.createItems(this.contentsOptions.items,this.$contents)},cItemRender:function(n,t){if(n.__type=="form"){var i=$('<div class="overflow-auto"><\/div>');n.render(i);t.append(i)}else n.render(t)},createToolbar:function(){var n,i,t,r;for(this.toolbarList=[],n=null,i=this.$header,t=0,r=this.toolbarOptionsList.length;t<r;t++)n=new ecount.layout.toolbar(this.toolbarOptionsList[t]),n.render(i),this.toolbarList.push(n)},_onFormLoadComplete:function(n){if(!this._noMaxWidth){var t=Math.max(n.TABLE_WIDTH,n.MIN_WIDTH);n.TITLE_WIDTH?this.$el.css({"max-width":ecview.util.getCssValueFormat(n.TITLE_WIDTH)}):this.$el.css({"max-width":ecview.util.getCssValueFormat(t)});this.$contents.css({"max-width":ecview.util.getCssValueFormat(t)})}},ON_CLICK:function(n,t){n.cid=="tgHeaderOption"||(n.cid=="tgHeaderSearch"?this.toggle():this.favorite.isUseFavorites&&!this.enableEnote&&n.id==="btn-header-bookmark"?(n.favorite=this.favorite,this.delegator&&this.delegator.triggerEvent("bookmark.click",n)):this.favorite.isUseFavorites&&n.id==="btn-user-help-mark"?(n.favorite=this.favorite,this.delegator&&this.delegator.triggerEvent("helper.click",n)):this.favorite.isUseFavorites&&n.cid==="helper"?(n.favorite=this.favorite,this.delegator&&this.delegator.triggerEvent("helper.click",n)):this.enableEnote?n.id==="btn-header-enote"?this._ON_SUB_LINK_DROPDOWN_DISPLAY(n,t):this.delegator&&this.delegator.triggerEvent("enoteMenu.click",n):this.delegator&&this.delegator.triggerEvent("button.click",n))},ON_CONTEXTMENU:function(n,t){n.id&&n.id==="btn-header-enote"&&t.preventDefault()},_ON_SUB_LINK_DROPDOWN_DISPLAY:function(n){var i=i||{},r=n.id||n.cid,t,u=n.id;t=this.getSubLinkDropdownOption(u,r);ecount.layer.show(t)},getSubLinkDropdownOption:function(n,t){var i=this.enoteMenu||[],r=n,u=this.$el.find("#"+t);return{type:"dropdown",showingUpDelay:0,ecPageID:this.ecPageID,serviceKey:ecount.common.makeServiceKey(this.ecPath,r),ownerKey:this.ecIKey,items:i||[],boundary:ec$.getZoomedBoundary(u[0])}},onProgressShow:function(){this.$Progresstitle&&this.$el.find("span#progressMarkF").text()!=""&&this.$el.find("span#progressMarkS").text()!=""&&this.$Progresstitle.find("#progressMarkS").css("display","block").delay(2e3).fadeOut()},clickProgressHandler:function(){this.onProgressShow()},clickDropdownHandler:function(n){this.delegator&&this.delegator.triggerEvent("dropdown.click",n)},onQuickSearchHandler:function(){var n=this.getControl("__headerQuick");this.delegator&&this.delegator.triggerEvent("button.click",{keyword:n.getValue(),control:n,command:"onHeaderQuickSearch"})},getQuickSearchControl:function(){return this.getControl("__headerQuick")},ON_KEY_F3:function(){ecount.widget.isVisible(this.$el.find("#"+this.searchBtn.id)[0])&&this.toggle()},toggleContents:function(n,t){this._showContents===undefined&&(this._showContents=ecount.widget.isVisible(this.$contents[0]));n===!1?this._showContents&&this.toggle(null,t):n===!0?this._showContents||this.toggle(null,t):this.toggle()},isShowContents:function(){return this._showContents},setSearchHeight:function(){for(var o=this.$contents.find(".tab-content"),r=o.find(".tab-pane"),n,t,u=document.body.parentElement.clientHeight,f=this.$contents.find(".header-search-btn-group").outerHeight(),e=0,i=0;i<r.length;i++)if(n=r.eq(i),n.css("display")!="none"){t=n.offset().top+n.outerHeight()+f+e;break}if(!t)return!1;t>u?n.parent().height(Math.round(u-n.offset().top-f-e-10)):n.parent().height("")},toggle:function(n,t){var i=this;(i._showContents===undefined&&(i._showContents=ecount.widget.isVisible(this.$contents[0])),!n||i._showContents)&&(ecount.runtime.notify("header.toggle",this.ecPageID,{ecPageID:this.ecPageID,showStatus:!i._showContents}),this.delegator&&this.delegator.triggerEvent("header.toggle",{showStatus:!i._showContents}),ecount.layer.clear(),this.$contents.slideToggle({duration:150,start:function(){var n=i.getTabContents();!$.isNull(n)&&n._usePreset&&(n.tabs.setExpand&&n.tabs.setExpand(),n.tabs.expandOrShrinkPreset&&n.tabs.expandOrShrinkPreset("shrink"))},complete:function(){var o,c,h,n,s,l;i._showContents=ecount.widget.isVisible(this);var r=i.getControl("__headerQuick"),u=i.getControl("quickLabel"),f=i.getControl("quickSelect"),e=i.getControl("quickInactive");if(i._showContents){for(r&&r.hide(),u&&u.hide(),f&&f.hide(),e&&e.hide(),$.isNull(i.getTabContents())||i.getTabContents().$tabPaneContanier.scrollTop(0),o=i.getControl(null,null,widget.generator.FORM),o&&o.setFocus(o.getInitFocusIndex()),c=i.getForm(!0),n=0,s=c.length;n<s;n++)c[n].redrawControl();for(h=i.getToolbar(null,!0),n=0,s=h.length;n<s;n++)h[n].redrawControl&&h[n].redrawControl()}else r&&i._noInputBox!=!0&&(r.isMoreCntOverQuickSearchHide||r.show(),u&&u.show(),f&&f.show(),e&&e.show());ecount.__isEventCaptureMode()&&($("body").append('<input type="hidden" data-recorder="toggle-header" id="toggleHeaderSearchComplete_'+i.ecPageID+'"/>'),l={type:"toggleHeaderSearch",showContents:i._showContents===!0,actionTarget:"toggleHeaderSearchComplete_"+i.ecPageID},ecount.eventLog("toggleHeaderSearch",l));t&&t()}}),this.delegator&&this.delegator.triggerEvent("page.adjustHeaderSearchDimensions"))},setTitleWidth:function(n){this.$el.css({"max-width":ecview.util.getCssValueFormat(n)})},isVisible:function(){return ecount.widget.isVisible(this.$contents[0])},getButton:function(n){n=n==="search"?"tgHeaderSearch":"tgHeaderOption";for(var t=0,i=this.buttons.length;t<i;t++)if(n===this.buttons[t].id)return this.buttons[t];return null},getItemCount:function(){return this.contentsOptions&&this.contentsOptions.items?this.contentsOptions.items.length:0},height:function(){return this.$el.parents(".wrapper-title").outerHeight()},serialize:function(){var n=ecount.layout.container.prototype.serialize.apply(this,arguments),t,i;return!$.isNull(n)&&this._quickSearchSerializeKey&&(t={},i=this.getQuickSearchControl().serialize(this._quickSearchSerializeKey),t[i.key]=i.value,$.isArray(n.result)?n.result.push(t):$.extend(n.result,t)),n},serializeWrap:function(){var n=ecount.layout.container.prototype.serializeWrap.apply(this,arguments);if(!$.isNull(n)&&this._quickSearchSerializeKey){var t={},i={},r=this.getQuickSearchControl(),u=r.serialize(this._quickSearchSerializeKey);i[u.key]=u.value;t[r.id]=i;$.isArray(n.result)?n.result.push(t):$.extend(n.result,t)}return n},extract:function(){var n=ecount.layout.container.prototype.extract.apply(this,arguments),t,i;return!$.isNull(n)&&this._quickSearchSerializeKey&&(t={},i=this.getQuickSearchControl().extract(),t[i.id]=i,$.isArray(n.result)?n.result.push(t):$.extend(n.result,t)),n},getControl:function(n){return n=="tgHeaderOption"?this.getButton(n):n=="tgHeaderSearch"?this.getButton("search"):ecount.layout.prototype.getControl.apply(this,arguments)}});ecount.layout.header.customerSupport||(ecount.layout.header.customerSupport={});ecount.layout.header.customerSupport._export=function(){return{prop:{title:null,buttons:null,itemList:null,$contents:null,template:'<div class="wrapper-toolbar"><div class="pull-left"><\/div><div class="pull-right"><\/div><\/div>',init:function(){ecount.layout.container.prototype.init.apply(this,arguments);this.buttons=[];this.itemList=[];this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.ecIKey=ecount.global.registerEcInstance(this)},render:function(n){this.hidden&&n.parent().addClass("hidden");this._isHideHeaderTitle===!0&&(this.template="<div><\/div>");ecount.layout.container.prototype.render.apply(this,arguments);this._createTitle();this._createButtonList();this.onLoadItems()},_createTitle:function(){var t=$("<span />").text(this.title||"").addClass("page-name"),n;t.appendTo(this.$el.find(".pull-left"));this.layout&&(n=new ecount.layout[this.layout.__type](this.layout),n.render(this.$el.find(".pull-right")))},_createButtonList:function(){var r,e;if(this.btnItems){var o=widget.generator.control(),u={},n={},t={},f={},i="";for(r=0,e=this.btnItems.length;r<e;r++)n=this.btnItems[r],i=n.controlType,u=n.direction==="left"?this.$el.find(".pull-left"):n.direction==="right"?this.$el.find(".pull-right"):n.direction=="bottom"?this.$el.closest(".header"):this.$el,i&&ecount.widget.createDisplayID(n,"btn",widget.generator.HEADER),f=ecount.common.createNamespace(i),this.initializer&&ecount.control.initializeByUserSetting(this.initializer,n),t=new f(n),t.delegator=this.delegator,t.render(u),i&&this.itemList.push(t),this.buttons.push(t)}},getItemCount:function(){return this.contentsOptions&&this.contentsOptions.items?this.contentsOptions.items.length:0},height:function(){return this.$el.parents(".wrapper-title").outerHeight()}},create:function(){var n=$.extend({},this.prop);ecount.layout.header.customerSupport=$.Class(ecount.layout.container,n)}}};ecount.layout.header.board||(ecount.layout.header.board={});ecount.layout.header.board._export=function(){return{prop:{template:'<div class="wrapper-board-share-people"><div id="div-board-share-category" class="wrapper-toolbar board-share-category"><div id="div-add-Receiver" class="btn-group link-group"><a href="javascript:;" class="dropdown-toggle"><span class="fa fa-user-plus"><\/span><\/a><span class="inline-divider" data-receiver="type"><\/span><\/div><div id="div-board-progress-status" class="btn-group _btn-group-select"><a id = "a_progress_id" href="javascript:;" class="dropdown-toggle"><\/a><\/div><\/div><div id="div-board-share-people" class="wrapper-toolbar board-share-people hidden"><\/div><\/div>',receiverCountTemplate:'<a href="javascript:;" id="link-user-A" data-receiver="A" class="view-share-A">{{ALL}}<\/a><span class="inline-divider" data-receiver="type"><\/span><a href="javascript:;" id="link-user-G" data-receiver="G" class="view-share-to">{{G}}<\/a><a href="javascript:;" id="link-user-R" data-receiver="R" class="view-share-cc">{{R}}<\/a><a href="javascript:;" id="link-user-S" data-receiver="S" class="view-share-pp">{{S}}<\/a><a href="javascript:;" id="link-user-C" data-receiver="C" class="view-share-cs">{{C}}<\/a><span class="inline-divider" data-receiver="type"><\/span>',receiverDetailHtmlTemplate:'<span class="share-{0}">{1}<\/span>',districtTemplate:'<span class="inline-divider"><\/span>',init:function(){ecount.layout.container.prototype.init.apply(this,arguments);this.totalCnt=0;this.receiverGCnt=0;this.receiverGAllChecked=!1;this.receiverRCnt=0;this.receiverRAllChecked=!1;this.receiverSCnt=0;this.receiverSAllChecked=!1;this.receiverCSCnt=0;this.receiverClassType={G:"to",R:"cc",S:"pp",C:"cs",A:"all"};this.receiverData={G:[],R:[],S:[],C:[],A:[],GD:[],RD:[],SD:[]};this._onclicked=!1;this._eventID=ecount.common.uuid("event");this.callbackID=ecount.global.registerCallback(this.ecPageID,this.onMessage,this);this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.isUserInTo=!1;this.isUserInCc=!1;this.isUserInShared=!1;this.isUserInCs=!1;this.itemList=[];this._serviceKey=ecount.common.makeServiceKey(this.ecPath,"board")},render:function(n){ecount.layout.container.prototype.render.apply(this,arguments);this.makeReceiver();this.$addGroup=this.$el.find("#div-add-Receiver, #div-board-progress-status");this.makeReceiverAddLayer();this.makeProgressStatus(n);this.setUserIn();this._bindEvent();this.createItems(this.contentsOptions.items,this.$el);this.onLoadItems()},makeProgressStatus:function(n){var u=this.boardProgressStatusOptions||[],i=this.boardProgressStatusValue||"",r=u.find(function(n){return n.value==i})||{},t=n.find("div#div-board-progress-status #a_progress_id");t&&(t.html(r.label),t.attr("value",i),t.attr("name",r.label))},makeReceiverAddLayer:function(){var n=ecount.resource;this.items=[{id:"add-receiver-G",label:n.LBL10028},{id:"add-receiver-R",label:n.LBL01684},];this._isCsShared==!0&&this.items.push({id:"add-receiver-C",label:"C-Portal"});this._isShared==!0&&this.items.push({id:"add-receiver-S",label:n.LBL05639})},_ON_RECEIVER_CLICK:function(n){this.delegator&&this.delegator.triggerEvent("dropdown.click",n);this.hideOpenPopuplayer()},makeReceiver:function(n){var t,r,u,i;for(this.initializationReceiver(),arguments.length==0&&(n=this.receiverDatas),r="",u=0;u<n.length;u++)if(i="",t=n[u],t.RECEIVER_TYPE=="G"?(this.receiverGCnt++,this.receiverGCnt>1&&(i=", "+t.USER_NAME),t.RECEIVER_ALL_CHECKED==!0&&this.receiverGAllChecked==!1&&(this.receiverGAllChecked=!0)):t.RECEIVER_TYPE=="R"?(this.receiverRCnt++,this.receiverRCnt>1&&(i=", "+t.USER_NAME),t.RECEIVER_ALL_CHECKED==!0&&this.receiverRAllChecked==!1&&(this.receiverRAllChecked=!0)):t.RECEIVER_TYPE=="S"?(this.receiverSCnt++,this.receiverSCnt>1&&(i=", "+t.USER_NAME)):this._isCsShared==!0&&t.RECEIVER_TYPE=="C"&&(this.receiverCSCnt++,this.receiverCSCnt>1&&(i=", "+t.USER_NAME)),this.receiverData[t.RECEIVER_TYPE].push(t.USER_ID),r+=String.format(this.receiverDetailHtmlTemplate,this.receiverClassType[t.RECEIVER_TYPE],i||t.USER_NAME),$.inArray(t.USER_ID,this.receiverData.A)==-1&&(this.totalCnt++,this.totalCnt>1&&(i=", "+t.USER_NAME),this.receiverData.A.push(t.USER_ID),r+=String.format(this.receiverDetailHtmlTemplate,this.receiverClassType.A,i||t.USER_NAME)),t.USER_IN)switch(t.RECEIVER_TYPE){case"G":this.isUserInTo=!0;break;case"R":this.isUserInCc=!0;break;case"S":this.isUserInShared=!0;break;case"C":this.isUserInCs=!0}this.$el.find("#div-board-share-people").append(r);this.$el.find("#div-board-share-category").prepend(this.makeDistrict());this.$el.find("#div-board-share-category > a[data-receiver]").on("click",this.receiverDetailToggle.bind(this));this.receiverRCnt==0&&this.$el.find("#link-user-R").addClass("hidden");this.receiverSCnt==0&&this.$el.find("#link-user-S").addClass("hidden");this.receiverCSCnt==0&&this.$el.find("#link-user-C").addClass("hidden");arguments.length>0&&this.receiverDetailToggle()},makeDistrict:function(){var n=ecount.resource,t=n.LBL08019;return ecount.widget.replaceAttr(this.receiverCountTemplate,{ALL:"All("+(this.getReceiverAllChecked()?t:this.totalCnt)+")",G:n.LBL10028+"("+(this.getReceiverAllChecked("G")?t:this.receiverGCnt)+")",R:n.LBL01684+"("+(this.getReceiverAllChecked("R")?t:this.receiverRCnt)+")",S:n.LBL05639+"("+(this.getReceiverAllChecked("S")?t:this.receiverSCnt)+")",C:"C-Portal("+this.receiverCSCnt+")"})},setUserIn:function(){this.isUserInTo==!0&&this.$el.find("a#link-user-G").addClass("text-bold");this.isUserInCc==!0&&this.$el.find("a#link-user-R").addClass("text-bold");this.isUserInShared==!0&&this.$el.find("a#link-user-S").addClass("text-bold");this.isUserInCs==!0&&this.$el.find("a#link-user-C").addClass("text-bold")},_bindEvent:function(){this.$el.find("#div-add-Receiver").on("click",this.userAddToggle.bind(this))},setEventForprogressStatus:function(n,t){if(n==!0)this.$el.find("#div-board-progress-status").on("click",function(){ecount.alert(String.format("{0}\r\n- {1} {2}({3})",ecount.resource.MSG00141,t,ecount.resource.LBL12503,ecount.resource.LBL14667))});else this.$el.find("#div-board-progress-status").on("click",this.progressStatusAddToggle.bind(this))},getDataProgressStatus:function(n){var t=n.control.$el.find("div#div-board-progress-status #a_progress_id"),r={},i;return t&&(r.oldValue=t.attr("value"),r.oldName=t.attr("name"),i=n.control.boardProgressStatusOptions.find(function(t){return t.value==n.value}),r.value=i.value,r.name=i.label,t.html(i.label),t.attr("value",i.value),t.attr("name",i.label)),r},setOldDataProgressStatus:function(n,t){var i=n.control.$el.find("div#div-board-progress-status #a_progress_id");i&&(i.html(t.oldName),i.attr("value",t.oldValue),i.attr("name",t.oldName))},progressStatusAddToggle:function(){if(this._onclicked==!0)ecount.layer.hide(this._serviceKey);else{var t=this.boardProgressStatusValue,n=this.boardProgressStatusOptions.where(function(n){return n.value!=t}),i={type:"dropdown",ownerKey:this.ecIKey,serviceKey:this._serviceKey,ecPageID:this.ecPageID,popupID:this.popupID,popupLevel:this.popupLevel,popupType:this.popupType,boundary:ec$.getZoomedBoundary(this.$addGroup[1]),showingUpDelay:0,isSetDropdownSize:n.length>8,items:n};ecount.layer.show(i)}return!1},userAddToggle:function(){if(this._onclicked==!0)ecount.layer.hide(this._serviceKey);else{var n={type:"dropdown",ownerKey:this.ecIKey,serviceKey:this._serviceKey,ecPageID:this.ecPageID,popupID:this.popupID,popupLevel:this.popupLevel,popupType:this.popupType,boundary:ec$.getZoomedBoundary(this.$addGroup[0]),showingUpDelay:0,items:this.items};ecount.layer.show(n)}return!1},showOpenPopuplayer:function(){if(this._onclicked==!1){this.isShowOpenPopuplayer(!0);var n=this.hideOpenPopuplayer.bind(this);$(document).bind("click."+this._eventID,n)}},hideOpenPopuplayer:function(){if(this._onclicked){this.isShowOpenPopuplayer(!1);var n=this.hideOpenPopuplayer.bind(this);$(document).unbind("click."+this._eventID,n)}},isShowOpenPopuplayer:function(n){this._onclicked=n;n==!0?this.$el.find("#div-add-Receiver").addClass("open"):this.$el.find("#div-add-Receiver").removeClass("open")},receiverDetailToggle:function(n){var u=this.$el.find("#div-board-share-category > a[data-receiver]"),t=this.$el.find("#div-board-share-people"),f=t.find("span[class^='share-']"),i,r;n!=null||n!=undefined?(i=n.target||n.srcElement,r=i.getAttribute("data-receiver"),$(i).hasClass("label label-primary")==!0?($(i).removeClass("label label-primary"),t.addClass("hidden")):(u.removeClass("label label-primary"),$(i).addClass("label label-primary"),t.removeClass("hidden"),f.addClass("hidden"),$target=t.find("span[class^='share-"+this.receiverClassType[r]+"']"),$target.removeClass("hidden"))):t.addClass("hidden");this.delegator&&this.delegator.triggerEvent("page.adjustContentsDimensions")},openPopup:function(n){var f;this.hideOpenPopuplayer();var t=this,n=n.targetID.split("-")[4],u=ecount.resource,i,r;n!="C"?(i="/ECERP/Popup.Search/EGD002P_02",r=u.LBL03682):(i="/ECERP/Popup.Search/EGM025P_06",r=u.LBL00330);f={width:450,height:500,url:i,responseID:t.callbackID,Title:"",name:r,Type:!1,selectedCodes:t.receiverData[n].join(ecount.delimiter),Receiver_Type:n};this.delegator&&this.delegator.triggerEvent("control.openPopup",{targetID:t.id,parameter:$.extend({},f),handler:function(n,i,r,u){t.responseID=i;n.popupLevel=u;n.__ecPageID=t.ecPageID;n.alreadyIncludedLayout=!0;var f={url:n.url,name:n.name,param:n,popupType:n.popupType,popupLevel:u,parentPageID:r||t.parentPageID};ecount.popup.openWindow(f)}})},onMessage:function(n,t){var i=t.Receiver_Type,r=this.getSeletedCode(t.data,i);this.delegator.triggerEvent("dropdown.click",{targetID:"on-Receiver-Add",Receiver_Type:i,codes:r});t.callback&&t.callback()},getSeletedCode:function(n,t){var u,i,r;if(n==undefined||n==null)return[];for(u=[],r=0;r<n.length;r++)i=n[r],u.push(t!="C"?{USER_ID:i.ID,USER_NAME:i.UNAME}:{USER_ID:i.CUST,USER_NAME:i.COMPANY_DES});return u},initializationReceiver:function(){this.totalCnt=0;this.receiverGCnt=0;this.receiverRCnt=0;this.receiverSCnt=0;this.receiverCSCnt=0;this.receiverData={G:[],R:[],S:[],C:[],A:[],GD:[],RD:[],SD:[]};this.$el.find("#div-board-share-people").find("span").remove();this.$el.find("#div-board-share-category > [data-receiver]").remove()},getItemCount:function(){return 0},height:function(){return this.$el.outerHeight()},getReceiverAllChecked:function(n){var t=!1;switch(n){case"G":t=this.receiverGAllChecked;break;case"R":t=this.receiverRAllChecked;break;case"S":t=this.receiverSAllChecked;break;default:t=this.receiverGAllChecked||this.receiverRAllChecked||this.receiverSAllChecked}return t},showAllRecievers:function(){var n=this.$el.find("#div-board-share-category"),t=n.children().not("._btn-group-select"),i=n.children("._btn-group-select");t.show();i.find("button[data-index=0]").addClass("ml-10")},hideAllRecievers:function(){var n=this.$el.find("#div-board-share-category"),t=n.children().not("._btn-group-select"),i=n.children("._btn-group-select");t.hide();i.find("button[data-index=0]").removeClass("ml-10")}},create:function(){var n=$.extend({},this.prop);ecount.layout.header.board=$.Class(ecount.layout.container,n)}}};ecount.layout.header.userGroup||(ecount.layout.header.userGroup={});ecount.layout.header.userGroup._export=function(){return{prop:{template:'<div class="wrapper-board-share-people"><div class="wrapper-toolbar board-share-category"><\/div><div class="wrapper-toolbar board-share-people"><\/div><\/div>',groupTemplate:'<a href="javascript:;" data-id={{id}} class="{{css}}">{{label}}<\/a>',userInfoTemplate:'<span data-id="{{id}}">{{label}}<\/span>',isShowAll:!0,isShowAdd:!0,groups:[],allLabel:"LBL08019",allUsers:[],init:function(){ecount.layout.container.prototype.init.apply(this,arguments);this._onclicked=!1;this._eventID=ecount.common.uuid("event");this.itemList=[];this._serviceKey=ecount.common.makeServiceKey(this.ecPath,"userGroup")},render:function(n){this.hidden&&n.parent().addClass("hidden");ecount.layout.container.prototype.render.apply(this,arguments);this._drawGroups();this._createContents();this.onLoadItems()},_createContents:function(){this.createItems(this.contentsOptions.items,this.$el)},_settingUserGroups:function(){var n='<span class="inline-divider"><\/span>',t,i;this.allUsers=[];this.$shareCategory=this.$el.find(".board-share-category");this.$sharePeople=this.$el.find(".board-share-people");this.isMailHeaderView&&this.$sharePeople.addClass("board-share-etc-info");this.$shareCategory.empty().off("*");this.$sharePeople.empty();this.$allGroup=$('<span data-id="header-all-group"><\/span>');this.$userGroup=$('<span data-id="header-user-group"><\/span>');this.$attachmentGroup=$('<span data-id="header-attachment-group"><\/span>');this.$addGroup=$('<div class="btn-group link-group"><a data-id="link-group" href="javascript:;" class="dropdown-toggle"><span class="fa fa-user-plus" data-function="addGroup"><\/span><\/a><\/div>');this.isShowAll&&(this.$shareCategory.append(this.$allGroup),this.$shareCategory.append($(n)));this.$shareCategory.append(this.$userGroup);this.isShowAdd&&(this.$shareCategory.append($(n)),this.$shareCategory.append(this.$addGroup));this.isShowAttachment&&(this.$shareCategory.append($(n)),this.$shareCategory.append(this.$attachmentGroup));t="";i="";this.progressMark&&this.progressMark.progressTitle1&&(t=this.progressMark.progressTitle1,i=this.progressMark.progressTitle2);this.$Progresstitle=$([' <span class="wrapper-title-notification">','<span id="progressMarkF" class="label label-primary title-notification-heading">',t,"<\/span>",'<span id="progressMarkS" class="label label-primary title-notification-contents" style="display:none">',i,"<\/span>","<\/span>"].join(""));this.$Progresstitle.find("#progressMarkF").bind("click",this.clickProgressHandler.bind(this));this.$shareCategory.append(" ").append(this.$Progresstitle);this.$sharePeople.hide()},_drawGroups:function(){this._settingUserGroups();for(var n=0,t=this.groups.length;n<t;n++)this._createUserGroup(this.groups[n]);this.isShowAll&&this._createAllGroup();this.isShowAdd&&this._createAddGroup();this.isShowAttachment&&this._createAttachmentGroup();this.isSharePeopleOpen&&this.$sharePeople.show()},_createUserGroup:function(n){var f=ecount.resource,e=n.LABEL,l=f[n.LABEL],r,u,o,s,t,h,i,c;u={id:e,label:String.format("{0}({1})",l,n.IS_ALL?f[this.allLabel]:n.USER_LIST.length),css:"display-inline-block"};this.isSharePeopleOpen&&(u.css="label label-primary");r=$(ecount.widget.replaceAttr(this.groupTemplate,u));r.on("click",this._ON_USER_GROUP_CLICK.bind(this));for(this.$userGroup.append(r),i=0,c=n.USER_LIST.length;i<c;i++)t=n.USER_LIST[i],this.isCustomDetail||(o={id:e,label:i==0?t.USER_NAME:String.format(", {0}",t.USER_NAME)},this.$sharePeople.append(ecount.widget.replaceAttr(this.userInfoTemplate,o))),h=this.allUsers.any(function(n){return n.USER_ID.toString()==t.USER_ID.toString()}),h||(this.isCustomDetail||(s={id:this.allLabel,label:this.allUsers.length==0?t.USER_NAME:String.format(", {0}",t.USER_NAME)},this.$sharePeople.append(ecount.widget.replaceAttr(this.userInfoTemplate,s))),this.allUsers.push(t))},_createAllGroup:function(){var i=ecount.resource,r=!1,n={},t;r=this.groups.any(function(n){return n.IS_ALL==!0});n={id:this.allLabel,label:String.format("{0}({1})",i[this.allLabel],r?i[this.allLabel]:this.allUsers.length),css:"display-inline-block"};this.isSharePeopleOpen&&(n.css="label label-primary");t=$(ecount.widget.replaceAttr(this.groupTemplate,n));t.on("click",this._ON_USER_GROUP_CLICK.bind(this));this.$allGroup.append(t)},_createAddGroup:function(){var u=ecount.resource,n,i=[],t,r;if(this.groups.length>1){for(t=0,r=this.groups.length;t<r;t++)n=this.groups[t],n.IS_SHOW_ADD&&i.push({id:"add-user",label:u[n.LABEL],value:n.LABEL});this.$addGroup.on("click",function(n){if(this._onclicked==!0)ecount.layer.hide(this._serviceKey);else{var t={type:"dropdown",ownerKey:this.ecIKey,serviceKey:this._serviceKey,ecPageID:this.ecPageID,popupID:this.popupID,popupLevel:this.popupLevel,popupType:this.popupType,boundary:ec$.getZoomedBoundary(this.$addGroup[0]),showingUpDelay:0,items:i};ecount.layer.show(t)}return n.preventDefault(),!1}.bind(this))}else this.groups.length==1},hasIconCSS:function(n){return n&&n.filter(function(n){return!!n.iconCSS||!!n.liCss}).length>0?!0:!1},_createAttachmentGroup:function(){function t(n,t,i){return{id:n,label:String.format("{0}({1})",ecount.resource[t],i),css:"display-inline-block"}}var i=$(ecount.widget.replaceAttr(this.groupTemplate,t("approvalRequiredSlip","LBL90149",this.approvalRequiredSlip.length))),n;i.on("click",this._ON_CLICK_APPROVAL_REQ_SLIP_GROUP.bind(this));if(this.$attachmentGroup.append(i),this.attchFileCallback){n=$(ecount.widget.replaceAttr(this.groupTemplate,t("attachFile","LBL02760",this.attachFileCnt)));n.on("click",this._ON_CLICK_ATTACHMENT_GROUP.bind(this))}this.$attachmentGroup.append(n)},onProgressShow:function(){this.$Progresstitle&&this.$el.find("span#progressMarkF").text()!=""&&this.$el.find("span#progressMarkS").text()!=""&&this.$Progresstitle.find("#progressMarkS").css("display","block").delay(2e3).fadeOut()},clickProgressHandler:function(){this.onProgressShow()},ON_CLICK:function(n,t,i,r){t.target.getAttribute("data-function")=="addGroup"&&(r.targetID="list-dropdown-add-user",r.value=this.groups[0].LABEL)},_ON_USER_GROUP_CLICK:function(n){var t=$.isString(n)?this.$el.find(String.format("a[data-id={0}]",n)).first():$(n.target||n.srcElement),i=this.$el.find("a[data-id]"),u=t.attr("data-id"),r;($.isString(n)||n.preventDefault(),this.$sharePeople.hide(),$.isEmpty(n))||(t.hasClass("label label-primary")==!0?this.isCustomDetail?i.removeClass("label label-primary"):t.removeClass("label label-primary"):(i.removeClass("label label-primary"),this.isCustomDetail&&this.onClick&&typeof this.onClick=="function"?(i.addClass("label label-primary"),this.onClick()):(t.addClass("label label-primary"),this.$sharePeople.find("span").hide(),r=String.format("span[data-id='{0}']",u),this.$sharePeople.find(r).show()),this.$sharePeople.show()),this.delegator&&this.delegator.triggerEvent("page.adjustContentsDimensions"))},_ON_ADD_USER_CLICK:function(n){var t;n.type&&n.type=="click"?t={targetID:"list-dropdown-add-user",type:"dropdown.click",value:$(n.currentTarget).attr("data-key")}:(t=n,this.hideAddLayer());this.delegator&&this.delegator.triggerEvent("dropdown.click",t)},_ON_CLICK_APPROVAL_REQ_SLIP_GROUP:function(n){this.showDropdownLayer(n)},_ON_CLICK_ATTACHMENT_GROUP:function(n){return this.attchFileCallback?this.attchFileCallback(n,this.showDropdownLayer.bind(this)):this.showDropdownLayer(n),!1},showDropdownLayer:function(n,t){var i=$(n.target).attr("data-id"),r;this[i+"ServiceKey"]=ecount.common.makeServiceKey(this.ecPath,i);this.attachFileInfo?t=this.attachFileInfo:_.isEmpty(t)&&(t=this[i]);r={type:"dropdown",ownerKey:this.ecIKey,serviceKey:this[i+"ServiceKey"],ecPageID:this.ecPageID,popupID:this.popupID,popupLevel:this.popupLevel,popupType:this.popupType,boundary:ec$.getZoomedBoundary(n.currentTarget),showingUpDelay:0,items:t};this.hasIconCSS(t)&&(r.hasDropdownLayerIcon=!0,r.isSetDropdownSize=!0);ecount.layer.show(r);n.preventDefault()},getItemCount:function(){return this.contentsOptions&&this.contentsOptions.items?this.contentsOptions.items.length:0},showAddLayer:function(){if(this._onclicked==!1){this._onclicked=!0;this.$addGroup.addClass("open");var n=this.hideAddLayer.bind(this);$(document).bind("click."+this._eventID,n)}},hideAddLayer:function(){if(this._onclicked==!0){this._onclicked=!1;this.$addGroup.removeClass("open");var n=this.showAddLayer.bind(this);$(document).unbind("click."+this._eventID,n)}},changeGroup:function(n,t){var i={};!$.isEmpty(n)&&$.isArray(t)&&t.length>0&&(i=this.groups.first(function(t){return t.LABEL==n}),$.isEmpty(i)||(i.USER_LIST=t),this._drawGroups())},changeAttachGroup:function(n,t){n&&t&&(this[n]=t,this._drawGroups())},showGroup:function(n){var t,i;$.isEmpty(n)||(t=this.$userGroup.find(String.format("a[data-id='{0}']",n)),t.length>0&&t.show(),i=this.dropdownMenu.$el.find(String.format("a[data-value='{0}']",n)),i.length>0&&i.show())},hideGroup:function(n){var t,i;$.isEmpty(n)||(t=this.$userGroup.find(String.format("a[data-id='{0}']",n)),t.length>0&&t.hide(),i=this.dropdownMenu.$el.find(String.format("a[data-value='{0}']",n)),i.length>0&&i.hide())},addGroup:function(n){var t=this.groups.any(function(t){return t.LABEL==n.LABEL});$.isEmpty(n)||t||(this.groups.push(n),this._drawGroups())},deleteGroup:function(n){$.isEmpty(n)||(this.groups=this.groups.filter(function(t){return t.LABEL!=n}),this._drawGroups())},getGroup:function(n){return this.groups.first(function(t){return t.LABEL==n})},toggleGroup:function(n){$.isEmpty(n)&&(n=this.allLabel);this._ON_USER_GROUP_CLICK(n)},addSharePeopleCustom:function(n,t){this.$sharePeople.html(n);arguments.length>1&&(this.$el.find("a[data-id]").removeClass("label label-primary"),t===!0?this.$sharePeople.show():this.$sharePeople.hide());this.delegator&&this.delegator.triggerEvent("page.adjustContentsDimensions")},getButton:function(){return null}},create:function(){var n=$.extend({},this.prop);ecount.layout.header.userGroup=$.Class(ecount.layout.container,n)}}};ecount.class("ecount.layout.header.qna","ecount.layout.container",{template:'<div class="online-manual-view-header"><div class="online-manual-view-caption"><\/div><div class="online-manual-view-title online-manuabookmark-add"><\/div><div class="online-manual-view-data"><\/div><\/div>',init:function(){ecount.layout.container.prototype.init.apply(this,arguments);this.itemList=[]},render:function(){ecount.layout.container.prototype.render.apply(this,arguments);this.createTitle();this.createControl()},createTitle:function(){this.title&&(this.$title=this.$el.find("div.online-manual-view-title"),this.$title&&(this.$title.text(this.title),this.bindEvent()))},bindEvent:function(){},createControl:function(){this.createItems(this.btnItems,this.$el.find("div.online-manual-view-data"))},getItemCount:function(){return this.btnItems?this.btnItems.length:0},clickHandler:function(n){this.delegator&&this.delegator.triggerEvent("bookmark.click",n)},destroy:function(){this.title&&this.$title&&this.$title.off();ecount.layout.prototype.destroy.call(this)}});ecount.class("ecount.layout.subContainer","ecount.layout",{itemList:null,init:function(){ecount.layout.prototype.init.apply(this,arguments);$.isNull(this.itemList)&&(this.itemList=[]);this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer)},render:function(){ecount.layout.prototype.render.apply(this,arguments);this.renderAfter&&this.renderAfter(arguments);this.ecTransaction.start()},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},createItems:function(n,t){var i,r,u,f;if(n&&n.length!==0)for(r=0,u=n.length;r<u;r++)i=n[r],i.itemIndex=r,i.__type===widget.generator.CONTROL?(ecount.control.initializeByUserSetting(this.initializer,i),ecount.widget.createDisplayID(i,"btn",this.__target),this._setControlOptions(i),f=ecount.common.createNamespace(i.controlType),i=new f(i)):(this._setLayoutOptions(i),i=new ecount.layout[i.__type](i)),this.itemList.push(i),i.render(t||this.$el),i.$el.after(" "),i=null},_setControlOptions:function(n){n.__pnode=this.__type;n.containerName=this.containerName;n.pId=this.id;n.gridID="";n.tabID=this.tabId;n.ecTransaction=this.ecTransaction;n.delegator=this.delegator;this.events&&(n.containerDelegator=this.events)},_setLayoutOptions:function(n){n.ecPageID=this.ecPageID;n.tabId=this.tabId;n.onSync=this.onSync;n.containerName=this.containerName;this.pageType&&n.__type==widget.generator.FORM&&(n.pageType=this.pageType);n.delegator=this.delegator;this.events&&(n.containerDelegator=this.events);n.__type===widget.generator.TABPANE?n.colSize=this.colSize:n.__type===widget.generator.TABCONTENTS&&(this.onSingleMode=n.onSingleMode)},getItemCount:function(){return this.itemList.length},setWidth:function(n){n||(n="");this._width=n;this.$el.css("width",n)},getGrid:function(n,t){var i,r,u;return t!==!1&&(t=this.onSingleMode?this.activeTabId:t||this.currentTabId),t instanceof Object?(r=t[0].parentTabId,u=t[1].childTabId,i=this.find(function(t){return t&&t.__type==widget.generator.GRID&&(!t.tabId||!r||t.tabId==r||!t.tabId||!u||t.tabId==u)&&(!n||t.id===n)}),t=!1):i=this.find(function(i){return i.__type==widget.generator.GRID&&(!n||i.id===n)&&(!t||i.tabId===t)}),n===!1&&t===!1?i:i?i[0]:null},isVisible:function(){return ecount.widget.isVisible(this.$el[0])},getLayout:function(n,t,i,r){var f,u;return n=n.toUpperCase(),n=="TABCONTENTS"&&(f=t,t=null,i=0),u=this.find(function(i){return i.__type==widget.generator[n]&&(!t||t==i.id)&&(!r||i.tabId==r)}),$.isNull(i)||(u.length>i?(u=u[i],$.isNull(f)||n!="TABCONTENTS"||(u=u.getTabPane(f))):u=null),u},removeItem:function(n){this.itemList[n]&&(this.itemList[n].destroy(),this.itemList.splice(n,1))},removeAll:function(){for(var n=0,t=this.itemList.length;n<t;n++)this.itemList[n].destroy(),this.itemList[n]=null,delete this.itemList[n];this.itemList.length=0}});ecount.class("ecount.layout.settingPanelContainer","ecount.layout.subContainer",{template:'<div class="wrapper-function-setup {{css}}"><\/div>',css:null,init:function(){ecount.layout.subContainer.prototype.init.apply(this,arguments)},render:function(){this.template=ecount.widget.replaceAttr(this.template,{css:this.css});ecount.layout.subContainer.prototype.render.apply(this,arguments)},renderAfter:function(){this.header&&this.createHeader(this.header);this.items&&this.createBody(this.items);this.footer&&this.createFooter(this.footer)},createHeader:function(n){var t=$('<div class="function-setup-header"><\/div>'),i;n&&(n.title&&t.append($('<div class="wrapper-sub-title">'+n.title+"<\/div>")),n.description&&t.append($('<div class="description">'+n.description+"<\/div>")));n.items&&(i=$('<div class="pull-right"><\/div>'),this.createItems(n.items,i),t.append(i));this.$el.append(t)},createBody:function(n){var t=$('<div class="function-setup-contents"><\/div>');this._align&&this._align=="center"&&t.addClass("text-center");this.createItems(n,t);this.$el.append(t)},createFooter:function(n){var t=$('<div class="function-setup-footer"><\/div>');n.layout?this.createItems(n.layout,t):n.toolbar&&this.createItems(n.toolbar,t);this.$el.append(t)}});ecount.class("ecount.layout.footer","ecount.layout",{itemList:null,toolbar:null,_loadedItemCount:0,init:function(){ecount.layout.prototype.init.apply(this,arguments);this.events=new ecount.events(this);this.events.on({"button.click":this.clickHandler,"anchor.click":this.clickHandler,"control.change":this.changeHandler,"item.onload":this.onLoadItem,"dropdown.click":this.clickDropdownHandler,"control.openPopup":this.openPopupHandler,scope:this});this.ecIKey=ecount.global.registerEcInstance(this)},render:function(n){this.$el=n;this.hidden&&this.$el.addClass("hidden");this.toolbar?(this.itemList=[],this.createToolbar(this.toolbar)):ecount.global.setTimeout(this.ecPageID,function(){this.onLoadItem(null,!0)}.bind(this),0);var t=this.addedOption;$.isNull(t)||($.isArray(t.targetID)||(t.targetID=[t.targetID]),this[t.type+"Controls"](t.targetID,t.exceptID||[]))},destroy:function(){ecount.layout.prototype.destroy.call(this)},createToolbar:function(n){var i,t,r;for(n.length===0&&ecount.global.setTimeout(this.ecPageID,function(){this.onLoadItem(null,!0)}.bind(this),0),t=0,r=n.length;t<r;t++)n[t].delegator=this.events,n[t].ecPageID=this.ecPageID,n[t].containerName=this.__type,i=new ecount.layout.toolbar(n[t]),i.render(this.$el),this.itemList.push(i)},hideControls:function(n){for(var i,t=0,r=n.length;t<r;t++)i=this.getControl(n[t]),i&&i.hide()},showControls:function(n,t){for(var e,f,r,i=0,u=this.itemList.length;i<u;i++)e=this.itemList[i],e.itemList.forEach(function(n){t.contains(n.id)==!1&&n.hide()});for(i=0,u=n.length;i<u;i++)f=n[i],$.isArray(f)?(r=this.getControl(f[0]),r&&r.removeGroupItem&&r.removeGroupItem()):r=this.getControl(f),r&&r.show()},clickHandler:function(n){this.delegator&&this.delegator.triggerEvent("button.click",n)},changeHandler:function(n){this.delegator&&this.delegator.triggerEvent("control.change",n)},clickDropdownHandler:function(n){this.delegator&&this.delegator.triggerEvent("dropdown.click",n)},openPopupHandler:function(n){this.delegator&&this.delegator.triggerEvent("control.openPopup",n)},get:function(n){return this.itemList[n]},getControl:function(n){for(var i,t=0,r=this.itemList.length;t<r;t++)if(this.itemList[t].__type===widget.generator.TOOLBAR&&(i=this.itemList[t].getControl(n),i))return i;return null},size:function(){for(var t=0,n=0,i=this.itemList.length;n<i;n++)this.itemList[n].itemList&&(t+=this.itemList[n].itemList.length);return t},isShow:function(){return this.size()>0},isHidden:function(){return this.hidden},onLoadItem:function(n,t){this._loadedItemCount++;(t||this.itemList.length==this._loadedItemCount)&&this.delegator.triggerEvent("container.onload",{target:this.__type,self:this})},getToolbar:function(n,t){var i=this.find(function(i){return i.__type==widget.generator.TOOLBAR&&(t&&!n?i.id:n)==i.id});return i?t?i:i[0]:null}});ecount.class("ecount.layout.additionalSection","ecount.layout.container",{template:null,type:null,itemList:null,colSize:1,init:function(){ecount.layout.container.prototype.init.apply(this,arguments);this.itemList=[]},render:function(n){var i,t,u,f,r;if(this.$el=n,this.hidden&&this.$el.addClass("hidden"),this.colGroup){for(i=$('<div class="row" {{parentAttr}}><\/div>'.replace("{{parentAttr}}",this.colGroupParentAttr||"")),this.items=[],t=0,u=this.colGroup.length;t<u;t++)f=this.colGroup[t].item,f&&(r=$('<div class="col-xs-'+this.colGroup[t].size+'"/>'),this.createItems([this.colGroup[t].item],r),i.append(r));this.$el.append(i)}else this.createItems(this.items)},get:function(n){return this.itemList[n]},getHtml:function(n){var t="",i;return n&&_.isObject(n)&&n.deleteLink===!0?(i=$("<div><\/div>").html(this.$el.html()),i.find("a").each(function(){$(this).replaceWith($(this).html())}),t=i.html().replace(/text-primary-inverse/g,"bsy").replace(/url\(\"/g,"url(").replace(/.gif"\)/g,".gif)")):t=this.$el.html().replace(/text-primary-inverse/g,"bsy").replace(/url\(\"/g,"url(").replace(/.gif"\)/g,".gif)"),t},scrollTop:function(n){this.$el.scrollTop($.isEmpty(n)?this.$el.height():n)}});ecount.layout.page||(ecount.layout.page={});ecount.layout.page._export=function(){return{prop:{template:'<div class="page page-include page-fluid"><\/div>',isRenderInclude:!0,_isLoadPage:!1,init:function(){ecount.layout.prototype.init.apply(this,arguments)},render:function(n){this.$renderParent=n;ecount.layout.prototype.render.apply(this,arguments);this.isRenderInclude&&this.includePage();this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",event):this.delegator&&this.delegator.triggerEvent("item.onload",event)},reRender:function(n,t){var i=n||this.$renderParent,t=t||{},r=t.formdata;r&&(t.__ecPage__=encodeURIComponent(Object.toJSON({extractDataKey:ecount.runtime.root.ecount.global.registerEcRepository(_.merge({},r))})));_.merge(this.includeParameter,t||{});this.$el&&i&&(this._isLoadPage=!1,this.$el.remove(),this.render(i))},includePage:function(){var n=this,t=this.useContentsClass==!0?"contents contents-fixed contents_inc":"contents_inc";this._isLoadPage!=!0&&(this.__INCLUDE_ECPAGEID=ecount.common.seqIndex(this.pageID),this.$el.attr("data-ecpageid",this.__INCLUDE_ECPAGEID),ecount.page.include(this,function(i,r){var u,f,e;if(n.$el){for(n.pageID=i,n.delegator.triggerEvent("page.beforeLoad",{pageID:i}),u=$(r),f=0,e=u.length;f<e;f++)u[f].tagName=="DIV"&&u[f].className=="contents"&&(u[f].className=t);n.$el.append(u)}},n._sync),this._isLoadPage=!0)},destroy:function(){if(this.instance&&this.instance.preDestroy&&this.instance.preDestroy(),ecount.layout.prototype.destroy.call(this),this.instance){var n=this.instance.ecPageID;window[ecount.page.prefix+n]&&(window[ecount.page.prefix+n]=null,delete window[ecount.page.prefix+n])}},onLoadContents:function(n){this.instance=n;this.itemList=this.instance.contents.itemList;this._ecParent._ecIncludedPageList||(this._ecParent._ecIncludedPageList={});this._ecParent._ecIncludedPageList[this.includeParameter.includeTabId]=this.instance;this.$el.attr("data-includepage-uid",this.instance.ecPageID);this.delegator.triggerEvent("page.afterLoad",{pageID:this.pageID,page:this.instance})}},create:function(){var n=$.extend({},this.prop);ecount.layout.page=$.Class(ecount.layout,n)}}};ecount.class("ecount.layout.tab","ecount.layout",{items:null,delegator:null,currentId:null,useXHR:!1,_currentTabID:null,init:function(){this.dropdownSet={};this._mouseOutTimerID=null;this._validateTime=null;this._isValidated=!1;this.dropdownKeyList=[];this.enableSetItem={};this.mouseHoverInTime=ecount.common.mouseHoverInTime;this.mouseHoverOutTime=ecount.common.mouseHoverOutTime;ecount.layout.prototype.init.apply(this,arguments);this._initPresetOrDynamic();this._setParentTab()},_initPresetOrDynamic:function(){this._usePreset===!0?this._initPreset():this._initDynamicAdd()},_initPreset:function(){if(this._usePreset===!0){this._currentPresetId=null;this._presetMaxIndex=0;this._presetCount=0;this._activatedLayerKey=null;this.LIMIT_TEXT_LENGTH=10;this._widthInfo={settingOnce:!0,allPresetWidth:[],totalWidth:0,EXPAND_WIDTH:0,NEW_PRESET_WIDTH:0,FN_WIDTH:0,enableExpand:!0,isExpanded:!0};this._setPresetStateByAction("initilize");var n=this._presetCount>=this._getIndexRange();this.items.push({id:ecount.layout.TEMP_NEW_TAB_ID,css:"preset tab-add",isDynamicTab:!0,isPreset:!0,hidden:n,name:""});this.items.push({id:ecount.layout.EXPAND_TAB_ID,name:"",css:"pull-right preset preset-more",isDynamicTab:!0,isPreset:!0})}},_initDynamicAdd:function(){this.useDynamicAdd()&&(this.LIMIT_TEXT_LENGTH=50,this.items.push({id:ecount.layout.TEMP_NEW_TAB_ID,dropdownTabItems:this._dynamicDropdownItems,isHiddenAddonButton:!!this._dynamicDropdownItems,activedDropdownTabItemID:ecount.layout.TEMP_NEW_TAB_ID,activedDropdownTabItemLabel:"",name:"",css:"tab-add"}))},_setParentTab:function(){var n={},t=[];this.items.forEach(function(i){i.parentTabId&&(n[i.parentTabId]||(n[i.parentTabId]=[]),n[i.parentTabId].push(i));t.push(i)});this.items.forEach(function(t){n[t.id]&&(t.childTab=n[t.id])})},destroy:function(){this.$el.off();ecount.widget.removeChild(this.$el.remove())},render:function(n){this.setEcIKey();this.$el=n;this.$el[0].ecIKey=this.getEcIKey();this.addItems();this._usePreset&&(this.setDragEvent(),ecount.control.registerLazyRender(this,function(){if(this.setExpand()===!0&&this._widthInfo.enableExpand){var n=this.items.head(function(n){return n.isMainTab===!0}.bind(this));(n&&this.isPresetInOneLine(n.id)||$.isNull(n))&&this.shrinkPresetInOneLine()}ecount.runtime.observe("resize",this.ecPageID,this.persistPresetInOneLine.bind(this))}))},removePreset:function(n){var t=this._getItemIndexById(n);this.items.splice(t,1);this.$el.children("li[id='"+n+"']").remove();this._setPresetStateByAction("remove",n);this._reflowContainerByAction("remove")},showOrHideExpand:function(){var n=this._widthInfo.totalWidth-this._widthInfo.EXPAND_WIDTH,t=this.$el.width(),i=t>n;i?(this.hideTab(ecount.layout.EXPAND_TAB_ID),this._widthInfo.enableExpand=!1,this.expandAllPreset()):(this.showTab(ecount.layout.EXPAND_TAB_ID),this._widthInfo.enableExpand=!0)},expandOrShrinkPreset:function(n){if(this._usePreset===!0&&this._widthInfo.enableExpand===!0){if(n==="shrink")if(this.isPresetInOneLine(this._currentPresetId)===!0)this._setIsExpanded(!0);else return;this._widthInfo.isExpanded?this.shrinkPresetInOneLine():this.expandAllPreset()}},isPresetInOneLine:function(n){var t=this._widthInfo.totalWidth,u=this.$el.width(),i=this._widthInfo.allPresetWidth.slice(),r=!1;return i.reverse(),i.every(function(i){return i.id===n?!1:(t-=i.width,u>=t)?(r=!0,!1):!0}.bind(this)),r},expandAllPreset:function(){this._widthInfo.enableExpand&&this._setIsExpanded(!0);var n=this._widthInfo.allPresetWidth.slice();n.reverse();n.forEach(function(n){this.showTab(n.id)}.bind(this))},shrinkPresetInOneLine:function(){if(this._widthInfo.enableExpand!==!1){this._setIsExpanded(!1);var n=this._widthInfo.totalWidth,i=this.$el.width(),t=this._widthInfo.allPresetWidth.slice();t.reverse();t.every(function(t){return i>=n?!1:(n-=t.width,this.hideTab(t.id),!0)}.bind(this))}},persistPresetInOneLine:function(){function r(){this._setIsExpanded(!1);var i=this._widthInfo.allPresetWidth.filter(function(n){return this.$el.children("li[id='"+n.id+"']").hasClass("hidden")}.bind(this));i.every(function(i){return t>n+i.width?(n+=i.width,this.showTab(i.id),!0):!1}.bind(this))}if(!this._widthInfo.isExpanded&&this._widthInfo.enableExpand!==!1){var t=this.$el.width(),n=this.items.reduce(function(n,t){var i=this.$el.children("li[id='"+t.id+"']");return i.hasClass("hidden")?n:n+=i.outerWidth(!0)}.bind(this),0),i=t<n;i?this.shrinkPresetInOneLine():r.call(this)}},setExpand:function(){var n=this.$el.children("li[id='"+this.items[0].id+"']").width()===0;if(!n)return this._widthInfo.settingOnce?(this._initWidthInfo(),this.showOrHideExpand(),!0):void 0},resetWidthInfoAfterRender:function(){this._widthInfo.EXPAND_WIDTH=$("#__ecExpandTab").outerWidth();this._widthInfo.NEW_PRESET_WIDTH=$("#__ecAddNewTab").outerWidth();this._widthInfo.FN_WIDTH=$(".wrapper-header-search").children(".nav-tabs").children("li").children("a.btn-fn").not(".hide").outerWidth()||0},_initWidthInfo:function(){this._widthInfo.settingOnce=!1;this.resetWidthInfoAfterRender();this._widthInfo.totalWidth=this.items.reduce(function(n,t){return n+this._getPresetWidthById(t.id)}.bind(this),0);this._widthInfo.totalWidth+=this._widthInfo.FN_WIDTH;this.items.forEach(function(n){if(n.isPreset&&!this._isFixedPreset(n.id)){var t=this._getPresetWidthById(n.id),i={id:n.id,width:t};this._widthInfo.allPresetWidth.push(i)}}.bind(this))},_setPresetStateByAction:function(n,t){this._setPresetCountByAction(n);this._setPresetMaxIndexByAction(n);this._setWidthInfoByAction(n,t)},_setPresetMaxIndexByAction:function(n){function t(){var n=0;return this.items.forEach(function(t){var r=(t.id||"").replace("custom",""),i=parseInt(r);n<i&&(n=i)}),n}switch(n){case"initilize":this._presetMaxIndex=t.call(this);break;case"add":this._presetMaxIndex+=1;break;case"remove":this._presetMaxIndex=t.call(this);break;default:return}},_setPresetCountByAction:function(n){var t=this;switch(n){case"initilize":this._presetCount=this.items.filter(function(n){return n.isPreset===!0&&t._isFixedPreset(n.id)===!1}).length;break;case"add":this._presetCount+=1;break;case"remove":this._presetCount-=1;break;default:return}},_setWidthInfoByAction:function(n,t){function i(){var n=t,i=this._getPresetWidthById(n),r=this._presetCount>=this._getIndexRange();r&&(this._widthInfo.totalWidth-=this._widthInfo.NEW_PRESET_WIDTH,this.hideTab(ecount.layout.TEMP_NEW_TAB_ID));this._widthInfo.totalWidth+=i;this._widthInfo.allPresetWidth.push({id:n,width:i})}function r(){var i=t,n=this._widthInfo.allPresetWidth.findIndex(function(n){return n.id===i}.bind(this)),r=this._widthInfo.allPresetWidth[n],u=this.$el.children("li[id='"+ecount.layout.TEMP_NEW_TAB_ID+"']").hasClass("hidden"),f=this._presetCount<this._getIndexRange();f&&u&&(this._widthInfo.totalWidth+=this._widthInfo.NEW_PRESET_WIDTH,this.showTab(ecount.layout.TEMP_NEW_TAB_ID));this._widthInfo.allPresetWidth.splice(n,1);this._widthInfo.totalWidth-=r.width}function u(){var n=t,i=this._widthInfo.allPresetWidth.head(function(t){return t.id===n}.bind(this)),r=this._getPresetWidthById(n),u=i.width;i.width=r;this._widthInfo.totalWidth-=u;this._widthInfo.totalWidth+=r}function f(){var n=t.sourcePreset,i=t.destPreset,r=this._widthInfo.allPresetWidth.findIndex(function(t){return t.id===n}),u=this._widthInfo.allPresetWidth.splice(r,1)[0],f=this._widthInfo.allPresetWidth.findIndex(function(n){return n.id===i});this._widthInfo.allPresetWidth.splice(f,0,u)}switch(n){case"add":i.call(this);break;case"remove":r.call(this);break;case"rename":u.call(this);break;case"drag":f.call(this);break;default:return}this.showOrHideExpand()},_setIsExpanded:function(n){this._widthInfo.isExpanded=n},_reflowContainerByAction:function(n){switch(n){case"add":this.expandAllPreset();break;case"remove":case"rename":this.persistPresetInOneLine();break;default:return}},addItems:function(n,t){for(var u,r=n||this.items,i=0,f=r.length;i<f;i++)u=r[i],this.addItem(u,t)},addItem:function(n,t){var i=dTabItem=null,r;i=this._usePreset&&n.isPreset?this._renderPresetItem(n):n.dropdownTabItems===undefined?this._renderTabItem(n):this._renderDropdownTabItem(n);t&&this.useDynamicAdd()?this._usePreset?(i.insertBefore(this.$el.children("[id='"+ecount.layout.TEMP_NEW_TAB_ID+"']")),r=this.items.findIndex(function(n){return n.id===ecount.layout.TEMP_NEW_TAB_ID}.bind(this)),this.items.splice(r,0,{id:n.id,name:n.name,isDynamicTab:!0,isPreset:!0,isNewTab:!0,css:"preset",hidden:undefined,isMainTab:!1}),this._setPresetStateByAction("add",n.id),this._reflowContainerByAction("add")):(i.insertBefore(this.$el.children("[id='"+ecount.layout.TEMP_NEW_TAB_ID+"']")),this.items.splice(this.items.length-1,0,{id:n.id,name:n.name,isDynamicTab:!0})):this.useTabToggleIcon?this.$el.find("ul").append(i):this.$el.append(i)},_setTabClassName:function(n){var t=[];return n.right&&t.push("pull-right"),n.active&&t.push("active"),n.hidden&&t.push("hidden"),n.css&&t.push(n.css),n.parentTabId&&t.push("tab-group"),n.childTab&&n.childTab.length>0&&t.push("tab-group split"),t.join(" ")},_setTabAttr:function(n,t){var i={id:n.id,className:this._setTabClassName(n),name:n.name,dropdownCss:"",eventAttr:this._setEventAttr(n,"tabitem")};return t&&this._setDropdownAttr(n,i),i},_setEventAttr:function(n,t){var i={tabid:n.id,ecpath:this.ecPath,func:"tab",functionId:t};return ecount.widget.replaceAttr('data-tabid="{{tabid}}" data-ecpath="{{ecpath}}" data-function="{{func}}" data-function-id="{{functionId}}"',i)},_setDropdownAttr:function(n,t){(n.name==null||n.name.length==0)&&(t.name=n.activedDropdownTabItemLabel);n.dropdownTabItems.where(function(n){return!n.aCss||n.aCss.indexOf("hidden")==-1}).length==0&&(t.dropdownCss="hidden");t.className+=" split";t.activatedTabId=n.activedDropdownTabItemID},_setPresetAttr:function(n){return{id:n.id,className:this._setTabClassName(n),name:n.name,eventAttr:this._setPresetEventAttr(n,"presetitem")}},_setPresetEventAttr:function(n,t){var i={presetid:n.id,ecpath:this.ecPath,func:"preset",functionId:t};return ecount.widget.replaceAttr('data-presetid="{{presetid}}" data-ecpath="{{ecpath}}" data-function="{{func}}" data-function-id="{{functionId}}"',i)},_renderPresetItem:function(n){n.css||(n.css="preset");var t=this._setPresetAttr(n),i=["<li id={{id}} class='{{className}}' {{eventAttr}}>","<a href='javascript:;' id='{{id}}' {{eventAttr}}>{{name}}<\/a>","<a href='#' class='btn btn-primary btn-fn hide' id='{{id}}_fn' data-service='layer.dropdown' data-service-attr='layer.fixed' {{eventAttr}}><\/a>","<\/li>",].join(""),r=_.isString(t.name)?t.name.escapeHTML(!0):_.isNil(t.name)?"":t.name;return $(ecount.widget.replaceAttr(i,_.merge({},t,{name:r})))},_renderTabItem:function(n){function f(n){return function(t){var i=[];return t==="4.0"?(i.push("<span class='tab-text' id='{{id}}'>{{name}}<\/span>"),n.isDynamicTab&&i.push("<span class='btn-fn hide' id='{{id}}_fn' {{eventAttr}}><\/span>")):i.push("<span class='tab-text' {{eventAttr}} id='{{id}}'>{{name}}<\/span>"),i.join("")}}function e(n){return n.childTab&&n.childTab.length>0?"<a href='javascript:;'><span class='caret right'><\/span><\/a>":""}var t=this._setTabAttr(n),i=f(n),r=n.linkAction?"data-linkaction='"+n.linkAction+"'":"",u=["<li id={{id}} class='{{className}}' {{eventAttr}} "+(n.isDynamicTab?"data-service='layer.dropdown' data-service-trigger='contextmenu'":"")+r+">","<a href='javascript:;' class='cursor-pointer' id='{{id}}' {{eventAttr}}>",i(this.tabVer),"<\/a>",e(n),"<\/li>",].join("");return $(ecount.widget.replaceAttr(u,t))},_renderDropdownTabItem:function(n){var t=this._setTabAttr(n,!0),i=n.linkAction?"data-linkaction='"+n.linkAction+"'":"",r=["<li id={{id}} class='{{className}}' activated-tabId='{{activatedTabId}}' {{eventAttr}} data-service='layer.dropdown' "+i+">",this._renderDropdownAnchor(n),this._renderDropdownAddonButton(n),"<\/li>"].join("");return this.dropdownSet[n.id]=this.createDropdownTabItems(n.dropdownTabItems),$(ecount.widget.replaceAttr(r,t))},_renderDropdownAnchor:function(n){var t={"class":"dropdown-toggle cursor-pointer",id:"tab_"+n.id+"_changeTab_"+this.ecPageID,name:n.name||n.activedDropdownTabItemLabel,eventAttr:this._setEventAttr(n,"tabitem")};return ecount.widget.replaceAttr('<a href="javascript:;" class="{{class}}" id="{{id}}" {{eventAttr}} data-service="layer.dropdown">{{name}}<\/a>',t)},_renderDropdownAddonButton:function(n){if(!n.isHiddenAddonButton){var t={"class":"",id:"tab_"+n.id+"_toggleTabList_"+this.ecPageID,name:n.name||n.activedDropdownTabItemLabel,eventAttr:this._setEventAttr(n,"tab_addon")};return n.dropdownTabItems.where(function(n){return!n.aCss||n.aCss.indexOf("hidden")==-1}).length==0&&(t.class+=" hidden"),ecount.widget.replaceAttr('<a href="javascript:;" class="{{class}}" {{eventAttr}} id="{{id}}" data-service-attr="layer.fixed"><span class="caret" {{eventAttr}} data-service="layer.dropdown" data-service-attr="layer.fixed"><\/span><\/a > ',t)}},createDropdownTabItems:function(n){for(var r,u=[],t,i=0;i<n.length;i++)t=n[i],r={hide:t.hide||t.aCss=="hidden",id:t.id,isActived:t.id,label:t.label,value:t.value!==undefined?t.value:t.id,css:t.css||"",aCss:t.aCss&&t.aCss!="hidden"?t.aCss:"",isEditFormMode:t.isEditFormMode||!1,linkAction:t.linkAction||!1,isShowChecked:t.isShowChecked||!1,active:t.active||!1},t.section&&(r.section=t.section),u.push(r);return u},addDropdownTabItems:function(n,t){this.dropdownSet[n]=this.createDropdownTabItems(t)},_clickDropdownTabItem:function(n,t){var i=$(t.target);if(i.filter("li").length>0?i=i.find("a").first():i.filter("a").length==0&&(i=i.parents("a")),$(t.target).filter("span.tab-close").length>0||i.attr("id").indexOf(ecount.layout.TEMP_NEW_TAB_ID)>0||i.attr("data-function")=="toggleTabList"&&!i.hasClass("hidden"))this._ON_DROPDOWN_TAB_CLICK(n,t);else return this._ON_CLICK(n,t)},getDropdownTabItem:function(n){var u=this.items,f=null,t={},i,r;if(u.length>0)for(i=0;i<u.length;i++)if(t=u[i].dropdownTabItems,t!=undefined)for(r=0;r<t.length;r++)t[r].id==n&&(f=t[r],f.parentDropdownTab=u[i]);return f},getAllPresetInfo:function(){var n=[];return this.items.forEach(function(t){t.isPreset===!0&&this._isFixedPreset(t.id)===!1&&n.push(this._makePresetInfo(t))}.bind(this)),n},getPresetInfo:function(n){n=n||this._currentPresetId;var t=this.items.find(function(t){return t.id===n&&this._isFixedPreset(n)===!1}.bind(this));return t?this._makePresetInfo(t):null},_makePresetInfo:function(n){if(n){var t=n.id;return{id:t,title:n.name,isFirstChangeTab:n.isFirstChangeTab,isFirstClick:n.isFirstClick,isFirstClickTab:n.isFirstClickTab}}},_getItemIndexById:function(n){return this.items.findIndex(function(t){return t.id===n})},_getPresetWidthById:function(n){return this.$el.children("li[id='"+n+"']").outerWidth(!0)},checkPreset:function(n){var t=this._getItemIndexById(n);if(t>-1)return this.items[t].isPreset===!0?!0:!1},_isFixedPreset:function(n){return n===ecount.layout.TEMP_NEW_TAB_ID||n===ecount.layout.EXPAND_TAB_ID?!0:!1},getTabInfo:function(n){n=n||this._currentTabID;var t=[];return this.items.forEach(function(i){if(i.id==n){t.push(i);return}i.childTab&&i.childTab.length>0&&i.childTab.forEach(function(r){if(r.id==n){r.parentTabID=i.id;t.push(r);return}})}),{id:n,title:this.$el.children("[id='"+n+"']").find("a").first().text(),isFirstChangeTab:t[0]&&t[0].isFirstChangeTab,isFirstClickTab:t[0]&&t[0].isFirstClickTab,isFirstClick:t[0]&&t[0].isFirstClick,parentTabID:t[0]&&t[0].parentTabID}},getTabInfoByIndex:function(n){var t;return(_.isArray(this.items)&&this.items[n]&&(t=this.items[n].id),!$.isNull(t))?this.getTabInfo(t):null},useDynamicAdd:function(){var n=this._getIndexRange();return this._usePreset?this._presetCount<n&&this._useDynamicAdd:this.dynamicTabIndex<n&&this._useDynamicAdd||this._dynamicDropdownItems},_getIndexRange:function(){var n=10;return!$.isNull(this.tabIndexRange)&&this.tabIndexRange>0&&(n=this.tabIndexRange),n},ON_CLICK:function(n,t,i,r){function h(n){var t,i,r;return $.isNull(this._blockPresetFeatureList)?!1:(t={__ecAddNewTab:"add","rename.preset":"rename",save:"save","delete":"delete",select:"default"},i=n.id===ecount.layout.TEMP_NEW_TAB_ID?t[n.id]:t[n.ecFunctionId],r=this._blockPresetFeatureList.includes(i),r)?(this._blockPresetCallback&&this._blockPresetCallback(),!0):!1}var o,s,f,u,e;if(this._usePreset){if(h.call(this,n))return n.stopPropagation=!0,n.suspend=!0,!1;if(o=n.id.indexOf("_fn")>-1,this.resetWidthInfoAfterRender(),o)return this._showPresetLayerByFn(n,t,i,r),n.stopPropagation=!0,n.suspend=!0,!1;if(n.id===ecount.layout.EXPAND_TAB_ID)return this.expandOrShrinkPreset(),n.stopPropagation=!0,n.suspend=!0,!1}else this.tabVer==="4.0"&&n.id.indexOf("_fn")>-1&&this._setDropdownTab(n,t,i,r,!0);if(t.target.tagName!="A"&&($.isNull(n.ecFunctionId)||n.ecFunction=="tab"&&n.handler==ECountEvent.Type.CLICK_DROPDOWN))return s=$(t.target).closest("a[data-function=tab]"),s.trigger("click"),n.stopPropagation=!0,n.suspend=!0,!1;switch(n.ecFunctionId){case"rename.customTab":f=t.target.getAttribute("data-parenttabid");f&&this.dynamicTabRename(f);break;case"rename.preset":u=t.target.getAttribute("data-parenttabid");u&&this.dynamicTabRename(u);break;case"save":u=t.target.getAttribute("data-parenttabid");u&&this._savePresetInfoToStore.apply(this,arguments);break;default:if(e=n.ecFunctionId&&"_ON_"+n.ecFunctionId.toUpperCase()+"_CLICK",this[e])return this[e].apply(this,arguments);if(n.handler==ECountEvent.Type.CLICK_LAYER)return this._ON_TABITEM_CLICK(n,t,i,r)}},ON_CLICK_SERVICE:function(n,t,i,r){this.ON_CLICK(n,t,i,r)},ON_CONTEXTMENU:function(n,t,i,r){if(this.tabVer==="4.0")return!1;this._setDropdownTab(n,t,i,r)},ON_DBLCLICK:function(n,t){var i="",u,r;if(this._usePreset){if(u=n.id.indexOf("_fn")>-1,u)return;t.target.hasAttribute("data-presetid")?i=t.target.getAttribute("data-presetid"):t.target.parentElement.hasAttribute("data-presetid")&&(i=t.target.parentElement.getAttribute("data-presetid"))}else t.target.hasAttribute("data-tabId")?i=t.target.getAttribute("data-tabid"):t.target.parentElement.hasAttribute("data-tabId")&&(i=t.target.parentElement.getAttribute("data-tabid"));return r=this.items.head(function(n){return n.id==i}),r&&(r.isDynamicTab||r.isPreset)&&this.dynamicTabRename(i),n.suspend=!0,!1},_ON_TAB_ADDON_CLICK:function(n,t){var r=t.target.getAttribute("data-tabid"),i=this.items.head(function(n){return n.id==r});i&&(n.ecService="layer.dropdown",this._ON_DROPDOWN_SHOW(n,t,{tab:i,onClicked:!0}))},_ON_PRESETITEM_CLICK:function(n,t,i,r){var u=t.target.getAttribute("data-presetid"),f=this.items.filter(function(n){return n.id==u});this._getPresetClickEventData(f,r,t)},_ON_TABITEM_CLICK:function(n,t,i,r){var e=t.target,h=t.target.getAttribute("data-tabid"),c=e.getAttribute("data-parentTabID"),u=this.items.filter(function(n){return n.id==h}),l=this._isDynamicNewTab(u,{}),a=Boolean(e.getAttribute("data-isDropdownTabItem")),f,o,s;if(h===ecount.layout.NEW_TAB_ID&&this._currentTabID==ecount.layout.NEW_TAB_ID||!t.isTrigger&&t.target.tagName=="LI"&&$(t.target).find("a").length>0)return!1;this._getTabClickEventData(u,r,t);l&&(r.initialize=n.initialize,r.tab=u[0],r.command="tab.activeOnFirst");u&&_.isArray(u)&&u.length>0&&u[0].linkAction==!0&&(r.command="tab.linkAction",r.linkId=u[0].id);e.id.indexOf(ecount.layout.TEMP_NEW_TAB_ID)>-1&&this._currentTabID&&(this.isTempNewTabClicked=!0,f=this.getLayerOption(n,t),f.items.length>0&&(f.showingUpDelay=0,f._onClicked=!0,ecount.layer.show(f)));a===!0&&(o=this.$el.children("li[id='"+c+"']"),$.isNull(this.dropdownSet[o.attr("id")])?(o.addClass("active"),o.attr("activated-tabid",e.parentNode.id)):(s=this.dropdownSet[c].filter(function(n){return n.id==r.originId}),s.length>0&&s[0].linkAction==!0&&(r.command="tab.linkAction",r.linkId=r.originId)))},_setPresetStore:function(n){if(this._usePreset&&n.store){var t=n.store,i=n.command,r=n.tabId,u=n.presetId;i&&(t.command=i);r&&(t.tabId=r);u&&(t.presetId=u)}},_savePresetInfoToStore:function(n,t,i,r){var u=t.target.getAttribute("data-parenttabid");this._setPresetStore({store:r,command:"preset.save",tabId:this._currentTabID,presetId:u});r.target=this.containerName;r.data={controlID:"save",isDropdownClick:!0,presetId:u,value:"save"}},_ON_DELETE_CLICK:function(n,t,i,r){var f,u;this._usePreset===!0?(f=t.target.getAttribute("data-parenttabid"),this._setPresetStore({store:r,command:"preset.close",tabId:this._currentTabID,presetId:f})):(u=t.target.getAttribute("data-parenttabid"),r.command="tab.close",r.tabId=u);r.targetID="btn-dynamicClose";r.target=this.containerName;r.data={controlID:"delete",isDropdownClick:!0,tabId:this._usePreset?this._currentTabID:u,value:"delete"}},_ON_CANCEL_CLICK:function(n,t,i,r){var u=t.target.getAttribute("data-parenttabid");r.command="tab.change";r.target=this.containerName;r.tabId=u;r.data={controlID:"cancel",isDropdownClick:!0,tabId:u,value:"cancel"}},_ON_SELECT_CLICK:function(n,t,i,r){var f,u;this._usePreset?(f=t.target.getAttribute("data-parenttabid"),this._setPresetStore({store:r,command:"preset.setDefault",tabId:this._currentTabID,presetId:f})):(u=t.target.getAttribute("data-parenttabid"),r.command="tab.change",r.tabId=u);r.target=this.containerName;r.data={controlID:"select",isDropdownClick:!0,tabId:this._usePreset?this._currentTabID:u,value:"select"}},_getTabClickEventData:function(n,t,i){var u,f,r=i.target,e=$(i.target),o=Boolean(r.getAttribute("data-isDropdownTabItem"));n.length>0&&(n[0].isFirstClick=!1,n[0].isFirstClickTab=!0,f=n[0].isDynamicTab,u=n[0].formSer);t.command=this.getCommandName(t);t.target=this.containerName;t.formSer=u;t.isDynamicTab=f;t.isDropdownTabItem=!!o;t.tabId=o===!0?r.parentNode.id:e.parent().attr("activated-tabid")||r.id||e.parents("li").attr("id");this._setPresetStore({store:t,presetId:this._currentPresetId})},_getPresetClickEventData:function(n,t,i){var s=i.target,h=Boolean(s.getAttribute("data-isDropdownTabItem")),r,u,f,e,o;n.length>0&&(u=n[0].isPreset,r=n[0].id,e=n[0].isDynamicTab,n[0].isFirstClick=!1,n[0].isFirstClickTab=!0,f=n[0].formSer,o=n[0].name);this._setPresetStore({store:t,command:"preset.change",tabId:this._currentTabID,presetId:r});t.target=this.containerName;t.isPreset=u;t.formSer=f;t.isDynamicTab=e;t.title=o;t.isFirstChangeTab=n[0].isFirstChangeTab},getCommandName:function(n){var t="tab.change";return n.section&&!n.isNewFormMode&&(t=n.command),t},_isDynamicNewTab:function(n,t){return this._isNewVersion&&n[0].id!=ecount.layout.NEW_TAB_ID&&n[0].isDynamicTab&&n[0].isFirstClick!=!1&&!t.initialize&&this.tabVer!="4.0"},rename:function(n,t){var u,i;if(this.tabVer!=="4.0")n.test(/newTab|custom/g)?this.$el.children("li[id='"+n+"']").find("span").first().text(t):this.$el.children("li[id='"+n+"']").find("a").first().text(t);else{var r=this.$el.children("li[id='"+n+"']").find("a").first(),f=this._getTargetText(r),o=r.children().length?r.children().clone():"",e=this.items.head(function(t){return t.id==n});e.name=t;f.text(t)}u="__ecAddNewTab";i=$.isNull(this.dropdownSet[n])?this.dropdownSet[u]:this.dropdownSet[n];i&&i.length&&i.forEach(function(i){if(i.id==n&&(i.label=t),i.isChildDepth&&i.childItems)for(var r=0,u=i.childItems.length;r<u;r++)i.dropdowns[r].id==n&&(i.dropdowns[r].label=t)})},_setDropdownTab:function(n,t,i,r,u){function e(n){var t=[];return t.push({id:"rename.customTab",label:ecount.resource.LBL11407+ecount.resource.LBL03532}),this._useDefaultDynamicActiveTab&&n.id!=ecount.layout.NEW_TAB_ID&&(this.tabVer==="4.0"&&n.isMainTab||this.tabVer!=="4.0"&&n.active?t.push({id:"select",label:ecount.resource.LBL17054,value:"cancel"}):t.push({id:"select",label:ecount.resource.LBL17055,value:"select"})),t.push({id:"delete",label:ecount.resource.LBL06157,value:"delete"}),t}var f=u?"_fn":"";return tab=this.items.head(function(t){return t.id+f==n.id}),items=[],layerOption={},tab&&tab.isDynamicTab?(items=e.call(this,tab),layerOption=this.getLayerOption(n,t,items),layerOption.showingUpDelay=0,ecount.layer.show(layerOption),n.suspend=!0,!1):void 0},_showPresetLayerByFn:function(n,t){function e(n){var t=[];return t.push({id:"save",label:ecount.resource.LBL20425,value:"save"}),t.push({id:"rename.preset",label:ecount.resource.LBL20383}),this._useDefaultDynamicActiveTab&&n.id!=ecount.layout.NEW_TAB_ID&&(n.isMainTab||n.active?t.push({id:"select",label:ecount.resource.LBL20427,value:"cancel"}):t.push({id:"select",label:ecount.resource.LBL20426,value:"select"})),t.push({id:"delete",label:ecount.resource.LBL06157,value:"delete"}),t}var f=t.target.dataset.presetid,r=this.items.head(function(n){return n.id===f}),u=[],i={};if(r){u=e.call(this,r);i=this.getLayerOption(n,t,u);n.oType==="click"&&(i._onClicked=!0);i.showingUpDelay=0;ecount.layer.show(i);ecount.layer.setOnClicked(i.serviceKey,!0);return}},dynamicTabRename:function(n){function o(){return document.activeElement.tagName==="IFRAME"}if(this._isFixedPreset(n)!==!0){var r=this.$el.children("[id='"+n+"']").find("a").first(),t=this._getTargetText(r),f=r.parent(),e=r.text(),i=document.createRange?document.createRange():document.body.createTextRange(),u=window.getSelection?window.getSelection():document.getSelection?document.getSelection():document.selection?document.selection.createRange().text:"";t.attr("contenteditable",!0);i.selectNodeContents?(i.selectNodeContents(t[0]),u.removeAllRanges(),u.addRange(i)):(i.moveToElementText(t[0]),i.select());o()&&t.focus();this.setDynamicTabInfo({targetTag:r,targetTagTabText:t,currentTargetTag:f,originName:e,selection:u,tabId:n})}},setDynamicTabInfo:function(n){this.currentDynamicTabInfo=n},removeDynamicTabInfo:function(){this.currentDynamicTabInfo=null},finishTabRename:function(){var t=this.currentDynamicTabInfo.targetTag,i=this.currentDynamicTabInfo.targetTagTabText,r=this.currentDynamicTabInfo.selection,n;this._isValidated&&(t.removeClass("has-error"),this.destroyPopover(t),this._isValidated=!1);this.checkLengthTabName()&&(n={tabId:this.currentDynamicTabInfo.tabId,newname:t.text()},r.removeAllRanges&&r.removeAllRanges(),this.delegator&&(this._usePreset?(n.presetId=this.currentDynamicTabInfo.tabId,this.delegator.triggerEvent("preset.rename",n),this._setPresetStateByAction("rename",this.currentDynamicTabInfo.tabId),this._reflowContainerByAction("rename")):this.delegator.triggerEvent("tab.rename",n),i.addClass("cursor-pointer"),i.attr("contenteditable",!1)),this.removeDynamicTabInfo())},resetDynamicTabName:function(){var n=this.currentDynamicTabInfo.targetTagTabText,t=this.currentDynamicTabInfo.originName;n.text(t)},validateTabName:function(n,t){var i=this.currentDynamicTabInfo.targetTag,f=t.keyCode,r=i.text(),u=this.currentDynamicTabInfo.targetTagTabText;return![8,13,35,36,37,39,46].contains(f)&&r.length>=this.LIMIT_TEXT_LENGTH&&this.currentDynamicTabInfo.selection.isCollapsed==!0?(i.addClass("has-error"),this.setPopover(u,{content:String.format(ecount.resource.MSG00297,this.LIMIT_TEXT_LENGTH,this.LIMIT_TEXT_LENGTH)}),this._isValidated=!0,this._validateTime||(this._validateTime=ecount.global.setTimeout(this.ecPageID,function(){u.text(r);this._validateTime=null}.bind(this),0)),!1):(this._isValidated&&(i.removeClass("has-error"),this.destroyPopover(i),this._isValidated=!1),!0)},checkLengthTabName:function(){var n=this.currentDynamicTabInfo.tabId,t=this.currentDynamicTabInfo.targetTag,i=t.html().trimHtml();return i.trim().length==0?(ecount.global.isDisableAlert()&&(ecount.global.setDisableAlert(!1),ecount.alert(ecount.resource.MSG06615,function(){this.resetDynamicTabName();this.dynamicTabRename(n)}.bind(this))),!1):!0},setUseXHR:function(n){this.useXHR=n},getUseXHR:function(){return this.useXHR},_ON_TABCLOSE_CLICK:function(n,t,i,r){var u=t.target.getAttribute("data-tabid");r.command="tab.close";r.targetID="btn-dynamicClose";r.tabId=u},ON_MOUSEDOWN:function(n,t){this.dragInstance&&this.currentDynamicTabInfo&&this.finishTabRename(n,t)},ON_MOUSEOVER:function(n,t,i,r){function s(n,t){var r=t.target.getAttribute("data-tabid"),i=f._getTabInfo(r);i&&(i.isDynamicTab||i.needRemove)&&$.isNull(f._useDefaultDynamicActiveTab)&&f._toggleRemoveButton(r,f);n.ecService=="layer.dropdown"&&i&&f._ON_DROPDOWN_SHOW(n,t,{tab:i})}var e,f,u,o;if(this._usePreset){if(this._activatedLayerKey&&(ecount.layer.removeLayer(this._activatedLayerKey),this._activatedLayerKey=null),e=n.id.indexOf("_fn")>-1,e)return this._showPresetLayerByFn(n,t,i,r),n.stopPropagation=!0,n.suspend=!0,!1}else f=this,u=t.target.getAttribute("data-tabid"),$.isNull(u)||$.isNull(this.enableSetItem)||($.isNull(this.enableSetItem[u])&&(this.enableSetItem[u]=!0),$.isNull(u)||this.delegator&&this.delegator.triggerEvent("tab.openLayer",{tabId:u,hasDropDownItems:this.enableSetItem[u],setTabItemFunc:this.addDropdownTabItems.bind(this),setUseXHR:this.setUseXHR.bind(this),showDropDown:s.bind(this,n,t)})),o=this.getUseXHR(),o||s(n,t),$.isNull(u)||$.isNull(this.enableSetItem)||(this.enableSetItem[u]=!1)},ON_MOUSEOUT:function(n,t){var r,i;r=n.handler=="mouseout.service.layer"?t.target.getAttribute("data-parenttabid"):t.target.getAttribute("data-tabid");i=this.items.head(function(n){return n.id==r});i&&(i.isDynamicTab||i.needRemove)&&!n.eventTriggerFromInterernalServiceTarget&&$.isNull(this._useDefaultDynamicActiveTab)&&this._toggleRemoveButton(r,!1);n.ecService=="layer.dropdown"&&this._ON_DROPDOWN_HIDE()},ON_MOUSEOUT_SERVICE:function(n,t,i,r){n.eventTriggerFromInterernalServiceTarget||this.ON_MOUSEOUT(n,t,i,r)},_ON_DROPDOWN_SHOW:function(n,t,i){var r;r=this.getLayerOption(n,t);i.onClicked&&(r._onClicked=!0);ecount.layer.show(r);i.onClicked?ecount.layer.setOnClicked(r.serviceKey,!0):this._pushDropdownKey(r.serviceKey)},_ON_DROPDOWN_HIDE:function(){this.dropdownKeyList.forEach(function(n){ecount.layer.hide(n)});this._clearDropdownKey()},_getTabInfo:function(n){return this.items.head(function(t){return t.id==n})},_pushDropdownKey:function(n){this.dropdownKeyList.push(n)},_clearDropdownKey:function(){this.dropdownKeyList=[]},ON_KEYDOWN_ENTER:function(n,t,i,r){this.currentDynamicTabInfo&&(r.completeTabRename=!0,this._usePreset&&this.finishTabRename(n,t))},ON_KEYDOWN_ESC:function(n,t){this.currentDynamicTabInfo&&(this.resetDynamicTabName(),this.finishTabRename(n,t))},ON_KEYDOWN_OTHERS:function(n,t){this.currentDynamicTabInfo&&(this.validateTabName(n,t)||(n.suspend=!0))},ON_FOCUSOUT:function(n,t){this.currentDynamicTabInfo&&this.finishTabRename(n,t)},ON_PASTE:function(n,t){var f;if(this.currentDynamicTabInfo){var u=this.currentDynamicTabInfo.targetTagTabText,e=window.navigator.userAgent.toLowerCase(),r=t.originalEvent.clipboardData||window.clipboardData,i=r.getData("text");navigator.appName=="Netscape"&&navigator.userAgent.search("Trident")!=-1||e.indexOf("msie")!=-1?(i==null&&(i=""),r.setData("text",i),u.text(i.substring(0,this.LIMIT_TEXT_LENGTH))):(f=r.getData("text/html").getTags("img"),!f.length>0&&u.text(i.substring(0,this.LIMIT_TEXT_LENGTH)));t.preventDefault()}},_toggleRemoveButton:function(n,t){var r=this.$el.find("li[id='"+n+"']"),i=r.find("span[data-function-id=tabclose]");i.length==0&&(i=this._renderRemoveButton({targetTab:r,tabId:n}));this._mouseOutTimerID!=undefined&&(clearTimeout(this._mouseOutTimerID),this._mouseOutTimerID=null);this._mouseOutTimerID=t?ecount.global.setTimeout(this.ecPageID,function(){i.addClass("tab-close")},this.mouseHoverInTime):ecount.global.setTimeout(this.ecPageID,function(){i.removeClass("tab-close")},this.mouseHoverOutTime)},_renderRemoveButton:function(n){var t='<span data-function-id="tabclose" data-tabid="{{tabId}}" data-ecpath="{{ecpath}}" data-original-title="{{title}}">',i={tabId:n.tabId,ecpath:this.ecPath,title:ecount.resource.LBL06157};return t=$(ecount.widget.replaceAttr(t,i)),n.targetTab.append(t),bootstrapFunc.tooltip.call(t,{container:"body",delay:{show:ecount.common.mouseHoverInTime,hide:ecount.common.mouseHoverOutTime}}),t},toggle:function(n){var t=this.getDropdownTabItem(n),u=t!=null?t.parentDropdownTab:null,i={},s=this.$el.children("li[id='"+n+"']"),f=s.children("a").children(".btn-fn"),o,r,e;o=this._usePreset===!0?this.$el.children("li[id='"+this._currentTabID+"']").not("[data-linkaction='true']"):this.$el.children("li.active").not("[data-linkaction='true']");r=o.children("a").children(".btn-fn");this._currentTabID=n;o.removeClass("active");s.addClass("active");f&&f.length?(f.removeClass("hide"),r.length&&f[0].id!==r[0].id&&r.addClass("hide")):r.addClass("hide");e=this.items.head(function(t){return t.id==n});e&&(e.isFirstChangeTab=!0,e.isDynamicTab&&this.isTempNewTabClicked&&(this.isTempNewTabClicked=!1,ecount.global.setTimeout(this.ecPageID,function(){this.dynamicTabRename(n)}.bind(this),0)));this.$el.children("li[id='"+n+"']").length==0&&u!=null&&(i=this.$el.children("li[id='"+u.id+"']"),i.addClass("active"),(u.name==null||u.name.length==0)&&($(i.get(0).firstChild).html(t.label),i&&t&&t.id&&i.attr("activated-tabid",t.id)))},togglePreset:function(n){var r=this.$el.children("li[id='"+this._currentPresetId+"']"),i=this.$el.children("li[id='"+n+"']"),t=this.items.head(function(t){return t.id==n});this._currentPresetId=n;r.removeClass("active");i.addClass("active");r.children(".btn-fn").addClass("hide");i.children(".btn-fn").removeClass("hide");i.children().each(function(n,t){t.getAttribute("id").indexOf("_fn")>1==!1&&t.setAttribute("class","cursor-pointer")});t&&(t.isFirstChangeTab=!0,t.isNewTab===!0&&(t.isNewTab=!1,ecount.global.setTimeout(this.ecPageID,function(){this.dynamicTabRename(n)}.bind(this),0)))},setTabActiveOption:function(n,t){var i=this.items.filter(function(t){return t.id==n});i.length!=0&&($.isNull(t.isFirstChangeTab)||(i[0].isFirstChangeTab=t.isFirstChangeTab),$.isNull(t.isFirstClickTab)||(i[0].isFirstClickTab=t.isFirstClickTab))},setTabActiveClass:function(n,t){var i=this.$el.children("li[id='"+n+"']");i.length>0&&(t?i.addClass("active"):i.removeClass("active"))},getCurrentId:function(){return this.currentId},getDropdown:function(n){return this.dropdownSet[n]},hideTab:function(n){this.$el.children("li[id='"+n+"']").addClass("hidden").removeClass("has-error")},showTab:function(n){this.$el.children("li[id='"+n+"']").removeClass("hidden")},isShowTab:function(n){var i=null,t=n&&this.$el.children("li[id='"+n+"']");return t&&t.length&&(i=!t.hasClass("hidden")),i},showError:function(n){this.$el.children("li[id='"+n+"']").hasClass("has-error")||this.$el.children("li[id='"+n+"']").addClass("has-error")},hideError:function(n){this.$el.children("li[id='"+n+"']").removeClass("has-error")},roundAllLayerItem:function(n,t){for(var i,r=0,u=n.length;r<u;r++){if(i=n[r],t.call(this,i,r,n)==!1)return null;i.isChildDepth===!0&&this.roundAllLayerItem(i.childItems,t)}return null},addDropdownItem:function(n,t){_.isArray(t)||(t=[t]);this.dropdownSet[n]||(this.dropdownSet[n]=[]);this.dropdownSet[n]=this.dropdownSet[n].concat(t)},removeDropdownItem:function(n,t,i){var r,u,e,f,o;if(i===!0)return this.dropdownSet[n]=[],!1;for(_.isArray(t)||(t=[t]),u=0,e=this.dropdownSet[n].length;u<e;u++){if(r=this.dropdownSet[n][u],t.contains(r.id)===!0){this.dropdownSet[n].splice(u,1);u--;e--;continue}if(r.isChildDepth===!0)for(f=0,o=r.childItems.length;f<o;f++)t.contains(r.childItems[f].id)===!0&&(r.childItems.splice(f,1),f--,o--)}},addDropdownChildItem:function(n,t,i){var r=this.getDropdownItem(n,t);r&&(r.isChildDepth=!0,r.childItems=i)},removeDropdownChildItem:function(n,t){var i=this.getDropdownItem(n,t);i&&i.childItems&&(i.childItems=null,i.isChildDepth=null,delete i.childItems,delete i.isChildDepth)},hideDropdownItem:function(n,t){_.isArray(t)||(t=[t]);for(var i,r=0,u=t.length;r<u;r++)i=this.getDropdownItem(n,t[r]),i&&(i.hide=!0)},showDropdownItem:function(n,t){_.isArray(t)||(t=[t]);for(var i,r=0,u=t.length;r<u;r++)i=this.getDropdownItem(n,t[r]),i&&(i.hide=!1)},getDropdownItem:function(n,t){var i;return this.roundAllLayerItem(this.dropdownSet[n]||[],function(n){if(n.id===t)return i=n,!1}),i},getDropdownVisibleItems:function(n){var t=[];return this.roundAllLayerItem(this.dropdownSet[n]||[],function(n){n.hide!==!0&&t.push(n)}),t},getDropdownItemLength:function(n){return this.dropdownSet[n]?this.dropdownSet[n].length:0},showDropdown:function(n,t){t=t||this.$el.find("[id='"+n+"']").attr("data-ecpath");var i=_.extend(this._getLayerOption(n),{serviceKey:ecount.common.makeServiceKey(t,this.layoutID)});ecount.layer.show(i)},hideDropdown:function(n,t){t=t||this.$el.find("#"+n).attr("data-ecpath");var i=ecount.common.makeServiceKey(t,this.layoutID);ecount.layer.hide(i)},_getLayerOption:function(n,t){var u,i,r;for(t=t||(this.dropdownSet[n]||[]).slice(0),u=this._getAttachableElement(n),i=0;i<t.length;i++)if(t[i].isDropdownTabItem=!0,t[i].parentTabID=n,t[i].isChildDepth&&t[i].childItems)for(r=0;r<t[i].childItems.length;r++)t[i].childItems[r].isDropdownTabItem=!0,t[i].childItems[r].parentTabID=n;return{type:"dropdown",ecPageID:this.ecPageID,boundary:ec$.getZoomedBoundary(u),ownerKey:this.ecIKey,items:t,directionX:this._usePreset?"right":""}},_getAttachableElement:function(n){return this._usePreset?this.$el.find("[id='"+n+"_fn']")[0]:this.$el.find("li[data-tabid="+n+"]")[0]},_getIdByAttr:function(n){return this._usePreset?n.getAttribute("data-presetid"):n.getAttribute("data-tabid")},_getClosestIdByAttr:function(n){return this._usePreset?ec$.getClosestAttr(n,"data-presetid"):ec$.getClosestAttr(n,"data-tabid")},_getTargetText:function(n){return this._usePreset?n:n.contents().first()},getLayerOption:function(n,t,i){var r=this._getIdByAttr(t.target);return _.extend(this._getLayerOption(r,i),{serviceKey:this.getLayerServiceKey(n,t)})},getLayerDropdownOption:function(n,t){for(var u,f=t.target.getAttribute("data-tabid"),e=f,i=(this.dropdownSet[f]||[]).slice(0),r=0;r<i.length;r++)if(i[r].isDropdownTabItem=!0,i[r].parentTabID=dropdownTab.get(0).id,i[r].isChildDepth&&i[r].childItems)for(u=0;u<i[r].childItems.length;u++)i[r].childItems[u].isDropdownTabItem=!0,i[r].childItems[u].parentTabID=dropdownTab.get(0).id;return $.extend({},{serviceKey:this.getLayerServiceKey(n),ownerKey:this.ecIKey,pcid:this.id,items:i})},getLayerServiceKey:function(n,t){var r=this._getClosestIdByAttr(t.target),i=ecount.common.makeServiceKey(n.ecPath,this.layoutID||r);return this._activatedLayerKey=i,i},setDropdownActiveTabCancel:function(n){var i=this.items.head(function(n){return n.active}),t;i&&(this.tabVer==="4.0"?i.isMainTab=!1:i.active=!1);t=this.items.head(function(t){return t.id==n});t&&(this.tabVer==="4.0"?t.isMainTab=!0:t.active=!0)},setDropdownActiveTabSelect:function(n){var t=this.items.head(function(t){return t.id==n});t&&(this.tabVer==="4.0"?t.isMainTab=!1:t.active=!1)},setDragEvent:function(){this.dragInstance=new ecount.draggable;this.dragInstance.setDragData({id:this.id,target:this.$el,helper:this.makeDragHelper.bind(this),helperDistance:{x:20,y:10},droppable:this.$el,blank:"<li class='preset draggable-holder'><a><\/a><\/li>",axis:"horizontal",drag_start:this.dragStartEvent.bind(this),drag_move:this.dragMoveEvent.bind(this),drag_stop:this.dragStopEvent.bind(this),getBlankArea:this.getBlankArea.bind(this)})},makeDragHelper:function(){var n="left: "+event.clientX+"px; top: "+event.clientY+"px;";return["<div class='nav-tabs-preset draggable-helper' style='"+n+"'>",this.$el.find("li#"+this.dragTargetId).text(),"<\/div>"].join("")},dragStartEvent:function(n){var i=n.originalEvent.target,t=i.getAttribute("data-presetid");if(t&&this._isFixedPreset(t)===!1){this.dragTargetId=t;this.dragBlankId=this.dragTargetId;this.hideTab(this.dragTargetId);this.onDragEvent({dragging:!0})}else return!1},dragMoveEvent:function(n){var t=n.helper;t.hasClass("not-droppable")&&n.isDroppable?t.removeClass("not-droppable"):t.hasClass("not-droppable")||n.isDroppable||t.addClass("not-droppable")},dragStopEvent:function(n){function y(){this.dragTargetId=null;this.dragBlankId=null;this.onDragEvent({dragging:!1})}function h(n,t){var i=n[t-1].id,r=n[t+1].id;return i+" "+r}var t=this.dragTargetId,i,u,e,o,s;if(this.showTab(t),i=this.$el.find("li[id='"+this.dragTargetId+"']"),this.$el.find("li.draggable-holder").replaceWith(i),u=i.prev().attr("id"),n.isDroppable){var f=this.items.findIndex(function(n){return n.id==t}),c=h(this.items,f),l=this.items.splice(f,1)[0],a=this.items.findIndex(function(n){return n.id==u}),r=a+1,v=this.items[r].id;this.items.splice(r,0,l);e=h(this.items,r);o=c!==e;y.call(this);s={isMoved:o,allPresetInfo:this.getAllPresetInfo()};this.delegator.triggerEvent("preset.dragComplete",s);this._setPresetStateByAction("drag",{sourcePreset:t,destPreset:v})}},onDragEvent:function(n){var t=n.dragging||!1;this.isDragging=t},getBlankArea:function(n){var r=n.originalEvent.target,t=r.getAttribute("data-presetid"),i;return t&&this._isFixedPreset(t)===!1&&(this.dragBlankId=t),i=n.isDroppable?this.$el.find("li[id='"+this.dragBlankId+"']"):this.$el.find("li[id='"+this.dragTargetId+"']"),{blankArea:i}}});ecount.class("ecount.layout.standAloneTab","ecount.layout.tab",{template:'<div class="wrapper-nav-tabs">\n<ul class="nav nav-tabs">\n<\/ul>\n<div class="tab-option">\n<span id="more" class="tab-more" data-function="more"><\/span>\n<span id="plus" class="tab-plus"  data-function="plus"><\/span>\n<\/div>\n<div>',items:null,$items:[],delegator:null,currentId:null,_currentTabID:null,isStandAloneTab:!0,editMode:!1,overWrite:!1,inputMode:!1,isKeyEnter:!1,init:function(){ecount.layout.prototype.init.apply(this,arguments)},destroy:function(){this.$el.off();ecount.widget.removeChild(this.$el.remove())},render:function(){ecount.layout.prototype.render.apply(this,arguments);this.addItems();this.onLoadItems()},setSortable:function(){var n=this.$el.find("ul.nav-tabs");n.sortable()},addItems:function(n){for(var i=n||this.items,f=this.$el.find("ul.nav-tabs"),r,t=0,u=i.length;t<u;t++)r=i[t],this._addItem(f,r,this.orgName[t]);this.setInputMode(!1);this.isKeyEnter=!1},enableToolTip:function(){var n=this.$el.find("ul.nav-tabs"),t=n.find("a");_.each(t,function(n){n.getAttribute("overwrite")==="true"&&n.setAttribute("title")})},addItem:function(n){var i=_.findIndex(this.items,function(t){return _.isEqual(t.id,n.id)}),t;if(i>0)return!1;t=this.$el.find("ul.nav-tabs");this._addItem(t,n);this.items.push(n)},updateItem:function(n,t){var u=_.merge({className:"active",ecPath:this.getEcPath()},t),f=this.$el.find("ul.nav-tabs"),i=_.findIndex(this.items,function(t){return _.isEqual(t.id,n)}),r;i>0&&(this.items[i]=t,r=f.children()[i],$(r).before(this._createItem(u,t.orgName)),$(r).remove());this.setInputMode(!1);this.isKeyEnter=!1},removeItem:function(n){var r=this.$el.find("ul.nav-tabs"),t=_.findIndex(this.items,function(t){return _.isEqual(t.id,n)}),i;t>0&&(i=r.children()[t],this.items.splice(t,1),$(i).remove())},removeItemAll:function(){var n=this.$el.find("ul.nav-tabs");_.each(n.children(),function(n){$(n).remove()});this.items=[]},reloadItems:function(n){var t=[];_.each(n,function(n){t.push({id:n.id,name:n.label,css:n.css||undefined,hidden:n.hidden||undefined,needRemove:n.needRemove||undefined,orgName:n.orgName||undefined})});this.removeItemAll();this.addItems(t)},getItem:function(n){var t=_.findIndex(this.items,function(t){return _.isEqual(t.id,n)});return this.items[t]},toggle:function(n){var e=0,t;this._currentTabID=n;this.$el.find("li.active").removeClass("active");t=this.$el.find("li[data-tabid="+n+"]");t.addClass("active");var i=this.$el.find("ul.nav-tabs"),r=i.width(),l=i.offset().left,o=this.$el.find(".tab-option"),f=o.width(),s=o.offset().left,h=t.offset().left,a=t[0].getBoundingClientRect().right,v=s-(r-f),c="left ease 0.2s",u=l-(h+r/3)+(r-f-t.width());u>0&&(u=0);v>h&&i.css({left:u,transition:c});s<a&&i.css({left:u,transition:c});_.each(i.children(),function(n){e+=n.getBoundingClientRect().width});e>r-f?this.showTabMoveBtn():this.hideTabMoveBtn()},_addItem:function(n,t,i){var r=_.merge({className:"",ecPath:this.getEcPath()},t);this._renderTabItem(n,r,i)},_createItem:function(n,t){var i,r;return n&&_.isString(n.name)&&_.size(n.name)>15?(n.overwrite=!0,n._name=_.join(_.slice(n.name,0,15),"")+"...",i='<a href="javascript:;" data-tabid={{id}} data-ecpath={{ecPath}} data-function="tab" title="{{name}}">'):(n.overwrite=!1,n._name=n.name,i='<a href="javascript:;" data-tabid={{id}} data-ecpath={{ecPath}} data-function="tab">'),n.orgName=t?_.isString(t)?t:t.name:n.orgName?n.orgName:n._name,r=["<li data-tabid={{id}} class='{{className}}' data-ecpath={{ecPath}} data-function=\"tab\">",i,"{{_name}}","<\/a>",'<input type="text" maxlength="50" data-tabid={{id}} data-ecpath={{ecPath}} data-function="tab" class="hidden" value={{orgName}}>',"<\/li>"].join(""),ecount.widget.replaceAttr(r,n)},_renderTabItem:function(n,t,i){var r=this._createItem(t,i);this.$items.push(r);n.append(r)},_setInputMode:function(n){function t(n){var t=$('<div style="position:absolute; left: -1000%;">').appendTo("body");_.isElement(n)?(t.html(n.value+"-"),n.style.width=t.width()+"px"):(t.html(this.value+"-"),this.style.width=t.width()+"px");t.remove()}var i=this.$el.find("ul.nav-tabs");_.each(i.children(),function(i){var r,u;_.isEqual(i.getAttribute("data-tabid"),n)&&(u=i.getElementsByTagName("a")[0],r=i.getElementsByTagName("input")[0],u.classList.add("hidden"),r.classList.remove("hidden"),r.select(),r.removeEventListener("input",t),r.addEventListener("input",t),t(r))});this.setInputMode(!0);this.setEditMode(!0)},_scrollTab:function(n){var i=this.$el.find("ul.nav-tabs"),e=i.width(),t=Number(i.css("left").replace("px",""))+n,r=i.children().last(),u=this.$el.find(".tab-option").offset().left,f=r.offset().left+r.width();u>f&&n<0&&(t=t-n);t>0&&(t=0);i.css("left",t)},slideTabs:function(){var n=this.$el,t=this.$el.find("ul.nav-tabs");t.css({transition:"none",left:"0px"});n.hasClass("open")?n.removeClass("open"):n.addClass("open")},setFocusMove:function(){var n=this.$el;n.removeClass("open")},getCurrentTabId:function(){return this._currentTabID},ON_CLICK:function(n,t,i,r){var u=t.target.getAttribute("data-tabid");switch(n.ecFunction){case"more":this.slideTabs();break;case"plus":r.command="onClickAddTabMenu";break;case"tab":this.setFocusMove();r.command="tab.change";r.target=this.containerName;r.tabId=u;r.isStandAloneTab=this.isStandAloneTab}},_ON_KEYDOWN_ENTER:function(){this.isKeyEnter=!0;var n=this.getEditMode(),t=this.getInputMode();n&&t&&this.delegator&&this.delegator.triggerEvent("tab.rename",{currentTargetId:this._currentTabID,currentTabItem:this.getItem(this._currentTabID),inputValue:event.target.value});_.isEmpty(event.target.value)?this.setEditMode(!0):this.setEditMode(!1)},ON_CONTEXTMENU:function(n,t){t.preventDefault();this.disableTabContextMenu||(this._currentTabID=t.target.getAttribute("data-tabid"),_.isNull(this.getCurrentTabId())||this._ON_SUB_LINK_DROPDOWN_DISPLAY(n,t))},ON_DBLCLICK:function(n,t){this.enableDBClick&&(this._currentTabID=t.target.getAttribute("data-tabid"),_.isNull(this._currentTabID)||this._setInputMode(this._currentTabID))},ON_FOCUSOUT:function(){var n=this.getEditMode(),t=this.getInputMode();!this.isKeyEnter&&n&&t&&this.delegator&&this.delegator.triggerEvent("tab.rename",{currentTargetId:this._currentTabID,currentTabItem:this.getItem(this._currentTabID),inputValue:event.target.value});_.isEmpty(event.target.value)?this.setEditMode(!0):this.setEditMode(!1);this.isKeyEnter=!1},setEditMode:function(n){this.editMode=n},getEditMode:function(){return this.editMode},setInputMode:function(n){this.inputMode=n},getInputMode:function(){return this.inputMode},_ON_SUB_LINK_DROPDOWN_DISPLAY:function(n,t){var r=r||{},i,u=t.target.getAttribute("data-tabid");i=this.getSubLinkDropdownOption(u,t.target);ecount.layer.show(i)},getSubLinkDropdownOption:function(n,t){var i=this.tabMenuItems,r=n,u;return r==="0"&&(i=this.tabMenuItems.filter(function(n){return n.isForTabAll==!0})),u=$(t),{type:"dropdown",showingUpDelay:0,ecPageID:this.ecPageID,ecFunction:"tabMenu",serviceKey:ecount.common.makeServiceKey(this.ecPath,r),ownerKey:this.ecIKey,items:i||[],boundary:ec$.getZoomedBoundary(u[0])}},showTabOption:function(){var n=this.$el.find(".tab-option");n.removeClass("hidden")},hideTabOption:function(){var n=this.$el.find(".tab-option");n.addClass("hidden")},showTabMoveBtn:function(){this.$el.find(".tab-option .tab-more").removeClass("hidden")},hideTabMoveBtn:function(){this.$el.find(".tab-option .tab-more").addClass("hidden")}});ecount.class("ecount.layout.tabContents","ecount.layout",{$tabPaneContanier:null,$tabsContanier:null,$tabsSign:null,tabs:null,currentTabId:null,itemList:null,onSingleMode:!1,showFormLayer:!1,onSync:!1,tabVer:"",css:"nav nav-tabs",colType:null,_loadedItemCount:0,_deactiveteDomDelete:!1,_invalidateElementCount:null,_defaultFormsetTabId:"details",init:function(){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.currentPresetId=null;this.events=new ecount.events(this);this.events.on({"form.sync":this.onSyncHandler,"form.simpleSearch":this.transferEvent,"form.focusout":this.transferEvent,"form.showCell":this.transferEvent,"form.hideCell":this.transferEvent,"panel.focusout":this.transferEvent,"tab.rename":this.renameTab,"tab.openLayer":this._onOpenBeforeLayer,"preset.rename":this.renamePreset,"preset.dragComplete":this._onPresetDragComplete,"control.change":this.transferEvent,"control.select":this.transferEvent,"control.openPopup":this.transferEvent,"control.openLayer":this.transferEvent,"control.changeValidate":this._onChangeControlValidateState,"tabPane.onload":this.onloadTabPane,"tabPane.removeItem":this.transferEvent,"tabPane.removeAll":this.onRemoveAllTabPane,"grid.append":this.transferEvent,"page.afterLoad":this.transferEvent,"page.beforeLoad":this.transferEvent,"form.change":this.onSyncHandler,"tabContents.onInit":this._onInitTabContents,"page.adjustHeaderSearchDimensions":this.transferEvent,"page.adjustContentsDimensions":this.transferEvent,"page.showProgressbar":this.transferEvent,"page.hideProgressbar":this.transferEvent,"page.customPageInvoke":this.transferEvent,"drawingPaper.all":this.transferEvent,"drawingPaper.history":this.transferEvent,"drawingPaper.shape":this.transferEvent,"drawingPaper.font":this.transferEvent,"drawingPaper.shapeStyle":this.transferEvent,"drawingPaper.layout":this.transferEvent,"drawingPaper.addMappingData":this.transferEvent,"drawingPaper.insertMappingData":this.transferEvent,"drawingPaper.insertHyperlink":this.transferEvent,"drawingPaper.editHyperlink":this.transferEvent,"drawingPaper.deleteHyperlink":this.transferEvent,"drawingPaper.viewSamples":this.transferEvent,"drawingPaper.setting":this.transferEvent,"drawingPaper.allSettings":this.transferEvent,"drawingPaper.initControl":this.transferEvent,"drawingPaper.makeCompleteControl":this.transferEvent,"drawingPaper.initPasteControl":this.transferEvent,"drawingPaper.shape.initTableCell":this.transferEvent,"drawingPaper.shape.dblClick":this.transferEvent,"drawingPaper.shape.select":this.transferEvent,"drawingPaper.shape.deselect":this.transferEvent,"drawingPaper.shape.click":this.transferEvent,"drawingPaper.shape.createInstance":this.transferEvent,"drawingPaper.shape.destroyInstance":this.transferEvent,"drawingPaper.shape.cloneInstance":this.transferEvent,"drawingPaper.shape.clickBtnOldHtml":this.transferEvent,"drawingPaper.shape.clickBtnConvertBackgroundImage":this.transferEvent,"drawingPaper.beginEdit":this.transferEvent,"drawingPaper.endEdit":this.transferEvent,"drawingPaper.renderComplete":this.transferEvent,"drawingPaper.contextmenuData":this.transferEvent,"drawingPaper.changeActive":this.transferEvent,"drawingPaper.deSelectPositionCollection":this.transferEvent,"tree.select":this.transferEvent,"tree.exceed":this.transferEvent,"tree.onload":this.transferEvent,"tree.loadnode":this.transferEvent,"tree.opennode":this.transferEvent,"tree.refresh":this.transferEvent,"tree.ready":this.transferEvent,"tree.rename":this.transferEvent,"tree.beforeAdd":this.transferEvent,"tree.focusNode":this.transferEvent,"tree.add":this.transferEvent,"tree.addMenu":this.transferEvent,"tree.setup":this.transferEvent,"tree.move":this.transferEvent,"tree.delete":this.transferEvent,"tree.deactivate":this.transferEvent,"tree.activate":this.transferEvent,"tree.viewAuthor":this.transferEvent,"tree.dropComplete":this.transferEvent,"tree.anchor":this.transferEvent,"tree.select":this.transferEvent,"tree.exceed":this.transferEvent,"tree.onload":this.transferEvent,"tree.loadnode":this.transferEvent,"tree.opennode":this.transferEvent,"tree.refresh":this.transferEvent,"tree.ready":this.transferEvent,"tree.rename":this.transferEvent,"tree.beforeAdd":this.transferEvent,"tree.focusNode":this.transferEvent,"tree.add":this.transferEvent,"tree.addMenu":this.transferEvent,"tree.setup":this.transferEvent,"tree.move":this.transferEvent,"tree.delete":this.transferEvent,"tree.deactivate":this.transferEvent,"tree.activate":this.transferEvent,"tree.viewAuthor":this.transferEvent,"tree.backup":this.transferEvent,"tree.deleteContents":this.transferEvent,"tree.dropComplete":this.transferEvent,"tree.anchor":this.transferEvent,"tree.getType":this.transferEvent,"report.toolbar":this.transferEvent,"report.activeArea":this.transferEvent,"report.areaClick":this.transferEvent,"report.resizeMargin":this.transferEvent,"report.resizeMarginEnd":this.transferEvent,"report.changeAreaHeight":this.transferEvent,"report.clickSettingPanel":this.transferEvent,"report.toggleSettingPanel":this.transferEvent,scope:this});this.events.register(ecount.gridV2.event.ready,this,this.transferEvent);this.events.register(ecount.grid.event.list.preInit,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderingError,this,this.transferEvent);this.events.register(ecount.grid.event.list.afterFormLoad,this,this.transferEvent);this.events.register(ecount.grid.event.list.initAddRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderAllRowComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.afterRowDataLoad,this,this.transferEvent);this.events.register(ecount.grid.event.list.preInitDrag,this,this.transferEvent);this.events.register(ecount.grid.event.list.dragEndPreInit,this,this.transferEvent);this.events.register(ecount.grid.event.list.dragEndCompleted,this,this.transferEvent);this.events.register(ecount.grid.event.list.resizing,this,this.transferEvent);this.events.register(ecount.grid.event.list.resizeEndCompleted,this,this.transferEvent);this.events.register(ecount.grid.event.list.activate,this,this.transferEvent);this.events.register(ecount.grid.event.list.gridResized,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeDisplaySetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formDisplaySetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeShowText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formShowText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeHideText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formHideText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeAddedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeRemovedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formRemovedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeAddedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeRemovedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formRemovedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeMerged,this,this.transferEvent);this.events.register(ecount.grid.event.list.formMerged,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeDivided,this,this.transferEvent);this.events.register(ecount.grid.event.list.formDivided,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAdd,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddItem,this,this.transferEvent);this.events.register(ecount.grid.event.list.formConnectItem,this,this.transferEvent);this.events.register(ecount.grid.event.list.formDeleteItem,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeBatchSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBatchSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeTotalSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formTotalSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetBeforeFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetBeforeCancelFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetCancelFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.fixedChange,this,this.transferEvent);this.events.register(ecount.grid.event.list.selectorBeforeSelect,this,this.transferEvent);this.events.register(ecount.grid.event.list.selectorSelect,this,this.transferEvent);this.events.register(ecount.grid.event.list.initMoveContainer,this,this.transferEvent);this.events.register(ecount.grid.event.list.containerMoving,this,this.transferEvent);this.events.register(ecount.grid.event.list.movedContainer,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetDragPrepareComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetDragComplete,this,this.transferEvent);this.events.register(ecount.gridV2.cellEvent.renderCompleted,this,this.transferEvent);this.events.register("grid.onRendering",this,this.transferEvent);this.events.register(ecount.grid.event.list.beforeOpeningContextmenu,this,this.transferEvent);this.events.register(ecount.grid.event.list.afterOpeningContextmenu,this,this.transferEvent);this.events.register(ecount.grid.event.list.completedOpenContextmenu,this,this.transferEvent);this._invalidateElementCount={}},render:function(n){function t(){this.delegator.triggerEvent("tabContents.onInit",{__self:this});this.showFormLayer&&this.show();this.tabOptions&&this.createTab(this.tabOptions);this.tabItems&&this.createItems(this.tabItems)}function i(n){n.colType&&(this.colSize=n.colType);n&&n.items?(this.setTabContents(n.items),t.call(this)):n&&n.columns&&(this.setFormControls(n.columns,n.option),t.call(this))}this.setEcIKey();this.$el=n;this.$el&&this.$el.length&&(this.$el[0].ecIKey=this.getEcIKey());this.Invisibility&&(this.css+=" hidden");this.$tabsContanier=$('<ul class="'+this.css+'"><\/ul>');this.$tabPaneContanier=$('<div class="tab-content"/>');this._tabPaneContanierCss&&this.$tabPaneContanier.addClass(this._tabPaneContanierCss);this.$tabsSign=this._sign?$('<li class="tab-text text-danger">'+this._sign+"<\/li>"):null;this.$tabsContanier.hide();this.$tabPaneContanier.hide();this.$el.append(this.$tabsContanier);this.$el.append(this.$tabPaneContanier);this.url?ecount.common.api({url:this.url,data:JSON.stringify(this.fOptions),success:function(n){n.Data&&i.call(this,n.Data)}.bind(this)}):this.fOptions&&this.fOptions.formType||this.fOptions.formInfoObject?(this._originFormInfo=this.fOptions.formType?ecount.layout.getFormData(this.fOptions.formType,this.inIncludePage,this.ecPageID,this.fromTypeTabCd):this.fOptions.formInfoObject,i.call(this,this._originFormInfo)):t.call(this);$.isNull(this.$tabsSign)||(this.$tabsContanier.append(this.$tabsSign),this.hideSign())},getDelegator:function(){return this.__pnode==widget.generator.TABCONTENTS?this.delegator.object.delegator:this.delegator},lazyRender:function(){},destroy:function(){ecount.layout.prototype.destroy.call(this)},setTabWidth:function(n){this.$tabsContanier.css({width:n})},setTabMaxWidth:function(n){this.$tabsContanier.css({maxWidth:n})},getTabHeight:function(){return this.$tabsContanier.height()+5},redraw:function(n){this.$tabsContanier.html("");n.delegator=this.events;n.containerName=this.containerName;n.ecPageID=this.ecPageID;n.popupID=this.popupID;n.popupLevel=this.popupLevel;this.tabs=new ecount.layout.tab(n);this.tabs.ecPageID=this.ecPageID;this.tabs.render(this.$tabsContanier)},setFormControls:function(n,t,i){function v(n,t){for(var r=0,i=0;i<n.length;i++)n[i].isTopPosition?(n[i].findex=0,f.splice(r,0,n[i]),r++):(n[i].findex=++t,f=f.concat(n[i]))}function c(n,t,i){n[t]=i}var y=widget.generator,e=y.control(),f=[],o=0,l=!0,s=null,p=this._defaultFormsetTabId,h=function(){return i||this.tabItems[p].first(function(n){return n.__type=="form"})}.bind(this),u=h(),r,a;for(u._isFocusIndexType=!0,l=!u._isModifyMode,typeof u._editFlag=="string"&&(s=u._editFlag=="M"?!0:!1),r=0,a=n.length;r<a;r++)this.filter&&this.filter(n[r])===!1||(e.define(n[r].controlType,n[r].id,n[r].name,n[r].title).setOptions({findex:n[r].cursorIndex,isMultiCell:u.colSize<2||ecount.common.isTrue(n[r].isLineMrge),cellSize:ecount.common.isTrue(n[r].isLineMrge)?u.colSize:undefined,isHideCell:n[r].width==0?!0:!1,formset:n[r],controlOption:$.isEmpty(n[r].controlOption)?undefined:n[r].controlOption,groupId:n[r].groupId,isItemFold:ecount.common.isTrue(n[r].isItemFold)}),$.isNull(s)?l||ecount.common.isTrue(n[r].isEditable)||e.readOnly():(!s||ecount.common.isTrue(n[r].isEditable))&&(s||ecount.common.isTrue(n[r].isInputable))||e.readOnly(),ecount.common.isTrue(n[r].colEssentialYn)&&e.dataRules(["required"],""),ecount.common.isTrue(n[r].isRequisite2)&&(n[r].controlType.indexOf("widget.code")>-1||n[r].controlType.indexOf("widget.multiCode")>-1)&&e.dataRulesLabel(["required"],""),f.push(e.end()),o<n[r].cursorIndex&&(o=n[r].cursorIndex));u.rows&&u.rows[0]&&u.rows[0].length>0?(v(u.rows[0],o),c(h(),"rows",f)):u.controls&&u.controls.length>0?(v(u.controls,o),c(h(),"controls",f)):c(h(),"rows",f)},setTabContents:function(n){var u=widget.generator.tabContents(),i=form=null,r=[],f=0,h=n.findIndex(function(n){return n.IsDynamicTab==!0&&n.isActive==!0}),c=n.findIndex(function(n){return n.IsDynamicTab!=!0&&n.isActive==!0}),o,t,e,s;for(h>-1?f=h:c>-1&&(f=c),t=0,e=n.length;t<e;t++)i=n[t],form=this.createForm(i),$.isNull(i.IsDynamicTab)||i.IsDynamicTab!=!0||r.push(t),i.right===!0?t===f?u.createRightActiveTab(i.id,i.title):u.createRightTab(i.id,i.title):t===f?u.createActiveTab(i.id,i.title):u.createTab(i.id,i.title),u.add(form);for(o=u.end(),this.tabOptions=o.tabOptions,this.tabItems=o.tabItems,this.activeTabId=o.activeTabId,this.tabOptions.dynamicTabIndex=r.length,r.length>0&&!this.nonSyncTabs&&(this.nonSyncTabs=[]),this._customTabMaxIndex=0,t=0,e=r.length;t<e;t++)s=this.tabOptions.items[r[t]].id,this._customTabMaxIndex=Math.max(this._customTabMaxIndex,parseInt(s.replace("custom",""))),this.nonSyncTabs.push(s),this.tabOptions.items[r[t]].isDynamicTab=!0,this.tabVer==="4.0"&&(this.tabOptions.items[r[t]].isMainTab=n[r[t]].IsMainTabUse),this._usePreset===!0&&(this.tabOptions.items[r[t]].isPreset=!0)},createForm:function(n){for(var t,i,r,e=widget.generator,f=e.form(),o=e.control(),u=0,s=n.subItems.length;u<s;u++){try{t=Object.clone(n.subItems[u],!0)}catch(h){try{t=$.extend(!0,{},n.subItems[u])}catch(h){}t=n.subItems[u]}if(!this.filter||this.filter(t)!==!1)if(t.controlType.indexOf("widget.select.ioType")>-1&&(t.isAllListView=!0),this._isCommonStatus&&(t._serializeByAll=!0,t._useCommonSerialize=!0),i=ecount.common.getExceptedControlsInForm(t),i)for(r=0;r<i.length;r++)f.add(o.define(i[r].controlType,i[r].id,i[r].name,i[r].subTitle,i[r].groupId).end());else f.add(t)}return this.simpleSearch&&f.add(o.define("widget.button.simpleSearch","simpleSearch","SIMPLE_SEARCH",ecount.resource.widget.QUICKSEARCH).setOptions({searchList:this.simpleSearch,searchDateName:this.dateName}).end()),f},createTab:function(){this.tabOptions.delegator=this.events;this.tabOptions._useDynamicAdd=this._useDynamicAdd;this.tabOptions._dynamicDropdownItems=this._dynamicDropdownItems;this.tabOptions._isNewVersion=this._isNewVersion;this.tabOptions.popupID=this.popupID;this.tabOptions.popupLevel=this.popupLevel;this.tabOptions.eventContainer=this.eventContainer;this.tabOptions.containerName=this.containerName;this.tabOptions.ecPageID=this.ecPageID;this.tabOptions._useDefaultDynamicActiveTab=this._useDefaultDynamicActiveTab;this.tabOptions.tabVer=this.tabVer;this.tabOptions.tabIndexRange=this.tabIndexRange;this.tabOptions._usePreset=this._usePreset;this.tabOptions._blockPresetFeatureList=this._blockPresetFeatureList;this.tabOptions._blockPresetCallback=this._blockPresetCallback;this.tabs=new ecount.layout.tab(this.tabOptions);this.tabs.render(this.$tabsContanier)},createItems:function(n){var i,t,r;ecount.__isEventCaptureMode()&&(i={type:"tabContents-initialize",self:this,tabs:n},ecount.eventLog("tabContents-initialize",i));var o=obj=null,u=this,f=u.containerName,e=!!this.additionalField;for(t in n)this._invalidateElementCount[t]=0,this.colWidth&&n[t].map(function(n){return n.colWidth=this.colWidth,n}.bind(this)),tabPane=new ecount.layout.tabPane({__HEADLESS:!0,containerName:f,__type:widget.generator.TABPANE,tabId:this.activeDropdownTabID&&this.activeTabId===t?this.activeDropdownTabID:t,colSize:this.colSize,onSync:this.onSync,delegator:this.events,pageType:this.pageType,ecPageID:this.ecPageID,_deactiveteDomDelete:this._deactiveteDomDelete,additionalField:e?this.additionalField.tabId===t?this.additionalField:null:null,items:n[t],report:this.report,eventContainer:this.eventContainer,formInfos:this.fOptions}),this.itemList.push(tabPane),tabPane.render(this.$tabPaneContanier),this.onSingleMode&&this.activeTabId===t&&tabPane.show(),r={colType:this.colSize},ecount.global.executeCallback(this.ecPageID,ecount.widget.FORM_LOAD_COMPLETE,r)},onloadTabPane:function(n){this._loadedItemCount++;var t=n.tabId;n.target=this.containerName;n.activeTabId=this.activeTabId;n.activeDropdownTabID=this.activeDropdownTabID;n.groupId=this.groupId;n.self=this;this.getDelegator().triggerEvent("tabPane.onload",n);this._loadedItemCount===(this.onSingleMode?1:this.tabOptions.itemCount)&&(this.hideTabList!==!0?this.$tabsContanier.show():this.hideTabList===!0&&(this.getTabs()._isShow=!1),this.$tabPaneContanier.show(),this.containerDelegator&&this.containerDelegator.triggerEvent("item.onload",{target:this.containerName,type:this.__type,self:this}),this.delegator&&this.delegator.triggerEvent("tabContents.onload",_.merge(n,{type:this.__type})))},onGridInitAddRow:function(n,t){return t},onGridRenderAllRowComplete:function(){this.adjustContentsDimensions()},changePreset:function(n,t){this.tabs.togglePreset(n);this.currentPresetId=n;var i=t&&t.target?t.target:this.getTabTarget(n);if(t)switch(i){case widget.generator.HEADER:this.getDelegator().triggerEvent("tabContents.onChangeHeaderPreset",t);break;case widget.generator.CONTENTS:this.getDelegator().triggerEvent("tabContents.onChangeContentsPreset",t)}},changeTab:function(n,t,i){this.tabs.toggle(n);this.changeTabPane(n,t);this.currentTabId=n;var r=i&&i.target?i.target:this.getTabTarget(n);r==widget.generator.HEADER?i&&this.getDelegator().triggerEvent("tabContents.onChangeHeaderTab",i):(r==widget.generator.CONTENTS||r==widget.generator.ROW)&&(i&&this.getDelegator().triggerEvent("tabContents.onChangeContentsTab",i),this.getDelegator().triggerEvent("page.adjustContentsDimensions"))},changeTabPane:function(n,t){if(!this.onSingleMode){var i=this.getTabHeight();this.itemList.forEach(function(r){r.isShow()&&r.tabId!=n&&r.deactivate();r.tabId==n&&(r.setReportTop(i),r.activate(null,t))})}},changeTabPosition:function(n,t){var r=this.tabs.$el.find("li"),i,u;r.length-1>t?this.tabs.$el[0].insertBefore(r[n],r[t+1]):this.tabs.$el[0].appendChild(r[n]);u=this.tabs.items[n];this.tabs.items.splice(n,1);this.tabs.items.splice(t,0,u);i=this.$el.find(".tab-pane");i.length-1>t?i.parent()[0].insertBefore(i[n],i[t+1]):i.parent()[0].appendChild(i[n]);u=this.itemList[n];this.itemList.splice(n,1);this.itemList.splice(t,0,u)},getTabInfo:function(n){return $.extend({FORM_TYPE:this.fOptions.formType,FORM_MASTER:this.fOptions.formTypeMaster,MAX_INDEX:this._customTabMaxIndex,FORM_SEQ:(n||"").replace("custom",""),FORM_TYPE_CODE:this.fOptions.formTypeCode},this.tabs.getTabInfo(n))},getPresetInfo:function(n){return $.extend({FORM_TYPE:this.fOptions.formType,FORM_MASTER:this.fOptions.formTypeMaster,FORM_SEQ:(n||"").replace("custom",""),FORM_TYPE_CODE:this.fOptions.formTypeCode,MAX_INDEX:this.tabs._presetMaxIndex},this.tabs.getTabInfo(n))},showErrorTab:function(n){this.tabs.showError(n)},hideErrorTab:function(n){this.tabs.hideError(n)},onSyncHandler:function(n){if(!n.__self._preventSync){var i=n.__self.pId||this.currentTabId,t=this;this.itemList.forEach(function(r){if(r.tabId!=i&&t.isNonSyncTab(i)==!1&&t.isNonSyncTab(r.tabId)==!1)if(n.type=="form.change")n.syncHandler&&n.syncHandler.apply(r.itemList[0],n.args);else{var u=t.getControl(n.cid,r.tabId);u&&(u.isCombinedControl()&&n.__self&&!n.__self.isCombinedControl()&&n.cid==n.__self.cid&&(u=t.getControl(n.cid,r.tabId).get(n.cid)),n.syncData?u.isCombinedControl()||u.reset(n.syncData,!1):n.syncHandler&&n.syncHandler.apply(u,n.args),n.nationalCode&&u.setNationalFlag(n.nationalCode))}})}},onChangeControlValidateState:function(n){var r=n.tabId,t,i,u;if(this._setInvalidStatus(r,n.method),n.control&&this.onSync&&this.isNonSyncTab(r)==!1)for(t in this.tabItems)r!=t&&this.isNonSyncTab(t)==!1&&(i=ecount.layout.container.prototype.getForm.call(this,t),i&&i.length>0&&(u=i[0].changeControlValidateState(n,!0),u&&this._setInvalidStatus(t,n.method)))},_onChangeControlValidateState:function(n){this.onChangeControlValidateState(n);this.activeTabId===n.tabId?(n.tabId=this.tabId,this.delegator.triggerEvent("control.changeValidate",n)):this.getDelegator().triggerEvent("control.changeValidate",n)},_onFirstActiveTab:function(n){n.FORM_TYPE=this.fOptions.formType;n.FORM_MASTER=this.fOptions.formTypeMaster;n.FORM_SEQ=n.tab.id.replace("custom","");n.FORM_TYPE_CODE=this.fOptions.formTypeCode;this.transferEvent(n)},_setInvalidStatus:function(n,t){t=="control.showError"?this._invalidateElementCount[n]++:this._invalidateElementCount[n]--;this._invalidateElementCount[n]>0?this.showErrorTab(n):this.hideErrorTab(n)},clearInvalidStatus:function(n){this._invalidateElementCount[n]=0;this.hideErrorTab(n)},clearAllInvalidStatus:function(){var i,t,n;for(i in this._invalidateElementCount)this.clearInvalidStatus(i);for(t=this.find(function(n){return n.__type==widget.generator.TABCONTENTS}),n=0;n<t.length;n++)t[n].clearAllInvalidStatus()},transferEvent:function(n){if(n.__eventType){var t=Array.prototype.slice.call(arguments);return this.delegator._triggerEvent.apply(this.delegator,[n.__eventType].concat(t))}this.delegator.triggerEvent(n.type,n)},getTabPane:function(n){for(var i=n||this.currentTabId,t=0,r=this.itemList.length;t<r;t++)if(this.itemList[t].tabId==i)return this.itemList[t];return null},getTabs:function(){return this.tabs},getCurrentTabId:function(){return this.currentTabId},getCurrentPresetId:function(){return this.currentPresetId},getAllPresetInfo:function(){return this.tabs.getAllPresetInfo()},getInvalidItemCount:function(n){return n?this._invalidateElementCount[n]:this._invalidateElementCount},hideTab:function(n){if(this.getTabPane(n))this.tabs.hideTab(n),this.resetErrorStatus(n);else if(n==ecount.layout.TEMP_NEW_TAB_ID)this.tabs.hideTab(n);else{var t=this.find(function(t){return t.__type=="tabContents"&&t.find(function(t){return t.__type=="tabPane"&&t.tabId==n}).length>0});t.length>0&&(t[0].tabs.hideTab(n),t[0].resetErrorStatus(n))}},showTab:function(n){if(this.getTabPane(n))this.tabs.showTab(n);else if(n==ecount.layout.TEMP_NEW_TAB_ID)this.tabs.showTab(n);else{var t=this.find(function(t){return t.__type=="tabContents"&&t.find(function(t){return t.__type=="tabPane"&&t.tabId==n}).length>0});t.length>0&&t[0].tabs.showTab(n)}},hideTabContainer:function(){this.$tabsContanier.hide()},showTabContainer:function(){this.$tabsContanier.show()},showExtraTab:function(n){switch(n){case 1:this.tabs.showTab(ecount.layout.TEMP_NEW_TAB_ID)}},hideExtraTab:function(n){switch(n){case 1:this.tabs.hideTab(ecount.layout.TEMP_NEW_TAB_ID)}},addPreset:function(n){this.tabs.addItems([n],!0)},removePreset:function(n){this.tabs.removePreset(n)},addTabPane:function(n){this.tabs.addItems([n],!0);var t={};t[n.id]=[this.createForm(n).end()];this.createItems(t);$.isNull(this.nonSyncTabs)&&(this.nonSyncTabs=[]);this.nonSyncTabs.push(n.id)},removeTabPane:function(n){var t;this.itemList.find(function(i,r){i.tabId===n&&(t=r)});this.tabs.$el.find("li#"+n).remove();this.getTabPane(n).removeItem(0);this.$tabPaneContanier.find("[data-container-id="+this.ecPageID+""+n+"]").remove();this.itemList.splice(t,1);this.hideSign()},addTabContents:function(n,t){var i=this.getTabPane(n);i.createItems(t)},resetErrorStatus:function(n){var i,r,t,f,u;for(this.hideErrorTab(n),this._invalidateElementCount[n]=0,i=ecount.layout.container.prototype.getForm.call(this,n),i&&i.length>0&&i[0].resetControlErrorStatus(),r=this.getTabChildIds(n),t=0;t<r.length;t++)f=t==0?r[t].parentTabId:r[t].childTabId,u=ecount.layout.container.prototype.getGrid.apply(this,[null,f]),u&&u.resetControlErrorStatus()},resetErrorStatusAll:function(){for(var n=0,t=this.itemList.length;n<t;n++)this.resetErrorStatus(this.itemList[n].tabId)},onRemoveAllTabPane:function(n){this.resetErrorStatus(n.tabId);this.transferEvent(n)},getCurrnetTabIds:function(n){var t=[{parentTabId:this.currentTabId}];return n||(n=this.currentTabId),this.getTabPane(this.currentTabId)&&this.getTabPane(n).find(function(n){n.__type!=widget.generator.TABCONTENTS||$.isEmpty(n.currentTabId)||t.push({childTabId:n.currentTabId})}),t},getTabChildIds:function(n){n||(n=this.currentTabId);var t=[{parentTabId:n}];return this.getTabPane(n)&&this.getTabPane(n).find(function(n){n.__type!=widget.generator.TABCONTENTS||$.isEmpty(n.currentTabId)||t.push({childTabId:n.currentTabId})}),t},_onInitTabContents:function(n){var t=this.$tabsContanier[0].style.width;t!=""&&(t=t.replace("px",""),t>0&&n.__self.setTabWidth(t))},getTabTarget:function(n){for(var r,t,i=0;i<this.itemList.length;i++)if(t=this.itemList[i],t.tabId==n){r=t.containerName;break}return r},setTabActionOption:function(n,t){this.tabs.setTabActiveOption(n,t)},isNonSyncTab:function(n){var t=this.nonSyncTabs;return t&&t.length>0?t.contains(n):!1},changeSign:function(n){$.isNull(this.$tabsSign)||$(this.$tabsSign).html(n)},showSign:function(){!$.isNull(this.$tabsSign)&&this.$tabsSign.hasClass("hidden")&&this.$tabsSign.removeClass("hidden")},hideSign:function(){$.isNull(this.$tabsSign)||this.$tabsSign.hasClass("hidden")||this.$tabsSign.addClass("hidden")},getDynamicTabCount:function(){return this.tabs&&this.tabs.items&&this.tabs.items.length>0?this.tabs.items.filter(function(n){return n.isDynamicTab}).length:0},setDropdownActiveTabStatus:function(n,t){t?this.tabs.setDropdownActiveTabSelect(n):this.tabs.setDropdownActiveTabCancel(n)},ON_CLICK:function(n,t,i,r){n.handler==ECountEvent.Type.CLICK_TAB?(this._useDynamicAdd&&this._isNewVersion&&this.addDynamicTab(r),_.extend(r,this.getTabInfo(r.tabId)),r.containerName=this.containerName,r.groupId=this.groupId):(r.command=="tab.close"||r.command=="preset.close")&&this.removeDynamicTab(r);n.handler=="click.preset"&&(r.containerName=this.containerName,_.extend(r,this.getPresetInfo(r.presetId)))},ON_CLICK_SERVICE:function(n,t,i,r){this.ON_CLICK(n,t,i,r)},addDynamicTab:function(n){n.tabId==ecount.layout.TEMP_NEW_TAB_ID?(this._originFormInfo&&(n.originFormInfo=this._originFormInfo),this.hideExtraTab(1),this.showSign()):n.tabId==ecount.layout.NEW_TAB_ID?this.showSign():this.hideSign()},checkPreset:function(n){return this.tabs.checkPreset(n)},renameTab:function(n){var t,i;arguments.length==2?(t=arguments[0],i=arguments[1]):(t=n.tabId,i=n.newname);this.fOptions&&this.fOptions.formType&&(n.formType=this.fOptions.formType,n.formTypeCode=this.fOptions.formTypeCode);n.tabIndex=t.replace("custom","");this.tabs.rename(t,i);this.getDelegator().triggerEvent("tab.rename",n)},renamePreset:function(n){var t,i;arguments.length==2?(t=arguments[0],i=arguments[1]):(t=n.tabId,i=n.newname);n.presetIndex=t.replace("custom","");this.tabs.rename(t,i);this.getDelegator().triggerEvent("preset.rename",n)},_onPresetDragComplete:function(n){this.getDelegator().triggerEvent("preset.dragComplete",n)},_onOpenBeforeLayer:function(n){this.getDelegator().triggerEvent("tab.openLayer",n)},removeDynamicTab:function(n){this.fOptions&&this.fOptions.formType&&(n.formType=this.fOptions.formType,n.formTypeCode=this.fOptions.formTypeCode);n.tabIndex=n.tabId.replace("custom","")},ON_KEYDOWN_ENTER:function(n,t,i,r){r.completeTabRename&&this._usePreset!==!0&&this.itemList.forEach(function(t){t.tabId==n.id&&t.activate()})},_checkEventBubbling:function(n){return n.ecFunction==="preset"?!1:!0},_ON_KEYDOWN_ARROW_UP:function(n){return this._checkEventBubbling(n)},_ON_KEYDOWN_ARROW_DOWN:function(n){return this._checkEventBubbling(n)},_ON_KEYDOWN_ARROW_LEFT:function(n){return this._checkEventBubbling(n)},_ON_KEYDOWN_ARROW_RIGHT:function(n){return this._checkEventBubbling(n)}});ecount.class("ecount.layout.tabPane","ecount.layout",{template:'<div class="tab-pane" style="display: none;"/>',itemList:null,_loadedItemCount:0,_deactiveteDomDelete:!1,$hideElements:null,init:function(){ecount.layout.prototype.init.apply(this,arguments);this._initDefaultData();this._initDefaultEvent();this.items&&this._initItemList();this.ecIKey=ecount.global.registerEcInstance(this)},_initDefaultData:function(){this.itemList=[];this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer)},_initDefaultEvent:function(){this.containerDelegator=new ecount.events;this.containerDelegator.register("item.onload",this,this.onLoadItems)},_initItemList:function(n,t){for(var i=null,u,f=n||this.items,r=0;r<f.length;r++)i=f[r],i.itemIndex=r,i.tabId=this.tabId,i.colSize=this.colSize||i.colSize,i.colWidth=i.colWidth||this.colWidth,i.onSync=this.onSync,i.containerName=this.containerName,i.__pnode=widget.generator.TABCONTENTS,i.ecPageID=this.ecPageID,i.eventContainer=this.eventContainer,i.delegator=this.delegator,i.__HEADLESS=this.__HEADLESS,i.formInfos=_.merge({},i.fOptions,this.formInfos),u=i.__type===widget.generator.CONTROL?this._createControlObject(i):this._createLayoutObject(i),this.itemList.push(u),t&&this._renderItemList([u])},_createControlObject:function(n){var t;return n.containerDelegator=this.containerDelegator,t=ecount.common.createNamespace(n.controlType),this.initializer&&ecount.control.initializeByUserSetting(this.initializer,n),new t(n)},_createLayoutObject:function(n){return this.pageType&&n.__type==widget.generator.FORM&&(n.pageType=this.pageType),n.tabItems&&n.__type==widget.generator.TABCONTENTS&&ecount.global.executeFuncWithScope(this.ecPageID,function(){this._isTabInTab=!0}),n.containerDelegator=this.containerDelegator,new ecount.layout[n.__type](n)},render:function(){ecount.layout.prototype.render.apply(this,arguments);this.report&&this.$el.append('<div class="wrapper-report"/>');this._deactiveteDomDelete&&(this.$hideElements=$("<div><\/div>"));this.items.length?(this._renderItemList(this.itemList),this.$el.attr("data-container-id",this.ecPageID+""+this.tabId)):this.onLoadItems()},_renderItemList:function(n){for(var t=0;t<n.length;t++)this.report?n[t].render(this.$el.find("div.wrapper-report")):n[t].render(this.$el)},destroy:function(){ecount.layout.prototype.destroy.call(this);this.containerDelegator.destroy()},_initFocus:function(){var t=ecount.layout.container.prototype.getForm.call(this),i=0,r,n;t.length>0&&(r=t[t.length-1],n=r.getControlByFindex(1)||r.getControlByIndex(0),n&&n.hasCheckControlType&&n.hasCheckControlType(n)&&(i=n.getInitFocusIndex()),n&&n.isVisibleElement(i)&&!ecount.isMobile&&n.setFocus(i))},activate:function(n,t){var r,u,i,f,e;if(this._deactiveteDomDelete&&this.$hideElements.children().length>0&&this.$el.append(this.$hideElements.children()),n!==!0&&ecount.layout.prototype.activate.apply(this,arguments),r=this.find(function(n){return n.__type==widget.generator.GRID}),r&&r.length)for(i=0,f=r.length;i<f;i++)r[i]._renderComplete==!0&&r[i].grid.redrawTbodyValidation&&r[i].grid.redrawTbodyValidation();if(u=this.find(function(n){return n.__type==widget.generator.FORM}),u&&u.length)for(i=0,f=u.length;i<f;i++)u[i].redrawControl();else e=this.__HEADLESS&&!n,e&&(this.__HEADLESS=!1,this.itemList.forEach(function(n){n.__type==widget.generator.CONTROL&&n.attachView()}));t!==!1&&(t||ecount.widget.isVisible(this.$el[0]))&&this._initFocus();this.containerName==widget.generator.HEADER&&this.delegator&&this.delegator.triggerEvent("page.adjustHeaderSearchDimensions")},deactivate:function(){var t,n,i;for(ecount.layout.prototype.deactivate.apply(this,arguments),t=this.find(function(n){return n.__type==widget.generator.FORM}),n=0,i=t.length;n<i;n++)t[n].redrawControl(!0);this._deactiveteDomDelete&&this.$hideElements.append(this.$el.children())},removeItem:function(n){this.delegator&&this.delegator.triggerEvent("tabPane.removeItem",{target:this.containerName,tabId:this.tabId,tabIndex:n,self:this});ecount.layout.container.prototype.removeItem.apply(this,arguments)},removeAll:function(){this.delegator&&this.delegator.triggerEvent("tabPane.removeAll",{target:this.containerName,tabId:this.tabId,self:this});ecount.layout.container.prototype.removeAll.apply(this,arguments)},onLoadItems:function(){var n=this.items.length;this._loadedItemCount++;(n===0||this._loadedItemCount==n)&&this.delegator.triggerEvent("tabPane.onload",{target:this.containerName,tabId:this.tabId,self:this})},setReportTop:function(n){var t=this.$el.find("div.wrapper-report");t.length>0&&t.css("top",n+"px")},createItems:function(n){this._initItemList(n,!0)}});ecount.class("ecount.layout.standAloneTabPane","ecount.layout.tabPane",{containerTemplate:'<div class="tab-content" />',template:'<div class="tab-pane"/>',itemList:null,_loadedItemCount:0,_deactiveteDomDelete:!1,$hideElements:null,init:function(n){this._setDefaultOptions(n);ecount.layout.tabPane.prototype.init.apply(this,arguments);this.list={};this.listKeyMap={};this.listLength={};this.listElement={};this.isAllList=!1;this.label=n.label;this.limit=n.limit;this.moreCount=1;this.moreBtn={};this.checkboxItems={};this.checkboxAllItems={};this.currentCategoryId=null;this.currentTargetId=null;this.currentCheckBoxTargetId=null;this.hideLink=n.hideAnchor;this.fileDropDownList=[];this._initList(n.list)},_setDefaultOptions:function(){},render:function(){ecount.layout.tabPane.prototype.render.apply(this,arguments);this._renderTodoList()},_initList:function(n){var i=this,t={};_.isArray(n)&&(t=i._convertObject(n));_.isFunction(n)&&(this._setIsAllList(!0),t=n(),_.each(t,function(n,r){t[r]=i._convertObject(n.list,r);i.setLimit(n.limit,r)}));this.setListData(t)},_convertObject:function(n,t){var u=this._getIsAllList(),i=this,r={},f=[];return _.each(n,function(n){r[n.id]=n;f.push(n.id);u?(i.listKeyMap[t]||(i.listKeyMap[t]=[]),i.listKeyMap[t].push(n.id)):(_.isArray(i.listKeyMap)||(i.listKeyMap=[]),i.listKeyMap.push(n.id))}),r},_renderTodoList:function(){var t=this,n,i=this.getListData(),u=this._getIsAllList(),r=!0;u?(_.each(i,function(i,u){_.isEmpty(i)||(n=t.createTodoList(i,u),t.$el[0].appendChild(n),r=!1)}),r&&(n=this.createTodoList(),t.$el[0].appendChild(n))):(n=this.createTodoList(i),t.$el[0].appendChild(n))},destroy:function(){for(var n=this.$el[0];n.firstChild;)n.removeChild(n.firstChild)},createNoData:function(){var i=document.createElement("ul"),r,n,t;return i.className="enote-nodata",r=document.createElement("li"),n=document.createElement("div"),n.className="enote-article",t=document.createElement("span"),t.className="note",t.innerText=ecount.resource.MSG00205,n.appendChild(t),r.appendChild(n),i.appendChild(r),i},createEnoteList:function(){var n=document.createElement("div");return n.className="enote-list",n},createGroupTitle:function(n,t){var e=this,s=this._getIsAllList(),r=document.createElement("div"),f=document.createElement("span"),o,u,i;return f.className="check",u=this.createCheckBox("enote-checkAll",t),this.setCheckboxAllElem(u.getElementsByClassName("enote-checkAll")[0],t),u.addEventListener("click",function(n){var t=n.target,i=t.checked,r=t.getAttribute("data-id");e.setCurrentCategoryId(r,i);e.setCheckAllItem(i,t.getAttribute("data-id"))}),i=document.createElement("a"),s?(i.text=n[_.keys(n)[0]].parentLabel,i.setAttribute("hrep","#group_"+t),i.setAttribute("data-toggle","collapse"),o=this.createCollapseArrow(t),i.appendChild(o)):(i.className="cursor-default",i.text=this.label),r.className="group-title",f.appendChild(u),r.appendChild(f),r.appendChild(i),r},createCollapseArrow:function(n){var i=this,t=document.createElement("span");return t.className="collapse-arrow",t.style.cursor="pointer",t.setAttribute("data-id",n),t.addEventListener("click",function(n){var t=n.target,r=t.getAttribute("data-id");i.setCurrentTargetId(r)}),t},createList:function(n,t){var r=this,i=document.createElement("ul");return _.isUndefined(t)?i.setAttribute("data-id",this.tabId):i.setAttribute("data-id",t),_.isPlainObject(n)&&this._createUl(i,n,t),i.addEventListener("click",function(n){var t=$(n.target).closest("li").attr("data-id"),i=$(n.target).closest("ul").attr("data-id");r.setCurrentTargetCategoryId(i);r.setCurrentTargetId(t)}),i},updateList:function(n,t,i){var e=this,o=this.getListData(n),r=this.getListElement(n),u,f=[];t&&(o[t]=i,_.each(r.children,function(n){_.isEqual(n.getAttribute("data-id"),t)&&f.push(n)}),_.each(f,function(n){u=e._createList(i,t);r.insertBefore(u,n);r.removeChild(n)}))},removeList:function(n,t){var u=this.getListData(n),i=this.getListElement(n),r=[];_.isArray(t)&&!_.isEmpty(t)&&_.each(t,function(n){var t=n.id;delete u[t];_.each(i.children,function(n){_.isEqual(n.getAttribute("data-id"),t)&&r.push(n)});_.each(r,function(n){i.removeChild(n)})})},removeListAll:function(n){var i=this.getListElement(n),t=this.getListData(n),u=this.getCheckboxItems(n),r=[];_.isEmpty(t)||(_.each(t,function(n){delete t[n.id];delete u[n.id]}),_.each(i.children,function(n){r.push(n)}),_.each(r,function(n){i.removeChild(n)}),this.setListDataLength(t,n),this.listKeyMap=[])},addList:function(n,t,i){var r=this,u=this.getListData(t),f=this.getListElement(t);this.removeListAll(t);_.isArray(i)&&(_.each(i,function(n){r.listKeyMap.push(n.id);n.parentLabel=r.label;n.parentId=r.tabId;u[n.id]=n;var i=r._createList(n,t);f.appendChild(i)}),this.setListDataLength(i,t));this._checkedItem(t)},_createUl:function(n,t,i){var e=this,o=this._getIsAllList(),r,u,f;r=o?this.listKeyMap[i]:this.listKeyMap;_.each(r,function(r){f=t[r];u=e._createList(f,i);n.appendChild(u)})},_createList:function(n,t){var u=this.getLimit(t),i=document.createElement("li");i.className="enote-li";var f=this.createCheck(n.id,t,n.checked),r,e=this.createArticle(n),o=this.createTime(n.time,n.notify);return i.setAttribute("data-id",n.id),i.appendChild(f),this.hideLink||_.isNumber(n.fileCount)&&n.fileCount>0&&(r=this.createComment(n.fileCount),i.appendChild(r)),i.appendChild(e),i.appendChild(o),n.index>=u&&i.classList.add("hidden"),i},createMoreList:function(n){var u=this._getIsAllList(),t=document.createElement("div"),i=document.createElement("span"),r=this.getLimit(n),f=this.getListDataLength(n);return i.innerText=ecount.resource.LBL09004,t.className="more-list",u?t.setAttribute("data-id",n):t.setAttribute("data-id",this.tabId),r>=f&&t.classList.add("hidden"),_.isUndefined(r)&&t.classList.add("hidden"),t.appendChild(i),this.setMoreBtn(t,n),t},createCheck:function(n,t,i){var r=this,u=document.createElement("div"),f=this.createCheckBox("enote-check",n,i),e;return i&&(this.setCurrentCategoryId(t,i),this.setCurrentTargetCategoryId(t)),e=this._getIsAllList(),u.className="check",u.appendChild(f),this.setCheckboxItems(f.getElementsByClassName("enote-check")[0],n,t),f.addEventListener("click",function(n){var t=$(n.target).closest("ul").attr("data-id"),i=n.target.getAttribute("data-id");n.target.checked?r.setCurrentCheckBoxTargetId(i):r.setCurrentCheckBoxTargetId();r.setCurrentCategoryId(t,n.target.checked);r.setCurrentTargetCategoryId(t);r._checkedItem()}),u},_checkedItem:function(n){var n=n||this.getCurrentTargetCategoryId(),r=this.getListDataLength(n),t=this.getCheckboxItems(n),i=0,u=this.getCheckboxAllElem(n);t&&_.isPlainObject(t)&&_.size(t)>0&&(_.each(t,function(n){n.checked&&(i+=1)}),u.checked=r===i?!0:!1)},createCheckBox:function(n,t,i){var u=document.createElement("span"),r,f;return u.classList.add("form-checkbox"),u.classList.add("form-checkbox-text-no"),r=document.createElement("input"),r.type="checkbox",r.className=n,i&&(r.checked=i),f=document.createElement("label"),t&&r.setAttribute("data-id",t),u.appendChild(r),u.appendChild(f),u},createComment:function(n){var i=new ecount.control.anchor({}),t=document.createElement("div");return t.innerText="["+n+"]",t.className="attached-link",t},createArticle:function(n){var i=document.createElement("div");i.className="enote-article";var f=document.createElement("span"),o=document.createElement("span"),t,e=n.article,s=n.isNew,r=n.label,u=n.labelColor;return _.isBoolean(s)&&s&&(o.className="icon-list-new",i.appendChild(o)),_.isString(r)&&!_.isEmpty(r)&&(t=document.createElement("span"),t.className=u>"#dddddd"?"label label-light":"label",t.innerText=r,t.style.backgroundColor=u,i.appendChild(t)),_.isArray(r)&&!_.isEmpty(r)&&_.each(r,function(n,r){t=document.createElement("span");t.className=u[r]>"#dddddd"?"label label-light":"label";t.innerText=n;t.style.backgroundColor=u[r];i.appendChild(t)}),_.isString(e)&&!_.isEmpty(e)&&(f.className="note",f.innerHTML=e,i.appendChild(f)),i},createTime:function(n,t){var i=document.createElement("div"),r="";return i.className="enote-time",r=$.isEmpty(n)&&$.isEmpty(t)?"":!$.isEmpty(n)&&$.isEmpty(t)?n:n+" / "+t,i.innerText=r,i},createDrag:function(){var n=document.createElement("div");return n.className="enote-drag",n},createTodoList:function(n,t){var o=this._getIsAllList(),i=this.createEnoteList(),u,r,f,e;return _.isEmpty(n)?(e=this.createNoData(),i.appendChild(e)):(u=this.createGroupTitle(n,t),r=this.createList(n,t),this.setListElement(t,r),i.appendChild(u),i.appendChild(r),f=this.createMoreList(t),i.appendChild(f)),i},activate:function(n,t){n!==!0&&this.$el.addClass("active");t!==!1&&(t||ecount.widget.isVisible(this.$el[0]))&&this._initFocus()},deactivate:function(){this.$el.removeClass("active")},setListElement:function(n,t){var i=this._getIsAllList();i?_.set(this,["listElement",n],t):_.set(this,["listElement"],t)},getListElement:function(n){var t=this._getIsAllList();return t?this.listElement[n]:this.listElement},setCurrentTargetCategoryId:function(n){this.currentTargetCategoryId=n},getCurrentTargetCategoryId:function(){return this.currentTargetCategoryId},setCurrentCategoryId:function(n,t){var f=this._getIsAllList(),i,r,u=!0;if(f)_.isArray(this.currentCategoryId)||(this.currentCategoryId=[]),t?(i=_.findIndex(this.currentCategoryId,function(t){return t===n}),i<0&&this.currentCategoryId.push(n)):(r=this.getCheckboxItems(n),_.each(r,function(n){n.checked&&(u=!1)}),u&&_.remove(this.currentCategoryId,function(t){return t===n}));else return this.currentCategoryId=n},getCurrentCategoryId:function(){return this.currentCategoryId},setCurrentTargetId:function(n){this.currentTargetId=n},getCurrentTargetId:function(){return this.currentTargetId},setCurrentCheckBoxTargetId:function(n){this.currentCheckBoxTargetId=n},getCurrentCheckBoxTargetId:function(){return this.currentCheckBoxTargetId},getCheckedItems:function(){var u=this,n,r=this.getCurrentCategoryId(),f=this._getIsAllList(),t,i;return f?(n={},_.each(r,function(r){t=u.getCheckboxItems(r);i=u.getListData(r);_.each(t,function(t,u){t.checked&&(_.isArray(n[r])||(n[r]=[]),n[r].push(i[u]))})})):(n=[],t=this.getCheckboxItems(r),i=this.getListData(r),_.each(t,function(t,r){t.checked&&n.push(i[r])})),n},setCheckAllItem:function(n,t){var i=this.getCheckboxItems(t),r=this._getIsAllList();_.each(i,function(t){t.checked=n})},setCheckboxAllElem:function(n,t){var i=this._getIsAllList();i?this.checkboxAllItems[t]=n:this.checkboxAllItems=n},getCheckboxAllElem:function(n){var t=this._getIsAllList();return t?this.checkboxAllItems[n]:this.checkboxAllItems},setCheckItem:function(n){var t=this.getCheckboxItems();_.each(t,function(t,i){n===i&&(t.checked=!0)})},setListData:function(n){this.list=n;this.setListDataLength(n)},setListDataById:function(){},getListData:function(n){var t=this._getIsAllList();return t?n?this.list[n]:this.list:this.list},getListDataById:function(n,t){var i=this.getListData(n);return i[t]},setListDataLength:function(n,t){var i=this,r=this._getIsAllList();r?t?i.listLength[t]=_.size(n):_.each(n,function(n,t){i.listLength[t]=_.size(n)}):this.listLength=_.size(n)},getListDataLength:function(n){var t=this._getIsAllList();return t?this.listLength[n]:this.listLength},_setIsAllList:function(n){this.isAllList=n},_getIsAllList:function(){return this.isAllList},setCheckboxItems:function(n,t,i){var f=this._getIsAllList(),u=_.isUndefined(t)?null:t.toString(),r=_.isUndefined(i)?null:i.toString();f?(this.checkboxItems[r]||(this.checkboxItems[r]={}),this.checkboxItems[r][u]=n):this.checkboxItems[u]=n},getCheckboxItems:function(n){_.isUndefined(n)&&(n=this.getCurrentCategoryId());var t=this._getIsAllList();return t?this.checkboxItems[n]:this.checkboxItems},setLimit:function(n,t){var i=this._getIsAllList();i?(_.isPlainObject(this.limit)||(this.limit={}),_.set(this.limit,[t],n)):this.limit=n},getLimit:function(n){var t=this._getIsAllList();return t?this.limit[n]:this.limit},setMoreCount:function(n,t){var i=this.getListDataLength(t),r=this.getLimit(t),u=r*n;u<i&&(this.moreCount=n)},getMoreCount:function(){return this.moreCount},setMoreBtn:function(n,t){var i=this._getIsAllList();i?_.set(this.moreBtn,[t],n):this.moreBtn=n},getMoreBtn:function(n){var t=this._getIsAllList();return t?this.moreBtn[n]:this.moreBtn},showMoreBtn:function(n){var t=this.getMoreBtn(n);t&&t.classList.remove("hidden")},hideMoreBtn:function(n){var t=this.getMoreBtn(n);t&&t.classList.add("hidden")},removeNewIcon:function(){var t=this.currentTargetCategoryId,i=this.$el.find("ul[data-id="+t+"]"),r=this.currentTargetId,n=i.find("[data-id="+r+"] .icon-list-new");n&&n.length>0&&n.remove()},showMoreItems:function(n){var t=n.getAttribute("data-id"),u=this.getLimit(t),i=this.getMoreCount(),f=u*(i+1),e=this._getIsAllList(),r;return r=e?this.getListElement(t).children:this.getListElement().children,_.each(r,function(n,t){n.classList.contains("hidden")&&t<f&&n.classList.remove("hidden")}),this.setMoreCount(i+1,t),t},toggleCollapse:function(n){var t=this.getListElement(n),i=this.getMoreBtn(n);$(t).slideToggle();$(i).slideToggle()},showFileList:function(n){var t={HID:this.getCurrentTargetId()};ecount.common.api({url:"/SVC/Common/Infra/GetRefData",ecPageID:this.ecPageID,async:!0,data:Object.toJSON(t),success:function(n){if(n.Data){var i=ecmodule.common.slipLink.setRefDataChange(n.Data,t);this.fileDropDownList=[];$.each(i,function(n,t){this.fileDropDownList.push({label:t.NAME||t.name,value:"download"+n,liCss:t.iconType,fileInfo:t})}.bind(this))}}.bind(this),error:function(n,t,i){ecount.error(i.Message,{title:"System Error "+t,trace:i.MessageDetail})},complete:function(){$.isEmpty(this.fileDropDownList)||this._ON_SUB_LINK_DROPDOWN_DISPLAY(n,this.fileDropDownList)}.bind(this)})},_ON_SUB_LINK_DROPDOWN_DISPLAY:function(n,t){var i=this.getSubLinkDropdownOption(n,t);ecount.layer.show(i)},getSubLinkDropdownOption:function(n,t){var i=$(n.target);return{type:"dropdown",css:"dropdown-menu-icon-list dropdown-menu-fixed-height",showingUpDelay:0,ecPageID:this.ecPageID,ecFunction:"tabMenu",serviceKey:ecount.common.makeServiceKey(this.ecPath,t.id),ownerKey:this.ecIKey,items:t||[],boundary:ec$.getZoomedBoundary(i[0])}},ON_CLICK:function(n,t,i,r){var s=this._getIsAllList(),e=this.getCurrentTargetId(),h=this.getCurrentCheckBoxTargetId(),u=t.target,c=this.tabId,f=this.getListData(),o,l=u.parentNode.classList.contains("more-list");if(!s||l||(o=this.getCurrentTargetCategoryId(),f=f[o],o)){u.classList.contains("attached-link")||u.classList.contains("check")||u.parentNode.classList.contains("enote-li")&&(u=u.parentNode);u.parentNode.classList.contains("enote-article")&&(u=u.parentNode);u.parentNode.classList.contains("more-list")&&(u=u.parentNode);r.enoteInstance=this;r.tabId=c;switch(u.className){case"enote-article":case"enote-li":r.command="onClickEnote";r.targetItem=f[e];break;case"enote-check":r.command="onClickEnoteCheckBox";r.targetItem=f[h];break;case"enote-checkAll":r.command="onClickEnoteCheckBoxAll";break;case"more-list":r.targetId=u.getAttribute("data-id");r.command="onClickEnoteMoreButton";break;case"collapse-arrow":this.toggleCollapse(e);r.command="onClickEnoteCollapse";break;case"attached-link":this.showFileList(event,f[e]);r.command="onClickEnoteFileLink";r.targetItem=f[e]}}}});ecount.class("ecount.layout.row","ecount.layout.container",{template:'<div class="row {{css}}"><\/div>',itemList:null,colSize:1,prevScrollTop:0,init:function(){ecount.layout.container.prototype.init.apply(this,arguments);this.itemList=[]},render:function(n){var i=[],u={},r={},f="",e=1,o,t,s;if(this.$el=n,this._width&&this.$el.css("width",this._width),this.hidden&&this.$el.addClass("hidden"),this.colGroup)for(o=this.template.replace("{{css}}",this.css||""),u=$(o).appendTo(this.$el),this.items=[],t=0,s=this.colGroup.length;t<s;t++)i=this.colGroup[t].items,f=this.colGroup[t].columnType!=undefined?this.colGroup[t].columnType:"xs",e=this.colGroup[t].columnSize!=undefined?this.colGroup[t].columnSize:1,colClass=this.colGroup[t].colClass!=undefined?this.colGroup[t].colClass:"",colFixed=this.colGroup[t].colFixed!=undefined?this.colGroup[t].colFixed:!1,marginTop=this.colGroup[t].marginTop!=undefined?this.colGroup[t].marginTop:0,i&&(r=$(String.format('<div class="col-{0}-{1} {2}"/>',f,e,colClass,colFixed)).appendTo(u),colFixed&&(this.setColFixedTarget(r),this.$colFixedTarget.css({position:"absolute",top:"0",right:"0"}),marginTop>0&&this.$colFixedTarget.css({"margin-top":marginTop}),ecount.constValue.isIE&&this.$colFixedTarget.css({transition:"all 0.2s ease"}),this.bindScrollEvent(this.ecPageID,this._ON_SCROLL.bind(this))),this.createItems(i,r));else this.createItems(this.items)},get:function(n){return this.itemList[n]},getColFixedTarget:function(){return this.$colFixedTarget},setColFixedTarget:function(n){this.$colFixedTarget=n},ON_SCROLL:function(n){var i=this.getColFixedTarget(),t=n.target.scrollTop,r=i[0].offsetHeight,u=n.target.offsetHeight,f=i[0].offsetTop;r>=u?this.prevScrollTop<t?t>=r-u&&i.css({top:t-(r-u)-5+"px"}):t<=f&&i.css({top:t+"px"}):i.css({top:t+"px"});this.prevScrollTop=t}});ecount.class("ecount.layout.divContainer","ecount.layout.container",{template:null,itemList:null,init:function(){ecount.layout.container.prototype.init.apply(this,arguments);this.itemList=[];this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer)},render:function(n){var t=this.text!=undefined?this.text:"";this.$el=$(String.format('<div class="{0}">{1}<\/div>',this.css,t));this.$el.appendTo(n);this._createDisplayIDs(this.items);this.createItems(this.items,this.$el)},_createDisplayIDs:function(n){var i={},t;for(n=n||[],t=0;t<n.length;t++)i=n[t],ecount.widget.createDisplayID(i,"btn",this.__target)},onLoadItems:function(){_.isFunction(this.scrollCallback)&&this.$el.bind("scroll.div."+this.ecPageID,function(n){var i=this.$el[0].scrollHeight,t=Math.ceil(this.$el[0].scrollTop),r=this.$el[0].clientHeight,u={event:n,target:this.$el[0],scrollTop:t,scrollHeight:i,clientHeight:r,isShowScrollBtn:t>100,isScrollEnd:i-(t+r)<30};this.scrollCallback&&this.scrollCallback(u)}.bind(this));ecount.layout.container.prototype.onLoadItems.apply(this,arguments)},setScrollTop:function(){this.$el.animate({scrollTop:0},200)},get:function(n){return this.itemList[n]},setFixedPosition:function(n){if(_.isPlainObject(n)){var t={position:"fixed",backgroundColor:"white",paddingRight:"5px"};n.isFixed?(n.top&&(t.top=n.top),n.width&&(t.width=n.width),n.zIndex&&(t.zIndex=n.zIndex)):t={position:"",backgroundColor:"",top:"",width:"",zIndex:"",paddingRight:""};this.$el.css(t)}}});ecount.class("ecount.layout.ul","ecount.layout",{template:'<ul class="{{css}}" {{userData}}><\/ul>',items:[],itemList:[],userData:{},init:function(){ecount.layout.prototype.init.apply(this,arguments);this._initializeData()},_initializeData:function(){this.itemList=[];this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this._initDelegator()},_initDelegator:function(){this.events=new ecount.events(this);this.events.on({"control.change":this._ON_CHANGE_CONTROL,"control.openPopup":this.transferEvent,"control.focusout":this._ON_MOVE_FOCUS,"control.showError":this._ON_SHOWERROR_CONTROL,"control.hideError":this._ON_HIDEERROR_CONTROL,"control.focusin":this._ON_FOCUSIN_CONTROL,"dateControl.display":this._ON_DISPLAY_DATECONTROL,"dualMode.buttonDisplay":this._ON_DUAL_MODE_BUTTON_DISPLAY,"dualMode.dropdownDisplay":this._ON_DUAL_MODE_DROPDOWN_DISPLAY,"dualMode.changeDualMode":this.changeDualMode,"dualMode.changeSubTitle":this._changeSubTitleByDualStep,"form.changeSubTitle":this._changeSubTitle,"form.sync":this.onSyncHandler,"page.adjustHeaderSearchDimensions":this.transferEvent,"page.adjustContentsDimensions":this.transferEvent,"page.showProgressbar":this.transferEvent,"page.hideProgressbar":this.transferEvent,"page.toggleProgressbarLayer":this.transferEvent,"control.openLayer":this.transferEvent,scope:this})},render:function(){this.setTemplate();ecount.layout.prototype.render.apply(this,arguments);_.isArray(this.items)&&this.items.length>0&&this.createItems()},setTemplate:function(){this.template=ecount.widget.replaceAttr(this.template,{css:this.css||"",userData:this.setUserData()})},setUserData:function(){var n=[];for(var t in this.userData)n.push("data-"+t+'="'+this.userData[t]+'"');return n.join(" ")},destroy:function(){this.events.destroy();ecount.layout.prototype.destroy.call(this)},getEcPath:function(){return this.ecPath},getEcIKey:function(){return this.ecIKey},setEcIKey:function(){this.ecIKey=ecount.global.registerEcInstance(this)},createItems:function(){var u=this.items,e=this.$el,n,t,r,i,f;if(u.length>0)for(i=0,f=u.length;i<f;i++)n=u[i],n.itemIndex=i,n.delegator=this.delegator,n.containerDelegator=this.events,n.ecPageID=this.ecPageID,n.inIncludePage=this.inIncludePage,n.__type===widget.generator.CONTROL&&(r=$("<li><\/li>"),n.liCss&&r.addClass(n.liCss),t=ecount.common.createNamespace(n.controlType),this.initializer&&ecount.control.initializeByUserSetting(this.initializer,n),t=new t(n),this.itemList.push(t),t.render(r),e.append(r),t=null)}});ecount.class("ecount.layout.timeline","ecount.layout",{template:'<div class="wrapper-timeline">{{title}}<ul class="{{css}}">{{emptyTemp}}<\/ul><\/div>',data:[],items:[],noDataText:"no data",noSearchText:"no search",init:function(n){ecount.layout.prototype.init.apply(this,arguments);this._initializeData(n)},_initializeData:function(n){this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadItems.bind(this));this.noDataText=_.isNil(n.noDataText)?ecount.resource.MSG00205:n.noDataText;this.noSearchText=_.isNil(n.noSearchText)?ecount.resource.LGN00234:n.noSearchText},render:function(){this._setTemplate();ecount.layout.prototype.render.apply(this,arguments);this._firstRenderItems();this.ecTransaction.start()},_setTemplate:function(){this.template=ecount.widget.replaceAttr(this.template,{title:this.title?'<div class="date">'+this.title+"<\/div>":"",css:this.css||"",emptyTemp:this.getEmptyTemp()})},setTitle:function(n){n&&(this.title=n,this.$el.find("div.date").text(n))},getTitle:function(){return this.title},_firstRenderItems:function(){this.$ul=this.$el.find("ul");this.$emptyLi=this.$ul.find("li.nodata");this._renderItems(this._addItems(this.data))},_addItems:function(n){var r=[],i,t,u;for(_.isArray(n)||(n=[n]),i=0;i<n.length;i++)t=n[i],u={pKey:t.pKey||_.padStart(i+"",5,"0"),title:t.title||"-",menutitle:t.menutitle||"-",contents:t.contents||"-",clickable:t.clickable===!1?!1:!0,data:t.data||{}},r.push(u);return this.items=this.items.concat(r),r},addItems:function(n){n&&this._renderItems(this._addItems(n))},getItems:function(n){return _.isNil(n)?this.items:this.items[n]},getItemsByPKey:function(n){return _.isNil(n)?this.items:this.items.find(function(t){return t.pKey==n})},removeItems:function(n,t){if(_.isNil(n))this.items=[],this.$ul.children().not(".nodata").remove();else{var i=_.remove(this.items,function(t){return t.pKey==n});i&&i.length>0&&this.$ul.find("li[data-pkey='"+n+"']").remove()}t||this.items.length!=0||this._renderItems()},_renderItems:function(n){function f(n){var i=[],t;for(n||(n=[""]),_.isArray(n)||(n=[n]),t=0;t<n.length;t++)i.push("<div>"+n[t]+"<\/div>");return i.join("\n")}var u,r,i,t;if(!n||n.length===0){this.setEmptyLiDisplay(!0,!1);return}for(u=this.getLiTemp(),r=[],i=0;i<n.length;i++)t=n[i],r.push(ecount.widget.replaceAttr(u,{pKey:t.pKey,title:t.title,contents:f(t.contents),menutitle:t.menutitle,notClickClass:t.clickable?"":"state-delete"}));this.setEmptyLiDisplay(!1,!1);this.$ul.append(r.join("\n"))},getLiTemp:function(){return'<li data-pkey="{{pKey}}">\n<div class="time">{{title}}<\/div>\n<div class="menu">{{menutitle}}<\/div>\n<div class="subject">{{contents}}<\/div>\n<\/li>'},getEmptyTemp:function(){return'<li class="nodata hidden">'+this.noDataText+"<\/li>"},setEmptyLiDisplay:function(n,t){n?this.$emptyLi.removeClass("hidden"):this.$emptyLi.addClass("hidden");t?this.$emptyLi.text(this.noSearchText):this.$emptyLi.text(this.noDataText)},setEmptyDataText:function(n){this.noDataText=_.isNil(n)?ecount.resource.MSG00205:n},setEmptySearchText:function(n){this.noSearchText=_.isNil(n)?ecount.resource.LGN00234:n},destroy:function(){ecount.layout.prototype.destroy.call(this)},getFindItems:function(n){if(n&&_.isString(n))return this.items.filter(function(t){var i=new RegExp(n,"gi"),r=t.title+" "+(_.isArray(t.contents)?t.contents.join(" "):t.contents);return i.test(r)})},showItemsSearch:function(n){var t=this.$ul.find("li:not(.nodata)"),r,f,i,u;if(n)if(r=this.getFindItems(n),r&&r.length>0){for(f=r.map(function(n){return n.pKey}),i=0;i<t.length;i++)u=t[i].dataset&&t[i].dataset.pkey,t[i].className=u&&!!~_.indexOf(f,u)?ecount.convertor.removeClass(t[i].className,"hidden"):ecount.convertor.uniqSumClass(t[i].className,"hidden");this.setEmptyLiDisplay(!1,!0)}else t.addClass("hidden"),this.setEmptyLiDisplay(!0,!0);else t.removeClass("hidden"),this.items.length>0?this.setEmptyLiDisplay(!1,!1):this.setEmptyLiDisplay(!0,!1)},ON_CLICK:function(n,t){var u=null,i=null,f,r;if(t&&(!t||t.target)&&ecview.util.showTimeOverCheck(200)){if(i=t.target.tagName=="LI"?$(t.target):$(t.target).parents("li"),i&&i.length>0){if(f=i.data("pkey"),r=this.getItemsByPKey(f),!r||r&&!r.clickable||i.hasClass("nodata"))return;u={event:t,liTarget:i,item:r}}u&&this.delegator&&this.delegator.triggerEvent("page.customPageInvoke",_.merge({commandName:_.camelCase("on_"+this.containerName+"_timeline_click")},u))}}});ecount.class("ecount.layout.bookmark","ecount.layout",{template:'<div class="wrapper-favourite"><ul class="{{css}}">{{emptyTemp}}<\/ul><\/div>',data:[],items:[],noDataText:"no data",noSearchText:"no search",init:function(n){ecount.layout.prototype.init.apply(this,arguments);this._initializeData(n)},_initializeData:function(n){this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadItems.bind(this));this.noDataText=_.isNil(n.noDataText)?ecount.resource.MSG00205:n.noDataText;this.noSearchText=_.isNil(n.noSearchText)?ecount.resource.LGN00234:n.noSearchText},render:function(){this._setTemplate();ecount.layout.prototype.render.apply(this,arguments);this._firstRenderItems();this.ecTransaction.start()},_setTemplate:function(){this.template=ecount.widget.replaceAttr(this.template,{css:this.css||"",emptyTemp:this.getEmptyTemp()})},_firstRenderItems:function(){this.$ul=this.$el.find("ul");this.$emptyLi=this.$ul.find("li.nodata");this._renderItems(this._addItems(this.data))},_addItems:function(n){var r=[],t,i,u;for(_.isArray(n)||(n=[n]),t=0;t<n.length;t++)i=n[t],u={pKey:i.pKey||_.padStart(t+"",5,"0"),title:i.title||"-",contents:i.contents||"-",data:i.data||{}},r.push(u);return this.items=this.items.concat(r),r},addItems:function(n){n&&this._renderItems(this._addItems(n))},getItems:function(n){return _.isNil(n)?this.items:this.items[n]},getItemsByPKey:function(n){return _.isNil(n)?this.items:this.items.find(function(t){return t.pKey==n})},removeItems:function(n,t){if(_.isNil(n))this.items=[],this.$ul.children().not(".nodata").remove();else{var i=_.remove(this.items,function(t){return t.pKey==n});i&&i.length>0&&this.$ul.find("li[data-pkey='"+n+"']").remove()}t||this.items.length!=0||this._renderItems()},_renderItems:function(n){function f(n){var i=[],t;for(n||(n=[""]),_.isArray(n)||(n=[n]),t=0;t<n.length;t++)i.push("<div>"+n[t]+"<\/div>");return i.join("\n")}var u,r,t,i;if(!n||n.length===0){this.setEmptyLiDisplay(!0,!1);return}for(u=this.getLiTemp(),r=[],t=0;t<n.length;t++)i=n[t],r.push(ecount.widget.replaceAttr(u,{pKey:i.pKey,title:i.title,contents:f(i.contents)}));this.setEmptyLiDisplay(!1,!1);this.$ul.append(r.join("\n"))},getLiTemp:function(){return'<li data-pkey="{{pKey}}">\n<div class="menu">{{title}}<\/div>\n<div class="subject">{{contents}}<\/div>\n<div class="close"><\/div>\n<\/li>'},getEmptyTemp:function(){return'<li class="nodata hidden">'+this.noDataText+"<\/li>"},setEmptyLiDisplay:function(n,t){n?this.$emptyLi.removeClass("hidden"):this.$emptyLi.addClass("hidden");t?this.$emptyLi.text(this.noSearchText):this.$emptyLi.text(this.noDataText)},setEmptyDataText:function(n){this.noDataText=_.isNil(n)?ecount.resource.MSG00205:n},setEmptySearchText:function(n){this.noSearchText=_.isNil(n)?ecount.resource.LGN00234:n},destroy:function(){ecount.layout.prototype.destroy.call(this)},getFindItems:function(n){if(n&&_.isString(n)){n=n.trim();return this.items.filter(function(t){var i=new RegExp(n,"gi"),r=t.title+" "+(_.isArray(t.contents)?t.contents.join(" "):t.contents);return i.test(r)})}},showItemsSearch:function(n){var t=this.$ul.find("li:not(.nodata)"),r,f,i,u;if(n)if(r=this.getFindItems(n),r&&r.length>0){for(f=r.map(function(n){return n.pKey}),i=0;i<t.length;i++)u=t[i].dataset&&t[i].dataset.pkey,t[i].className=u&&!!~_.indexOf(f,u)?ecount.convertor.removeClass(t[i].className,"hidden"):ecount.convertor.uniqSumClass(t[i].className,"hidden");this.setEmptyLiDisplay(!1,!0)}else t.addClass("hidden"),this.setEmptyLiDisplay(!0,!0);else t.removeClass("hidden"),this.items.length>0?this.setEmptyLiDisplay(!1,!1):this.setEmptyLiDisplay(!0,!1)},ON_CLICK:function(n,t){var r=null,i=null,f,u;if(t&&(!t||t.target)&&ecview.util.showTimeOverCheck(200)){if(i=t.target.tagName=="LI"?$(t.target):$(t.target).parents("li"),i&&i.length>0){if(f=i.data("pkey"),u=this.getItemsByPKey(f),!u||i.hasClass("nodata"))return;r={event:t,liTarget:i,item:u,isDelete:t.target.tagName=="DIV"&&t.target.className=="close"}}r&&this.delegator&&this.delegator.triggerEvent("page.customPageInvoke",_.merge({commandName:_.camelCase("on_"+this.containerName+"_bookmark_click")},r))}}});ecount.class("ecount.layout.layerDropdown","ecount.layout",{template:null,templateTable:null,templateBody:null,templateLink:'<a href="javascript:;" data-trigger="click" class="{{css}}" data-cid="{{CID}}" data-identify="{{IDENTIFY}}" data-value="{{VALUE}}">{{TITLE}}<\/a>',isShow:!1,useOuterClick:!0,init:function(){ecount.layout.prototype.init.apply(this,arguments);this.initProperties();this.bodyClickHandler=function(n){var t=n.target;t&&t.getAttribute&&t.getAttribute("data-trigger")=="click"||this.hide.call(this,n)}.bind(this)},initProperties:function(){},render:function(){ecount.layout.prototype.render.apply(this,arguments);this.items&&this.addItems();this.bindEvents();this.$el.hasClass("position-fixed")||this.$el.addClass("position-fixed");this.$el&&this.$el[0]&&this.$el[0].setAttribute("data-ulecpageid",this.ecPageID)},bindEvents:function(){this.$el.on("click","a[data-trigger=click]",this.clickHandler.bind(this))},makeLinkButton:function(n,t,i){var r=ecount.resource;return this.templateLink.replace(/{{CID}}/g,this.pcid).replace(/{{IDENTIFY}}/g,n[this.column.identify]).replace(/{{TITLE}}/g,r[t||n[this.column.res]]).replace(/{{VALUE}}/g,i||"").replace(/{{css}}/g,n.css||"")},toggle:function(){this.isShow?this.hide(event):this.show(event)},show:function(){this.isShow||(this.isShow=!0,this.onBeforeShow&&this.onBeforeShow(this),this._show(),this.useOuterClick==!0&&$(document).on("mousedown.ecDropdown"+(this.pcid||this._tabId),this.bodyClickHandler))},hide:function(n){n&&this.pcid&&(this.$el.find($(n.target)).length>0||this.$el[0]==n.target)||this.isShow&&(this.isShow=!1,this._hide(),this.onBeforeHide&&this.onBeforeHide(),this.useOuterClick==!0&&$(this.eventContainer||document).unbind("mousedown.ecDropdown"+(this.pcid||this._tabId),this.bodyClickHandler))},clickHandler:function(n){var t=$(n.target),i={targetID:n.target.id,controlID:this.pcid,pcontrolID:this.ppcid,value:t.attr("data-value"),identify:t.attr("data-identify")};if(n.target.tagName.toUpperCase()=="A")if(this.hide(),this.delegator)this.delegator.triggerEvent("dropdown.click",i);else if(this.onClick){i.type="dropdown.click";this.onClick(i,t)}return n.preventDefault(),!1},destroy:function(){this.hide();this.removeItems();ecount.widget.removeChild(this.$el[0]);this.$el=null;delete this.$el},removeItems:function(){this.$el&&this.$el.find("a").off()}});ecount.layout.column||(ecount.layout.column={});ecount.layout.column._export=function(){return{prop:{css:"panel-default",_loadedItemCount:0,init:function(){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,scope:this})},destroy:function(){ecount.layout.prototype.destroy.apply(this,arguments)},render:function(n){this.$el=n;this.items&&this.createBody(this.items);this.ecTransaction.start()},createBody:function(n){for(var f,o,t,r=$('<div class="row"><\/div>'),i=0,s=n.length;i<s;i++){n[i].ecPageID=this.ecPageID;var u=i>this.columns.length-1?i%this.columns.length:i,h=this.columns[u],e="";this.fixedColumnIndex&&i==this.fixedColumnIndex&&(this.fixedColumnHeight=this.fixedColumnHeight||500,e=String.format(' style="height:{0}px; overflow: hidden;overflow-y: scroll;" ',this.fixedColumnHeight));f=$(String.format('<div class="col-md-{0}" {1} ><\/div>',h,e));n[i].controlType?(ecount.control.initializeByUserSetting(this.initializer,n[i]),ecount.widget.createDisplayID(n[i],"btn",this.__target),o=ecount.common.createNamespace(n[i].controlType),t=new o(n[i]),t.__pnode=this.__type,t.controlType==="widget.custom"&&(t.__target=this.__target),t.__type=widget.generator.CONTROL,t.pId=this.tabId,t.gridID="",t.tabID=this.tabId,t.ecTransaction=this.ecTransaction,t.delegator=this.delegator,t.containerDelegator=this.event):(t=n[i],t.itemIndex=this.itemIndex,t.tabId=this.tabId,t.colSize=t.colSize||this.colSize,t.onSync=this.onSync,t.__target=this.__target,this.pageType&&t.__type==widget.generator.FORM&&(t.pageType=this.pageType),t.delegator=this.delegator,t.containerDelegator=this.event,t=new ecount.layout[t.__type](t));this.itemList.push(t);t.render(f);u==0&&(r=$('<div class="row"><\/div>'));$(r).append(f);u==0&&this.$el.append(r)}},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)}},create:function(){var n=$.extend({},this.prop);ecount.layout.column=$.Class(ecount.layout,n)}}};ecount.layout.layerList||(ecount.layout.layerList={});ecount.layout.layerList._export=function(){return{prop:{template:'<div class="dropdown-menu dropdown-menu-fixed-height" />',templateTable:['<table class="table table-hover table-bordered text-center {{layoutType}} table-nowrap">',"{{colgroup}}","<thead>","<tr>","{{title}}","<\/tr>","<\/thead>","<tbody>","{{body}}","<\/tbody>","<\/table>",].join("\n"),templateBody:"<tr>\n{{body}}\n<\/tr>",templateForm:"",isShow:!1,_layerTitle:null,_layerList:null,_layerCss:null,_layerPlacement:null,_layerDirection:null,_layerAutoPosition:!1,init:function(){ecount.layout.prototype.init.apply(this,arguments);this.callbackID=ecount.global.registerCallback(this.ecPageID,this.onMessage,this);this.bodyClickHandler=this.hide.bind(this);this.keydownHandler=function(n){if(n.keyCode===13)return this.hide(),this.bodyClickHandler(n),!1}.bind(this);this.events=new ecount.events(this);this.events.on({"control.change":this._ON_CHANGE_CONTROL,"anchor.click":this._ON_CLICK_CONTROL,scope:this})},render:function(){if(ecount.layout.prototype.render.apply(this,arguments),this._layerTitle&&this._layerList){var t=this._getFormContainer(),n=this._getForm();n.render(this.$el);this.itemList=n.itemList}this.$el.hasClass("position-fixed")||this.$el.addClass("position-fixed");this.$el&&this.$el[0]&&this.$el[0].setAttribute("data-ulecpageid",this.ecPageID)},setItem:function(n,t){this._layerTitle=n;this._layerList=t;this.draw()},draw:function(){this.destroy();var t=this._getFormContainer(),n=this._getForm();n.render(this.$el);this.itemList=n.itemList},_getFormContainer:function(){return $(this.template)},_getForm:function(){function c(){var e=widget.generator,s=e.control(),h=e.control(),c=ecount.resource.widget,o=[],t,n,i,r,u,f;if(this._layerList)for(t=0;t<this._layerList.length;t++)for(n=0;n<this._layerList[t].column.length;n++)i=this._layerList[t].column[n],typeof i=="object"?(r=i.type,u=i.label):(r=this._layerTitle[n].type,u=i),f=s.define(r,this._layerTitle[n].id+t.toString(),this._layerTitle[n].id+t.toString()).label(u),this._layerTitle[n].checked&&f.value("Y").select("Y"),o.add(f.end());return o}for(var u,o,s,h=widget.generator,n=h.form(),f="",r="",t="",e="",i=0;i<this._layerTitle.length;i++)r+=this._layerWidth?'<col width="'+this._layerWidth[i]+'px"/>':"",f+="<th>"+this._layerTitle[i].title+"<\/th>",t+="<td class= "+(this._layerCss||"")+"><\/td>";for(t=this.templateBody.replace(/{{body}}/,t),u=0;u<this._layerList.length;u++)e+=t;return this.templateForm=this.templateTable.replace(/{{title}}/,f).replace(/{{layoutType}}/,"table-layout-auto").replace(/{{colgroup}}/,r!=""?"<colgroup>"+r+"<\/colgroup>":"").replace(/{{body}}/,e),n.useCustomForm(),n.addControls(c.call(this)),n.customTemplate(this.templateForm),o=ecount.common.createNamespace("ecount.layout.form"),s=new o($.extend({ecPageID:this.ecPageID,__target:this.__target,delegator:this.events},n.end())),s},show:function(n){!this.isShow&&this._layerList&&this._layerTitle&&(this.isShow=!0,this._show(),this._adjustPlacement(n),$(document).bind("mousedown.ecDropdown"+(this.pcid||this._tabId),this.bodyClickHandler),this.$el.bind("keydown",this.keydownHandler))},hide:function(n){var t=!1;n&&this.pcid&&(this.$el.find($(n.target)).length>0||this.$el[0]==n.target)||this.isShow&&(t=this.isPreventHideWhenScroll!==!0?!0:this._inScrollRange(n)?!1:!0,t===!0&&(this.isShow=!1,this._hide(),$(document).unbind("mousedown.ecDropdown"+(this.pcid||this._tabId),this.bodyClickHandler),this.$el.unbind("keydown",this.keydownHandler)))},_adjustPlacement:function(n){var t=n&&n.target&&$.extend({},n.target.getBoundingClientRect()),i=$.extend({},this.$el.get(0).getBoundingClientRect()),u=$(window).height(),f=$(window).width(),r=["top","bottom","left","right"];if(t)if(window.scrollX>0&&(t.left+=window.scrollX,t.right+=window.scrollX,i.left+=window.scrollX,i.right+=window.scrollX),window.scrollY>0&&(t.top+=window.scrollY,t.bottom+=window.scrollY,i.top+=window.scrollY,i.bottom+=window.scrollY),r.contains(this._layerPlacement)&&r.contains(this._layerDirection))this._adjustDirection(this._layerPlacement,this._layerDirection,t,i);else if(this._layerAutoPosition==!0){if(t.top>i.height){this._adjustDirection("top","left",t,i);return}if(u-t.bottom>i.height){this._adjustDirection("bottom","left",t,i);return}if(t.left>i.width){this._adjustDirection("left","top",t,i);return}if(f-t.right>i.width){this._adjustDirection("right","top",t,i);return}}},_adjustDirection:function(n,t,i,r){function e(n,t){n=="left"&&(f=i.left,!t&&f-window.scrollX+r.width>l&&e("right",!0));n=="right"&&(f=i.right-r.width,!t&&f-window.scrollX<0&&e("left",!0))}function o(n,t){n=="top"&&(u=i.top,!t&&u-window.scrollY+r.height>c&&o("bottom",!0));n=="bottom"&&(u=i.bottom-r.height,!t&&u-window.scrollY<0&&o("top",!0))}var s=r.width,h=r.height,u,f,c=$(window).height(),l=$(window).width();switch(n){case"top":u=i.top-r.height;e(t);break;case"bottom":u=i.bottom;e(t);break;case"left":f=i.left-r.width;o(t);break;case"right":f=i.right;o(t)}this.$el.offset({top:u,left:f});this.$el.width(s-2);this.$el.height(h-2)},toggle:function(n){this.isShow?this.hide(n):this.show(n)},removeItems:function(){this.itemList&&this.itemList.forEach(function(n){n.destroy()});this.itemList=null},destroy:function(){this.removeItems();this.$el.find("table").remove()},reset:function(){this.itemList&&this.itemList.forEach(function(n){n.reset()})},getRowIndexById:function(n){for(var i=-1,t=0;t<this.itemList.length;t++)if(this.itemList[t].id==n){i=Math.floor(t/this._layerTitle.length);break}return i},getElementById:function(n){for(var t=0;t<this.itemList.length;t++)if(this.itemList[t].id==n)return this.itemList[t]},setLayerTitle:function(n){this._layerTitle=n},setLayerList:function(n){this._layerList=n},setCheckboxSelected:function(n,t,i){if($.isNull(t)&&(t=!0),this.itemList)for(var r=0;r<this.itemList.length;r++)idx=r%this._layerTitle.length,idx==n&&(i&&i!=this.getValueByRowindex(this.getRowIndexById(this.itemList[r].id))||this.itemList[r].setValue(0,t))},hasItemList:function(){return this.itemList&&this.itemList.length>0?!0:!1},getItemListLength:function(){return this.itemList?this.itemList.length:0},getRowObjectByRowindex:function(n){return this._layerList[n]},getValueByRowindex:function(n){return this.getRowObjectByRowindex(n).value},getSelectedCheckboxs:function(){return this.$el.find("input:checked")},getSelectedCheckboxIds:function(){var t=this.getSelectedCheckboxs(),i,r=[],n,u;if(t)for(n=0,u=t.length;n<u;n++)i=t[n],r.push(i.getAttribute("data-cid"));return r},getSelectedObject:function(){for(var i,r,t=[],n=0;n<this.getSelectedCheckboxs().length;n++)i=this.getSelectedCheckboxs()[n].getAttribute("data-cid"),r=this.getRowObjectByRowindex(this.getRowIndexById(i)),t.push(r);return t},getSelectedValue:function(){for(var i,r,t=[],n=0;n<this.getSelectedCheckboxs().length;n++)i=this.getSelectedCheckboxs()[n].getAttribute("data-cid"),r=this.getValueByRowindex(this.getRowIndexById(i)),t.push(r);return t},getTableHeight:function(){var i=this.$el.find("table"),n=i.clone(),t=0;return n.appendTo(document.body),t=n.outerHeight(),n.remove(),t},isShowing:function(){return this.isShow===!0?!0:!1},setCSS:function(n,t){this.$el.css(n,t)},hasScroll:function(n){var t=this.css("overflow"),i=typeof n=="undefined"||n=="y"?this.css("overflow-y"):this.css("overflow-x");var r=typeof n=="undefined"||n=="y"?this.get(0).scrollHeight>this.innerHeight():this.get(0).scrollWidth>this.innerWidth(),u=t=="auto"||t=="visible"||i=="auto"||i=="visible",f=t=="scroll"||i=="scroll";return r&&u||f},_inScrollRange:function(n){var u=n.pageX,f=n.pageY,t=$(n.target),l=this.hasScroll.call(t),a=this.hasScroll.call(t,"x"),i=null,r=null,e=!1,o=!1,s=50,h=function(){this.top=0;this.left=0;this.bottom=0;this.right=0},c=function(n,t,i){return i>=n.top&&i<=n.bottom&&t>=n.left&&t<=n.right};return l&&(r=new h,r.top=t.offset().top,r.right=t.offset().left+t.outerWidth(),r.bottom=r.top+t.outerHeight(),r.left=r.right-s,o=c(r,u,f)),a&&(i=new h,i.bottom=t.offset().top+t.outerHeight(),i.left=t.offset().left,i.top=i.bottom-s,i.right=i.left+t.outerWidth(),e=c(i,u,f)),e||o},_ON_CHANGE_CONTROL:function(n){if(this.delegator){this.onSync&&this.delegator.triggerEvent("form.sync",n);var t=this.getRowIndexById(n.cid);this.delegator&&this.delegator.triggerEvent("control.change",{type:"layer.control.change",pcid:this.pcid,cid:n.cid,cindex:n.cindex,targetID:"chk-layer-change-control",value:this.getValueByRowindex(t),event:n,rowIndex:t,rowObject:this.getRowObjectByRowindex(t),__self:this})}},_ON_CLICK_CONTROL:function(n){if(this.delegator){var t=this.getRowIndexById(n.name);this.delegator&&this.delegator.triggerEvent("anchor.click",{type:"anchor.click",pcid:this.pcid,cid:n.name,cindex:0,targetID:"lnk-layer-"+this.pcid,value:this.getValueByRowindex(t),event:n,rowIndex:t,rowObject:this.getRowObjectByRowindex(t),__self:this})}}},create:function(){var n=$.extend({},this.prop);ecount.layout.layerList=$.Class(ecount.layout,n)}}};ecount.layout.form=function(n){return ecount.layout.form.general._export&&(ecount.layout.form.general._export().create(),ecount.layout.form.general._export=null),n._isVertical?(ecount.layout.form.horizon._export&&(ecount.layout.form.horizon._export().create(),ecount.layout.form.horizon._export=null),ecount.layout.form.vertical._export&&(ecount.layout.form.vertical._export().create(),ecount.layout.form.vertical._export=null),new ecount.layout.form.vertical(n)):n._isCustomForm?(ecount.layout.form.custom._export&&(ecount.layout.form.custom._export().create(),ecount.layout.form.custom._export=null),new ecount.layout.form.custom(n)):n._isTableType?(ecount.layout.form.base._export&&(ecount.layout.form.base._export().create(),ecount.layout.form.base._export=null),new ecount.layout.form.base(n)):n._isBaseForm?new ecount.layout.form.general(n):n._isTableForm?(ecount.layout.form.table._export&&(ecount.layout.form.table._export().create(),ecount.layout.form.table._export=null),new ecount.layout.form.table(n)):n._isGeneralForm?(ecount.layout.form.general._export&&(ecount.layout.form.general._export().create(),ecount.layout.form.general._export=null),new ecount.layout.form.general(n)):n._isSetupForm?(ecount.layout.form.horizon._export&&(ecount.layout.form.horizon._export().create(),ecount.layout.form.horizon._export=null),ecount.layout.form.setup._export&&(ecount.layout.form.setup._export().create(),ecount.layout.form.setup._export=null),new ecount.layout.form.setup(n)):(ecount.layout.form.general._export&&(ecount.layout.form.general._export().create(),ecount.layout.form.general._export=null),new ecount.layout.form.general(n))};ecount.layout.form.resetSubTitle=function(n){if(!n._alreadyModify&&n.name&&n.name.indexOf("P_DES")==0)if(n.isResettableSubTitle==undefined||n.isResettableSubTitle==""){var t=n.subTitle.split(""),i=t.shift();if(i.toUpperCase()=="D")return!1;n.subTitle=t.join("")}else if(n.isResettableSubTitle.toUpperCase()=="D")return!1;return!0};ecount.class("ecount.layout.printContent","ecount.layout",{template:'<div><div class="wrapper-print" style="width: 650px;"><div class="wrapper-print-content" style="top: 0;min-width: 650px;">{{html}}<\/div><\/div><\/div>',_html:"",_htmlObject:null,init:function(){ecount.layout.prototype.init.apply(this,arguments)},setDefault:function(){this.data=[{html:this._html}]},render:function(n){this._html=$("<div>"+this._html+"<\/div>").html();this.template=this.template.replace(/{{html}}/,this._html);this.$el=$(this.template);this.hidden&&this.$el.hide();n.append(this.$el);this._htmlObject=this.$el.find("div.wrapper-print-content");this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",event):this.delegator&&this.delegator.triggerEvent("item.onload",event);ecount.global.executeCallbak(this.ecPageID,ecount.widget.LAZY_INITIALIZER,function(){this.$el.find("div.wrapper-print").height(this.$el.find("div.wrapper-print-content").height()+20)}.bind(this))},getHtml:function(){return this.$el.find("div.wrapper-print-content").html()},setHtml:function(){this.$el.find("div.wrapper-print-content").html($("<div>"+this._html+"<\/div>").html())}});ecount.class("ecount.layout.batchSetup","ecount.layout",{template:'<div class="{{css}}" ><\/div>',itemList:null,css:"wrapper-template-setup-detail",detailCss:"panel panel-default panel-template-setup-detail",header:null,setupItemCount:0,_loadedItemCount:0,_formIndexCouning:0,init:function(){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,scope:this})},destroy:function(){ecount.layout.prototype.destroy.apply(this,arguments)},render:function(){this.template=ecount.widget.replaceAttr(this.template,{css:this.css});ecount.layout.prototype.render.apply(this,arguments);this.createContents();this.ecTransaction.start()},createContents:function(){var n,i,t;for(this._formIndexCouning=0,n=0;n<this.setupList.length;n++)this.setupList[n]&&(i=this.setupList[n].css||this.detailCss,t=$(String.format('<div class="{0}"><\/div>',i)),this.setupList[n]&&this.createHeader(this.setupList[n].title,t),this.setupList[n].items&&this.setupList[n].items.length>0&&this.createBody(this.setupList[n].items,t)),this.$el.append(t)},createHeader:function(n,t){t.append($(String.format('<div class="panel-heading">{0}<\/div>',n||"")))},createBody:function(n,t){for(var f,i,u=$('<div class="panel-body">'),r=0,e=n.length;r<e;r++)i=n[r],i.ecPageID=this.ecPageID,i.controlType?(ecount.control.initializeByUserSetting(this.initializer,i),ecount.widget.createDisplayID(i,"btn",this.__target),f=ecount.common.createNamespace(i.controlType),i=new f(i),i.__pnode=this.__type,i.controlType==="widget.custom"&&(i.__target=this.__target),i.__type=widget.generator.CONTROL,i.pId=this.tabId,i.gridID="",i.tabID=this.tabId):(i=new ecount.layout[i.__type](i),i.itemIndex=this._formIndexCouning,i.tabId=this.tabId,i.colSize=i.colSize||this.colSize,i.onSync=this.onSync,i.__target=this.__target,i.__type==widget.generator.FORM&&(this.pageType&&(i.pageType=this.pageType),this._formIndexCouning++)),i.delegator=this.delegator,i.containerDelegator=this.events,this.itemList.push(i),i.render(u);t.append(u)},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)}});ecount.class("ecount.layout.sectionUnion","ecount.layout",{template:'<div class="wrapper-template-setup-detail"><\/div>',itemList:null,css:"panel panel-default panel-template-setup-detail",formCss:"table-template-setup",init:function(){ecount.layout.prototype.init.apply(this,arguments);this.setInitData();this.itemList=[];this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.events=new ecount.events(this);this.events.on({"control.focusout":this._ON_MOVE_FOCUS,"button.click":this.transferEvent,"anchor.click":this.transferEvent,"dropdown.click":this.transferEvent,"control.change":this.transferEvent,"control.openPopup":this.transferEvent,"item.onload":this.onLoadItem,scope:this})},setInitData:function(){var n=this.unionData||this.viewBag.InitDatas.formInfo.Formset.Basic;this.unionData=n;this._isLeftMenu&&(this.css="panel panel-default")},render:function(){this.setTemplate();ecount.layout.prototype.render.apply(this,arguments);this.items=this.parseUnionData(this.unionData);this.createContents(this.items);this.ecTransaction.start()},setTemplate:function(){this._noHeader&&(this.template='<div class="panel panel-default"><\/div>')},getSuffixIndex:function(n){return"_"+n.toString().padLeft(3,"0")},parseUnionData:function(n){var l=widget.generator,e=l.control(),f=null,s=[],i,t,u,r,h,o,c;for($.isArray(n)||(n=[n]),r=0,h=n.length;r<h;r++){if(t=n[r],$.isNull(t.controlVisible))for(f={title:t.FORM_NM||t.SECTION_TITLE||t.RESX_SUB_DES,id:t.CLASS_CD,name:t.CLASS_CD,items:[],sIndex:$.isNull(t.sIndex)?r:t.sIndex},i=this.getSuffixIndex(f.sIndex),o=0,c=t.Class.length;o<c;o++)u=t.Class[o],u.suffixIndex=i,e.define("widget.union.form",u.WIDGET_ID+i,u.WIDGET_ID+i,ecount.resource[u.RESX_CD]).addUnionData(u).showBackground(this.showBackground).setUnionWidth(this.unionWidth).setOptions({_noSurffixIndex:this._noSurffixIndex,suffixIndex:i}),f.items.push(e.end());else f={title:"SECTION_UNION_"+r,id:"SECTION_UNION_"+r,name:"SECTION_UNION_"+r,items:[],sIndex:r},i=this.getSuffixIndex(f.sIndex),u={suffixIndex:i,controlVisible:t.controlVisible},e.define("widget.union.leftBasicType","UNION"+i,"UNION"+i,ecount.resource.LBL00832).addUnionData(u),f.items.push(e.end());s.push(f)}return s},getContainer:function(n){return this._noHeader?this.getContainerNoHeader():this.getContainerWithHeader(n)},getContainerNoHeader:function(){var n=this.$el;return this.$el[0].childElementCount&&n.children().remove(),n},getContainerWithHeader:function(n){var t,i=this.$el.find('div[data-sindex="'+n.sIndex+'"]');return i.length==0?(t=$(String.format('<div class="{0}" data-sindex="{1}"><\/div>',n.css||this.css,n.sIndex)),this.$el.append(t)):(i.children().remove(),t=i),t},createContents:function(n){for(var i,t,r=0;r<n.length;r++)t=n[r],$.isNull(t)||(i=this.getContainer(t),this.createHeader(t.title,i),t.items&&t.items.length>0&&this.createBody(t.items,i))},createHeader:function(n,t){this._noHeader!=!0&&t.append($(String.format('<div class="panel-heading">{0}<\/div>',n||"")))},createBody:function(n,t){for(var f,i,u=$('<div class="panel-body">'),r=0,e=n.length;r<e;r++)i=n[r],i.ecPageID=this.ecPageID,i.controlType?(ecount.widget.createDisplayID(i,"btn",this.containerName),f=ecount.common.createNamespace(i.controlType),i=new f(i),i.__pnode=this.__type,i.__type=widget.generator.CONTROL,i.pId=this.tabId,i.gridID="",i.tabID=this.tabId,i.delegator=this.delegator,i.pcid=this.id,i.onSync=this.onSync,i.containerName=this.containerName,i.popupID=this.popupID,i.popupLevel=this.popupLevel,i.responseID=this.responseID,i.parentPageID=this.parentPageID,i.inIncludePage=this.inIncludePage,i.eventContainer=this.eventContainer,i.alreadyIncludedLayout=this.alreadyIncludedLayout,ecount.widget.createDisplayID(i,"btn",this.containerName)):(i=new ecount.layout[i.__type](i),i.tabId=this.tabId,i.colSize=i.colSize||this.colSize,i.onSync=this.onSync,i.containerName=this.containerName,i.__type==widget.generator.FORM&&this.pageType&&(i.pageType=this.pageType)),i.delegator=this.events,i.containerDelegator=this.events,this.itemList.push(i),i.render(u);t.append(u)},destroy:function(){ecount.layout.prototype.destroy.apply(this,arguments)},validate:function(n){for(var u=[],t=null,i=null,r=0,f=this.itemList.length;r<f;r++)i=this.itemList[r],t=i.validate.call(i,null,null,n),t.length>0&&u.push(t);return u},serialize:function(){for(var n=this.itemList,i,t=0,r=n.length;t<r;t++)i=n[t],i.__type!=widget.generator.CONTROL&&(n.splice(t,1),r--);return ecount.widget.serialize(n)},serializeBySuffixIndex:function(n){var i=this.serialize(),r={},u;for(var t in i)u=Number(t.substr(t.length-3)),Number(n)==u&&(r[t.substr(0,t.length-4)]=i[t]);return r},refreshContents:function(n,t){var i,u,r;this.createContents([this.items[Number(t)]]);for(r in n)u=this.makeControlID(r,t),i=this.getControl(u),i&&i.setStandardValue(n[r]);this.executeController()},refreshSectionUnion:function(n){n&&(this.destroyWidget(n.sIndex),this.items=this.parseUnionData(n),this.createContents(this.items))},destroyWidget:function(n){for(var t,r,i=this.itemList.length-1;i>=0;i--)(t=this.itemList[i],r=t.suffixIndex&&Number(t.suffixIndex.substr(t.suffixIndex.length-3)),$.isNull(n)||r===n)&&(t.destroy(),delete this.itemList.splice(i,1))},setValueByPath:function(n,t,i){var f,r,e,u;for($.isArray(n)||(n=[n]),u=0;u<n.length;u++)e=$.isNull(i)?n[u]:this.makeControlID(n[u],i),r=this.getControl(e),f=r&&r.mappingPath&&this.getDataFromPath(r.mappingPath,t),$.isNull(f)||r.setStandardValue(f);this.executeController()},getDataFromPath:function(n,t){for(var r=n.split("/"),u=t,i=0;i<r.length;i++)r[i]!=""&&(u=u[r[i]]);return u},makeControlID:function(n,t){return n+($.isNumber(t)?this.getSuffixIndex(t):"")},executeController:function(){for(var n,t=0,i=this.itemList.length;t<i;t++)n=this.itemList[t],n.__type==widget.generator.CONTROL&&n.executeController&&n.executeController()},reset:function(n){this.itemList.forEach(function(t){var i;n&&(i=n[t.id]);t.reset(i)})},transferEvent:function(n){if(n.__eventType){var t=Array.prototype.slice.call(arguments);return this.delegator._triggerEvent.apply(this.delegator,[n.__eventType].concat(t))}this.delegator.triggerEvent(n.type,n)},ON_KEYDOWN_ENTER:function(n,t,i){i&&!i.useAsyncFocusChange&&i.onNextFocus(n.cindex)},_ON_MOVE_FOCUS:function(n){for(var r,i,u,t,e,o,s,f=0;f<this.itemList.length;f++)for(i=this.itemList[f],u=i.itemList,s=i.unionData.controlVisible||{},r=0;r<u.length;r++){if(t=u[r],e=i.removeSuffixIndex(t.id),o==!0&&t.controlType&&s[e]!==!1){t.setFocus(0);return}t.id==n.__self.id&&(o=!0)}},showLayer:function(n){var t=this.getControl(n);t&&t.$el&&t.$el.show()},hideLayer:function(n){var t=this.getControl(n);t&&t.$el&&t.$el.hide()},showCollapseAll:function(){for(var n,t=0;t<this.itemList.length;t++)n=this.itemList[t],n.controlType=="widget.union.form"&&n.showCollapse()},hideCollapseAll:function(){for(var n,t=0;t<this.itemList.length;t++)n=this.itemList[t],n.controlType=="widget.union.form"&&n.hideCollapse()},isControlVisible:function(n){var t=this.getControlsTableRow(n);return!t.hasClass("hidden")&&ecount.widget.isVisible(t[0])},getControlsTableRow:function(n){return this.$el.find("tr#row-"+n)},onLoadComplete:function(){var n={target:this.containerName,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)}});ecount.layout.settingPanel||(ecount.layout.settingPanel={});ecount.layout.settingPanel._export=function(){return{prop:{template:'<div class="wrapper-function-setup"><\/div>',tableCss:"table table-template-setup",init:function(){ecount.layout.prototype.init.apply(this,arguments);this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.itemList=[];this.events=new ecount.events(this);this.events.on({"control.change":this._ON_CHANGE_CONTROL,"anchor.click":this._ON_CLICK_CONTROL,"button.click":this._ON_CLICK_CONTROL,"dropdown.click":this._ON_CLICK_CONTROL,onClickControl:this._ON_CLICK_CONTROL,"control.focusout":this._ON_MOVE_FOCUS,"control.openPopup":this._ON_CLICK_CONTROL,scope:this});this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer)},render:function(){if(this._isUseBottomLine===!0&&(this._isHideBottomSeparatedLine=!0),this.template=this._isHideBottomSeparatedLine===!0?'<div class=""><\/div>':'<div class="wrapper-function-setup" id="'+this.id+'"><\/div>',!this.id&&ecount.__isTRecordMode()){alert("  .\n  .");throw"  ";}ecount.layout.prototype.render.apply(this,arguments);this.createHeader(this._header);this.createContents(this._contents);this.createFooter(this._footer);this.createBottomLine();this.hidden&&this.$el.hide();this.ecTransaction.start()},createHeader:function(n){if(n){var t=$('<div class="function-setup-header"/>');n.title&&t.append($('<div class="wrapper-sub-title">'+n.title+"<\/div>"));n.description&&t.append($('<div class="description">'+n.description+"<\/div>"));this.$el.append(t)}},createContents:function(n){var f=widget.generator,r,o;if(n&&n.items.length>0){var e=$('<div class="function-setup-contents"/>'),t=this._useFormLayout===!0?f.form():f.toolbar(),i={},u={};for(r=0,o=n.items.length;r<o;r++)u=this._setControlOptions(n.items[r]),this._useFormLayout===!0?t.add(u):t.attach(u);if(this._useFormLayout===!0&&(this._labelColumnWidth=this._labelColumnWidth||100,t.useBaseForm({_isThShow:!0,_isRowInCount:1}).colgroup([{width:this._labelColumnWidth},{width:""}]).css(this.tableCss).setOptions({_isErrorBorderNone:!0})),t=t.end(),t.tabId=this.tabId,t.ecPageID=this.ecPageID,t.__target=this.__target,t.delegator=this.events,t.containerDelegator=this.containerDelegator,this._useFormLayout===!0){i=new ecount.layout.form(t);i.events.on({"control.focusout":this._ON_MOVE_FOCUS.bind(this)})}else i=new ecount.layout.toolbar(t);i.render(e);this.itemList.push(i);this.$el.append(e)}},_setControlOptions:function(n){return n.controlType==="widget.custom"&&(n.__target=this.__target),ecount.control.initializeByUserSetting(this.initializer,n),n.__pnode=this.__type,n.__type=widget.generator.CONTROL,n.pId=this.tabId,n.gridID="",n.tabID=this.tabId,ecount.widget.createDisplayID(n,"btn",this.__target),n.delegator=this.events,n.ecTransaction=this.ecTransaction,n},createFooter:function(n){var e=$('<div class="function-setup-footer"><\/div>'),f={},t=widget.generator.toolbar(),r={},i,u;if(n&&(n.leftItems&&n.leftItems.length>0||n.rightItems&&n.rightItems.length>0)){for(n.leftItems=n.leftItems||[],n.rightItems=n.rightItems||[],i=0,u=n.leftItems.length;i<u;i++)r=this._setControlOptions(n.leftItems[i]),t.addLeft(r);for(i=0,u=n.rightItems.length;i<u;i++)r=this._setControlOptions(n.rightItems[i]),t.addRight(r);t=t.end();t.tabId=this.tabId;t.ecPageID=this.ecPageID;t.__target=this.__target;t.delegator=this.events;t.containerDelegator=this.containerDelegator;f=new ecount.layout.toolbar(t);f.render(e);this.itemList.push(f);this.$el.append(e)}},createBottomLine:function(){this._isUseBottomLine===!0&&this.$el.append("<hr>")},createControl:function(n){if(n.controlType=="widget.empty")return null;n.__pnode=this.__type;n.controlType==="widget.custom"&&(n.__target=this.__target);n.__type=widget.generator.CONTROL;n.pId=this.tabId;n.gridID="";n.tabID=this.tabId;ecount.widget.createDisplayID(n,"btn",this.__target);n.delegator=this.events;n.ecTransaction=this.ecTransaction;var t=ecount.common.createNamespace(n.controlType);return new t(n)},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},setFocus:function(n){var t=this.getControlByIndex(n);t?t.setFocus(n):this.delegator.triggerEvent("panel.focusout",{__self:this,type:"panel.focusout",target:this.__target,tabId:this.tabId})},setHeaderHtml:function(n,t){var i=this.$el.find("div.function-setup-header");n&&(i.find("div.wrapper-sub-title").length==0?i.append('<div class="wrapper-sub-title">'+n+"<\/div>"):i.find("div.wrapper-sub-title").html(n));t&&(i.find("div.description").length==0?i.append('<div class="description">'+t+"<\/div>"):i.find("div.description").html(t))},getControl:function(n){return this.itemList.length==0?null:this.itemList[0].getControl(n)},getControlByIndex:function(n){return this.itemList.length==0?null:this.itemList[0].getControlByIndex(n)},_ON_CHANGE_CONTROL:function(n){this.delegator&&(this.onSync&&this.delegator.triggerEvent("form.sync",n),this.delegator.triggerEvent("control.change",n))},_ON_CLICK_CONTROL:function(n){this.delegator&&this.delegator.triggerEvent(n.type,n)},_ON_MOVE_FOCUS:function(n){for(var f,s,o=n.cid,h=ecount.widget.isVisible,r,t,u,i=[],e=0,c=this.itemList.length;e<c;e++)for(i=this.itemList[e].itemList,r=0,f=0,s=i.length;f<s;f++){if(i[f].id==o){if(f==s-1){if(e==c-1)u!=undefined?u.onFocusOut():i[r].onFocusOut();else if(t=this.itemList[e+1].itemList[0],!h(t.$el[0])||t._readOnly||t.isHideCell)o=t.id;else return u!=undefined?u.onFocusOut():i[r].onFocusOut(),t.setFocus(0),!1;break}if(t=i[f+1],!h(t.$el[0])||t._readOnly||t.isHideCell)r--,o=t.id;else return u!=undefined?u.onFocusOut():i[r].onFocusOut(),t.setFocus(0),!1}r++;u=i[r]}this.delegator.triggerEvent("panel.focusout",{__self:this,type:"panel.focusout",target:this.__target,tabId:this.tabId})}},create:function(){var n=$.extend({},this.prop);ecount.layout.settingPanel=$.Class(ecount.layout,n)}}};ecount.layout.unorderedList||(ecount.layout.unorderedList={});ecount.layout.unorderedList._export=function(){return{prop:{template:"<ul><\/ul>",templateLi:"<li><\/li>",init:function(){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,scope:this})},render:function(){this.template=ecount.widget.replaceAttr(this.template,{css:this.css});ecount.layout.prototype.render.apply(this,arguments);this.items&&this.createList(this.items);this.ecTransaction.start();this._width&&this.$el.css("width",this._width)},destroy:function(){ecount.layout.prototype.destroy.apply(this,arguments)},createList:function(n){for(var f,r,t,i,u=0,e=n.length;u<e;u++)t=n[u],r=$(this.templateLi),t.ecPageID=this.ecPageID,t.containerName=this.containerName,t.listCss&&r.addClass(t.listCss),t.controlType?(ecount.control.initializeByUserSetting(this.initializer,t),ecount.widget.createDisplayID(t,"btn",this.__target),f=ecount.common.createNamespace(t.controlType),i=new f(t),this._setControlOptions(i)):(this._setLayoutOptions(t),i=new ecount.layout[t.__type](t)),this.itemList.push(i),i.render(r),this.$el.append(r)},_setLayoutOptions:function(n){n.itemIndex=this.itemIndex;n.tabId=this.tabId;n.colSize=n.colSize||this.colSize;n.onSync=this.onSync;n.__target=this.__target;this.pageType&&n.__type==widget.generator.FORM&&(n.pageType=this.pageType);n.delegator=this.delegator;n.containerDelegator=this.event},_setControlOptions:function(n){n.__pnode=this.__type;n.controlType==="widget.custom"&&(n.__target=this.__target);n.__type=widget.generator.CONTROL;n.pId=this.tabId;n.gridID="";n.tabID=this.tabId;n.ecTransaction=this.ecTransaction;n.delegator=this.delegator;n.containerDelegator=this.event},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)}},create:function(){var n=$.extend({},this.prop);ecount.layout.unorderedList=$.Class(ecount.layout,n)}}};ecount.layout.orderedList||(ecount.layout.orderedList={});ecount.layout.orderedList._export=function(){return{prop:{template:'<ol class="{{css}}"><\/ol>',templateLi:'<li class="wrapper-article"><\/li>',init:function(){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,scope:this})},render:function(){this.template=ecount.widget.replaceAttr(this.template,{css:this.css});ecount.layout.prototype.render.apply(this,arguments);this.items&&this.createList(this.items);this.ecTransaction.start();this._width&&this.$el.css("width",this._width)},destroy:function(){ecount.layout.prototype.destroy.apply(this,arguments)},createList:function(n){for(var l,o,f,u,s,h,r,t,e,c="",i=0,a=n.length;i<a;i++)t=n[i],(_.isEmpty(t._unordered)||t._unordered&&t._unordered!==c)&&(r=$(this.templateLi)),t.ecPageID=this.ecPageID,t.containerName=this.containerName,t.listCss&&r.addClass(t.listCss),t.controlType?(ecount.control.initializeByUserSetting(this.initializer,t),ecount.widget.createDisplayID(t,"btn",this.__target),l=ecount.common.createNamespace(t.controlType),e=new l(t),this._setControlOptions(e)):(this._setLayoutOptions(t),e=new ecount.layout[t.__type](t)),this.itemList.push(e),t._unordered?(t._unordered!==c?(u=$("<div class='form wrapper-toolbar whole-row indent1'><\/div>"),e.render(u),this.itemTitles[i]&&(s=this.itemTitles[i].category&&this.itemTitles[i].category.text?'<span class="text-primary">['+this.itemTitles[i].category.text+"] <\/span>":"",h='<span class="text-bold">'+s+this.itemTitles[i].content.text+"<\/span>",r.append(h)),o=$("<ul><\/ul>"),f=$("<li><\/li>"),f.append("<span>"+this.itemTitles[i].subTitle.text+"<\/span>"),f.append(u),o.append(f),r.append(o),this.$el.append(r)):(u=$("<div class='form wrapper-toolbar whole-row indent1'><\/div>"),e.render(u),o=$("<ul><\/ul>"),f=$("<li><\/li>"),f.append("<span>"+this.itemTitles[i].subTitle.text+"<\/span>"),f.append(u),o.append(f),r.append(o),this.$el.append(r)),c=t._unordered):(u=$("<div class='form wrapper-toolbar whole-row'><\/div>"),e.render(u),this.itemTitles[i]&&(s=this.itemTitles[i].category&&this.itemTitles[i].category.text?'<span class="text-primary">['+this.itemTitles[i].category.text+"] <\/span>":"",h='<span class="text-bold">'+s+this.itemTitles[i].content.text+"<\/span>",r.append(h)),r.append(u),this.$el.append(r))},_setLayoutOptions:function(n){n.itemIndex=this.itemIndex;n.tabId=this.tabId;n.colSize=n.colSize||this.colSize;n.onSync=this.onSync;n.__target=this.__target;this.pageType&&n.__type==widget.generator.FORM&&(n.pageType=this.pageType);n.delegator=this.delegator;n.containerDelegator=this.event},_setControlOptions:function(n){n.__pnode=this.__type;n.controlType==="widget.custom"&&(n.__target=this.__target);n.__type=widget.generator.CONTROL;n.pId=this.tabId;n.gridID="";n.tabID=this.tabId;n.ecTransaction=this.ecTransaction;n.delegator=this.delegator;n.containerDelegator=this.event},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)}},create:function(){var n=$.extend({},this.prop);ecount.layout.orderedList=$.Class(ecount.layout,n)}}};ecount.layout.tableContents||(ecount.layout.tableContents={});ecount.layout.tableContents._export=function(){return{prop:{template:'<table class="table table-bordered">\r<thead>\r<tr id="theadTr">\r<\/tr>\r<\/thead>\r<tbody>\r<tr id="tbodyTr">\r<\/tr>\r<\/tbody>\r<\/table>',thead:['<th id="{{column}}">',"<\/th>",].join("\r"),tbody:['<td id="{{column}}">',"<\/td>",].join("\r"),itemList:[],init:function(){ecount.layout.prototype.init.apply(this,arguments);this.events=new ecount.events(this);this.events.on({"control.change":this._ON_CHANGE_CONTROL});this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer)},render:function(){this.template=ecount.widget.replaceAttr(this.template,{css:this.css});ecount.layout.prototype.render.apply(this,arguments);this.items&&this.createList(this.items);this.ecTransaction.start();this._width&&this.$el.css("width",this._width)},destroy:function(){ecount.layout.prototype.destroy.apply(this,arguments)},createList:function(n){for(var e,o,u,s,f,t,i,r=0,h=n.length;r<h;r++)t=n[r],t.ecPageID=this.ecPageID,t.containerName=this.containerName,ecount.control.initializeByUserSetting(this.initializer,t),ecount.widget.createDisplayID(t,"btn",this.__target),e=ecount.common.createNamespace(t.controlType),i=new e(t),i.delegator=this.events,this.itemList.push(i),t.tableIndex==="head"?(o=ecount.widget.replaceAttr(this.thead,{column:i.id}),u=$(o),i.render(u),this.$el.find("#theadTr").append(u)):t.tableIndex==="body"&&(s=ecount.widget.replaceAttr(this.tbody,{column:i.id}),f=$(s),i.render(f),this.$el.find("#tbodyTr").append(f))},_setControlOptions:function(n){n.__pnode=this.__type;n.controlType==="widget.custom"&&(n.__target=this.__target);n.__type=widget.generator.CONTROL;n.pId=this.tabId;n.gridID="";n.tabID=this.tabId;n.ecTransaction=this.ecTransaction;n.delegator=this.delegator;n.containerDelegator=this.event},ON_CLICK:function(){},_ON_CHANGE_CONTROL:function(n){var t=n.__self,i=this.$el.find("#"+t.id),r=i.parent().children().index(i),u=i.parent().attr("id"),s=t.getValue(n.cindex),f,e,o;t&&t.controlType=="widget.checkbox"&&u==="theadTr"?(f=this.$el.find("#tbodyTr").children()[r],this.getControl(f.getAttribute("id")).setCheckedAll(s)):t&&t.controlType=="widget.checkbox.numbered"&&u==="tbodyTr"&&(e=this.$el.find("#theadTr").children()[r],o=t.getIsCheckedAll()?!0:!1,this.getControl(e.getAttribute("id")).setCheckedAll(o));this.delegator&&(this.onSync&&this.delegator.triggerEvent("form.sync",n),this.delegator.triggerEvent("control.change",n))},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)}},create:function(){var n=$.extend({},this.prop);ecount.layout.tableContents=$.Class(ecount.layout,n)}}};ecount.layout.singular||(ecount.layout.singular={});ecount.layout.singular._export=function(){return{prop:{template:'<div class="wrapper-article {{css}}"><\/div> ',css:"",init:function(){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,scope:this})},render:function(){this.template=ecount.widget.replaceAttr(this.template,{css:this.css});ecount.layout.prototype.render.apply(this,arguments);this.items&&this.createBody(this.items);this.ecTransaction.start()},destroy:function(){ecount.layout.prototype.destroy.apply(this,arguments)},createBody:function(n){for(var r,t,i=0,u=n.length;i<u;i++)n[i].ecPageID=this.ecPageID,n[i].controlType?(ecount.control.initializeByUserSetting(this.initializer,n[i]),ecount.widget.createDisplayID(n[i],"btn",this.__target),r=ecount.common.createNamespace(n[i].controlType),t=new r(n[i]),t.__pnode=this.__type,t.controlType==="widget.custom"&&(t.__target=this.__target),t.__type=widget.generator.CONTROL,t.pId=this.tabId,t.gridID="",t.tabID=this.tabId,t.ecTransaction=this.ecTransaction,t.delegator=this.delegator,t.containerDelegator=this.event):(t=n[i],t.itemIndex=this.itemIndex,t.tabId=this.tabId,t.colSize=t.colSize||this.colSize,t.onSync=this.onSync,t.__target=this.__target,this.pageType&&t.__type==widget.generator.FORM&&(t.pageType=this.pageType),t.delegator=this.delegator,t.containerDelegator=this.event,t=new ecount.layout[t.__type](t)),this.itemList.push(t),t.render(this.$el),t.$el.after(" ")},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)}},create:function(){var n=$.extend({},this.prop);ecount.layout.singular=$.Class(ecount.layout,n)}}};ecount.class("ecount.layout.formstylelayer","ecount.layout.layer",{template:'<div class="dropdown-menu dropdown-menu-set-send-notice {{css}}" data-type="layout.formstylelayer" data-ecpath="{{ecPath}}" style="{{style}}">{{ulTemp}}<\/div>',ulTemplate:'<ul class="wrapper-form wrapper-form-state-1 {{css}}" data-ecpath="{{ecPath}}" >{{liTemp}}<\/ul>',liTemplate:'<li data-listid="{{id}}" class="{{class}}">{{contents}}<\/li>',liDummy:'<li data-listid="{{id}}" class="{{class}}"><div class="title" data-listid="testMultiCodewh">testMultiCodewh<\/div><div class="form"><div class="control-set"><div class="control">test code<\/div><\/div><\/li>',titleTemplate:'<div class="title" data-listid="{{id}}">{{title}}<\/div>',formTemplate:'<div class="form"><\/div>',items:[],itemList:[],groupData:{},_isShow:!1,_notClear:!1,positionTop:0,positionLeft:0,maxHeight:250,isPlacementAuto:!0,init:function(){ecount.layout.prototype.init.apply(this,arguments);this._initializeData()},_initializeData:function(){this.groupData={};this.itemList=[];this._initFormDelegator()},_initFormDelegator:function(){this.events=new ecount.events(this);this.events.on({"control.change":this._ON_CHANGE_CONTROL,"control.openPopup":this.transferEvent,"control.openLayer":this.transferEvent,"page.adjustHeaderSearchDimensions":this.transferEvent,"page.adjustContentsDimensions":this.transferEvent,"page.showProgressbar":this.transferEvent,"page.hideProgressbar":this.transferEvent,"page.toggleProgressbarLayer":this.transferEvent})},render:function(n){this.setTemplate();ecount.layout.prototype.render.call(this,n);this.items&&this.addItems();this._setObserve();this._bindEvent()},_setObserve:function(){ecount.runtime.observe("scroll.page.eventContainer",this.ecPageID,function(){this.isVisible()&&this.hide()}.bind(this));ecount.runtime.observe("resize",this.ecPageID,function(){this.isVisible()&&this.hide()}.bind(this))},_stopObserving:function(){ecount.runtime.stopObserving(this.ecPageID,"scroll.page.eventContainer");ecount.runtime.stopObserving(this.ecPageID,"resize")},_bindEvent:function(){$(document).off("mousedown."+this.ecPageID).on("mousedown."+this.ecPageID,this._other_click.bind(this))},_unBindEvent:function(){$(document).off("mousedown."+this.ecPageID)},_other_click:function(){var n=ec$.getClosestAttr(arguments[0].target,"data-type")=="layout.formstylelayer",t=ec$.getClosestAttr(arguments[0].target,"data-service")=="layout.formstylelayer",i=ec$.getClosestAttr(arguments[0].target,"data-cid"),r=this.getControl(i)===null;n||t||this._notClear||!r||this.hide()},setNotClear:function(n){this._notClear=!!n},destroy:function(){this._stopObserving();this._unBindEvent();ecount.layout.prototype.destroy.apply(this,arguments)},getEcPath:function(){return this.ecPath},getEcIKey:function(){return this.ecIKey},setEcIKey:function(){this.ecIKey=ecount.global.registerEcInstance(this)},getOwnerKey:function(){return this.ownerKey},setTemplate:function(){this.ulTemplate=ecount.widget.replaceAttr(this.ulTemplate,{liTemp:"",css:"",ecPath:this.ecPath});this.template=ecount.widget.replaceAttr(this.template,{ulTemp:this.ulTemplate,css:"",ecPath:this.ecPath,style:"max-height: "+this.maxHeight+"px;",serviceKey:this.getEcIKey(),ownerKey:this.getOwnerKey()})},addItems:function(){var n=this.$el?this.$el.find("ul"):[];if(n.length>0)n=n.eq(0);else return;this._createControl();this._renderControl(n)},_createControl:function(){for(var i,n,t=0,r=this.items.length;t<r;t++)i=this._addOptionsToItem(this.items[t]),i.__type===widget.generator.CONTROL&&(n=ecount.common.createNamespace(i.controlType),n=new n(i),n.habitation="formStyleLayer",this.itemList.push(n))},_addOptionsToItem:function(n){var t=_.extend({},n,{containerName:this.containerName,ecPageID:this.ecPageID,pId:this.tabId,panelID:this.panelID,tabID:this.tabId,onSync:this.onSync,__pnode:this.__type,__type:widget.generator.CONTROL,__HEADLESS:this.__HEADLESS,delegator:this.events,ecTransaction:this.ecTransaction});return t.groupId&&this._insertGroupMember(t.groupId,t.id),(t.addonPopoverOptions||t._controls)&&(t.otherPopoverContainer=this.$el),t},_insertGroupMember:function(n,t){var i=this.groupData[n];i?i.member.push(t):this.groupData[n]={master:t,member:[],isHide:!0}},_renderControl:function(n){for(var t,u=0,e=this.itemList.length;u<e;u++){t=this.itemList[u];var i=document.createElement("li"),r=document.createElement("div"),f=document.createElement("div");i.setAttribute("id",t.id);i.setAttribute("data-listid",t.id);i.className=this._setLiClass(u,t);r.setAttribute("data-listid",t.id);r.appendChild(document.createTextNode(t.subTitle));t.groupId&&this.isGroupMaster(t)&&(r.setAttribute("data-ecpath",this.ecPath),r.setAttribute("data-function","group"));r.className="title";f.className="form";i.appendChild(r);i.appendChild(f);n.append(i);t.render($(f))}},_setLiClass:function(n,t){var i=[],r=t.groupId&&this.isGroupMaster(t),u=t.groupId&&!this.isGroupMaster(t),f=t.isCombinedControl()?!t.hidden:t.isVisible();return(t.isMultiCell||t.isWholeRow)&&i.push("whole-row"),r&&i.push("form-collapse collapsed"),(u||t.isHideCell||!f)&&i.push("hidden"),i.join(" ")},isGroupMaster:function(n){var i=n.groupId,r=n.id,t=this.groupData[i];return t&&t.master==r?!0:!1},getItemList:function(){return this.itemList},getControl:function(n,t){return t!==undefined?this.getControlByIndex(t):this._getControl("id",n)},getIndex:function(n){var i=this.getItemList(),t,r;if(typeof n=="string")for(t=0,r=i.length;t<r;t++)if(i[t].id==n)return t;return null},getControlByIndex:function(n){return this.itemList[n]},_getControl:function(n,t){for(var i=0,f=this.itemList.length,r,u;i<f;i++)if(r=this.itemList[i],t==r[n])return r;for(i--;i>-1;i--)if(r=this.itemList[i],r.isCombinedControl()&&r.itemList&&(u=this._getControl.call(r,n,t),u))return u;return null},show:function(n){this._isShow=!0;this.setPosition(n);this.$el.addClass("show");this.reflowContainer()},hide:function(){this._isShow=!1;this.$el.removeClass("show")},isVisible:function(){return this._isShow},toggle:function(n){this.isVisible()?this.hide():this.show(n)},setPosition:function(n){var r={},i=2-ecount.common.getZoomRatio(),u=ecount.global.findPageInstance(this.ecPageID),f=this.$el.outerHeight(!0),e,t,o,s;_.isObjectLike(n)&&(this.positionTop=n.top-f,this.positionLeft=n.left,this.isPlacementAuto&&(e=$(window).scrollTop(),t=[{posName:"top",value:f*i-n.top*i+e},{posName:"bottom",value:f*i-($(window).height()-n.top*i-n.height*i)-e}],console.log("[topOverPx: %o], [bottomOverPx: %o], [scrollTop: %o]",t[0].value,t[1].value,e),console.log("[top: %o], [left: %o], [layerHeight: %o]",n.top,n.left,f),o=t[0].value<t[1].value?t[0]:t[1],o.posName==="bottom"&&(this.positionTop=n.top+n.height)));r.top=this.positionTop+"px";r.left=this.positionLeft+"px";u&&(s=u.isInclude?u._ecParent:u,s.popupType=="layer"&&(r.zIndex="2002"));this.$el.css(r)},showRow:function(n,t){var u,i,f,t=t||"hidden",r;for($.isArray(n)||(n=[n]),r=0;r<n.length;r++)f=n[r],i=this.getControl(f),u=this.$el.find('li[data-listid="'+f+'"]'),u.length>0&&(u.removeClass(t),i&&i.show(),i&&i.reflowContainer&&i.reflowContainer())},hideRow:function(n,t){var i,u,f,t=t||"hidden",r;for($.isArray(n)||(n=[n]),r=0;r<n.length;r++)f=n[r],u=this.getControl(f),i=this.$el.find('li[data-listid="'+f+'"]'),i.length>0&&(i.hasClass(t)||i.addClass(t),u&&u.hide())},reflowContainer:function(){for(var t,i=this.getItemList(),n=0,r=i.length;n<r;n++)t=i[n],t.reflowContainer&&t.reflowContainer()},setNotClear:function(n){this._notClear=n===!1?!1:!0},_ON_CHANGE_CONTROL:function(n){n.preventTriggerEvent||this.delegator.triggerEvent("control.change",n)},ON_CLICK:function(n){if(n.ecFunction){var t="_ON_"+n.ecFunction.toUpperCase()+"_CLICK";this[t]&&this[t].apply(this,arguments)}},_ON_GROUP_CLICK:function(n,t){var u=n&&n.cid?n.cid:t.target.getAttribute("data-listid"),r=this.getControl(u),f=r&&this.isGroupMaster(r),i=this.groupData[r.groupId],e=n&&!$.isNull(n.toggleFlag)?n.toggleFlag:i.isHide;f&&!r.isHideCell&&(e===!0?(this.showRow(i.member),this.$el.find('li[data-listid="'+u+'"]').removeClass("collapsed"),i.isHide=!1):(this.hideRow(i.member),this.$el.find('li[data-listid="'+u+'"]').addClass("collapsed"),i.isHide=!0),ecount.runtime.notify("button.reposition",this.ownerKey,{}))}});ecount.layout.form.base||(ecount.layout.form.base={});ecount.layout.form.base._export=function(){return{prop:{active:!1,onSync:!1,templateType:null,_styleType:null,_hideRowList:[],_isErrorBorderNone:!1,_useDynamicColSize:!1,_dummy:$("<div><\/div>"),_useCustomColGroup:!1,_emptyDummyCellStr:"<th class='moveNoCell'><\/th><td class='moveNoCell'>",init:function(n){var t,i;if(ecount.layout.prototype.init.apply(this,arguments),this.rowspanIdx=0,this.headMergePoint=0,this.headerRowSpanIdx=0,t=$.isEmpty(n.controls)?n.rows:n.controls,this.hasFormSet=t.some(function(n){return n.formSet&&n.formSet.length>0}),this.mouseHoverInTime=ecount.common.mouseHoverInTime,this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID}),this.multiColSettings=n.multiColSettings?n.multiColSettings:ecount.config.companyForm.MULTICOL_SETTINGS,$.isEmpty(this.template)){this.templateType=this.templateType||"base";switch(this.templateType){case"base":case"formset":i="base";this.template=ecount.layout.template[["form",i].join("-")];break;case"customer":this.template=ecount.layout.template[["form",this.templateType].join("-")];break;default:this.template=n.colSize||this.colSize?ecount.layout.template[["form",this.templateType,n.colSize||this.colSize].join("-")]:ecount.layout.template[["form",this.templateType].join("-")]}}this.initialTemplate=this.template;this.itemList=[];this.invalidControlList=[];this.dropDownLists={};this.dropdownLayerLists={};this.events=new ecount.events(this);this.events.on({"control.change":this._ON_CHANGE_CONTROL,"control.openPopup":this._ON_POPUP,"anchor.click":this._ON_CLICK_CONTROL,"button.click":this._ON_CLICK_CONTROL,"dropdown.click":this._ON_CLICK_CONTROL,onClickControl:this._ON_CLICK_CONTROL,"control.focusout":this._ON_MOVE_FOCUS,"control.showError":this._ON_SHOWERROR_CONTROL,"control.hideError":this._ON_HIDEERROR_CONTROL,"control.focusin":this._ON_FOCUSIN_CONTROL,"dualMode.buttonDisplay":this._ON_DUAL_MODE_BUTTON_DISPLAY,"page.adjustContentsDimensions":this.ADJUSTCONTENTSDIMENSIONS,"page.showProgressbar":this.transferEvent,"page.hideProgressbar":this.transferEvent,"control.openLayer":this._ON_LAYER,scope:this});this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer)},render:function(){var n,i,r,t;if(this.setupItems(),n=this.convertItemsToRows(this.items),!_.isEmpty(n)){for(i=[],r=0;r<n.length-2;r++){var u=n[r],f=n[r+1],e=u.length;for(t=0;t<e;t++)!u[t].thSubTitle||!f[t].thSubTitle||i.push(t)}this.thSubTitleColIdxArr=i.filter(function(n,t){return i.indexOf(n)===t}.bind(i))}this.setTemplate();ecount.layout.prototype.render.apply(this,arguments);this.afterRenderAction(n)},afterRenderAction:function(n){this.setData(n);this.active&&this.$el.addClass("active")},getFormTypeControl:function(){var n=ecount.layout.getFormData(this.fOptions.formType,this.inIncludePage,this.ecPageID,this.fromTypeTabCd);return ecount.layout.tabContents.prototype.setFormControls.apply(this,[n.columns,n.option,this]),$.isEmpty(this.controls)?this.convertRowsToItems(this.rows):this.controls},reDraw:function(){var i=this.$el.parent(),n=document.createDocumentFragment("div"),r=ecview.util.findOwnIndex(this.$el.get(0)),t;this.$el.remove();this.template=this.initialTemplate;this.setupItems();t=this.convertItemsToRows(this.items);this.setTemplate();ecount.layout.prototype.render.apply(this,[$(n)]);ecview.util.insertInside(i.get(0),n,r);this.afterRenderAction(t)},setMultiColSettings:function(n){_.isArray(n)&&(this.multiColSettings=n)},getMultiColSettings:function(){return this.multiColSettings},getHeadColWidth:function(){return this.getColWidthByIndex(0)},getDataColWidth:function(){return this.getColWidthByIndex(1)},getFormWidth:function(){return this.$el.width()},isFullWidthMode:function(){return!!(this.$el.get(0).style.width.indexOf("%")>-1)},setFullWidthMode:function(n){if(n){this.$el.get(0).style.width="100%";this.setDataColWidth(null);return}this.$el.get(0).style.width=ecview.util.getCssValueFormat(this.$el.width());this.setDataColWidth(parseFloat(this.$el.find("tbody > tr > td:nth(1)").css("width"))||parseFloat(this.$el.find("colgroup > col:nth(1)").css("width")))},setHeadColWidth:function(n){for(var t=0,i=this.colSize*2;t<i;t+=2)this.setColWidthByIndex(t,n)},setDataColWidth:function(n){for(var t=1,i=this.colSize*2;t<i;t+=2)this.setColWidthByIndex(t,n)},updateTableWidth:function(){var n;n=this._hasNoColGroup()?Array.prototype.reduce.call(this.$el.get(0).rows[0].cells,function(n,t){return n+parseInt(t.style.width?t.style.width:t.getBoundingClientRect().width)},0):Array.prototype.reduce.call(this.$el.get(0).firstElementChild.children,function(n,t){return n+parseInt(t.style.width)},0);this.$el.get(0).style.width=ecview.util.getCssValueFormat(n+1)},getColWidthByIndex:function(n){return this.$el.get(0).rows[0].cells[n].getBoundingClientRect().width},setColWidthByIndex:function(n,t){if(this._hasNoColGroup()){this.$el.find("tbody > tr").children(":nth("+n+")").css("width",ecview.util.getCssValueFormat(width));return}this.$el.get(0).firstElementChild.children[n].style.width=ecview.util.getCssValueFormat(t)},destroy:function(){ecount.layout.prototype.destroy.call(this)},convertRowsToItems:function(n){var i,r,u,f,t;if($.isEmpty(n))return n;for(r=[],u=0;u<n.length;u++){if(i=$.isArray(n[u])?n[u]:[n[u]],i.length==1){i.cellSize=this.colSize;r.push(i[0]);continue}if(i.length==this.colSize){for(t=0;t<i.length;t++)i[t].cellSize=1,r.push(i[t]);continue}for(f=0,t=0;t<i.length;t++)i[t].cellSize=this.getCellSize(i[t]),f+=i[t].cellSize,r.push(i[t]);if(f<this.colSize)for(t=f;t<this.colSize;t++)r.push({controlType:"widget.empty"})}return r},convertItemsToRows:function(n,t){function k(i){for(var r=i+1;r<n.length;r++)if(t.call(this,n[r]))return n[r]}function h(n){var n=$.isArray(n)?n:[n],t=n.length,i=n.count(function(n){return n.controlType=="widget.empty"});(t!=i||f.allowEmptyRow)&&o.push(Object.clone(n));n.clear();e=0;f._rowspan&&f._styleType&&f._styleType._isToolbarType==!0&&(f._rowspan[o.length-1]?(u=f.colSize,l=o.length-1):l+f._rowspan[l]==o.length&&(u=u+1))}function p(n,t){for(var i=0;i<t;i++)n.push({controlType:"widget.empty"})}var s,v,b,y;if($.isEmpty(n))return null;$.isFunction(t)||(t=function(n){return n.isHideCell!=!0});var f=this,o=[],i,c,r=[],e=0,w=0,l,a,u=this._styleType&&this._styleType._isToolbarType==!0?this.colSize+1:this.colSize;for(s=0,v=n.length;s<n.length;s++,v--){if(i=n[s],c=k.call(this,s),t.call(this,i)==!1){a||(a=$("<div/>").hide().appendTo(this.$el));b=$.isArray(i)?i:[i];control=this.getItemListByControlId(b[0].id);a.append(control.$el);continue}if(i.cellSize=this.getCellSize(i),e+=i.cellSize,w=v==1?0:this.getCellSize(c),e<=u&&r.push(i),e==u||i.hideCellTitle){h(r);continue}if(e+w>u){p(r,u-e);h(r);continue}if($.isEmpty(c)){p(r,u-e);h(r);continue}}if(this.emptyRowCount>0)for(y=0;y<this.emptyRowCount;y++)p(r,this.colSize),h(r);return o},setData:function(n){var t=[];n&&(n=$.isArray(n)?n:[n],t=this.createRows.call(this,n),this.$el.find("tbody").off().empty().append(t),this.createShowError(n),this.ecTransaction.complete(this.onLoadComplete.bind(this)),this.ecTransaction.start())},createShowError:function(n){for(var u,i,f,r,t=0;t<n.length;t++)for(u=n[t],i=0;i<u.length;i++)f=u[i],r=this.getItemListByControlId(f.id),r&&r.needValidate&&r.showError()},createRows:function(n){for(var u,f=[],i=1,r=0,e=1,o=0,s=!1,s=n.some(function(n){return n[0].thSubTitle}),t=0;t<n.length;t++)n[t].pIndex=t,n[t].colSize=this.colSize+1,this._rowspan&&this._rowspan[t]?(r=this._rowspan[t],i=r):this._thSubTitleRowspan&&this._thSubTitleRowspan[t]?(o=this._thSubTitleRowspan[t],e=o):r>1?(r--,i=0):i=1,u=this.createRow(n[t],t,i,e,s),u&&f.push(u);return f},createRow:function(n,t,i,r,u){function s(){for(var u=this._styleType&&this._styleType._isToolbarType==!0?"th, td":"td",r=f.find(u),i=0;i<n.length;i++)(e=this.getItemListByControlId(n[i].id),$.isNull(e))||(e.pIndex=t,e._popover&&delete e._popover,e._isRendered?$(r[i]).append(e.$el):e.render($(r[i])))}function h(){if(n.length==1&&n[0].groupId)if(f.attr("data-group",n[0].groupId),n[0].isGroupMember)f.addClass("hidden");else f.find("[data-show]").on("click",this._ON_TOGGLE_GROUP.bind(this))}function c(){for(var r,t=0;t<n.length;t++)if(r=n[t]._popover,r){var u="span-user-help-mark-"+f.attr("id").split("-")[f.attr("id").split("-").length-1],i=$('<span class="user-help-mark" id="'+u+'" data-content="'+r.message+'" data-placement="'+r.placement+'" data-trigger="focus hover click" data-toggle="popover" data-html="true"/>'),e=[{target:i,isShow:!1},{target:f,isShow:!1}],o=n[0].popoverThPosition&&n[0].popoverThPosition-1;f.find("th").eq(o||t).after(" ").append(i);i.popover({content:r.message||"error",container:n[t].eventContainer||"body",delay:{show:this.mouseHoverInTime,hide:0},popoverCallBack:this.togglePopover.bind(this,e)});f.on("mouseenter",this.togglePopover.bind(this,{target:f,isShow:!0}));f.on("mouseleave",this.togglePopover.bind(this,{target:f,isShow:!1}));i.on("mouseenter",this.togglePopover.bind(this,{target:i,isShow:!0}));i.on("mouseleave",this.togglePopover.bind(this,{target:i,isShow:!1}));delete n[t]._popover}}function l(){var r=f.find("th"),t,n,i,u;for(this.allowEmptyRow&&f.css("height","33px"),i=0,u=r.length;i<u;i++)n=r.eq(i),t=n.attr("id")||n.next("td").attr("id")||f.attr("id")&&f.attr("id").replace("row-",""),this.allowEmptyRow&&t&&f.css("height",""),n.attr("data-hoverid",t),n.next("td").attr("data-hoverid",t),n.attr("data-listid",t),n.next("td").attr("data-listid",t)}var e,f,o;return n=$.isArray(n)?n:[n],this._styleType?f=this.createCellStyle(n,i):n.length>1?f=this.createCellMulti(n,i):(o=n[0].groupId&&!n[0].isGroupMember,f=this.createCellSingle(n[0],o,i,r,u)),this._hideRowList.contains(t)&&f.hide(),c.call(this),s.call(this),h.call(this),l.call(this),f},addPopoverList:function(n){this.popoverList.push(n)},togglePopover:function(n){for(var r=$.isArray(n)?n:[n],t,u,i=0;i<r.length;i++)t=r[i].target,u=r[i].isShow,t[0].nodeName.toUpperCase()=="TR"?this.togglePopoverIcon(t,u):this.drawPopoverIcon(t,u)},togglePopoverIcon:function(n,t){if(this.isMouseActionPopover(n)==!1)return!1;t==!0?(n.find("th > [id^='span-user-help-mark-']").css("display","inline-block"),n.find("th > [id^='span-user-help-mark-']").css("visibility","visible")):(n.find("th > [id^='span-user-help-mark-']").css("display",""),n.find("th > [id^='span-user-help-mark-']").css("visibility",""))},drawPopoverIcon:function(n,t){if(this.isMouseActionPopover(n)==!1)return!1;t==!0?n.addClass("active"):n.removeClass("active")},isMouseActionPopover:function(n){if(n[0].nodeName.toUpperCase()=="TR"){if(n.find("th > span").data("popover-mousedown")=="true")return!1}else if(n.data("popover-mousedown")=="true")return!1;return!0},hideClickPopover:function(n){var t=this.popoverList.find(function(t){return t!=n&&t._onclicked});t&&t.bodyClickHandler&&t.bodyClickHandler()},createCellStyle:function(n,t){var r=$("<tr><\/tr>"),e="",h=1,c=0,l=this.colSize,a=0,f=Array(),u,o,v,s,i,y;for($.isEmpty(n[0].id)==!1&&r.attr("id","row-"+n[0].id),this._styleType._isThShow&&(c=1),this.RowInCount&&(h=this.RowInCount),i=0;i<h;i++)for(u=0;u<2;u++)for(o=0;o<(u==0?c:l);o++)u==0?t>=1&&(e+="<th "+(t>1?"rowspan='"+t+"'":"")+"><\/th>"):(v=o==l-1&&this._styleType&&this._styleType._isToolbarType==!0?' class="text-center"':"",e+='<td data-label="'+n[0].subTitle+'"'+v+"><\/td>"),u==0&&f.push(a),a++;for(e.length>0&&r.append(e),n._isNoMoveFormset&&(r.find("td").attr("data-nomove","1"),r.find("th").attr("data-nomove","1")),s=r.find("th"),i=0;i<s.length;i++)$.isNull(n[f[i]].subTitle)||s.eq(i).html(n[f[i]].subTitle),$.isNull(n[f[i]].css)||s.eq(i).addClass(n[f[i]].css);if(n&&n.dualMode==!0){y=$('<div class="pull-right"><div class="btn-group"><a dropdown-show="show" href="javascript:;"><span class="fa fa-caret-right"><\/span><\/a><\/div><\/div>');r.find("th").after(" ").append(y);this.createDualButtonFunction(r,n);r.find("[dropdown-show]").on("click",this._ON_FOCUSIN_CONTROL.bind(this,{id:n.id,mode:!0}));r.find("div[dual-arrow]").on("mouseenter",this._ON_DUAL_MOUSEOVER.bind(this,{id:n.id,mode:!0,time:this.mouseHoverInTime}));r.find("div[dual-arrow]").on("mouseleave",this._ON_DUAL_MOUSEOUT.bind(this,{id:n.id,mode:!0}))}return r},createCellSingle:function(n,t,i,r,u){var f,e,s=!$.isEmpty(n.thSubTitle),o=n.subTitle||"",h,c,l;if(t)this.colSize==1?f=$(ecount.widget.replaceAttr(ecount.layout.template.formRowGroupingSingle,n)):(f=$(ecount.widget.replaceAttr(ecount.layout.template.formRowGrouping,n)),f.find("td").attr("colspan",this.colSize*2-1)),f.find("td").attr("data-label",n.subTitle),n._isNoMoveFormset&&(f.find("td").attr("data-nomove","1"),f.find("th").attr("data-nomove","1"));else{if(f=$("<tr><\/tr>"),$.isEmpty(n.id)==!1&&f.attr("id","row-"+n.id),e="",n.hideCellTitle||this.hideCellTitle||i>0&&(e+="<th "+(i>1?"rowspan='"+i+"'":"")+"><\/th>"),e+='<td data-label="'+n.subTitle+'"><\/td>',f.append(e),n._isNoMoveFormset&&(f.find("td")&&f.find("td").attr("data-nomove","1"),f.find("th")&&f.find("th").attr("data-nomove","1")),$.isEmpty(n.groupId)==!1&&i>0&&f.find("th")&&f.find("th").css("text-primary"),$.isEmpty(n.subTitle)==!1&&i>0&&!n.hideCellTitle&&!this.hideCellTitle&&($.isEmpty(n.titleLink)||(o=['<a href="javascript:;" id="btn-TitleFormLink-',n.titleLinkID,'">',o,"<\/a>"].join("")),$.isEmpty(n.subTitleLink)?f.find("th").html(o):(h='<div class="{0}"><a href="javascript:;" id="btn-FormLink-{1}" class="{2}">{3}<\/a><\/div>',c=n.subLinkButton!=!0?"pull-right":"",f.find("th").html(o+String.format(h,c,n.subLinkID,n.subLinkCss||"",n.subTitleLink))),f.find("a").length))f.on("click","a",this._ON_CLICK_SUBTITLELINK.bind(this));if(this.colSize>1&&(n.hideCellTitle?f.find("td").attr("colspan",this.colSize*2):f.find("td").attr("colspan",this.colSize*2-1)),$.isEmpty(n.id)==!1&&i>0&&(n.hideCellTitle||this.hideCellTitle?f.find("td").attr("id",n.id):f.find("th").attr("id",n.id)),$.isNull(n.thCss)||n.hideCellTitle||this.hideCellTitle||f.find("th").addClass(n.thCss),n&&n.dualMode==!0){l=$('<div class="pull-right"><div class="btn-group" dual-arrow><a dropdown-show="show" href="javascript:;"><span class="fa fa-caret-right"><\/span><\/a><\/div><\/div>');f.find("th").after(" ").append(l);this.createDualButtonFunction(f,n);f.find("[dropdown-show]").on("click",this._ON_FOCUSIN_CONTROL.bind(this,{id:n.id,mode:!0}));f.find("div[dual-arrow]").on("mouseenter",this._ON_DUAL_MOUSEOVER.bind(this,{id:n.id,mode:!0,time:this.mouseHoverInTime}));f.find("div[dual-arrow]").on("mouseleave",this._ON_DUAL_MOUSEOUT.bind(this,{id:n.id,mode:!0}))}u&&!s&&f.find("#"+n.id).attr("colspan",2);s&&(i==0&&f.find("th").length==0?f.prepend("<th>"+n.thSubTitle+"<\/th>"):f.find("th").after("<th>"+n.thSubTitle+"<\/th>"))}return f},createCellMulti:function(n,t){var i,f,r=$("<tr><\/tr>"),e,u,o,s,h,c;for($.isEmpty(n[0].id)==!1&&r.attr("id","row-"+n[0].id),e=this.items.some(function(n){return!!n.thSubTitle}),u=0;u<n.length;u++){if(i=n[u],f=i.subTitle||"",o=!$.isEmpty(i.thSubTitle),cells="",i.hideCellTitle||this.hideCellTitle||t>0&&(cells+="<th "+(t>1?"rowspan='"+t+"'":"")+"><\/th>"),cells+='<td data-label="'+i.subTitle+'"><\/td>',r.append(cells),i.cellSize>1&&r.find("td").eq(u).attr("colspan",i.cellSize*2-1),i.hideCellTitle&&r.find("td").eq(u).attr("colspan",i.cellSize*2),$.isEmpty(i.subTitle)==!1&&t>0&&!i.hideCellTitle&&!this.hideCellTitle&&($.isEmpty(i.titleLink)||(f=['<a href="javascript:;" id="btn-TitleFormLink-',i.titleLinkID,'">',f,"<\/a>"].join("")),$.isEmpty(i.subTitleLink)?e?r.find("th").last().html(f):r.find("th").eq(u).html(f):(s='<div class="{0}"><a href="javascript:;" id="btn-FormLink-{1}" class="{2}">{3}<\/a><\/div>',h=i.subLinkButton!=!0?"pull-right":"",r.find("th").eq(u).html(f+String.format(s,h,i.subLinkID,i.subLinkCss||"",i.subTitleLink))),r.find("a").length))r.on("click","a",this._ON_CLICK_SUBTITLELINK.bind(this));if(i._isNoMoveFormset&&(r.find("td")&&r.find("td").eq(u).attr("data-nomove","1"),r.find("th")&&r.find("th").eq(u).attr("data-nomove","1")),$.isEmpty(i.id)==!1&&t>0&&(i.hideCellTitle||this.hideCellTitle?r.find("td").eq(u).attr("id",i.id):e?r.find("th").last().attr("id",i.id):r.find("th").eq(u).attr("id",i.id)),$.isNull(i.thCss)||i.hideCellTitle||this.hideCellTitle||r.find("th").eq(u).addClass(i.thCss),i&&i.dualMode==!0){c=$('<div class="pull-right"><div class="btn-group"><a dropdown-show="show" href="javascript:;"><span class="fa fa-caret-right"><\/span><\/a><\/div><\/div>');r.find("th").eq(u).after(" ").append(c);this.createDualButtonFunction(r,i);r.find("[dropdown-show]").on("click",this._ON_FOCUSIN_CONTROL.bind(this,{id:i.id,mode:!0}))}!o&&this.thSubTitleColIdxArr.indexOf(u)>=0&&r.find("#"+i.id).attr("colspan",2);o&&r.find("td").last().before("<th id='thSubTitle'>"+i.thSubTitle+"<\/th>")}return r},createDualButtonFunction:function(n,t){var r=ecount.common.createNamespace(t.controlType).prototype.dualStepButtonInfo,i=n.find("div.btn-group");this.dropDownLists["list-"+t.id]=new ecount.layout.dropdown({items:r,ecPageID:this.ecPageID,eventContainer:t.eventContainer,direction:"",dualMode:t.dualMode,onClick:function(n){this._ON_DUAL_MODE(n,t)}.bind(this),onBeforeHide:function(){this.setIsDualClick(t.id,!1);ecount.global.clearTimeoutByTimerNo(this.ecPageID,this.dropdownLayerLists["dropdown-"+t.id]._mouseHoverTimer)}.bind(this),popupID:t.popupID,popupLevel:t.popupLevel,pnode:i});this.dropDownLists["list-"+t.id].render(i);this.dropdownLayerLists["dropdown-"+t.id]={}},createControl:function(n,t){if(n.controlType=="widget.empty")return null;var i=this.getControlGeneratingOptions(n,t);return this.getGeneratedControl(i)},getGeneratedControl:function(n){var t=ecount.common.createNamespace(n.controlType);return new t(n)},getControlGeneratingOptions:function(n,t){if(n.controlType=="widget.empty")return null;if(this.initializer&&ecount.control.initializeByUserSetting(this.initializer,n),n.__pnode=this.__type,n.controlType==="widget.custom"&&(n.containerName=this.containerName),n.containerName=this.containerName,n.__type=widget.generator.CONTROL,n.pId=this.tabId,n.gridID="",n.tabID=this.tabId,n.onSync=this.onSync,(this.css||"").indexOf("table-template-setup")==-1&&this.fOptions)switch(this.fOptions.formType){case"AU360":case"AU760":case"AU761":case"AU762":case"AU763":case"AU764":case"AU390":case"AU370":case"AU380":case"AU340":case"AU350":case"AU410":case"AU400":case"AU420":case"AU440":case"AU450":case"AU460":case"AU470":case"AU480":case"AU500":n._isRowSpan=!1;break;default:n._isRowSpan=this.colSize>=2}return n.colSize=this.colSize,n._isErrorBorderNone=this._isErrorBorderNone,this._executeValidateIfVisible&&(n._executeValidateIfVisible=this._executeValidateIfVisible),ecount.widget.createDisplayID(n,"btn",this.containerName),n.delegator=this.delegator,n.containerDelegator=this.containerDelegator_panel,n.ecTransaction=this.ecTransaction,t&&(n=$.extend(n,t)),n},onLoadComplete:function(){var n={target:this.containerName,type:this.__type,__self:this};this.showFormLayer&&this.setShowFormLayer();this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},setShowFormLayer:function(){var n=this.$el.closest(".wrapper-header-search");n.length>0?n.show():this.$el.parent().show()},destroy:function(){ecount.layout.prototype.destroy.apply(this,arguments)},setupItems:function(){var n=$.isEmpty(this.controls)?this.convertRowsToItems(this.rows):this.controls;this.fOptions&&this.fOptions.formType&&(n=this.getFormTypeControl(n));this.items=this.cloneRows(n);this.setGroupInfo(n);this.setItemList(n)},setTemplate:function(){function e(n){var i=this.multiColSettings.find(function(t){return Number(t.COL_TYPE)==n}),t={IS_APPLY:null,SIZE:null,IS_FILL:null,TABLE_WIDTH:0,COL_WIDTH:[]};if(n=$.parseNumber(n),t.COL_WIDTH.clear(),t.IS_APPLY=this._useDynamicColSize,t.IS_APPLY==!1)return t;t.SIZE=n;t.IS_FILL=i.FILL_CHK_YN=="1";switch(t.SIZE){case 1:t.COL_WIDTH=this._isFixed?[150,null]:[$.parseNumber(i.LABEL_WIDTH)-1,t.IS_FILL?null:$.parseNumber(i.INPUT_WIDTH),];break;case 2:t.COL_WIDTH=this._isFixed?[150,null,150,null]:[$.parseNumber(i.LABEL_WIDTH)-1,t.IS_FILL?null:$.parseNumber(i.INPUT_WIDTH),$.parseNumber(i.LABEL_WIDTH,0),t.IS_FILL?null:$.parseNumber(i.INPUT_WIDTH)];break;case 3:t.COL_WIDTH=[$.parseNumber(i.LABEL_WIDTH)-1,t.IS_FILL?null:$.parseNumber(i.INPUT_WIDTH),$.parseNumber(i.LABEL_WIDTH,0),t.IS_FILL?null:$.parseNumber(i.INPUT_WIDTH),$.parseNumber(i.LABEL_WIDTH,0),t.IS_FILL?null:$.parseNumber(i.INPUT_WIDTH)];break;case 4:t.COL_WIDTH=[$.parseNumber(i.LABEL_WIDTH)-1,t.IS_FILL?null:$.parseNumber(i.INPUT_WIDTH),$.parseNumber(i.LABEL_WIDTH,0),t.IS_FILL?null:$.parseNumber(i.INPUT_WIDTH),$.parseNumber(i.LABEL_WIDTH,0),t.IS_FILL?null:$.parseNumber(i.INPUT_WIDTH),$.parseNumber(i.LABEL_WIDTH,0),t.IS_FILL?null:$.parseNumber(i.INPUT_WIDTH)]}return t.TABLE_WIDTH=t.IS_FILL?null:t.COL_WIDTH.sum()+1,t}var t,h,o,f,c,n,r,i,l,u;if(this.template=ecount.widget.replaceAttr(this.template,{style:this.style?'style="'+this.style+'"':"",css:this.css||"",label_width:"",input_width:"",serviceAttr:this.hasFormSet?"formSet":""}),t=$(this.template),this._styleType&&this._styleType._isToolbarType==!0){var s=$("<colgroup><\/colgroup>"),n=e.call(this,1),r=this.colgroup||[];for(i=0,h=r.length;i<h;i++)o=$("<col><\/col>"),f=r[i].width,i==0&&$.isNull(f)&&(f=n.COL_WIDTH[0]),o.css("width",f||""),s.append(o);t.prepend(s);t.filter("table").removeClass("table-responsive");t.filter("table").addClass("table-border-no-a");t.css("width",n.TABLE_WIDTH);this.template=$("<div><\/div>").append(t).html();return}if($.isEmpty(this.isShowLeftAndRightBorder)==!1&&(c=(this.css||"").indexOf("table-border-no-lr")>-1,c?this.isShowLeftAndRightBorder==!0&&t.removeClass("table-border-no-lr"):this.isShowLeftAndRightBorder==!1&&t.addClass("table-border-no-lr")),this.noBorderTable&&t[0].setAttribute("class","table table-border-no-a table-th-left table-th-bold table-responsive table-form"),this._useCustomColGroup||this._styleType&&this.colgroup){for(r=$("<colgroup><\/colgroup>"),i=0;i<this.colgroup.length;i++)r.append("<col><\/col>").css("width",this.colgroup[i].width||"");t.prepend(r);this.template=$("<div><\/div>").append(t).html()}if(this.colgroup){t.find("colgroup > col").eq(0).css("width",this.colgroup[0].width);this.colgroup.length>1&&t.find("colgroup > col").eq(1).css("width",this.colgroup[1].width||"");this.template=$("<div><\/div>").append(t).html();return}this.useResizable&&t.addClass("resizable");n=null;switch(this.templateType){case"list":n=e.call(this,1);n.TABLE_WIDTH=null;n.COL_WIDTH[1]=null;break;case"register":n=e.call(this,1);n.IS_FILL&&(n.TABLE_WIDTH=null);break;case"base":case"input":case"formset":for(n=e.call(this,this.colSize),r=$("<colgroup><\/colgroup>"),i=0;i<n.SIZE;i++)r.append("<col><\/col><col><\/col>");l=this.items.some(function(n){return!!n.thSubTitle});l&&r.children().first().after('<col id="subThTitle"><\/col>');t.prepend(r);this.templateType=="formset"&&(n.TABLE_WIDTH=null,n.IS_APPLY=!1)}n&&n.IS_APPLY&&(t.find("colgroup > col").length!=n.COL_WIDTH.length&&(u=[],n.COL_WIDTH.forEach(function(n,t){if(t%2)u.push(n);else{var i=n/2;u.push(i);u.push(i)}}),n.COL_WIDTH=u),$.each(t.find("colgroup > col"),function(t,i){$.isEmpty(n.COL_WIDTH[t])==!1&&$(i).css("width",n.COL_WIDTH[t])}),$.isEmpty(n.TABLE_WIDTH)!=!1||this._isFixed||t.css("width",n.TABLE_WIDTH),this.template=$("<div><\/div>").append(t).html())},setItemList:function(n){var f,i,r,t,u;for(this.itemList.clear(),t=0;t<n.length;t++)for(r=r=$.isArray(n[t])?n[t]:[n[t]],u=0;u<r.length;u++)f=r[u],i=this.createControl(f),i&&(i.__id=f.id,i.__formId=this.id,this.pushItemList.call(this,i))},pushItemList:function(n){n&&(n.isHideCell&&n.render(this._dummy),this.itemList.push(n))},setGroupInfo:function(n){for(var i=null,n=$.isArray(n)?n:[n],r=n.length,t=0;t<r;t++)n[t].groupId?i==null||n[t].groupId!=i?i=n[t].groupId:n[t].isGroupMember=!0:i&&(i=null)},cloneRows:function(n){for(var r,i=[],t=0;t<n.length;t++)if($.isArray(n[t]))for(i[t]=[],r=0;r<n[t].length;r++)i[t].push(n[t][r]);else i[t]=n[t];return i},hasInvalidControl:function(){return this.invalidControlList&&this.invalidControlList.length>0},changeControlValidateState:function(n,t){var i,r;return n.control.pcid?(i=this.getControl(n.control.pcid),i&&(i=i.get(n.control.id),i.controlType.indexOf("widget.multiCode")<0&&i.controlType.indexOf("widget.date")<0&&i.controlType.indexOf("widget.multiDate")<0&&i.controlType.indexOf("widget.input.password")<0&&(i=null))):i=this.getControl(n.control.id),i&&(r={instance:i,cid:i.id},n.method=="control.showError"?(i.errorType=n.control.errorType,i.errorMessage=n.control.errorMessage,i.showError(null,i.errorMessage,null,!0),this._ON_SHOWERROR_CONTROL(r,t)):n.method=="control.hideError"&&(i.hideError(null,!0),this._ON_HIDEERROR_CONTROL(r,t))),i},getItemListByControlId:function(n){return this.itemList.first(function(t){return t.__id==n})},removeControls:function(){this.itemList&&($(this.itemList).each(function(n,t){t.destroy();t=null;delete t}),this.itemList.length=0)},getControlByName:function(n){return this.getControlByAttr("name",n)},getControl:function(n,t){return $.isEmpty(t)==!1?this.getControlByIndex(t):this.getControlByAttr("id",n)},getControlByIndex:function(n){return this.itemList[n]},getControlByFindex:function(n){return this.itemList.head(function(t){return t.findex==n})},getControlByAttr:function(n,t){for(var r,u,i=0;i<this.itemList.length;i++)if(r=this.itemList[i],t==r[n])return r;for(i--;i>-1;i--)if(r=this.itemList[i],r.controlType=="widget.custom"&&r.itemList&&(u=this.getControlByAttr.call(r,n,t),u))return u;return null},getCellSize:function(n){return $.isEmpty(n)?0:this._useDynamicColSize&&n.isMultiCell?+this.colSize:n.cellSize?n.cellSize>this.colSize?+this.colSize:+n.cellSize:n.isMultiCell?+this.colSize:1},validate:function(n,t){for(var f=[],r=null,i=null,u=0,e=this.itemList.length;u<e;u++)(i=this.itemList[u],t&&i.formset&&i.formset.width===0)||(r=i.validate.call(i),r.length>0&&f.push(r));return f},isActive:function(){return this.active},activate:function(){this.active=!0;this.$el.addClass("active")},deactivate:function(){this.active=!1;this.$el.removeClass("active")},reset:function(n){this.itemList.forEach(function(t){var i;n&&(i=n[t.id]);t.reset(i)})},redrawControl:function(n){this.itemList.forEach(function(t){t.reflowContainer&&t.reflowContainer();t.hasError()?n||t.showError():t.controlType=="widget.custom"&&t.showErrorOfItemList()})},serialize:function(){return ecount.widget.serialize(this.itemList)},serializeById:function(){return ecount.widget.serialize(this.itemList,!0)},save:function(n){var i=n?[]:{},r=n?function(t){i.push(n(t))}:function(n){i[n.key]=n.value},u=this.itemList,t=null;return $(u).each(function(n,i){t=i.save.call(i);t&&($.isArray(t)?$(t).each(function(n,t){t&&r(t)}):r(t))}),i},restore:function(n,t){var i,r;if(t)n.forEach(function(n){n=t(n);i=this.getControl(n.key);i&&i.restore(n.value)});else for(r in n)i=this.getControl(r),i&&i.restore(n[r])},extract:function(){return ecount.widget.extract(this.itemList)},toggleRow:function(n){var t=this.$el.find("#row-"+n);t&&(t.toggle(),ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("toggleRow",{type:"toggleRow"}))},showRow:function(n){var i=this.$el.find("tr#row-"+n),t;i&&i.show();this.find(function(t){return t.id==n}).length>0&&(t=this.find(function(t){return t.id==n})[0],t.controlType=="widget.textarea"&&t.hasFn&&t.show());ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("showRow",{type:"showRow"})},hideRow:function(n){var t=this.$el.find("tr#row-"+n);t&&t.hide();ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("hideRow",{type:"hideRow"})},showTd:function(n){var t=this.getControl(n),i=this.$el.find("tr#row-"+n),r=i&&i.find("td");r&&r.removeClass("hide");t&&t.reflowContainer&&t.reflowContainer()},hideTd:function(n){var t=this.$el.find("tr#row-"+n),i=t&&t.find("td");i&&i.addClass("hide")},showTdAll:function(){var n=this.$el.find("td");n&&n.removeClass("hide")},hideTdAll:function(){var n=this.$el.find("td");n&&n.addClass("hide")},showSubTitleLink:function(n){var t=this.$el.find("#btn-FormLink-"+n);t&&t.show()},hideSubTitleLink:function(n){var t=this.$el.find("#btn-FormLink-"+n);t&&t.hide()},addClassSubTitleLink:function(n,t){var i=this.$el.find("#btn-FormLink-"+n);i&&i.addClass(t)},removeClassSubTitleLink:function(n,t){var i=this.$el.find("#btn-FormLink-"+n);i&&i.removeClass(t)},setTitle:function(n,t,i,r){var u=i?this.$el.find("th#"+n):this.$el.find("tr#row-"+n).find("th"),f;u&&(r?u[0].childNodes[0].nodeValue=t:u.html(t),f=this.getControl(n),f&&(f.subTitle=t))},setStyle:function(n){var i=this.$el;for(var t in n)i.css(t,n[t])},changePopover:function(n,t){var i=this.$el.find("tr#row-"+n).find("span.user-help-mark");i&&i.length>0&&i[0].setAttribute("data-content",t.message)},showCell:function(n){this._enable(n,n);ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("showCell",{type:"showCell"})},hideCell:function(n){this._disable(n,n);ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("hideCell",{type:"hideCell"})},enable:function(n){this._enable(n,n)},disable:function(n){this._disable(n,n)},_enable:function(n,t){var r=this.$el.find("#"+n),i=this.getControl(t);i&&(r&&r.html(i.subTitle),i.enable())},_disable:function(n){var t=this.$el.find("#"+n),i=this.getControl(n);t&&t.html("");i&&i.disable()},_hasNoColGroup:function(){return["list","register"].contains(this.templateType)},_ON_DUAL_MODE_BUTTON_DISPLAY:function(n){var i=n.id||"",r=n.isShow,t;$.isEmpty(i)||(t=this.dropDownLists["list-"+i],r?t&&t.show():t&&t.hide())},ADJUSTCONTENTSDIMENSIONS:function(){this.delegator&&this.delegator.triggerEvent("page.adjustContentsDimensions")},transferEvent:function(n){this.delegator.triggerEvent(n.type,n)},_ON_CHANGE_CONTROL:function(n){if(n.__self._hideDateControl&&n.isChecked){var i=n.targetID,t=n.baseID;this.getControl(i)&&this.getControl(t)&&this.getControl(i).setDate([this.getControl(t).getDate()[0],this.getControl(t).getDate()[1]])}this.delegator&&(this.onSync&&this.delegator.triggerEvent("form.sync",n),this.delegator.triggerEvent("control.change",n))},_ON_TOGGLE_GROUP:function(n){var i=$(n.currentTarget),t=i.children("span"),u=i.data("show"),r=this.$el.find("[data-group='"+u+"']:not(:first)");return t.hasClass("fa-caret-up")?(t.removeClass("fa-caret-up").addClass("fa-caret-down"),r.addClass("hidden")):(t.addClass("fa-caret-up").removeClass("fa-caret-down"),r.removeClass("hidden")),this.delegator.triggerEvent("onToggleGroup",n),ecount.__isEventCaptureMode()?!1:void 0},_ON_CLICK_CONTROL:function(n){if(n.name=="SIMPLE_SEARCH"){var t=this.getOrignID(n.targetID),r=n.searchName||ecount.constValue.DEFAULT_SIMPLESEARCH_KEY,i=this.getControlByName(r);i&&(t=ecount.control.date.period[t].call(i,i.ecPageID),t&&i.setDate(t),n.targetID=["btn",this.containerName,"simpleSearch"].join("-"));this.delegator.triggerEvent("form.simpleSearch",n)}else this.delegator.triggerEvent(n.type,n)},_ON_CLICK_SUBTITLELINK:function(n){var t=$(n.target),i={targetID:t.attr("id"),event:n,__self:this};this.delegator&&this.delegator.triggerEvent("anchor.click",i)},_ON_POPUP:function(n){this.delegator&&this.delegator.triggerEvent("control.openPopup",n)},_ON_LAYER:function(n){this.delegator&&this.delegator.triggerEvent("control.openLayer",n)},_ON_FOCUSIN_CONTROL:function(n){n&&n.mode&&ecount.global.setTimeout(this.ecPageID,function(){var t=n.id,i=this.getIsDualClick(t);i==!1?(this._ON_DUAL_MODE_BUTTON_DISPLAY({id:t,isShow:!0}),this.setIsDualClick(t,!0)):(this._ON_DUAL_MODE_BUTTON_DISPLAY({id:t,isShow:!1}),this.setIsDualClick(t,!1))}.bind(this),100)},_ON_DUAL_MOUSEOVER:function(n){n&&n.mode&&(this.dropdownLayerLists["dropdown-"+n.id]._dropdownLayerTimer=ecount.global.setTimeout(this.ecPageID,function(){this._ON_DUAL_MODE_BUTTON_DISPLAY({id:n.id,isShow:!0,type:"mouseover"})}.bind(this),n.time||100))},_ON_DUAL_MOUSEOUT:function(n){if(n&&n.mode){var t=this.dropdownLayerLists["dropdown-"+n.id]._onDualClick;t||(this._ON_DUAL_MODE_BUTTON_DISPLAY({id:n.id,isShow:!1}),ecount.global.clearTimeoutByTimerNo(this.ecPageID,this.dropdownLayerLists["dropdown-"+n.id]._mouseHoverTimer))}},getIsDualClick:function(n){return this.dropdownLayerLists["dropdown-"+n]._onDualClick||!1},setIsDualClick:function(n,t){return this.dropdownLayerLists["dropdown-"+n]._onDualClick=t},_ON_MOVE_FOCUS:function(n){var c=n.cid,a=ecount.widget.isVisible,s=0,i,u,l=!1,f,e,t,h,o,r;if(this._isFocusIndexType){for(t=0;t<this.itemList.length;t++){if(this.itemList[t].id==c){f=t;continue}if(!$.isEmpty(f)&&this.itemList[f].findex==this.itemList[t].findex)return this.itemList[f].onFocusOut(),r=null,this.itemList[t].needValidate&&(r={readonly:!0}),this.itemList[t].setFocus(0,r),!1}for(t=0;t<this.itemList.length;t++)this.itemList[f].findex<this.itemList[t].findex&&this.itemList[t].findex!="0"&&($.isNull(e)||this.itemList[e].findex>this.itemList[t].findex)&&(e=t);if(!$.isNull(e))return this.itemList[f].onFocusOut(),r=null,this.itemList[e].needValidate&&(r={readonly:!0}),this.itemList[e].setFocus(0,r),!1}else for(t=0,h=this.itemList.length;t<h;t++){if(u=null,this.itemList[t].id==c){if(t==h-1){this.itemList[s].onFocusOut();break}if(i=this.itemList[t+1],i.preventOnFocusAtLastIndex){t==h-2&&this.itemList[s].onFocusOut();continue}if(u=i.$el||i.ecview&&i.ecview.$el,u)for(o=0;conLen=u.length,o<conLen;o++)if(u[o].nodeType!=3&&(l=a(u[o]),l))break;if(!l||i._readOnly||i.isHideCell)s--,c=i.id;else return this.itemList[s].onFocusOut(),r=null,i.needValidate&&(r={readonly:!0}),i.setFocus(o,r),!1}s++}this.delegator.triggerEvent("form.focusout",{__self:this,type:"form.focusout",target:this.containerName,tabId:this.tabId,control:n})},_ON_SHOWERROR_CONTROL:function(n,t){var i=!1;for(k=0,len=this.invalidControlList.length;k<len;k++)if(n.cid==this.invalidControlList[k].cid){i=!0;break}i||(this.invalidControlList.push(n),!t&&this.delegator&&this.delegator.triggerEvent("control.changeValidate",{__self:this,control:n.instance,method:"control.showError",containerName:this.containerName,tabId:this.tabId,invalidControlList:this.invalidControlList}))},_ON_HIDEERROR_CONTROL:function(n,t){for(k=0,len=this.invalidControlList.length;k<len;k++)if(n.cid==this.invalidControlList[k].cid){this.invalidControlList.splice(k,1);!t&&this.delegator&&this.delegator.triggerEvent("control.changeValidate",{__self:this,control:n.instance,method:"control.hideError",containerName:this.containerName,tabId:this.tabId,invalidControlList:this.invalidControlList});break}},_ON_DUAL_MODE:function(n,t){var r=this.getControl(t.id),i,u={sync:!0,dualStep:n.dualstep,dropdownClick:!0};r._ON_DUAL&&(r._ON_DUAL(u),ecount.global.setTimeout(this.ecPageID,function(){i=this.getControl(n.dualcontrolid);i&&i.setFocus(0)}.bind(this),180))},getOrignID:function(n){return this.id=="all"?n:n.replace("_"+this.id,"")},resetControlErrorStatus:function(){this.invalidControlList.length=0},setInsertBefore:function(n,t,i){var u,c={isAddRow:!1},r=$("<th><\/th><td><\/td>"),e=!1,s,o,f,h,l;return t>=this.itemList.length?u=this.itemList[this.itemList.length-1].id:t==0?(u="",e=!0):u=this.itemList[t-1].id,u!=""&&(f=this.$el.find("th."+u),f.length==0&&(f=this.$el.find("th#"+u)),f.parent().find("th").length==1&&(e=!0),e||f.parent().find("th")[1]==f&&(e=!0)),n.isMultiCell&&(h=f.parent().find("td"),l=this.colSize*2-1,r=h.length==1&&$.isEmpty(h.attr("colspan"))?$("<th><\/th><td><\/td>"):$("<th><\/th><td colspan='"+l+"'><\/td>")),e&&(r=n.isMultiCell?$("<tr><\/tr>").append(r):$("<tr><th><\/th><td><\/td>"+this._emptyDummyCellStr+"<\/td><\/tr>")),s=this.getControlGeneratingOptions({controlType:n.controlType,id:n.id,name:n.propertyName,subTitle:n.title,groupId:null,FormSetButton:n.FormSetButton,data:[{label:$.isNull(n.label)?"":n.label,value:$.isNull(n.value)?"":n.value}],isFormSetButton:n.isFormSetButton},i),this.controls.splice(t,0,s),o=this.getGeneratedControl(s),e?($(r.find("th")[0]).html(n.title),o.render($(r.find("td")[0])),$(r.find("th")[0]).attr("id",n.id),$(r.find("td")[0]).attr("id",n.id),u==""?this.$el.find("tr:first").before(r):this.$el.find("th#"+u).parent().after(r),c.isAddRow=!0):($(r[0]).html(n.title),o.render($(r[1])),$(r[0]).attr("id",n.id),$(r[1]).attr("id",n.id),this.$el.find("th#"+u).next().after(r)),this.itemList.splice(t,0,o),c},setItemDelete:function(n,t){for(var u,r,i=0;i<this.itemList.length;i++)if(u=this.itemList[i],u.id==n){r=this.itemList.splice(i,1)[0];this.controls[i].isHideCell=!0;$target=this.$el.find("th#"+r.id).next();$target.prev().remove();$target.attr("colspan")==t/2-1&&$target.parent().remove();$target.remove();break}},hideRowGroup:function(n,t,i,r){var c=this.$el.find("tr#row-"+t),e=this.$el.find("tr[data-group='"+n+"'][id !='row-"+t+"']"),o,l,a,u,s,f,h;if(c&&c.hide(),e.length==1&&(o=e.find("a"),l="<div>"+o.text()+"<\/div>",o.hide(),e.find("th").append(l)),i)for(a=this.itemList.length,s=!1,f=0;f<a;f++)if(h=this.itemList[f],u=h.groupId||"",!$.isEmpty(u)){if(s&&u!=n)break;u==n&&(h.reset(),s=!0)}this._ON_CHANGE_SHOWGROUP(n,t,i,!1,r!==!1)},showRowGroup:function(n,t,i,r){var f=this.$el.find("tr#row-"+t),e=this.$el.find("tr[data-group='"+n+"']").first(),u=e.find("a");f&&f.show();u.length>0&&(u.show(),u.next().remove());this._ON_CHANGE_SHOWGROUP(n,t,null,!0,r!==!1)},showGroupRow:function(n){var t=this.$el.find("#row-"+n+" th a");t.find("span.fa-caret-down").length>0&&t.click();ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("showGroupRow",{type:"showGroupRow"})},hideGroupRow:function(n){var t=this.$el.find("#row-"+n+" th a");t.find("span.fa-caret-up").length>0&&t.click();ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("hideGroupRow",{type:"hideGroupRow"})},getColSize:function(){return this.colSize},setColSize:function(n){this.colSize=n;this.reDraw()},_ON_CHANGE_SHOWGROUP:function(n,t,i,r,u){if(u&&this.delegator){var f={syncHandler:r?this.showRowGroup:this.hideRowGroup,args:[n,t,i,!1],__self:this};this.delegator.triggerEvent("form.change",f)}},ON_MOUSEOVER:function(n){n.ecService=="formSet"&&this.getControl(n.ecListid)&&this.getControl(n.ecListid).showFormsetLayer()},ON_MOUSEOUT:function(n){n.ecService=="formSet"&&this.getControl(n.ecListid)&&this.getControl(n.ecListid).hideFormsetLayer()}},create:function(){var n=$.extend({},this.prop);ecount.layout.form.base=$.Class(ecount.layout,n)}}};ecount.layout.form.custom||(ecount.layout.form.custom={});ecount.layout.form.custom._export=function(){return{prop:{active:!1,onSync:!1,isOnlyBodySearch:!1,init:function(){ecount.layout.form.general.prototype.init.apply(this,arguments)},render:function(){ecount.layout.form.general.prototype.render.apply(this,arguments)},_renderFormContents:function(){function n(){for(var r,e,i,u,f,n=0;n<this.items.length;n++)if(i=this.getItemListByControlId.call(this,this.items[n].id),i){if(this.items[n].position?(r=this.items[n].callback&&this.items[n].callback(this.$el,this.items[n].position),u=r[0],f=r[1]):this.isOnlyBodySearch?(u=this.$el.find("tbody > tr > th").eq(n),f=this.$el.find("tbody > tr > td").eq(n)):(u=this.$el.find("th").eq(n),f=this.$el.find("td").eq(n)),u.length>0&&($.isNull(i.subTitle)==!1&&u.text(i.subTitle),e=i._popover,e)){var t=u.parent(),o="span-user-help-mark-"+t.attr("id").split("-")[t.attr("id").split("-").length-1],r=$('<span class="user-help-mark" id="'+o+'" data-content="'+e.message+'" data-placement="right" data-trigger="focus hover click" data-toggle="popover" data-html="true"/>'),s=[{target:r,isShow:!1},{target:t,isShow:!1}];u.after(" ").append(r);r.popover({content:e.message||"error",container:i.eventContainer||"body",delay:{show:this.mouseHoverInTime,hide:0},popoverCallBack:this.togglePopover.bind(this,s)});t.on("mouseenter",this.togglePopover.bind(this,{target:t,isShow:!0}));t.on("mouseleave",this.togglePopover.bind(this,{target:t,isShow:!1}));r.on("mouseenter",this.togglePopover.bind(this,{target:t,isShow:!0}));r.on("mouseleave",this.togglePopover.bind(this,{target:t,isShow:!1}));delete i._popover}f.length>0&&i.render(f)}}this.items&&(this.items=$.isArray(this.items)?this.items:[this.items],n.call(this),this.ecTransaction.complete(this.onLoadComplete.bind(this)),this.ecTransaction.start())},showRow:function(n){var i=this.$el.find("tr#row-"+n),t;i&&i.show();this.find(function(t){return t.id==n}).length>0&&(t=this.find(function(t){return t.id==n})[0],t.controlType=="widget.textarea"&&t.hasFn&&t.show());ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("showRow",{type:"showRow"})},hideRow:function(n){var t=this.$el.find("tr#row-"+n);t&&t.hide();ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("hideRow",{type:"hideRow"})}},create:function(){var n=$.extend({},this.prop);ecount.layout.form.custom=$.Class(ecount.layout.form.general,n)}}};ecount.layout.form.general||(ecount.layout.form.general={});ecount.layout.form.general._export=function(){return{prop:{GROUP_TOGGLE_CLASS:"hide",template:"<ul class='wrapper-form {{css}}' data-formid={{formId}} data-ecpath={{ecpath}}><\/ul>",dualCaretTemplate:"<div class='dual-caret'>G<\/div> ",active:!1,onSync:!1,groupData:{},dualModeData:{},dualModeKey:{},showLayerFocusInOnDualMode:!1,subLinkData:[],titleStyle:"",$searchFormItemCodeDivider:null,init:function(){ecount.layout.prototype.init.apply(this,arguments);this._initializeData();this._initializeForm();this._initializeItemList();this.setEcIKey()},_initializeData:function(){this.groupData={};this.dualModeData={};this.dualModeKey={};this.dropdownKeyList=[];this._hideRowList=this._hideRowList||[];this.colSize=this.colSize||1;this._isUseCollapsed=!1;this._isAllCollapsed=!0;this.collapsedData={};this.useCollapsed=!1},_initializeForm:function(){this.itemList=[];this.mouseHoverInTime=ecount.common.mouseHoverInTime;this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this._initFormDelegator();this.invalidControlList=[]},_initFormDelegator:function(){this.events=new ecount.events(this);this.events.on({"control.change":this._ON_CHANGE_CONTROL,"control.openPopup":this.transferEvent,"control.focusout":this._ON_MOVE_FOCUS,"control.showError":this._ON_SHOWERROR_CONTROL,"control.hideError":this._ON_HIDEERROR_CONTROL,"control.focusin":this._ON_FOCUSIN_CONTROL,"dateControl.display":this._ON_DISPLAY_DATECONTROL,"dualMode.buttonDisplay":this._ON_DUAL_MODE_BUTTON_DISPLAY,"dualMode.dropdownDisplay":this._ON_DUAL_MODE_DROPDOWN_DISPLAY,"dualMode.changeDualMode":this.changeDualMode,"dualMode.changeSubTitle":this._changeSubTitleByDualStep,"form.changeSubTitle":this._changeSubTitle,"form.sync":this.onSyncHandler,"page.adjustHeaderSearchDimensions":this.transferEvent,"page.adjustContentsDimensions":this.transferEvent,"page.showProgressbar":this.transferEvent,"page.hideProgressbar":this.transferEvent,"page.toggleProgressbarLayer":this.transferEvent,"control.openLayer":this.transferEvent,scope:this})},_initializeItemList:function(){this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this._initItemListFormData();this._initItems()},_initItemListFormData:function(){var n,i,t,r=$.isEmpty(this.controls)?this.convertRowsToItems(this.rows):this.controls,u;this.fOptions&&this.fOptions.formType?(n=ecount.layout.getFormData(this.fOptions.formType,this.inIncludePage,this.ecPageID,this.fromTypeTabCd),n.colType?this.colSize=n.colType:n.colType=this.colSize,t=n.option):(n={colType:this.colSize},this.formInfos&&(this.formInfos.formType?(i=ecount.layout.getFormData(this.formInfos.formType,this.inIncludePage,this.ecPageID,this.fromTypeTabCd),t=this.formInfos.formType=="Search"?i:i&&i.option):t=_.get(this.formInfos,"formInfoObject")));t&&this.hasMultiColConfig(t)&&!_.isEmpty(_.get(ecount,"config.companyForm.MULTICOL_SETTINGS"))&&(u=ecount.global.getPublicInfo(this.ecPageID,"xFormMultiColSettings")||{},u[this.id]=this.getMultiColSetting(this.colSize,t),ecount.global.setPublicInfo(this.ecPageID,"xFormMultiColSettings",u));r=this.getFormTypeControl(n);ecount.global.executeCallback(this.ecPageID,ecount.widget.FORM_LOAD_COMPLETE,n);this.items=r;this.__oldItems=this.convertItemsToRows(r)},hasMultiColConfig:function(n){return!!_.get(n,"itemNmWdth",!1)},getMultiColSetting:function(n,t){var i=_.cloneDeep(ecount.config.companyForm.MULTICOL_SETTINGS);return i[n-1]=_.merge({},i[n-1],{FILL_CHK_YN:t.isInpClmnAutoCalc,FILL_NUMBER_CHK_YN:t.isNumClmnAutoCalc,INPUT_NUMBER_WIDTH:t.numClmnWdth,INPUT_WIDTH:t.inpClmnWdth,LABEL_WIDTH:t.itemNmWdth}),i},getFormTypeControl:function(n){return n.columns?ecount.layout.tabContents.prototype.setFormControls.apply(this,[n.columns,n.option,this]):n.items&&this._setFormControlsFromFormData(n.items),$.isEmpty(this.controls)?this.convertRowsToItems(this.rows):this.controls},setColSize:function(n){var t={colType:n};this.colSize=n;this.$el.get(0).className=this.$el.get(0).className.replace(/(wrapper-form-state-)\d+/,"$1"+n);this.multiColOption&&(t.multiColOption=this.multiColOption);ecount.global.executeCallback(this.ecPageID,ecount.widget.FORM_LOAD_COMPLETE,t)},_setFormControlsFromFormData:function(n){var u=n[0].subItems,i,r,f,t;if(u){for(this.rows||(this.rows=[]),i=[],r=0,f=u.length;r<f;r++)(t=u[r],this.filter&&this.filter(t)===!1)||(i.push(t),t.id=="txtCustGroup1"?(i.push($.extend({},t,{id:"txtCustGroup2",name:"CUST_GROUP2",subTitle:t.subTitle+"2"})),t.name=t.name+"1",t.subTitle=t.subTitle+"1"):t.id=="txtClassCd"&&(i.push($.extend({},t,{id:"txtClassCd2",name:"PROD_CLASS_CD2",subTitle:t.subTitle+"2"})),i.push($.extend({},t,{id:"txtClassCd3",name:"PROD_CLASS_CD3",subTitle:t.subTitle+"3"})),t.subTitle=t.subTitle+"1",t.name=t.name+"1"));this.rows=i.concat(this.rows)}},_initItems:function(){for(var n,f,t,e,o,u,s,i,r=0;r<(this.items||[]).length;r++)if((n=this.items[r],n.controlType!="widget.empty")&&(this.initializer&&ecount.control.initializeByUserSetting(this.initializer,n),n.activeInlineMode&&this._initInlineModeData(n),n.dualMode&&n.dualModeMaster&&(u=ecount.constValue.dualInfoSet[n.controlType],s=n.dualControls,s?t=this._initDualModeDataByCustomDualControls(n,s):u&&(this._initDualModeDataByControlType(n,u),t=this._initDualModeData(n,u)),t)))if(this._setDualModeKey(n.id,n.id),e=t.dualControlInfo,e)for(o=t[n.dualPageType],i=1;!t.isInlineMode&&i<e.length;i++)(!o||o.contains(i))&&(f=r+i,this.items.splice(f,0,this.addDualControl(n,i)),this._setDualModeKey(this.items[f].id,n.id));else t.isInlineMode&&this._setDualModeKey(n.id,n.id)},_initInlineModeData:function(n){var i=n.extractData&&n.extractData.__state?n.extractData.__state["inlineMode.activeInlineMode"]:n.activeInlineMode,r=n.inlineModeList,t;t=(r||[]).find(function(n){return n.mode==i});n.subTitle=t?t.layerLabel:n.subTitle},_initDualModeDataByControlType:function(n,t){if(n.controlType=="widget.multiCode.person"){var f=$.isNull(n.isSharing)?!0:n.isSharing,e=$.isNull(n.isCS)?!0:n.isCS,r=Object.clone(t.dualStepButtonInfo,!0),u=Object.clone(t.dualControlInfo,!0),i;f==!1&&(i=r.findIndex(function(n){return n.id=="sharing"}),r.splice(i,1),u.splice(i,1));e==!1&&(i=r.findIndex(function(n){return n.id=="cs"}),r.splice(i,1),u.splice(i,1));n.dualStepButtonInfo=r;n.dualControlInfo=u}},_initDualModeData:function(n,t){var i,r,u;return i=_.merge(Object.clone(t,!0),{controlType:n.controlType,dualModeKey:$.isNull(n.dualPageType)?n.dualModeKey:n.dualPageType,dualStep:n.dualStep}),n.dualStepButtonInfo&&(i.dualStepButtonInfo=n.dualStepButtonInfo),n.dualControlInfo&&(i.dualControlInfo=n.dualControlInfo),i.dualStepButtonInfo&&_.isEmpty(i.dualStepButtonInfo[0].label)&&(i.dualStepButtonInfo[0].label=n.subTitle),i.isInlineMode&&(u=n.dualPageType||n.dualStep,u=="S"||u==0?r=i.dualStepButtonInfo[0].label:(u=="M"||u==1)&&(r=i.dualStepButtonInfo[1].label),r=ecount.resource[r]||r,n.subTitle=r||n.subTitle),this.dualModeData[n.id]=i,i},_initDualModeDataByCustomDualControls:function(n,t){for(var o=t.length,u={},e=[{controlType:n.controlType,id:"",dualStepItem:0,hasDualIconIndividual:!1,hideIndividual:!0}],f=[{id:n.id+"0",label:n.subTitle,dualStep:0}],i,r=0;r<o;r++)i=t[r],dualIndex=r+1,e.push({controlType:i.controlType,subTitle:i.subTitle,id:"_"+i.id,name:"_"+i.name,dualStepItem:dualIndex,hasDualIconIndividual:r==0,isCustomDualControl:i.isCustomDualControl,isCustomDualAddedControl:i.isCustomDualAddedControl}),f.push({id:n.id+dualIndex,label:i.dualLabel,dualStep:dualIndex});return n.useIndividual&&f.push({id:"INDIVISUAL",label:"LBL10694",dualStep:dualIndex+1}),u.dualControlInfo=e,u.dualStepButtonInfo=f,this.dualModeData[n.id]=u,u},_setDualModeKey:function(n,t){this.dualModeKey[n]=t},addDualControl:function(n,t){for(var s=this.dualModeData[n.id],u=s.dualControlInfo[t],r=Object.clone(n),e=["controlType","groupId","removeDualIcon","hasDualIcon","serializeDualStep"],o=["id","name"],i,f=0;f<e.length;f++)i=e[f],r[i]=$.isEmpty(u[i])&&!_.isNull(u[i])?n[i]:u[i];for(f=0;f<o.length;f++)i=o[f],r[i]=n[i]+u[i];return _.merge(r,{dualModeMaster:!1}),r.subTitle=ecount.resource[u.subTitle]||u.subTitle,r.hidden=!0,r.isCustomDualControl=u.isCustomDualControl,r.isCustomDualAddedControl=u.isCustomDualAddedControl,delete r.extractData,r},render:function(n){this._defineItemList();this._renderForm();this._renderFormContents();this.$el[0].ecIKey=this.getEcIKey();this._appendForm(n);this.hidden&&this.$el.hide();this._setItemFold();this.ecTransaction.complete(this.onLoadComplete.bind(this));this.ecTransaction.start()},_defineItemList:function(){var t,n;for(this.itemList.clear(),n=0;n<this.items.length;n++)(t=this.items[n],ecount.layout.form.resetSubTitle(t))&&this._defineItem(t)},_defineItem:function(n){var t;if(n.controlType=="widget.empty")return null;this._addOptionsToControl(n);t=this._createControl(n);this._pushItemList(t)},_addOptionsToControl:function(n){var t=ecount.constValue.dualInfoSet[n.controlType]&&ecount.constValue.dualInfoSet[n.controlType].isInlineMode;ecount.widget.createDisplayID(n,"btn",this.containerName);n.containerName=this.containerName;this._executeValidateIfVisible&&(n._executeValidateIfVisible=this._executeValidateIfVisible);n.colEssentialYn=="Y"&&n.controlType.indexOf("widget.combine")==-1&&(n.dataRules=["required"]);n.groupId&&this._insertGroupMember(n.groupId,n.id);n.pId=this.tabId;n.panelID=this.panelID;n.gridID="";n.tabID=this.tabId;n.onSync=this.onSync;n._isRowSpan=this.colSize==2;n.colSize=this.colSize;n._isErrorBorderNone=this._isErrorBorderNone;n.__pnode=this.__type;n.__type=widget.generator.CONTROL;n.ecTransaction=this.ecTransaction;n.__HEADLESS=this.__HEADLESS;n.dualMode!=!0&&$.isNull(n.dualStep)||(n.OBSERVE_CHANGE_STATE=this._observeControlState.bind(this),n.dualStep=(t&&!n.isCustomDualAddedControl?n.dualPageType:n.dualStep)||0)},_insertGroupMember:function(n,t){var i=this.groupData[n];i?i.member.push(t):this.groupData[n]={master:t,member:[],isHide:!0}},_createControl:function(n){var t=ecount.common.createNamespace(n.controlType);return t=new t(n),t.delegator=this.events,t.__id=n.id,t.__formId=this.id,t.titleLink=n.titleLink,t.titleLinkID=n.titleLinkID,t.subLinkID=n.subLinkID,t.subTitleLink=n.subTitleLink,t.subLinkDropdown=n.subLinkDropdown,t},_pushItemList:function(n){n&&this.itemList.push(n)},_renderForm:function(){var n={formId:this.id,ecpath:this.ecPath,css:(this.css||"")+(this._useChangeSelectedForm||this._useChangeItemForm?" change-selected-item":"")+(" wrapper-form-state-"+this._currentColumnCount())};this.$el=$(ecount.widget.replaceAttr(this.template,n));this.hiddden&&this.$el.hide()},_renderFormContents:function(n){var t,u,r="",s=!1,c=this._rowspan&&this._rowspan[0],f,i,e,o,h;for(n=n||0,this.useCollapsed=this.items.some(function(n){return n.isItemFold===!0}),this.isUseCollapsed(this.useCollapsed),i=n;i<this.itemList.length;i++)t=this.itemList[i],u=this._renderFormItem(i,t,i==0&&c),this._bindPopoverElement(t,u),t.searchItemCode=="M"&&(r!==!1&&(this.useCollapsed&&(this.$searchFormCollapsed=this._getFormCollapsedTemplate(),this.$el.append(this.$searchFormCollapsed)),this.$searchFormItemCodeDivider=this._getFormDividerTemplate(ecount.resource.LBL03070,"template"),this.$el.append(this.$searchFormItemCodeDivider),r=!1),t.isVisible()&&!t._hideRow&&(s=!0)),f&&t.formGroupId&&t.formGroupId!==f&&(e=this._getFormDividerTemplate(t.formGroupName,t.formGroupId),e.addClass("hidden"),this.$el.append(e)),t.formGroupId!==undefined&&(f=t.formGroupId),t.formGroupId&&t.isVisible()&&!t._hideRow&&(o=this._getFormDivider(t.formGroupId),o&&o.removeClass("hidden")),this.$el.append(u),t._hideRow&&this.hideRow(t.id);this.pageType=="input"&&this.useCollapsed&&this._useNewItemFold&&(this._initCollapsedData(),this.$searchFormCollapsed=this._getFormCollapsedTemplate(),this.$el.append(this.$searchFormCollapsed));r===!1&&s===!1&&this.$searchFormItemCodeDivider.hide();this.pageType!="input"&&r!==!1&&this.useCollapsed&&(h=this.$el.find('li[data-listid="collapsed"]'),h.length<=0&&(this.$searchFormCollapsed=this._getFormCollapsedTemplate(),this.$el.append(this.$searchFormCollapsed)))},_getFormDivider:function(n){return this.$el.find('li[data-form-group-id="'+n+'"]')},_getFormCollapsedTemplate:function(){return $('<li data-listid="collapsed" class="whole-row wrapper-form-view-hidden-item"><div class="view-hidden-item collapsed" data-service="layer.checkboxitem" data-service-attr="layer.fixed"><div><\/div><\/div><\/li>')},_getFormDividerTemplate:function(n,t){return $('<li class="wrapper-form-divider" data-form-group-id="'+t+'"><div class="title">'+n+"<\/div><\/li>")},_bindPopoverElement:function(n,t){var r=this._isUsePopover(n),u=t.find("[data-function=popover]"),i;r&&(i=this._getPopoverOptions(n),ecount.popover.create(u,i))},_getPopoverOptions:function(n){var i=this.getControlDataById(n.id),t=i._popover,r=n.popupType=="layer"?$("div[data-ecpageid="+this.ecPageID+"]").closest("div.ui-dialog"):"body";return popoverOptions={type:"popover",trigger:"hover click",container:r,html:!0,animation:!1,followMouse:!0,placement:t.placement,content:(t.message||"").cr2br(),delay:{show:ecount.common.mouseHoverInTime,hide:ecount.common.mouseHoverOutTime}}},_renderFormItem:function(n,t,i){var r=this._renderControlContainer(n,t,i);return t.render(r.find(".form")),r},_renderControlContainer:function(n,t,i){var u=this._setContainerClass(n,t),f=!!(t.inlineModeList&&t.inlineModeList.length>0),r=t.hideCellTitle?"":this._renderContainerTitle(r,t),e={listid:t.id,title:r||"",classAttr:[f?"form-has-control-selector ":"",u||""].join(""),dataCelltype:i?' data-celltype="rowspan"':"",style:t.parentStyle?t.parentStyle:""};return $(ecount.widget.replaceAttr('<li data-listid="{{listid}}"{{dataCelltype}} class="{{classAttr}}" {{style}}>{{title}}<div class="form"><\/div><\/li>',e))},_setContainerClass:function(n,t){var i=[],r=t.groupId&&this.isGroupMaster(t),u=t.groupId&&!this.isGroupMaster(t),f=!$.isNull(t.dualStep)&&t.dualModeMaster!==!0,e=t.__state?t.__state["style.display"]:!0;return(t.isMultiCell||t.isWholeRow)&&i.push("whole-row"),(t.isHideCell||this._hideRowList.contains(n)||f||!e)&&i.push("hidden"),r&&i.push("form-collapse collapsed"),u&&(t.controlType=="widget.multiCode.siteGroup"?i.push(this.GROUP_TOGGLE_CLASS):i.push("hidden")),i.join(" ")},_renderContainerTitle:function(n,t){function f(n){var u,r,t,i;if(!_.isPlainObject(n))return"";for(u=[],r=Object.keys(n),t=0;t<r.length;t++)i=n[r[t]],i&&u.push(r[t]+":"+i+(i.substr(i.length-1,1)===";"?"":";"));return'style="'+u.join(" ")+'"'}var r;if(this._styleType&&this._styleType._isToolbarType==!0||this._options.hideCellTitle)return"";var u=t.groupId&&this.isGroupMaster(t),i=t.subTitle||"";return t.titleLink&&(i=['<a href="javascript:;" data-function="formTitleLink" id="btn-TitleFormLink-',t.titleLinkID,'">',i,"<\/a>"].join("")),t.subTitleLink&&(_.isArray(t.subLinkDropdown)&&t.subLinkDropdown.length>0?(this.subLinkData.push({ownerCid:t.id,cid:"btn-FormLink-"+t.subLinkID,dropdownOptions:t.subLinkDropdown}),i=[i,'<div class="pull-right"><a href="javascript:;" data-function="formSubTitleLink" id="btn-FormLink-',t.subLinkID,'" data-service="layer.dropdown" data-service-attr="layer.fixed" owner-cid="'+t.id+'">',t.subTitleLink,"<\/a><\/div>"].join("")):i=[i,'<div class="pull-right"><a href="javascript:;" data-function="formSubTitleLink" id="btn-FormLink-',t.subLinkID,'">',t.subTitleLink,"<\/a><\/div>"].join("")),r={listid:t.id,title:i,option:this._renderTitleOption(t),eventAttr:"",titleStyle:f(this.titleStyle)},u&&(r.eventAttr=this._makeEventAttrs(t,"group"),r.command="group"),ecount.widget.replaceAttr('<div class="title" data-listid="{{listid}}" {{eventAttr}} {{titleStyle}}>{{title}}{{option}}<\/div>',r)},_makeEventAttrs:function(n,t){var i={ecpath:this.ecPath,functionId:t};return ecount.widget.replaceAttr('data-ecpath="{{ecpath}}" data-function="{{functionId}}"',i)},_renderTitleOption:function(n){var i=this._isUseDualIcon(n),r=this._isUsePopover(n);if(!i&&!r)return"";var u,t='<div class="title-option">{{option}}<\/div>',f=(i?'<div class="form-option" data-listid="{{listid}}" data-ecpath="{{ecpath}}" data-function="dual" data-service="layer.dropdown"><\/div>':"")+(r?'<span class="user-help-mark" data-listid="{{listid}}" data-ecpath="{{ecpath}}" data-function="popover"><\/span>':"");return t=t.replace("{{option}}",f),u={listid:n.id,ecpath:this.ecPath},ecount.widget.replaceAttr(t,u)},_isUseDualIcon:function(n){var t=this.getControlDataById(n.id);return!$.isNull(n.dualStep)&&t.removeDualIcon!==!1&&t.hasDualIcon!==!1&&n.dualMode!==!1},_isUsePopover:function(n){var t=this.getControlDataById(n.id);return!$.isNull(t._popover)},_appendForm:function(n){this.attachView(n)},_setItemFold:function(){this._useNewItemFold||this.pageType!="input"&&this.items.forEach(function(n){n.isItemFold===!0&&this.hideRow(n.id)}.bind(this))},attachView:function(n){var n=n||this._$parent;n.append(this.$el);this._onMountForm()},_onMountForm:function(){},onLoadComplete:function(){var n={target:this.containerName,type:this.__type,__self:this};this.__HEADLESS||this.redrawControl();this.showFormLayer&&this.setShowFormLayer();this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},setShowFormLayer:function(){var n=this.$el.closest(".wrapper-header-search");n.length>0?n.show():this.$el.parent().show()},setDividerDisplay:function(n){var t=this.$el.find("li.wrapper-form-divider");t.length>0&&t[n?"show":"hide"]()},setInsertBefore:function(n,t,i){var e,u,f,o=t>=this.itemList.length?this.itemList.length-1:t,s=this.itemList[o],h=this.$el.find('li[data-listid="'+s.id+'"]'),r={id:n.id,groupId:null,subTitle:n.title,name:n.propertyName,controlType:n.controlType,FormSetButton:n.FormSetButton,data:[{label:n.label}]};r=$.extend(r,i);e=ecount.common.createNamespace(r.controlType);u=new e(r);f=this._renderControlContainer(u);u.render(f.find(".form"));h.after(f)},convertRowsToItems:function(n){var i,u,r,f,t;if($.isEmpty(n))return n;for(u=[],r=0;r<n.length;r++){if(i=$.isArray(n[r])?n[r]:[n[r]],i.length==this.colSize){for(t=0;t<i.length;t++)i[t].cellSize=1,u.push(i[t]);continue}for(f=0,t=0;t<i.length;t++)i[t].cellSize=this.getCellSize(i[t]),f=parseInt(f)+parseInt(i[t].cellSize),u.push(i[t]);if(f<this.colSize)for(t=f;t<this.colSize;t++)u.push({controlType:"widget.empty"})}return u},convertItemsToRows:function(n,t){function p(i){for(var r=i+1;r<n.length;r++)if(t.call(this,n[r]))return n[r]}function a(n){var n=$.isArray(n)?n:[n],t=n.length,f=n.count(function(n){return n.controlType=="widget.empty"});t!=f&&o.push(Object.clone(n));n.clear();i=0;u._rowspan&&u._styleType&&u._styleType._isToolbarType==!0&&(u._rowspan[o.length-1]?(r=u.colSize,c=o.length-1):c+u._rowspan[c]==o.length&&(r=r+1))}function y(n,t){for(var i=0;i<t;i++)n.push({controlType:"widget.empty"})}var s,l;if($.isEmpty(n))return null;$.isFunction(t)||(t=function(n){return n.isHideCell!=!0});var u=this,o=[],f,h,e=[],i=0,v=0,c,r=this._styleType&&this._styleType._isToolbarType==!0?this.colSize+1:this.colSize;for(s=0,l=n.length;s<n.length;s++,l--){if(f=n[s],h=p.call(this,s),f.cellSize=this.getCellSize(f),i=parseInt(i)+parseInt(f.cellSize),v=l==1?0:this.getCellSize(h),i<=r&&e.push(f),i==r||f.hideCellTitle){a(e);continue}if(i+v>r){y(e,r-i);a(e);continue}if($.isEmpty(h)){y(e,r-i);a(e);continue}}return o},getCellSize:function(n){return $.isEmpty(n)?0:n.cellSize?n.cellSize>this.colSize?this.colSize:n.cellSize:n.isMultiCell?this.colSize:1},redrawControl:function(n){var t=this.__HEADLESS&&!n;t&&(this.__HEADLESS=!1);this.itemList.forEach(function(i){if(t&&i.attachView(),i.reflowContainer&&i.reflowContainer(),i.isCombinedControl()){if(i.hasError(i._IT_SELF)&&!n&&i.showError({useDefaultOptions:!0}),i.hasError()&&!n)for(var r,u=0,f=(i.controlList||[]).length;u<f;u++)r=i.controlList[u],r.reflowContainer&&r.reflowContainer(),r.hasError()&&!n&&r.showError({useDefaultOptions:!0,forceUpdateView:!0})}else i.hasError()&&!n&&i.showError({useDefaultOptions:!0,forceUpdateView:!0})});this.setWrapperFormState()},getControlByIndex:function(n){return this.itemList[n]},getControlByFindex:function(n){return this.itemList.head(function(t){return t.findex==n})},getDualInfo:function(n){var i=this.dualModeKey[n],t=this.getControl(i);return t?this.dualModeData[t.id]:!1},destroy:function(){ecount.layout.prototype.destroy.call(this)},isGroupMaster:function(n){var i=n.groupId,r=n.id,t=this.groupData[i];return t&&t.master==r?!0:!1},_ON_DUAL_CLICK:function(n,t){var i={cid:t.target.getAttribute("data-listid"),onClicked:!0,showingUpDelay:0};this._ON_DUAL_MODE_DROPDOWN_DISPLAY(n,t,i)},_ON_GROUP_CLICK:function(n,t){var u=n&&n.cid?n.cid:t.target.getAttribute("data-listid"),i=this.getControl(u),e=i&&this.isGroupMaster(i),r=this.groupData[i.groupId],o=n&&!$.isNull(n.toggleFlag)?n.toggleFlag:r.isHide,f=i.controlType=="widget.multiCode.person";e&&!i.isHideCell&&(o===!0?(this.showRow(r.member,f?this.GROUP_TOGGLE_CLASS:"hidden"),this.$el.find('li[data-listid="'+u+'"]').removeClass("collapsed"),r.isHide=!1):(this.hideRow(r.member,f?this.GROUP_TOGGLE_CLASS:"hidden"),this.$el.find('li[data-listid="'+u+'"]').addClass("collapsed"),r.isHide=!0),this.containerName==widget.generator.HEADER&&this.ADJUST_HEADERSEARCH_DIMENSIONS())},showGroupRow:function(n){var t=this.getControl(n),r=t&&this.isGroupMaster(t),i;r&&(i=this.groupData[t.groupId],i.isHide=!0);this._ON_GROUP_CLICK({cid:n})},hideGroupRow:function(n){var t=this.getControl(n),i,r;t&&(i=t&&this.isGroupMaster(t),i&&(r=this.groupData[t.groupId],r.isHide=!1),this._ON_GROUP_CLICK({cid:n}))},getGroupRowCollapseStatus:function(n){var t=this.$el.find('li[data-listid="'+n+'"]');return t.hasClass("collapsed")},setGroupRowCollapseStatus:function(n,t){var i=this.$el.find('li[data-listid="'+n+'"]'),r=this.groupData[n];i.length&&(t?(r.isHide=!0,i.hasClass("collapsed")||i.addClass("collapsed")):(r.isHide=!1,i.removeClass("collapsed")))},getLayerDropdownOption:function(n,t){var i=t.target.getAttribute("data-listid"),r=this.dualModeKey[i];return this.getDualDropdownOption(r,i)},_ON_CHANGE_CONTROL:function(n){(this.onSync&&this.delegator.triggerEvent("form.sync",n),n.preventTriggerEvent)||this.delegator.triggerEvent("control.change",n)},_ON_DISPLAY_DATECONTROL:function(n){if(n.dateChange){var i=this.getControl(n.targetID),t=this.getControl(n.baseID);i&&t&&i.setDate([t.getDate()[0],t.getDate()[1]])}this.delegator&&this.delegator.triggerEvent("form.sync",n)},_observeControlState:function(n){var t=n.key,i=n.state,r=n.targetID},showDropdownCaret:function(n){var r,t,i;for($.isArray(n)||(n=[n]),i=0;i<n.length;i++)t=n[i],r=this.$el.find('li[data-listid="'+t+'"]').find("div.form-option"),r.length>0&&(r.removeClass("hidden"),this.changeGroupMaster(this.getControl(this.dualModeKey[t]).groupId,t))},hideDropdownCaret:function(n){var i,r,t;for($.isArray(n)||(n=[n]),t=0;t<n.length;t++)r=n[t],i=this.$el.find('li[data-listid="'+r+'"]').find("div.form-option"),i.length>0&&i.addClass("hidden")},changeGroupMaster:function(n,t){if(this.groupData[n]&&this.groupData[n].member.contains(t)==!1){var i=this.$el.find('li[data-listid="'+t+'"]'),r=this.getControl(t);r.controlType=="widget.multiCode.person"&&(r.groupId=n,this.groupData[n].master=t,i.addClass("form-collapse"+(this.groupData[n].isHide?" collapsed":"")),i.find("div.title").attr("data-function","group"))}},hideGroupCaret:function(n){var t=this.$el.find('li[data-listid="'+n+'"]');t.removeClass("form-collapse collapsed");t.find("div.title").attr("data-function","")},isVisibleDropdownCaret:function(n){var t=this.$el.find('li[data-listid="'+n+'"]').find("div.form-option");return(t.length===0&&(t=this.$el.find('li[data-listid="'+n+'"]').find("a.control-selector")),t.length>0&&!t.hasClass("hidden"))?!0:!1},getDualDropdownOption:function(n,t){for(var e=this.getDualInfo(n),u=e.dualStepButtonInfo,f=[],i,o=this.dualModeKey[n],s=this.$el.find("div.title-option > div[data-listid="+t+"]"),r=0;r<u.length;r++)i=u[r],f.push({id:i.id,label:ecount.resource[i.label]||i.label,dualStep:i.dualStep});return{type:"dropdown",ecPageID:this.ecPageID,serviceKey:ecount.common.makeServiceKey(this.ecPath,o),ownerKey:this.ecIKey,items:f||[],boundary:ec$.getZoomedBoundary(s[0])}},getControlDataById:function(n){for(var i=this.items.filter(function(n){return n.controlType!="widget.empty"}),t=0;t<this.itemList.length;t++)if(this.itemList[t].id===n)return i[t]},toggleRow:function(n,t){var r,t=t||"hidden",i;for($.isArray(n)||(n=[n]),i=0;i<n.length;i++){if(r=this.$el.find('li[data-listid="'+n[i]+'"]'),r.length=0)return!1;r.toggleClass(t)}},showRow:function(n,t){var u,i,t=t||"hidden",r;for($.isArray(n)||(n=[n]),r=0;r<n.length;r++)cid=n[r],i=this.getControl(cid),u=this.$el.find('li[data-listid="'+cid+'"]'),u.length>0&&(u.removeClass(t),i&&i.show(),this.updateFormGroupVisibility(i),i.reflowContainer&&i.reflowContainer())},hideRow:function(n,t){var i,r,t=t||"hidden",u;for($.isArray(n)||(n=[n]),u=0;u<n.length;u++)cid=n[u],r=this.getControl(cid),i=this.$el.find('li[data-listid="'+cid+'"]'),i.length>0&&(i.hasClass(t)||i.addClass(t),r&&r.hide(),this.updateFormGroupVisibility(r))},setNotUseItemFold:function(n,t){var i,t=t===!1?!1:!0,r;for($.isArray(n)||(n=[n]),r=0;r<n.length;r++)cid=n[r],i=this.getControl(cid),i&&_.isFunction(i.setNotUseItemFold)&&i.setNotUseItemFold(t)},updateFormGroupVisibility:function(n){var t,i,r;n&&n.formGroupId&&(t=this._getFormDivider(n.formGroupId),t&&(i=this.itemList.filter(function(t){return t.formGroupId==n.formGroupId}),i.length&&(r=i.any(function(n){return n.isVisible()}),t[r?"removeClass":"addClass"]("hidden"))))},changePopover:function(n,t){var i=this.$el.find('li[data-listid="'+n+'"]').find("span.user-help-mark");i&&i.length>0&&i[0].setAttribute("data-content",t.message)},showCell:function(n){this.showRow(n)},hideCell:function(n){this.hideRow(n)},showCellByFormSet:function(n){var t=this.getControlBySearchItemCode("M");n=n||t.map(function(n){return n.id});this.showRow(n);t.length>0&&(t.some(function(n){return n.isVisible()==!0})?this.setDividerDisplay(!0):this.setDividerDisplay(!1))},hideCellByFormSet:function(n){var t=this.getControlBySearchItemCode("M");n=n||t.map(function(n){return n.id});this.hideRow(n);t.length>0&&(t.some(function(n){return n.isVisible()==!0})?this.setDividerDisplay(!0):this.setDividerDisplay(!1))},showTd:function(n){var t=function(n,t,i){var u=this.getControl(n),r=this.$el.find('li[data-listid="'+n+'"]');r.length>1?t===null&&i?i.removeClass("hidden"):r.eq(t).removeClass("hidden"):r.removeClass("hidden");this._styleType&&this._styleType._isToolbarType==!0&&r.find(".title").addClass("hidden");u&&u.reflowContainer&&u.reflowContainer()}.bind(this),i,r;!(this._useChangeSelectedForm||this._useChangeItemForm)&&this.__oldItems&&this.__oldItems.length>0?this.__oldItems.forEach(function(i,r){i[0].id==n&&i.forEach(function(n){t(n.id,r)})}):(t(n),this._useChangeSelectedForm&&(i=this.$el.find('li[data-listid="'+n+'"]'),r=i.next().attr("data-listid"),r&&t(r,null,i.next())))},hideTd:function(n){var t=function(n,t){var i=this.$el.find('li[data-listid="'+n+'"]');if(i.length>1&&t){t.addClass("hidden");return}i.addClass("hidden")}.bind(this),i,r;!(this._useChangeSelectedForm||this._useChangeItemForm)&&this.__oldItems&&this.__oldItems.length>0?this.__oldItems.forEach(function(i){i[0].id==n&&i.forEach(function(n){t(n.id)})}):(t(n),this._useChangeSelectedForm&&(i=this.$el.find('li[data-listid="'+n+'"]'),r=i.next().attr("data-listid"),r&&t(r,i.next())))},showTdAll:function(){var n=this.$el.find("> li");n&&n.removeClass("hidden")},hideTdAll:function(){var n=this.$el.find("> li:not([data-celltype=rowspan])");n&&n.addClass("hidden");this._styleType&&this._styleType._isToolbarType==!0&&this.$el.find("> li[data-celltype=rowspan] > .title").addClass("hidden")},isUseCollapsed:function(n){return this._isUseCollapsed=_.isBoolean(n)?n:this._isUseCollapsed,this._isUseCollapsed},isAllCollapsed:function(n){return this.isUseCollapsed()&&this.$searchFormCollapsed&&_.isBoolean(n)&&(this._isAllCollapsed=n,this.$searchFormCollapsed.find(".view-hidden-item")[n?"addClass":"removeClass"]("collapsed")),this._isAllCollapsed},isItemFoldFilterId:function(n,t){return n=_.isArray(n)?n:[n],t=t!==!1,this.items.filter(function(i){return i.searchItemCode=="D"&&n.contains(i.id)&&(t?i.isItemFold===!0:i.isItemFold!==!0)}).map(function(n){return n.id})},showAllCollapsed:function(){this.isAllCollapsed(!1);var n=this.items.filter(function(n){return n.searchItemCode=="D"});n.forEach(function(n){var t=this.getControl(n.id),r=t&&t.isNotUseItemFold,u=t&&this.isGroupMaster(t),f=t&&t.isDualMode(),i=this.groupData[t.groupId],e=i&&i.isHide;if((!i||e!==!0||u)&&r!==!0&&n.isItemFold!==undefined&&n.isItemFold===!0){if(f){t.dualModeMaster&&this.changeDualMode(t.id,t.getDualStep());return}this.showRow(n.id)}}.bind(this));this.ADJUST_HEADERSEARCH_DIMENSIONS()},hideAllCollapsed:function(){this.isAllCollapsed(!0);var n=this.items.filter(function(n){return n.searchItemCode=="D"});n.forEach(function(n){var t=this.getControl(n.id),i=t&&t.isNotUseItemFold;i!==!0&&n.isItemFold!==undefined&&n.isItemFold===!0&&this.hideRow(n.id)}.bind(this));this.ADJUST_HEADERSEARCH_DIMENSIONS()},showCollapsed:function(n){this.showRow(n);this.collapsedData[n]&&(this.collapsedData[n].checked=!0);this.ADJUST_HEADERSEARCH_DIMENSIONS()},hideCollapsed:function(n){this.hideRow(n);this.collapsedData[n]&&(this.collapsedData[n].checked=!1);this.ADJUST_HEADERSEARCH_DIMENSIONS()},setStyle:function(n){var i=this.$el;for(var t in n)i.css(t,n[t])},_ON_SYNC_FORM:function(n,t,i,r){var r=r!==!1&&this.onSync,u;this.delegator&&r&&(u={syncHandler:this[n],layoutID:this.id,__self:this,args:[t,i,!1]},this.delegator.triggerEvent("form.change",u))},showSubTitleLink:function(n){var t=this.$el.find("#btn-FormLink-"+n);t&&t.show()},hideSubTitleLink:function(n){var t=this.$el.find("#btn-FormLink-"+n);t&&t.hide()},addClassSubTitleLink:function(n,t){var i=this.$el.find("#btn-FormLink-"+n);i&&i.addClass(t)},removeClassSubTitleLink:function(n,t){var i=this.$el.find("#btn-FormLink-"+n);i&&i.removeClass(t)},_ON_MOVE_FOCUS:function(n){var f=n.origin_id,e=n.origin_id==n.cid?null:n.cid,u=0,i,t,r,o;if(this.itemList){if(e){if(o=!1,t=this.getControl(e),t.pcid){if(o=!0,r=t&&t.getIndex(f),t&&r!==t.getVisibleIndex().pop()){t.onNextFocus(r);return}t=this.getControl(t.pcid);r=t&&t.getIndex(e)}else r=t&&t.getIndex(f);if(t&&r!==t.getVisibleIndex().pop()){t.onNextFocus(r);return}if(i=this.getNextFocusControl(t.id),u=this.getNextFocusIndex(i,u),i.targetControl&&i.targetControl.isCombinedControl()){this._setFocusOutControl(i.originControl.get(o?e:f),n);this._setFocusOnControl(i.targetControl,i.targetControl.getVisibleIndex().shift());return}if(i.targetControl){this._setFocusOutControl(i.originControl,n);this._setFocusOnControl(i.targetControl,u);return}}else if(i=this.getNextFocusControl(f),u=this.getNextFocusIndex(i,u),i.targetControl){this._setFocusOutControl(i.originControl,n);this._setFocusOnControl(i.targetControl,u);return}this.delegator.triggerEvent("form.focusout",{__self:this,type:"form.focusout",target:this.containerName,tabId:this.tabId,control:n})}},_ON_SUB_LINK_DROPDOWN_DISPLAY:function(n,t,i){var i=i||{},u=n.cid||i.cid,r,f=i.ownerCid;r=this.getSubLinkDropdownOption(f,u);ecount.layer.show(r)},getSubLinkDropdownOption:function(n,t){var i=this.subLinkData.find(function(n){return n.cid==t}),u=i.dropdownOptions,r=n,f=this.$el.find("#"+t);return{type:"dropdown",subTitleLinkId:i.cid,subTitleLinkCid:r,showingUpDelay:0,ecPageID:this.ecPageID,serviceKey:ecount.common.makeServiceKey(this.ecPath,r),ownerKey:this.ecIKey,items:u||[],boundary:ec$.getZoomedBoundary(f[0])}},_ON_DUAL_MODE_DROPDOWN_DISPLAY:function(n,t,i){var i=i||{},u=n.cid||i.cid,f=this.dualModeKey[u],r;if($.isNull(f))return!1;n.ecService="layer.dropdown";r=this.getDualDropdownOption(f,u);r.afterShow={action:"removeLayer",delay:ecount.common.LAYER_DISAPPEAR_DELAY_3000};r.showingUpDelay=i.showingUpDelay;i.onClicked&&(r._onClicked=!0);ecount.layer.show(r);i.onClicked?ecount.layer.setOnClicked(r.serviceKey,!0):this._pushDropdownKey(r.serviceKey)},_pushDropdownKey:function(n){this.dropdownKeyList.push(n)},_clearDropdownKey:function(){this.dropdownKeyList=[]},getNextFocusControl:function(n){for(var r=this.itemList.length,t,u,i=0;i<this.itemList.length;i++)if(t=this.itemList[i],t.pcid&&t.pcid==n){r=i;break}else if(t.id==n){r=i;break}return u=this._isFocusIndexType?this.getNextIndexControl(r,t):this.getNextControl(r,t),{originControl:t,targetControl:u}},getNextIndexControl:function(n,t){for(var i,f,u,r=n+1;r<this.itemList.length;r++)if(i=this.itemList[r],t.findex==i.findex&&i.isVisibleElement()&&i.hasFocusableComponent())return i;for(r=0;r<this.itemList.length;r++)i=this.itemList[r],f=t.findex<i.findex&&i.isVisibleElement()&&i.hasFocusableComponent()&&i.findex!="0",f&&(!u||u.findex>i.findex)&&(u=i);return u},getNextControl:function(n){for(var i=n+1,t;i<this.itemList.length;i++)if(t=this.itemList[i],t.isVisibleElement()&&t.hasFocusableComponent())return t},getNextFocusIndex:function(n,t){var i=n.targetControl;return i&&i.hasCheckControlType&&i.hasCheckControlType(i)&&(t=i.getPriorityDateFocusIndex()),t},_setFocusOutControl:function(n,t){n.onFocusOut(t)},_setFocusOnControl:function(n,t){n.preventOnFocusAtLastIndex||n.setFocus(t,{readonly:n.hasValidateNeededComponent()})},_ON_POPUP:function(n){this.delegator.triggerEvent("control.openPopup",n)},getControlByName:function(n){return this._getControl("name",n)},getOrignID:function(n){return this.id=="all"?n:n.replace("_"+this.id,"")},getControl:function(n,t){return t!==undefined?this.getControlByIndex(t):this._getControl("id",n)},getControlByGroup:function(n){var u=[],t,i=this.groupData[n],r;if(!i)return!1;for(t=this.getControl(i.master),u.push(t),r=0;r<i.member;r++)t=this.getControl(i.member[r]),u.push(t);return u},getControlByIndex:function(n){return this.itemList[n]},getControlBySearchItemCode:function(n){return this.itemList.filter(function(t){return t.searchItemCode==n})},_getControl:function(n,t){for(var i=0,f=this.itemList.length,r,u;i<f;i++)if(r=this.itemList[i],t==r[n])return r;for(i--;i>-1;i--)if(r=this.itemList[i],r.isCombinedControl()&&r.itemList&&(u=this._getControl.call(r,n,t),u))return u;return null},validate:function(n,t){for(var f=[],r=null,i=null,u=0,e=this.itemList.length;u<e;u++)(i=this.itemList[u],t&&i.formset&&i.formset.width===0)||(r=i.validate.call(i,null,null,n),r.length>0&&f.push(r));return f},isActive:function(){return this.active},activate:function(){this.active=!0;this.$el.addClass("active")},deactivate:function(){this.active=!1;this.$el.removeClass("active")},reset:function(n){this.itemList.forEach(function(t){var i;n&&(i=n[t.id]);t.reset(i)})},callChangeEvent:function(){this.itemList.forEach(function(n){n.callChangeEvent()})},serialize:function(){return ecount.widget.serialize(this.itemList)},serializeById:function(){return ecount.widget.serialize(this.itemList,!0)},save:function(n,t){var r=n?[]:{},u=n?function(t){r.push(n(t))}:function(n){r[n.key]=n.value},f=this.itemList,i=null;return $(f).each(function(n,r){i=t?r.saveWithoutEmpty.call(r):r.save.call(r);i&&($.isArray(i)?$(i).each(function(n,t){t&&u(t)}):u(i))}),r},restore:function(n,t){var i,r,u;if(t)if($.isArray(n))n.forEach(function(n){n=t(n);i=this.getControl(n.key);i&&i.restore(n.value)}.bind(this));else for(r in n)r=t(r),i=this.getControl(r),i&&i.restore(n[r]);else for(u in n)i=this.getControl(u),i&&i.restore(n[u])},restorePresetData:function(n,t){var i,r;if(t)n.forEach(function(n){n=t(n);i=this.getControl(n.key);i.disableTabSync&&i.disableTabSync();i&&i.restore(n.value);i.enableTabSync&&i.enableTabSync()});else for(r in n)i=this.getControl(r),i.disableTabSync&&i.disableTabSync(),i&&i.restore(n[r]),i.enableTabSync&&i.enableTabSync()},extract:function(){return ecount.widget.extract(this.itemList)},resetControlErrorStatus:function(){this.invalidControlList.length=0},_ON_SHOWERROR_CONTROL:function(n,t){var i=!1;for(k=0,len=this.invalidControlList.length;k<len;k++)if(n.cid==this.invalidControlList[k].cid){i=!0;break}i||(this.invalidControlList.push(n),!t&&this.delegator&&this.delegator.triggerEvent("control.changeValidate",{__self:this,control:n.instance,method:"control.showError",target:this.containerName,tabId:this.tabId,invalidControlList:this.invalidControlList}))},_ON_HIDEERROR_CONTROL:function(n,t){for(k=0,len=this.invalidControlList.length;k<len;k++)if(n.cid==this.invalidControlList[k].cid){this.invalidControlList.splice(k,1);!t&&this.delegator&&this.delegator.triggerEvent("control.changeValidate",{__self:this,control:n.instance,method:"control.hideError",target:this.containerName,tabId:this.tabId,invalidControlList:this.invalidControlList});break}},ADJUST_HEADERSEARCH_DIMENSIONS:function(n){this.delegator.triggerEvent("page.adjustHeaderSearchDimensions",n)},_changeSubTitleByDualStep:function(n,t){var r,u,i;arguments.length===1&&_.isPlainObject(arguments[0])&&(r=arguments[0],n=r.cid,t=r.dualStep);u=this.getDualInfo(n);t=="S"?t=0:t=="M"&&(t=1);u.isInlineMode&&(i=u.dualStepButtonInfo[t],$.isNull(i)||this.setTitle(n,ecount.resource[i.label]||i.label))},_changeSubTitle:function(n){var t=n.rowId||n.cid,i=n.title;this.setTitle(t,i)},onSyncHandler:function(n){this.onSync&&this.delegator&&this.delegator.triggerEvent("form.sync",n)},setTitle:function(n,t,i,r){var f=this.getControl(n),u=this.$el.find('li[data-listid="'+n+'"]').find(".title"),e=u.find("#btn-TitleFormLink-"+n);u&&f&&t!==undefined&&(r||u[0].childNodes[0].tagName=="A"||f&&f.isDualMode()?_.isNull(u[0].childNodes[0].nodeValue)?u[0].childNodes[0].childNodes[0].nodeValue=t:u[0].childNodes[0].nodeValue=t:u.html(t),f&&(f.subTitle=t))},setChangeTitle:function(n,t){var r=this.getControl(n),i,u;r&&(i=this.$el.find("li[data-listid='"+n+"']").find(".title"),u=['<a href="javascript:;" data-function="formTitleLink" id="btn-TitleFormLink-',n,'">'+r.subTitle+"<\/a>"].join(""),i[0].childNodes[0].remove(),t?i.prepend(u):i[0].prepend(r.subTitle))},setStyle:function(n){var i=this.$el;for(var t in n)i.css(t,n[t])},hasInvalidControl:function(){return this.invalidControlList&&this.invalidControlList.length>0},changeControlValidateState:function(n,t){var i,r,u;return n.control.id&&(i=this.getControl(n.control.id)),i&&(r={instance:i,cid:i.id},u=_.merge(n.control._getPopoverOptions(),{trigger:"focus hover",toggle:!1}),i.setPreventHideError(n.control.isPreventHideError()),i.setPopover(i._IT_SELF,u),n.method=="control.showError"?(i.showError({useDefaultOptions:!0,preventTrigger:!0}),this._ON_SHOWERROR_CONTROL(r,t)):n.method=="control.hideError"&&(i.hideError(null,!0),this._ON_HIDEERROR_CONTROL(r,t))),i},_ON_SHOWERROR_CONTROL:function(n,t){var i=!1;for(k=0,len=this.invalidControlList.length;k<len;k++)if(n.cid==this.invalidControlList[k].cid){i=!0;break}i||(this.invalidControlList.push(n),!t&&this.delegator&&this.delegator.triggerEvent("control.changeValidate",{__self:this,control:n.instance,method:"control.showError",target:this.containerName,tabId:this.tabId,invalidControlList:this.invalidControlList}))},_ON_HIDEERROR_CONTROL:function(n,t){for(k=0,len=this.invalidControlList.length;k<len;k++)if(n.cid==this.invalidControlList[k].cid){this.invalidControlList.splice(k,1);!t&&this.delegator&&this.delegator.triggerEvent("control.changeValidate",{__self:this,control:n.instance,method:"control.hideError",target:this.containerName,tabId:this.tabId,invalidControlList:this.invalidControlList});break}},getItemListByControlId:function(n){return this.itemList.first(function(t){return t.__id==n})},removeControls:function(){this.itemList&&(this.itemList.forEach(function(n){n.destroy()}),this.itemList.length=null)},getControlByName:function(n){return this.getControlByAttr("name",n)},getControl:function(n,t){return $.isEmpty(t)==!1?this.getControlByIndex(t):this.getControlByAttr("id",n)},getControlByIndex:function(n){return this.itemList[n]},getControlByAttr:function(n,t){for(var f,u=[],i=0,r;i<this.itemList.length;i++){if(r=this.itemList[i],t==r[n])return r;r.isCombinedControl()&&r.itemList&&u.push(r)}if(u.length>0)for(i=0;i<u.length;i++)if(f=u[i].itemList.filter(function(i){return t==i[n]},this),f.length>0)return f[0];return null},_currentColumnCount:function(){var n=this.eventContainer?this.eventContainer.width():$("body").width(),t=parseInt(this.colSize||"1");return n<ecount.infra.getMinimnumWidthOfForm(2)?1:n<ecount.infra.getMinimnumWidthOfForm(3)?Math.min(2,t):n<ecount.infra.getMinimnumWidthOfForm(4)?Math.min(3,t):Math.min(4,t)},setWrapperFormState:function(){var n,t;this.$el&&(n=this.$el.attr("class").match(/wrapper-form-state-\d+/g),n&&(t=this._currentColumnCount(),n.length>0&&this.$el.removeClass(n[0]),this.$el.addClass("wrapper-form-state-"+t)))},addItems:function(n,t){var i,r;_.isEmpty(n)||(i=this.convertRowsToItems(n),this.items=this.items.concat(i),this.__oldItems=this.__oldItems.concat(this.convertItemsToRows(i)),this._initItemsByAdd(i),r=this.itemList.length,this._defineItemListByAdd(i),this._renderFormContents(r),_.isFunction(t)&&t({items:i}))},_initItemsByAdd:function(n){for(var i=0,t;i<n.length;i++)(t=n[i],t.controlType!="widget.empty")&&(this.initializer&&ecount.control.initializeByUserSetting(this.initializer,t),t.activeInlineMode&&this._initInlineModeData(t))},_defineItemListByAdd:function(n){for(var i,t=0;t<n.length;t++)(i=n[t],ecount.layout.form.resetSubTitle(i))&&this._defineItem(i)},_initCollapsedData:function(){this.items.forEach(function(n){if(n.isItemFold===!0){if(this._exceptionFoldList&&this._exceptionFoldList.contains(n.id))return;this.collapsedData[n.id]={title:n.subTitle,checked:n._hideRow?!1:!0}}}.bind(this))},setCollapsedData:function(n){this.collapsedData=n},getCollapsedData:function(){return this.collapsedData},_getDisplayValue:function(n){var i="",t=this.getControl(n),r=t.controlType,u;return r&&(r.contains("widget.code",!0)?i=_.join(_.map(t.getSelectedItem(),function(n){return _.isEmpty(n.value)&&_.isEmpty(n.label)?"":String.format("[{0}]{1}",n.value,n.label)})," "):r.contains("widget.select",!0)?(u=t.getSelectedItem(),_.isEmpty(u.value)||(i=String.format("[{0}]{1}",u.value,u.label))):r.contains("widget.date",!0)?t.isEmptyDate()||(i=t.getComposedSetupDate?t.getComposedSetupDate():t.getDateFormat("yyyyMMdd")):r.contains("widget.link",!0)?i=ecount.resource.LBL02263:r.contains("widget.radio",!0)?(t.getValue()||t.getCheckedLabel())&&(i=String.format("[{0}]{1}",t.getValue()||"",t.getCheckedLabel()||"")):i=t.getFoldLayerValue()),_.isUndefined(i)&&(i=""),{key:n,value:i,label:this.collapsedData[n].title,checked:this.collapsedData[n].checked}},_openCheckboxItemLayer:function(n,t){var r=Object.keys(this.collapsedData).map(function(n){return this._getDisplayValue(n)}.bind(this)),i={type:"folditem",from:"form",ownerKey:this.ecIKey,ecPageID:n.ecPageID,serviceKey:ecount.common.makeServiceKey(n.ecPath,"fn"),items:r,boundary:ec$.getZoomedBoundary(t.target,{left:0}),isCheckbox:!0,showingUpDelay:0,_onClicked:!0};_.merge(i.boundary,{x:t.clientX,y:t.clientY,width:1,height:1,top:t.clientY,bottom:t.clientY,left:t.clientX,right:t.clientX});ecount.layer.show(i);ecount.layer.setOnClicked(i.serviceKey,!0)},ON_MOUSEOVER:function(n,t){var i={};n.ecFunction=="dual"&&(i.cid=n.ecListid,this._ON_DUAL_MODE_DROPDOWN_DISPLAY(n,t,i))},ON_MOUSEOUT:function(n){n.ecFunction=="dual"&&(this.dropdownKeyList.forEach(function(n){ecount.layer.hide(n)}),this._clearDropdownKey())},ON_FOCUSIN:function(n,t,i,r){this.isVisibleDropdownCaret(n.cid)&&r.showLayerInFocus!=!1&&(r.afterShow={action:"removeLayer",delay:ecount.common.LAYER_DISAPPEAR_DELAY_3000},this.showLayerFocusInOnDualMode===!0&&this._ON_DUAL_MODE_DROPDOWN_DISPLAY(n,t,{onClicked:!0,showingUpDelay:200}))},ON_FOCUSOUT:function(n){var i=n.cid,r=this.dualModeKey[i],t;$.isNull(r)||(t=this.getDualDropdownOption(r,i).serviceKey,ecount.layer.setOnClicked(t,!1),ecount.layer.hide(t))},ON_KEYDOWN_ENTER:function(n,t,i){i&&!i.useAsyncFocusChange&&i.onNextFocus(n.cindex)},ON_CLICK:function(n,t){var r,i,u;n.ecFunction=="formSubTitleLink"&&n.ecService=="layer.dropdown"&&(r={cid:t.target.id,ownerCid:t.target.getAttribute("owner-cid")},this._ON_SUB_LINK_DROPDOWN_DISPLAY(n,t,r));n.ecFunction&&(i="_ON_"+n.ecFunction.toUpperCase()+"_CLICK",this[i]&&this[i].apply(this,arguments));n.ecListid=="collapsed"&&(this.pageType=="input"&&this.useCollapsed?this._openCheckboxItemLayer(n,t):(u=this.$searchFormCollapsed.find(".view-hidden-item").hasClass("collapsed"),u?this.showAllCollapsed():this.hideAllCollapsed()))},ON_CLICK_SERVICE:function(n,t,i,r){if(this.pageType=="input"&&this.useCollapsed){r.command="onClickCheckboxItemLayer";return}var f=r.ecIKey.split(ecount.separator.ecPath).pop(),u=r.dualStep;$.isNull(u)||this.changeDualMode(f,u)},changeDualMode:function(n,t,i){var r,f;arguments.length===1&&_.isPlainObject(arguments[0])&&(r=arguments[0],n=this.dualModeKey[r.cid],t=r.dualStep,i=r.sync);var u=this.getDualInfo(n),e=this.getControl(n),o=_.get(this.items.find(function(t){return t.id===n}),"isItemFold",!1);this.isUseCollapsed()&&this.isAllCollapsed()&&o||u&&(this._setControlDualStep(n,t),u.isInlineMode?(e._CHANGE_DUAL_MODE(t),this._changeSubTitleByDualStep(n,t)):this._changeDualModeByDualStep(n,t),this.delegator&&i!==!1&&(f={syncHandler:this.changeDualMode,layoutID:this.id,__self:this,args:[n,t,!1]},this.delegator.triggerEvent("form.change",f)))},_changeDualModeByDualStep:function(n,t){var i,r;arguments.length===1&&_.isPlainObject(arguments[0])&&(i=arguments[0],n=this.dualModeKey[i.cid],t=i.dualStep);r=this._isIndivisualMode(n,t);r?this._ON_DUAL_DROPDOWN_INDIVISUAL(n):this._ON_DUAL_DROPDOWN_EACH(n,t)},_isIndivisualMode:function(n,t){for(var u=this.getDualInfo(n),r=u.dualStepButtonInfo,i=0;i<r.length;i++)if(t==r[i].dualStep&&r[i].id=="INDIVISUAL")return!0},_setControlDualStep:function(n,t){var f=this.getDualInfo(n),u,i,r;if(f.isInlineMode)i=this.getControl(n),i.setDualStep(t,!0);else for(u=f.dualControlInfo,r=0;r<u.length;r++)i=this.getControl(n+u[r].id),i.setDualStep(t,!0)},_ON_DUAL_DROPDOWN_INDIVISUAL:function(n){for(var t,u=this.getDualInfo(n),r=u.dualControlInfo,i=0;i<r.length;i++)t=n+r[i].id,r[i].hideIndividual===!0?this.hideRow(t):this.showRow(t),r[i].hasDualIconIndividual===!1?(this.hideDropdownCaret(t),this.hideGroupCaret(t)):this.showDropdownCaret(t)},_ON_DUAL_DROPDOWN_EACH:function(n,t){function s(n,t){for(var i=0,r=(n||[]).length;i<r;i++)if(n[i].groupId==t.groupId&&n[i].isShow)return n[i].hasDualIconIndividual!==!1?this.showDropdownCaret(t.id):this.hideDropdownCaret(t.id),!0;return!1}for(var e,i,u,o=this.getDualInfo(n),f=o.dualControlInfo,r=0;r<f.length;r++)e=$.isNull(f[r].dualStep)?r:f[r].dualStep,i=n+f[r].id,u=this.getControl(i),$.isNull(o.dualStepInfo)?e==t?(this.showDropdownCaret(i),this.showRow(i),u.setFocus(0),ecount.layer.clear()):(this.hideRow(i),this.hideGroupCaret(i)):this.isGroupMaster(u)&&(s.call(this,o.dualStepInfo[t],u)||e==t)?(this.showRow(i),u.setFocus(0),ecount.layer.clear(),this._ON_GROUP_CLICK({cid:i,toggleFlag:!1})):this.hideRow(i)},_ON_FORMTITLELINK_CLICK:function(n,t,i,r){r.__self=this;r.targetID=n.id},_ON_FORMSUBTITLELINK_CLICK:function(n,t,i,r){r.__self=this;r.targetID=n.id}},create:function(){var n=$.extend({},this.prop);ecount.layout.form.general=$.Class(ecount.layout,n)}}};ecount.layout.form.input||(ecount.layout.form.input={});ecount.layout.form.input._export=function(){return{prop:{active:!1,onSync:!1,templateType:"base",cssDefault:"table-border-no-a table-th-left table-inv-top",_dummy:$("<div><\/div>"),init:function(){ecount.layout.form.general.prototype.init.apply(this,arguments)},render:function(){this.css=this.css||this.cssDefault;$.isEmpty(this.templateType)==!1&&this.templateType!="base"&&(this.css="");ecount.layout.form.general.prototype.render.apply(this,arguments)},setDataWithHideCells:function(n){function r(n){for(var r,i=[],t=0;t<n.length;t++)if($.isArray(n[t]))for(i[t]=[],r=0;r<n[t].length;r++)i[t].push(n[t][r]);else i[t]=n[t];return i}var i=ecount.layout.form.general.prototype,t=[];t=r(this.items);$.isFunction(n)&&(t=n.call(this,t));this.itemList.forEach(function(n){n._isRendered=!0});t=i.convertItemsToRows.call(this,t);i.setData.call(this,t)},showCell:function(n){this.delegator&&this.delegator.triggerEvent("form.showCell",{ctrlIds:n,tabId:this.tabId});n=$.isArray(n)?n:[n];var t=this.itemList;this.setDataWithHideCells(function(t){return t.forEach(function(t){if(n.contains(t.id)){t.isHideCell=!1;var i=this.getControl(t.id);i&&(i.isHideCell=!1)}},this),t})},hideCell:function(n){this.delegator&&this.delegator.triggerEvent("form.hideCell",{ctrlIds:n,tabId:this.tabId});n=$.isArray(n)?n:[n];this.setDataWithHideCells(function(t){return t.forEach(function(t){if(n.contains(t.id)){var i=this.getControl(t.id);i&&(i.isHideCell=!0,i.needValidate&&i.hideError());t.isHideCell=!0}},this),t})},setStyle:function(n){var i=this.$el;for(var t in n)i.css(t,n[t])}},create:function(){var n=$.extend({},this.prop);ecount.layout.form.input=$.Class(ecount.layout.form.general,n)}}};ecount.layout.form.horizon||(ecount.layout.form.horizon={});ecount.layout.form.horizon._export=function(){return{prop:{active:!1,onSync:!1,init:function(n){if(ecount.layout.prototype.init.apply(this,arguments),this.rowspanIdx=0,this.headMergePoint=0,this.headerRowSpanIdx=0,this.mouseHoverInTime=ecount.common.mouseHoverInTime,this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID}),this.template=ecount.layout.template[["form",this.pageType||"list",n.colSize||this.colSize].join("-")],$.isEmpty(this.template))switch(this.templateType){case"customer":this.template=ecount.layout.template[["form",this.templateType].join("-")];break;default:this.template=ecount.layout.template[["form",this.pageType||"list",n.colSize||this.colSize].join("-")]}this.itemList=[];this.invalidControlList=[];this.dropDownLists={};this.dropdownLayerLists={};this.events=new ecount.events(this);this.events.on({"control.change":this._ON_CHANGE_CONTROL,"control.openPopup":this._ON_POPUP,"anchor.click":this._ON_CLICK_CONTROL,"button.click":this._ON_CLICK_CONTROL,"dropdown.click":this._ON_CLICK_CONTROL,onClickControl:this._ON_CLICK_CONTROL,"control.focusout":this._ON_MOVE_FOCUS,"control.focusin":this._ON_FOCUSIN_CONTROL,"control.showError":this._ON_SHOWERROR_CONTROL,"control.hideError":this._ON_HIDEERROR_CONTROL,"dateControl.display":this._ON_DISPLAY_DATECONTROL,"form.sync":this.onSyncHandler,"dualMode.addition":this._ON_DUAL_MODE_ADDITION,"dualMode.buttonDisplay":this._ON_DUAL_MODE_BUTTON_DISPLAY,"dualMode.setDualStep":this._ON_DUAL_MODE_SET_DUALSTEP,"dualMode.change":this._ON_CHANGE_DUAL_MODE,"dualMode.toggelDisplay":this._ON_DUAL_MODE_CONTROl_DISPLAY,"page.adjustHeaderSearchDimensions":this.ADJUST_HEADERSEARCH_DIMENSIONS,"page.adjustContentsDimensions":this.ADJUSTCONTENTSDIMENSIONS,"page.showProgressbar":this.showProgressbar,"page.hideProgressbar":this.hideProgressbar,scope:this});this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer)},render:function(){if(this.setTemplate(),ecount.layout.prototype.render.apply(this,arguments),this.url||!$.isEmptyObject(this.fOptions)?ecount.common.api({url:this.url,ecPageID:this.ecPageID,data:JSON.stringify(this.fOptions),success:function(n){var u=n.Data.items[0].subItems,i,r,f,t;if(u){for(this.rows||(this.rows=[]),i=[],r=0,f=u.length;r<f;r++)(t=u[r],this.filter&&this.filter(t)===!1)||(i.push(t),t.id=="txtCustGroup1"?(i.push($.extend({},t,{id:"txtCustGroup2",name:"CUST_GROUP2",subTitle:t.subTitle+"2"})),t.name=t.name+"1",t.subTitle=t.subTitle+"1"):t.id=="txtClassCd"&&(i.push($.extend({},t,{id:"txtClassCd2",name:"PROD_CLASS_CD2",subTitle:t.subTitle+"2"})),i.push($.extend({},t,{id:"txtClassCd3",name:"PROD_CLASS_CD3",subTitle:t.subTitle+"3"})),t.subTitle=t.subTitle+"1",t.name=t.name+"1"));this.rows=i.concat(this.rows);this.setData(this.rows)}}.bind(this)}):this.setData(this.rows),this.active&&this.$el.addClass("active"),this.explanation){var n=this.explanation,t=n.startIndex,i=n.endIndex,f=n.msg,r=this.$el.find("th"),u;$(r.get(t)).attr("rowspan","2");$(r.get(i)).remove();this.$el.find("td:gt("+i+")").attr("colspan","3");u=String.format('<td colspan="{0}" rowspan="{1}" class="text-center">{2}<\/td>',2,2,f);$(this.$el.find("td").get(t)).after(u)}},destroy:function(){ecount.layout.prototype.destroy.call(this)},setTemplate:function(){var n="",r,t,i;this.colgroup?(n=this.colgroup[0].width,this.colgroup.length>1&&(t=this.colgroup[1].width)):ecount.config.companyForm&&ecount.config.companyForm.MULTICOL_SETTINGS&&(i=ecount.config.companyForm.MULTICOL_SETTINGS.find(function(n){return Number(n.COL_TYPE)==1}),n=parseInt(i.LABEL_WIDTH,10),this.pageType=="register"&&i.FILL_CHK_YN!=="1"&&(t=parseInt(i.INPUT_WIDTH,10),r=t+n,this.style=this.style?this.style+" width:"+r+"px;":" width:"+r+"px;",n=n-1));n="width:"+n+"px;";t=t?' style="width:'+t+'px;" ':"";this._hideLRBorder&&(this.css==undefined&&(this.css=""),this.css+=" table-border-no-lr");this.template=ecount.widget.replaceAttr(this.template,{style:this.style?'style="'+this.style+'"':"",css:this.css||"",label_width:n,input_width:t})},dualControlCheck:function(n,t){for(var i,r,f,e,u=0;u<n.length;u++)if(i=n[u],i.dualMode&&i.dualModeMaster&&i.id==t.id&&(i.isCustomDualControl==!0?(r=i,this._initDualControl(i)):(r=ecount.common.createNamespace(i.controlType).prototype,typeof r.setDataCallback=="function"&&r.setDataCallback(r,i),i.dualType=r.dualControlInfo[0].dualType,i.warehouseType=r.dualControlInfo[0].warehouseType,i.dualStepItem=r.dualControlInfo[0].dualStepItem),r))for(e=r.dualControlInfo[0].dualControlLen,f=1;f<=e;f++)n.splice(u+1,0,this.addDualControl(i,r,f)),u++;return n},_initDualControl:function(n){n.dualType=n.id;n.dualStep=0;n.dualStepItem=0;n.dualControlInfo=[];n.dualStepButtonInfo=[];n.dualStepInfo={maxStep:1};n.dualControlInfo.push({id:"",dualStepItem:0,dualControlLen:0,dualControlId:n.id});n.dualStepButtonInfo.push({id:n.id,dualStep:0,dualControlId:n.id,label:n.subTitle});for(var i=0,t;i<n.dualControls.length;i++)t=n.dualControls[i],n.dualControlInfo.push($.extend({},t,{id:"_"+t.id,name:"_"+t.name,dualStepItem:i+1})),n.dualControlInfo[0].dualControlLen++,n.dualStepButtonInfo.push({id:"_"+t.id,name:"_"+t.name,dualStep:i+1,dualControlId:String.format("{0}_{1}",n.id,t.id),label:t.dualLabel}),n.dualStepInfo.maxStep++;n.disableIndividual||n.dualStepButtonInfo.push({id:"individual",label:ecount.resource.LBL10694,dualStep:n.dualStepInfo.maxStep,dualControlId:n.includeDualMaster?n.id:n.id+n.dualControlInfo[1].id})},_implementDualControl:function(n){var t=this;n._ON_DUAL=function(n,t){var c=$.isNull(n.sync)?!0:n.sync,i=n.dualStep,h=n.dropdownClick,l=this.$el.closest("tbody"),r,u,f,e,o,s;if(!$.isEmpty(i)){for(this.dualStep=i,this.dualResetInfo=[],r=0;r<this.dualControlInfo.length;r++)u=this.dualControlInfo[r],f=l.find(String.format("tr[data-dualtype='{0}'][data-dualStepItem=\"{1}\"]",this.dualType,u.dualStepItem)),e=f.find("a[dropdown-show]"),i==this.dualStepInfo.maxStep?(u.dualStepItem!=0||this.includeDualMaster?(f.show(),r==0&&this.includeDualMaster?e.show():r!=1||this.includeDualMaster?e.hide():e.show()):f.hide(),this.dualResetInfo.push(u.id)):i==u.dualStepItem?(f.show(),e.show()):(f.hide(),e.hide(),this.dualResetInfo.push(u.id));this.delegator&&(o=this.dualControlInfo[0].dualControlId,s=i==this.dualStepInfo.maxStep,this.delegator.triggerEvent("dualMode.setDualStep",{dualType:this.dualType,dualStep:this.dualStep}),this.delegator.triggerEvent("dualMode.change",{cid:o,dualStep:i,dualControlId:s?"individual":o+this.dualControlInfo[i].id,isEachSelection:s,targetID:"on-changeDualMode",__eventType:"control.change"}),t||$.isEmpty(this.dualResetInfo)||this.delegator.triggerEvent("dualMode.addition",{type:"reset",param:this.dualResetInfo,dropdownClick:h}),c&&this.delegator.triggerEvent("form.sync",{syncHandler:this._ON_DUAL,cid:this.id,args:[{sync:!1,dualStep:i,dropdownClick:h},t],__self:this}))}};n._ON_DUAL_LASTRESET=function(n){$.isEmpty(n.dualStep)||this._ON_DUAL(n,!0)};n.dualModeAddition=function(){this.reset()};n.getDualStep=function(){return this.dualStep};n.setDualStep=function(n){var t={sync:!0,dualStep:n};this._ON_DUAL(t)};n.dualModeShowButtonDisplay=function(){var n=this.includeDualMaster?0:1,t=this.dualControlInfo[0].dualControlId+this.dualControlInfo[n].id;return this.dualStep!=this.dualStepInfo.maxStep?!0:this.id==t?!0:!1};n._setDualModeStep=function(n){this.dualStep=n};n._bindDefaultEvent=function(){var t=n._bindDefaultEvent;return function(){t&&t.apply(n,arguments);var i=function(n){n.on("keyup",function(){event.keyCode!=13&&(!this.dualModeShowButtonDisplay||this.dualModeShowButtonDisplay())&&this.delegator&&this.delegator.triggerEvent("dualMode.buttonDisplay",{id:this.id,isShow:!1})}.bind(this))}.bind(this);this.controlType.indexOf("widget.input")>-1&&i(this.$el)}}();n.onFocus=function(){var t=n.onFocus;return function(){if(t&&t.apply(n,arguments),!(this.controlType.indexOf("widget.multiCode.")>-1)){if(this.dualMode&&this.dualModeShowButtonDisplay()&&!this.isDualTriggered){var i={id:this.id,mode:!0};this.delegator&&this.delegator.triggerEvent("control.focusin",i)}this.isDualTriggered=!1}}}()},addDualControl:function(n,t,i){var u=Object.clone(n),r,o,f,s,e;for(r in n)r==="controlType"?u[r]=t.dualControlInfo[i].controlType:r==="dualMode"||r==="dualSubTitle"?(o=t.dualControlInfo[i].hasDualIcon,o==!1&&(u.isGroupMember=!0,u.dualMode=!1)):r==="id"?u[r]=n[r]+t.dualControlInfo[i].id:r==="name"?u[r]=n[r]+t.dualControlInfo[i].name:r==="subTitle"?u[r]=t.dualControlInfo[i].subTitle:r==="groupId"?(f=t.dualControlInfo[i].groupId,s=t.dualControlInfo[i].isDefaultShow,s||(u.hideRow=!0),$.isEmpty(f)||(u[r]=f)):r==="dualModeMaster"?delete u[r]:r==="warehouseType"?u[r]=t.dualControlInfo[i].warehouseType||"":r==="additionalInitData"?(e=t.dualControlInfo[i].additionalInitDataType||"",$.isEmpty(e)||e==n.additionalInitData.initDataType&&(u.additionalInitDataControlType=n.additionalInitData.additionalInitDataControlType),delete u[r]):r==="dualStepItem"?u[r]=t.dualControlInfo[i].dualStepItem:r==="codes"?delete u[r]:u[r]=n[r];return u},setData:function(n){var t,i,e,o,u,f,s,r,h;if(n){for(n=$.isArray(n)?n:[n],this.initializeRowdata(n),u=0;u<n.length;u++)if(t=n[u],ecount.layout.form.resetSubTitle(t)){if(t.colEssentialYn=="Y"&&t.controlType.indexOf("widget.combine")==-1&&(t.dataRules=["required"]),t.pIndex=u,t.colSize=this.colSize+1,t.onSync=this.onSync,e=t.groupId&&!t.isGroupMember,o=this._rowspan&&this._rowspan[u],i=$.isArray(t)?this.addMultiContorl(t,e,o,this.tabId):this.addSingleControl(t,e,o,u),f=t._popover,f&&delete t._popover,t.groupId)if(i.attr("data-group",t.groupId),t.dualType&&i.attr("data-dualType",t.dualType),t.isGroupMember)i.addClass("hidden");else if(t.dualMode){i.find("[dual-show]").on("click",this._ON_FOCUSIN_CONTROL.bind(this,{id:t.id,mode:!0,timer:100}));i.find("[data-show]").on("click",this._ON_TOGGLE_GROUP.bind(this));i.find("div[dual-arrow]").on("mouseenter",this._ON_DUAL_MOUSEOVER.bind(this,{id:t.id,mode:!0,time:this.mouseHoverInTime}));i.find("div[dual-arrow]").on("mouseleave",this._ON_DUAL_MOUSEOUT.bind(this,{id:t.id,mode:!0}))}else i.find("[data-show]").on("click",this._ON_TOGGLE_GROUP.bind(this));if(this.$el.find("> tbody").append(i),f){s="span-user-help-mark-"+i.attr("id").split("-")[i.attr("id").split("-").length-1];r=$('<span class="user-help-mark" id="'+s+'" data-content="'+f.message+'" data-placement="'+f.placement+'" data-trigger="focus hover click" data-toggle="popover" data-html="true"/>');i.find("th").after(" ").append(r);h=[{target:r,isShow:!1},{target:i,isShow:!1}];r.popover({content:f.message||"error",container:t.eventContainer,delay:{show:this.mouseHoverInTime,hide:0},popoverCallBack:this.togglePopover.bind(this,h)});i.on("mouseenter",this.togglePopover.bind(this,{target:i,isShow:!0}));i.on("mouseleave",this.togglePopover.bind(this,{target:i,isShow:!1}));r.on("mouseenter",this.togglePopover.bind(this,{target:r,isShow:!0}));r.on("mouseleave",this.togglePopover.bind(this,{target:r,isShow:!1}))}c.call(this);function c(){for(var u=i.find("th"),t,n,r=0,f=u.length;r<f;r++)n=u.eq(r),t=n.attr("id")||n.next("td").attr("id")||i.attr("id").replace("row-",""),n.attr("data-hoverid",t),n.next("td").attr("data-hoverid",t)}}this.ecTransaction.complete(this.onLoadComplete.bind(this));this.ecTransaction.start()}},addPopoverList:function(n){this.popoverList.push(n)},togglePopover:function(n){for(var r=$.isArray(n)?n:[n],t,u,i=0;i<r.length;i++)t=r[i].target,u=r[i].isShow,t[0].nodeName.toUpperCase()=="TR"?this.togglePopoverIcon(t,u):this.drawPopoverIcon(t,u)},togglePopoverIcon:function(n,t){if(this.isHoverActionPopover(n)==!1)return!1;t==!0?n.find("th > [id^='span-user-help-mark-']").addClass("visible"):n.find("th > [id^='span-user-help-mark-']").removeClass("visible")},drawPopoverIcon:function(n,t){if(this.isHoverActionPopover(n)==!1)return!1;t==!0?n.addClass("active"):n.removeClass("active")},isHoverActionPopover:function(n){if(n[0].nodeName.toUpperCase()=="TR"){if(n.find("th > span").data("mousedown")=="true")return!1}else if(n.data("mousedown")=="true")return!1;return!0},hideClickPopover:function(n){var t=this.popoverList.find(function(t){return t!=n&&t._onclicked});t&&t.bodyClickHandler&&t.bodyClickHandler()},initializeRowdata:function(n){for(var r=null,i=null,u=0,f=0,n=$.isArray(n)?n:[n],t=0,e=n.length;t<e;t++)if(n[t].groupId?r==null||n[t].groupId!=r?r=n[t].groupId:n[t].isGroupMember=!0:r&&(r=null),n[t].rowspan){if(this._rowspan||(this._rowspan={}),n[t].rowspan!=i&&i!==null){this._rowspan[u]=f++;u=t;i=n[t].rowspan;f=1;continue}i||(u=t,i=n[t].rowspan);f++}else i!==null&&(this._rowspan[u]=f,i=null,u=0,f=0)},addSingleControl:function(n,t,i,r){var u,f,s,h,a,y,c=this.createControl(n),o=c.subTitle||"",v,e,p,l,w;if(this.mergeHeaderOptions.length!==0&&(a=this.mergeHeaderOptions[this.headerRowSpanIdx],y=r===this.headMergePoint),n.titleLink&&(n.subTitle=['<a href="javascript:;" id="btn-TitleFormLink-',n.titleLinkID,'">',n.subTitle,"<\/a>"].join("")),n.subTitleLink&&(n.subTitle=[n.subTitle,'<div class="pull-right"><a href="javascript:;" id="btn-FormLink-',n.subLinkID,'">',n.subTitleLink,"<\/a><\/div>"].join("")),t){if(n.dualMode){u=this.colSize==1?$(ecount.widget.replaceAttr(ecount.layout.template.formRowDualGroupingSingle,n)):$(ecount.widget.replaceAttr(ecount.layout.template.formRowDualGrouping,n));this.createDualButtonFunction(u,n);u.find("[dropdown-show]").on("click",this._ON_FOCUSIN_CONTROL.bind(this,{id:n.id,mode:!0}));u.find("div[dual-arrow]").on("mouseenter",this._ON_DUAL_MOUSEOVER.bind(this,{id:n.id,mode:!0,time:this.mouseHoverInTime}));u.find("div[dual-arrow]").on("mouseleave",this._ON_DUAL_MOUSEOUT.bind(this,{id:n.id,mode:!0}));n.dualType&&u.attr("data-dualType",n.dualType);(n.dualStepItem!=undefined||n.dualStepItem!=null)&&u.attr("data-dualStepItem",n.dualStepItem)}else u=this.colSize==1?$(ecount.widget.replaceAttr(ecount.layout.template.formRowGroupingSingle,n)):$(ecount.widget.replaceAttr(ecount.layout.template.formRowGrouping,n));u.attr("id","row-"+n.id);u.find("td").attr("data-label",o)}else{if(f=['<tr id="row-'+n.id+'">'],s=i?' rowspan="'+i+'"':"",h=n.groupId?' class="text-primary"':"",y&&(f.push("<th rowspan="+a.count+">"+a.header+"<\/th>"),this.headMergePoint=this.mergeHeaderOptions[this.headerRowSpanIdx].count+r,this.headerRowSpanIdx++),this._rowspan===undefined?f.push("<th"+s+h+">"+n.subTitle+"<\/th>"):(v=!0,this.current=i?r+i-1:this.current,v=r<=this.current?!1:!0,i===undefined&&v===!0?f.push("<th"+s+h+">"+n.subTitle+"<\/th>"):this.current===0&&f.push("<th"+s+h+">"+n.subTitle+"<\/th>"),i&&f.push("<th"+s+h+">"+n.subTitle+"<\/th>")),this.mergeBodyOptions.length===0?this.colSize===1?f.push('<td data-label="'+o+'"><\/td>'):f.push('<td colspan="'+(this.colSize+1)+'" data-label="'+o+'"><\/td>'):(e=this.mergeBodyOptions[this.rowspanIdx],p=r>=e.start&&r<=e.start+e.count-1,this.colSize===1?f.push("<td "+(p?"":' colspan ="2"')+' data-label="'+o+'"><\/td>'):f.push('<td colspan="'+(this.colSize+1)+'" data-label="'+o+'"><\/td>'),r===e.start&&(l=this.createControl(e.control),f.push('<td rowspan="'+e.count+'" data-label="'+o+'"><\/td>')),r!=0&&e.start+e.count-1===r&&this.mergeBodyOptions.length-1>this.rowspanIdx&&this.rowspanIdx++),f.push("<\/tr>"),u=$(f.join("")),u.find("a").length)u.on("click","a",this._ON_CLICK_SUBTITLELINK.bind(this));if(n&&n.dualMode==!0){w=$('<div class="pull-right"><div class="btn-group" dual-arrow><a dropdown-show="show" href="javascript:;"><span class="fa fa-caret-right"><\/span><\/a><\/div><\/div>');u.find("th").after(" ").append(w);this.createDualButtonFunction(u,n);u.find("[dropdown-show]").on("click",this._ON_FOCUSIN_CONTROL.bind(this,{id:n.id,mode:!0}));u.find("div[dual-arrow]").on("mouseenter",this._ON_DUAL_MOUSEOVER.bind(this,{id:n.id,mode:!0,time:this.mouseHoverInTime}));u.find("div[dual-arrow]").on("mouseleave",this._ON_DUAL_MOUSEOUT.bind(this,{id:n.id,mode:!0}));n.dualType&&u.attr("data-dualType",n.dualType);(n.dualStepItem!=undefined||n.dualStepItem!=null)&&u.attr("data-dualStepItem",n.dualStepItem)}}return n.dualMode&&(n.isCustomDualControl==!0&&this._implementDualControl(c),n.hideRow&&u.hide()),n._hideRow==!0&&u.hide(),c&&c.render(u.find("td").first()),l&&l.render(u.find("td").last()),this.itemList.push(c),u},createDualButtonFunction:function(n,t){var i,r=n.find("div.btn-group");i=t.isCustomDualControl?t.dualStepButtonInfo:t.dualStepButtonInfo?t.dualStepButtonInfo:ecount.common.createNamespace(t.controlType).prototype.dualStepButtonInfo;this.dropDownLists["list-"+t.id]=new ecount.layout.dropdown({items:i,ecPageID:this.ecPageID,eventContainer:t.eventContainer,direction:"",dualMode:t.dualMode,onClick:function(n){this._ON_DUAL_MODE(n,t)}.bind(this),onBeforeHide:function(){this.setIsDualClick(t.id,!1);ecount.global.clearTimeoutByTimerNo(this.ecPageID,this.dropdownLayerLists["dropdown-"+t.id]._dropdownLayerTimer)}.bind(this),popupID:t.popupID,popupLevel:t.popupLevel,pnode:r});this.dropDownLists["list-"+t.id].render(r);this.dropdownLayerLists["dropdown-"+t.id]={}},addMultiContorl:function(n){var i=null,r=null,t,f=null,u,e,o;for(i=$('<tr  id="row-'+n[0].id+'"><\/tr>'),u=0,e=n.length;u<e;u++)t=n[u],r=this.createControl(t),o=r.subTitle,t.titleLink&&(t.subTitle=['<a href="javascript:;" id="btn-TitleFormLink-',t.titleLinkID,'">',t.subTitle,"<\/a>"].join("")),t.subTitleLink&&(t.subTitle=[t.subTitle,'<div class="pull-right"><a href="javascript:;" id="btn-FormLink-',t.subLinkID,'">',t.subTitleLink,"<\/a><\/div>"].join("")),f=$('<th  id="'+t.id+'">'+t.subTitle+'<\/th><td data-label="'+o+'"><\/td>'),r.render($(f[1])),i.append(f),this.itemList.push(r);if(i.find("a").length)i.on("click","a",this._ON_CLICK_SUBTITLELINK.bind(this));return i},createControl:function(n){var t;if(this.initializer&&ecount.control.initializeByUserSetting(this.initializer,n),n.dualMode&&n.dualModeMaster&&this.dualControlCheck(this.rows,n),n.__pnode=this.__type,n.controlType==="widget.custom"&&(n.containerName=this.containerName),n.controlType.indexOf("widget.multiCode.")>-1&&(n.containerName=this.containerName),n.__type=widget.generator.CONTROL,n.pId=this.tabId,n.gridID="",n.tabID=this.tabId,n.panelID=this.panelID,n._isRowSpan=["register","list"].contains(this.pageType||"list")?!1:!0,n.colSize=this.colSize,ecount.widget.createDisplayID(n,"btn",this.containerName),n.initializePopover=!1,n.delegator=this.events,n.ecTransaction=this.ecTransaction,t=ecount.common.createNamespace(n.controlType),!t)throw String.format("[ERROR][widget initialize] - '{0}' not defined. (name:{1}, subTitle:{2}, gridId:{3})",n.controlType,n.name,n.subTitle,n.gridID);return new t(n)},getControlByName:function(n){return this._getControl("name",n)},getOrignID:function(n){return this.id=="all"?n:n.replace("_"+this.id,"")},getControl:function(n,t){return t!==undefined?this.getControlByIndex(t):this._getControl("id",n)},getControlByGroup:function(n){for(var t,r=[],i=0,u=this.itemList.length;i<u;i++)t=this.itemList[i],t.isGroupMember&&t.groupId==n&&r.push(t);return r},getControlByIndex:function(n){return this.itemList[n]},getControlByFindex:function(n){return this.itemList.head(function(t){return t.findex==n})},_getControl:function(n,t){for(var i=0,f=this.itemList.length,r,u;i<f;i++)if(r=this.itemList[i],t==r[n])return r;for(i--;i>-1;i--)if(r=this.itemList[i],r.isCombinedControl()&&r.itemList&&(u=this._getControl.call(r,n,t),u))return u;return null},validate:function(n){for(var u=[],t=null,i=null,r=0,f=this.itemList.length;r<f;r++)i=this.itemList[r],t=i.validate.call(i,null,null,n),t.length>0&&u.push(t);return u},isActive:function(){return this.active},activate:function(){this.active=!0;this.$el.addClass("active")},deactivate:function(){this.active=!1;this.$el.removeClass("active")},reset:function(n){this.itemList.forEach(function(t){var i;n&&(i=n[t.id]);t.reset(i)})},redrawControl:function(n){this.itemList.forEach(function(t){t.reflowContainer&&t.reflowContainer();t.hasError()?n||t.showError():t.controlType=="widget.custom"&&t.showErrorOfItemList()})},serialize:function(){return ecount.widget.serialize(this.itemList)},serializeById:function(){return ecount.widget.serialize(this.itemList,!0)},save:function(n){var i=n?[]:{},r=n?function(t){i.push(n(t))}:function(n){i[n.key]=n.value},u=this.itemList,t=null;return $(u).each(function(n,i){t=i.save.call(i);t&&($.isArray(t)?$(t).each(function(n,t){t&&r(t)}):r(t))}),i},restore:function(n,t){var i,r;if(t)n.forEach(function(n){n=t(n);i=this.getControl(n.key);i&&i.restore(n.value)});else for(r in n)i=this.getControl(r),i&&i.restore(n[r])},extract:function(){return ecount.widget.extract(this.itemList)},toggleRow:function(n){var t=this.$el.find("#row-"+n);t&&(t.toggle(),ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("toggleRow",{type:"toggleRow"}))},showRow:function(n){var t=this.$el.find("tr#row-"+n);t&&t.show();ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("showRow",{type:"showRow"})},hideRow:function(n){var t=this.$el.find("tr#row-"+n);t&&t.hide();ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("hideRow",{type:"hideRow"})},showSubTitleLink:function(n){var t=this.$el.find("#btn-FormLink-"+n);t&&t.show()},hideSubTitleLink:function(n){var t=this.$el.find("#btn-FormLink-"+n);t&&t.hide()},addClassSubTitleLink:function(n,t){var i=this.$el.find("#btn-FormLink-"+n);i&&i.addClass(t)},removeClassSubTitleLink:function(n,t){var i=this.$el.find("#btn-FormLink-"+n);i&&i.removeClass(t)},setTitle:function(n,t,i,r){var u=i?this.$el.find("th#"+n):this.$el.find("tr#row-"+n).find("th"),f;u&&(r?u[0].childNodes[0].nodeValue=t:u.html(t),f=this.getControl(n),f&&(f.subTitle=t))},changePopover:function(n,t){var i=this.$el.find("tr#row-"+n).find("span.user-help-mark");i&&i.length>0&&i[0].setAttribute("data-content",t.message)},enable:function(n){this._enable(n,n)},disable:function(n){this._disable(n,n)},_enable:function(n,t){var r=this.$el.find("#"+n),i=this.getControl(t);i&&(r&&r.html(i.subTitle),i.enable())},_disable:function(n){var t=this.$el.find("#"+n),i=this.getControl(n);t&&t.html("");i&&i.disable()},showGroupRow:function(n){var t=this.$el.find("#row-"+n+" th a");t.find("span.fa-caret-down").length>0&&t.click();ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("showGroupRow",{type:"showGroupRow"})},hideGroupRow:function(n){var t=this.$el.find("#row-"+n+" th a");t.find("span.fa-caret-up").length>0&&t.click();ecount&&ecount.__isEventCaptureMode()&&ecount.eventLog("hideGroupRow",{type:"hideGroupRow"})},hasInvalidControl:function(){return this.invalidControlList&&this.invalidControlList.length>0},changeControlValidateState:function(n,t){var i,r;return n.control.pcid?(i=this.getControl(n.control.pcid),i&&(i=i.get(n.control.id),i.controlType.indexOf("widget.multiCode")<0&&i.controlType.indexOf("widget.date")<0&&i.controlType.indexOf("widget.multiDate")<0&&(i=null))):i=this.getControl(n.control.id),i&&(r={instance:i,cid:i.id},n.method=="control.showError"?(i.errorType=n.control.errorType,i.errorMessage=n.control.errorMessage,i.showError(null,i.errorMessage,null,!0),this._ON_SHOWERROR_CONTROL(r,t)):n.method=="control.hideError"&&(i.hideError(null,!0),this._ON_HIDEERROR_CONTROL(r,t))),i},onLoadComplete:function(){var n={target:this.containerName,type:this.__type,__self:this};this.redrawControl();this.showFormLayer&&this.setShowFormLayer();this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},setShowFormLayer:function(){var n=this.$el.closest(".wrapper-header-search");n.length>0?n.show():this.$el.parent().show()},_ON_DISPLAY_DATECONTROL:function(n){if(n.dateChange){var i=this.getControl(n.targetID),t=this.getControl(n.baseID);i&&t&&i.setDate([t.getDate()[0],t.getDate()[1]])}this.delegator&&this.delegator.triggerEvent("form.sync",n)},onSyncHandler:function(n){this.onSync&&this.delegator&&this.delegator.triggerEvent("form.sync",n)},_ON_DUAL_MODE_ADDITION:function(n){for(var r=$.isArray(n.param)?n.param:[n.param],f=n.type,e=n.dropdownClick,o=r.length,u,t,i=0;i<o;i++)u=r[i],t=this.getControl(u),t&&t.dualModeAddition&&t.dualModeAddition(f,e)},_ON_DUAL_MODE_BUTTON_DISPLAY:function(n){var i=n.id||"",r=n.isShow,t;$.isEmpty(i)||(t=this.dropDownLists["list-"+i],r?t&&t.show():t&&t.hide())},_ON_DUAL_MODE_CONTROl_DISPLAY:function(n){var i,f;if(n){var e=n.dualStepItem,o=n.dualType,r,t,u=!1;if(controls=this.itemList.filter(function(n){return n.dualType==o}),controls)for(i=0,f=controls.length;i<f;i++)r=controls[i],t=this.$el.find("tr#row-"+r.id),e.contains(r.dualStepItem)==!0?(t.show(),t.find("div[dual-arrow]").show(),u==!0&&t.find("div[dual-arrow]").hide(),u=!0):t.hide()}},_ON_DUAL_MODE_SET_DUALSTEP:function(n){for(var r=n.dualType,u=n.dualStep,t,i=0,f=this.itemList.length;i<f;i++)t=this.itemList[i],t.dualMode&&t.dualType==r&&t._setDualModeStep&&t._setDualModeStep(u)},_ON_CHANGE_DUAL_MODE:function(n){this.delegator.triggerEvent("control.change",n)},_ON_CHANGE_CONTROL:function(n){(this.onSync&&this.delegator&&this.delegator.triggerEvent("form.sync",n),n.preventTriggerEvent)||this.delegator.triggerEvent("control.change",n)},_ON_TOGGLE_GROUP:function(n){var u=$(n.currentTarget),i=u.children("span"),t=u.data("show"),r=this.$el.find("[data-group='"+t+"']:not(:first)"),f=i.hasClass("fa-caret-up"),e=this.$el.find("[data-group='"+t+"']").first(),o=this.getControl(e.attr("id").replace("row-","")),s,h;o&&o.isDualGroupType&&(s=e.attr("data-dualtype"),r=this.$el.find("[data-group='"+t+"']:not([data-dualtype="+s+"])"),i=this.$el.find("[data-group='"+t+"']").find("th").find(".fa-caret-up,.fa-caret-down"));f?(i.removeClass("fa-caret-up").addClass("fa-caret-down"),r.addClass("hidden")):(i.addClass("fa-caret-up").removeClass("fa-caret-down"),r.removeClass("hidden"),h=this.getControlByGroup(t),h.forEach(function(n){n.needValidate&&n.showError();n.codeType=="multi"&&n.reflowContainer()}));this.delegator.triggerEvent("onToggleGroup",n);this.containerName==widget.generator.HEADER&&this.ADJUST_HEADERSEARCH_DIMENSIONS();ecount.__isEventCaptureMode()&&ecount.eventLog("onToggleGroup",{type:"onToggleGroup",ecPageID:this.ecPageID,doHide:f})},_ON_CLICK_CONTROL:function(n){var i,r,t;n.name=="SIMPLE_SEARCH"?(i=this.getOrignID(n.targetID),["endMonth"].contains(i)&&(i="endDay"),r=n.searchName||ecount.constValue.DEFAULT_SIMPLESEARCH_KEY,t=this.getControlByName(r),t&&t.controlType=="widget.custom"&&t.getDateControl&&(t=t.getDateControl()),t&&(n&&n.targetID=="settingButton"?n.targetID="btn-simpleSearchSetting":(i=n.fromDate&&!["endDay"].contains(i)?[n.fromDate,n.toDate]:ecount.control.date.period[i].call(t,t.ecPageID),i&&t.setDate(i),n.targetID=n&&n.originTargetID?n.originTargetID:["btn",this.containerName,"simpleSearch"].join("-"))),this.delegator.triggerEvent("form.simpleSearch",n)):this.delegator.triggerEvent(n.type,n)},_ON_CLICK_SUBTITLELINK:function(n){var t=$(n.target),i={targetID:t.attr("id"),event:n,__self:this};this.delegator&&this.delegator.triggerEvent("anchor.click",i)},_ON_POPUP:function(n){this.delegator.triggerEvent("control.openPopup",n)},_ON_FOCUSIN_CONTROL:function(n){n&&n.mode&&ecount.global.setTimeout(this.ecPageID,function(){var t=n.id,i=this.getIsDualClick(t);i==!1?(this._ON_DUAL_MODE_BUTTON_DISPLAY({id:t,isShow:!0}),this.setIsDualClick(t,!0)):(this._ON_DUAL_MODE_BUTTON_DISPLAY({id:t,isShow:!1}),this.setIsDualClick(t,!1))}.bind(this),100)},_ON_DUAL_MOUSEOVER:function(n){n&&n.mode&&(this.dropdownLayerLists["dropdown-"+n.id]._dropdownLayerTimer=ecount.global.setTimeout(this.ecPageID,function(){this._ON_DUAL_MODE_BUTTON_DISPLAY({id:n.id,isShow:!0,type:"mouseover"})}.bind(this),n.time||100))},_ON_DUAL_MOUSEOUT:function(n){if(n&&n.mode){var t=this.dropdownLayerLists["dropdown-"+n.id]._onDualClick;t||(this._ON_DUAL_MODE_BUTTON_DISPLAY({id:n.id,isShow:!1}),ecount.global.clearTimeoutByTimerNo(this.ecPageID,this.dropdownLayerLists["dropdown-"+n.id]._dropdownLayerTimer))}},ADJUST_HEADERSEARCH_DIMENSIONS:function(n){this.delegator.triggerEvent("page.adjustHeaderSearchDimensions",n)},ADJUSTCONTENTSDIMENSIONS:function(){this.delegator&&this.delegator.triggerEvent("page.adjustContentsDimensions")},transferEvent:function(n){this.delegator.triggerEvent(n.type,n)},getIsDualClick:function(n){return this.dropdownLayerLists["dropdown-"+n]._onDualClick||!1},setIsDualClick:function(n,t){return this.dropdownLayerLists["dropdown-"+n]._onDualClick=t},_ON_MOVE_FOCUS:function(n){var r=n.cid,u=n.__self&&n.__self.pcid,t,i,f;if(u){if(i=this.getControl(u),f=i&&i.getIndex(r),i&&f!==i.getVisibleIndex().pop()){i.onNextFocus(f);return}if(t=this.getNextFocusControl(u),t.targetControl&&t.targetControl.isCombinedControl()){t.originControl.get(r).onFocusOut(n);t.targetControl.setFocus(t.targetControl.getVisibleIndex().shift());return}if(t.targetControl){t.originControl.get(r).onFocusOut(n);t.targetControl.setFocus(0);return}}else if(t=this.getNextFocusControl(r),t.targetControl){t.originControl.onFocusOut(n);t.targetControl.setFocus(0);return}this.delegator.triggerEvent("form.focusout",{__self:this,type:"form.focusout",target:this.containerName,tabId:this.tabId,control:n})},getNextFocusControl:function(n){for(var r=this.itemList.length,i,u,t=0;t<this.itemList.length;t++)if(u=this.itemList[t],u.pcid&&u.pcid==n){r=t;break}else if(u.id==n){r=t;break}for(t=r+1;t<this.itemList.length;t++)if(i=this.itemList[t],i.isVisibleElement()||i.isCombinedControl())break;else i=null;return{originControl:this.itemList[r],targetControl:i}},_ON_SHOWERROR_CONTROL:function(n,t){var i=!1;for(k=0,len=this.invalidControlList.length;k<len;k++)if(n.cid==this.invalidControlList[k].cid){i=!0;break}i||(this.invalidControlList.push(n),!t&&this.delegator&&this.delegator.triggerEvent("control.changeValidate",{__self:this,control:n.instance,method:"control.showError",target:this.containerName,tabId:this.tabId,invalidControlList:this.invalidControlList}))},_ON_HIDEERROR_CONTROL:function(n,t){for(k=0,len=this.invalidControlList.length;k<len;k++)if(n.cid==this.invalidControlList[k].cid){this.invalidControlList.splice(k,1);!t&&this.delegator&&this.delegator.triggerEvent("control.changeValidate",{__self:this,control:n.instance,method:"control.hideError",target:this.containerName,tabId:this.tabId,invalidControlList:this.invalidControlList});break}},_ON_DUAL_MODE:function(n,t){var r=this.getControl(t.id),i,u={sync:!0,dualStep:n.dualstep,dropdownClick:!0};r._ON_DUAL&&(r._ON_DUAL(u),ecount.global.setTimeout(this.ecPageID,function(){i=this.getControl(n.dualcontrolid);i&&(i.isDualTriggered=!0,i.setFocus(0))}.bind(this),180))},resetControlErrorStatus:function(){this.invalidControlList.length=0},hideRowGroup:function(n,t,i,r){var c=this.$el.find("tr#row-"+t),e=this.$el.find("tr[data-group='"+n+"'][id !='row-"+t+"']"),o,l,a,u,s,f,h;if(c&&c.hide(),e.length==1&&(o=e.find("a"),l="<div>"+o.text()+"<\/div>",o.hide(),e.find("th").append(l)),i)for(a=this.itemList.length,s=!1,f=0;f<a;f++)if(h=this.itemList[f],u=h.groupId||"",!$.isEmpty(u)){if(s&&u!=n)break;u==n&&(h.reset(),s=!0)}this._ON_CHANGE_SHOWGROUP(n,t,i,!1,r!==!1)},showRowGroup:function(n,t,i,r){var f=this.$el.find("tr#row-"+t),e=this.$el.find("tr[data-group='"+n+"']").first(),u=e.find("a");f&&f.show();u.length>0&&(u.show(),u.next().remove());this._ON_CHANGE_SHOWGROUP(n,t,null,!0,r!==!1)},_ON_CHANGE_SHOWGROUP:function(n,t,i,r,u){if(u&&this.delegator){var f={syncHandler:r?this.showRowGroup:this.hideRowGroup,args:[n,t,i,!1],__self:this};this.delegator.triggerEvent("form.change",f)}},executeSimpleSearch:function(n){n.name="SIMPLE_SEARCH";this._ON_CLICK_CONTROL(n)},ON_KEYDOWN_ENTER:function(n,t,i){i&&!i.useAsyncFocusChange&&i.onNextFocus(n.cindex)}},create:function(){var n=$.extend({},this.prop);ecount.layout.form.horizon=$.Class(ecount.layout,n)}}};ecount.layout.form.vertical||(ecount.layout.form.vertical={});ecount.layout.form.vertical._export=function(){return{prop:{active:!1,onSync:!1,init:function(){ecount.layout.form.horizon.prototype.init.apply(this,arguments)},render:function(){ecount.layout.form.horizon.prototype.render.apply(this,arguments)},setTemplate:function(){var n="",i,t,r;this.colgroup?(n=this.colgroup[0].width,this.colgroup.length>1&&(t=this.colgroup[1].width)):ecount.config.companyForm&&ecount.config.companyForm.MULTICOL_SETTINGS&&(r=ecount.config.companyForm.MULTICOL_SETTINGS.find(function(n){return Number(n.COL_TYPE)==1}),n=parseInt(r.LABEL_WIDTH,10),this.pageType=="register"&&r.FILL_CHK_YN!=="1"&&(t=parseInt(r.INPUT_WIDTH,10),i=t+n,this.style=this.style?this.style+" width:"+i+"px;":" width:"+i+"px;",n=n-1));n="width:"+n+"px;";t=t?' style="width:'+t+'px;" ':"";this.template=ecount.widget.replaceAttr(ecount.layout.template["form-vertical-1"],{style:'style="width:'+i+'px;"',css:this.css})},setData:function(n){var n=$.isArray(n)?n:[n];this.addSingleControl(n);this.ecTransaction.complete(ecount.layout.form.horizon.prototype.onLoadComplete.bind(this));this.ecTransaction.start()},addSingleControl:function(n){for(var r=$("<tr>"),u=$("<tr>"),i,f,t=0,e=n.length;t<e;t++)r.append($("<th>").text(n[t].subTitle)),i=ecount.layout.form.horizon.prototype.createControl.call(this,n[t]),f=u.append($("<td>")),i.render($(f.find("td")[t])),this.itemList.push(i);this.$el.append(r);this.$el.find("tbody").append(u)}},create:function(){var n=$.extend({},this.prop);ecount.layout.form.vertical=$.Class(ecount.layout.form.horizon,n)}}};ecount.layout.form.table||(ecount.layout.form.table={});ecount.layout.form.table._export=function(){return{prop:{active:!1,onSync:!1,init:function(){ecount.layout.prototype.init.apply(this,arguments);this.rowspanIdx=0;this.headMergePoint=0;this.headerRowSpanIdx=0;this.mouseHoverInTime=ecount.common.mouseHoverInTime;this.ecTransaction=new ecount.transaction;this.template=ecount.layout.template["form-table"];this.emptyMsg=this.emptyMessage?this.emptyMessage:ecount.resource.MSG08908;this.emptyRowActive=!1;this.controlIdx=0;this.itemList=[];this.itemListByRow=[];this.rowListByControl=[];this.checkboxList=[];this.tableCheckboxCount=this.tableLength;this.lazyRenderList={};this.invalidControlList=[];this.dropDownLists={};this.dropdownLayerLists={};this.events=new ecount.events(this);this.events.on({"control.change":this._ON_CHANGE_CONTROL,"control.openPopup":this._ON_POPUP,"control.focusout":this._ON_MOVE_FOCUS,"control.showError":this._ON_SHOWERROR_CONTROL,"control.hideError":this._ON_HIDEERROR_CONTROL,"dateControl.display":this._ON_DISPLAY_DATECONTROL,"form.sync":this.onSyncHandler,"dualMode.addition":this._ON_DUAL_MODE_ADDITION,"dualMode.buttonDisplay":this._ON_DUAL_MODE_BUTTON_DISPLAY,"dualMode.setDualStep":this._ON_DUAL_MODE_SET_DUALSTEP,"dualMode.change":this._ON_CHANGE_DUAL_MODE,"dualMode.toggelDisplay":this._ON_DUAL_MODE_CONTROl_DISPLAY,"page.adjustHeaderSearchDimensions":this.ADJUST_HEADERSEARCH_DIMENSIONS,"page.showProgressbar":this.showProgressbar,"page.hideProgressbar":this.hideProgressbar,"control.openLayer":this._ON_LAYER,scope:this});this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer)},render:function(){this.setTemplate();ecount.layout.prototype.render.apply(this,arguments);this.setData(this.columnSet);!this.tableRowData||this.tableRowData.length||this.emptyRowActive||this.addEmptyRow(this.$el,this.emptyMsg);this.active&&this.$el.addClass("active")},destroy:function(){if(this.itemList)for(var n=this.itemList.length-1;n>=0;n--)this.itemList[n]._lazyRenderTarget&&(this.itemList[n]=null,delete this.itemList.splice(n));ecount.layout.prototype.destroy.call(this)},setTemplate:function(){var t=this.makeColGroup(),n;this.style=(this.style?this.style:"")+(this._useTableRowIndex?" width:"+this.totalWidth+"px; ":"");this.template=ecount.widget.replaceAttr(this.template,{style:this.style?'style="'+this.style+'"':"",css:this.css||"",colgroup:t,thead:this._useTableHeader?"<thead><\/thead>":""});n=$(this.template);this.useResizable&&(n.addClass("resizable"),this.template=$("<div><\/div>").append(n).html())},makeColGroup:function(){var t=parseInt(ecount.config.user.INPUT_WIDTH),u="",i,r,f,n;for(this.totalWidth=0,n=0;n<this.columnSet.length;n++)r="",t=this.getTdWidth(this.columnSet[n].width),this.columnSet[n].isHideColumn&&(r+="hide "),f=this.columnSet[n].useForm?"":this.columnSet[n].id,t?(this.totalWidth+=this.columnSet[n].isHideColumn?0:t,i='style="width:{{width}}px;"'.replace("{{width}}",t)):i="",u+='<col class="{{css}}" {{width}} columnId="{{columnId}}">'.replace("{{width}}",i).replace("{{css}}",r).replace("{{columnId}}",f);return u},getTdWidth:function(n){var t=!1;return this._useTableRowIndex||(t=ecount.config.user.INPUT_WIDTH),n?n:t},setData:function(n){var i,u,r,t;if(n){for(n=$.isArray(n)?n:[n],this.initializeRowdata(n),this._useTableHeader&&this.renderHeaderArea(),r=0;r<this.tableLength;r++){for(u=$("<tr><\/tr>"),this.rowListByControl=[],t=0;t<n.length;t++)i=this.initWidgetData(n,r,t),i.pIndex=this.controlIdx++,i.onSync=this.onSync,tdItem=this.addSingleControl(i,this.columnSet[t].align),u.append(tdItem);this.itemListByRow.push(this.rowListByControl);this.$el.find("tbody").append(u)}this.ecTransaction.complete(this.onLoadComplete.bind(this));this.ecTransaction.start()}},addDataRow:function(n,t,i){var f,o=$("<tr><\/tr>"),r=this.itemListByRow,s,e,u,h;if(elements=this.$el.find("tbody").children(),n){if(n=$.isArray(n)?n:[n],this.initializeRowdata(n),r.length)for(u=r.length;u>t;u--)for(s=0;s<this.columnSet.length;s++)r[u-1][s].rowIdxTable++;for(this.rowListByControl=[],e=0;e<n.length;e++)f=this.initWidgetData(n,t,e,i),f.ptargetIdx=this.controlIdx++,f.onSync=this.onSync,tdItem=this.addSingleControl(f,this.columnSet[e].align,null,!0),o.append(tdItem);if(r[f.rowIdxTable]?r.splice(f.rowIdxTable,0,this.rowListByControl):r.push(this.rowListByControl),elements.length)for(u=0;u<r.length;u++){if(h=r[u][0].rowIdxTable,t<h)elements.eq(t).before(o);else if(t>=h)if(h==r.length-1)elements.eq(t-1).after(o);else continue;continue}else this.$el.find("tbody").append(o)}},initWidgetData:function(n,t,i,r){for(var u={},e=["controlType","data","groupColCd","groupId","id","isResettableSubTitle","name","pairId","propertyName","subTitle","title","isHeaderStyle","_placeHolder","colEssentialYn","hasWrapperSet","noLabel"],f=0;f<e.length;f++)u[e[f]]=this.getDataFromColumn(n[i],e[f],t);return u.absoluteIdxTable=r?r:t,u.rowIdxTable=t,u.columnIdxTable=i,u},getDataFromColumn:function(n,t,i){var r=null,u;return n.useForm?r=n.formData[i][t]:$.isArray(n[t])?r=n[t][i]:n[t]!=undefined&&(r=n[t],(t=="id"||t=="name")&&(u=this.tableRowData&&this.tableRowData[i]&&this.tableRowData[i][t],r+="_"+(u?u:i.toString()))),r},initializeRowdata:function(n){for(var r=null,i=null,u=0,f=0,n=$.isArray(n)?n:[n],t=0,e=n.length;t<e;t++)if(n[t].groupId?r==null||n[t].groupId!=r?r=n[t].groupId:n[t].isGroupMember=!0:r&&(r=null),n[t].rowspan){if(this._rowspan||(this._rowspan={}),n[t].rowspan!=i&&i!==null){this._rowspan[u]=f++;u=t;i=n[t].rowspan;f=1;continue}i||(u=t,i=n[t].rowspan);f++}else i!==null&&(this._rowspan[u]=f,i=null,u=0,f=0)},addSingleControl:function(n,t,i,r){var e,h,f,o,u=this.createControl(n),y=u.subTitle||"",c=n.isHeaderStyle?"th":"td",v=this.columnSet[n.columnIdxTable].isHideColumn,l=this.columnSet[n.columnIdxTable].isLazyRender,s=v?"hide ":"",a=$("<div class='wrapper-toolbar"+(t=="center"?" text-center":" whole-row")+"'><\/div>");return t=="center"&&(s+="text-center "),t=="right"&&(s+="text-right "),f=this.columnSet[n.columnIdxTable].useForm?"":this.columnSet[n.columnIdxTable].id,h="<"+c+' class="'+s+'" data-label="'+(n.subTitle||"")+'" data-columnid="'+n.columnIdxTable+'" data-rowid="'+n.rowIdxTable+'" data-table-cid="'+u.id+'" columnId="'+f+'"><\/'+c+">",e=$(h),this._useTableHeaderCheckbox===n.columnIdxTable?(r?this.checkboxList.splice(n.rowIdxTable,0,u):this.checkboxList.push(u),o=e):(e.append(a),o=a),l&&(u._lazyRenderTarget=o,this.lazyRenderList[f]||(this.lazyRenderList[f]=[]),this.lazyRenderList[f].push(u)),!l&&u&&u.render(o),n.defaultValue&&u.restore(defaultValue),i?(this.itemList[u.pIndex]=u,this.itemListByRow[n.rowIdxTable][n.columnIdxTable]=u):(this.itemList.push(u),this.rowListByControl.push(u)),e},renderHeaderArea:function(){for(var t,r=$("<tr><\/tr>"),i,u,n=0;n<this.columnSet.length;n++)i="text-center ",this.columnSet[n].isHideColumn&&(i+="hide "),u=this.columnSet[n].useForm?"":this.columnSet[n].id,t=$('<th class="'+i+'" columnId="'+u+'">'+this.columnSet[n].title+"<\/th>"),this._useTableHeaderCheckbox===n&&this.makeTableCheckbox(t),r.append(t);this.$el.find("thead").append(r)},makeTableCheckbox:function(n){var i=this._isChecked?"checked":"",t=$('<span class="form-checkbox" data-cid="tableHeaderCheckbox'+this.id+'"><input type="checkbox" value='+this._tableCheckboxValue+' data-cid="tableHeaderCheckbox'+this.id+'" name="tableHeaderCheckbox'+this.id+'" data-index="0" id="tableHeaderCheckbox'+this.id+'" '+i+' ><label data-cid="tableHeaderCheckbox'+this.id+'" for="tableHeaderCheckbox'+this.id+'"><\/label><\/span>');n.append(t);t.find("input[type=checkbox]").on("change.table",this.checkboxHandler.bind(this))},checkboxHandler:function(n){for(var r=$(n.target).parent().find("input[type=checkbox]"),i=r.prop("checked"),t=0;t<this.checkboxList.length;t++)this.checkboxList[t].setCheckedValue([this._tableCheckboxValue],i),this.tableCheckboxCount=i?this.tableLength:0},refreshColumn:function(n){for(var u,i,f,r,t=0;t<this.tableLength;t++)i=this.initWidgetData(this.columnSet,t,n),u=this.$el.find("[data-columnid="+n+"][data-rowid="+t+"]"),f=this.getControl(u.attr("data-table-cid")),i.pIndex=f.pIndex,i.onSync=this.onSync,f.destroy(),u.remove(),n==0?(r=this.$el.find("[data-rowid="+t+"]").parent(),r.prepend(this.addSingleControl(i,this.columnSet[n].align,!0))):(r=this.$el.find("[data-columnid="+(Number(n)-1)+"][data-rowid="+t+"]"),r.after(this.addSingleControl(i,this.columnSet[n].align,!0)))},createControl:function(n){var t;if(this.initializer&&this.initializeByUserSetting(this.initializer,n),n.__pnode=this.__type,n.containerName=this.containerName,n.__type=widget.generator.CONTROL,n.pId=this.tabId,n.gridID="",n.tabID=this.tabId,n.panelID=this.panelID,n.onSync=this.onSync,n.delegator=this.events,n.inIncludePage=this.inIncludePage,n._useTableRowIndex=this._useTableRowIndex,n.originControlID=this.columnSet[n.columnIdxTable].id,this.settingItemDataRules(n),ecount.widget.createDisplayID(n,"btn",this.containerName),ecount.control.lazyLoad(n.controlType),t=ecount.common.createNamespace(n.controlType),!t)throw String.format("[ERROR][widget initialize] - '{0}' not defined. (name:{1}, subTitle:{2}, gridId:{3})",n.controlType,n.name,n.subTitle,n.gridID);return new t(n)},initializeByUserSetting:function(n,t){var i=widget.generator.control(),r;i.define(t.controlType,t.id,this.makeControlName(t),t.subTitle,t.groupId);t.formset&&i.setOptions({formset:t.formset});n(t.id,i,t.controlType,this.makeControlInfo(t));i=i.end();for(r in i)if(i[r]!==undefined){if(r==="data"&&i[r]&&i[r].length===0)continue;t[r]=r==="data"?i[r]&&i[r].where(function(n){return $.isEmpty(n.isFnData)||n.isFnData==!1}):i[r]}},makeControlName:function(n){return this._useTableRowIndex?this.columnSet[n.columnIdxTable].name:n.name},makeControlInfo:function(n){var t={};return this.tableRowData&&this.tableRowData[n.rowIdxTable]?this.tableRowData[n.rowIdxTable]:(t.columnId=this.columnSet[n.columnIdxTable].id,t.rowIdx=n.rowIdxTable,t)},settingItemDataRules:function(n){this._useTableRowIndex&&ecount.common.isTrue(n.colEssentialYn)?n.controlType.indexOf("widget.combine")==-1&&(n.dataRules=["required"]):n.colEssentialYn=null},getOrignID:function(n){return this.id=="all"?n:n.replace("_"+this.id,"")},getControl:function(n,t){return t!==undefined?this.getControlByIndex(t):this._getControl("id",n)},getControlByGroup:function(n){for(var t,r=[],i=0,u=this.itemList.length;i<u;i++)t=this.itemList[i],t.isGroupMember&&t.groupId==n&&r.push(t);return r},getControlByIndex:function(n){return this.itemList[n]},getControlByFindex:function(n){return this.itemList.head(function(t){return t.findex==n})},_getControl:function(n,t){for(var i=0,f=this.itemList.length,r,u;i<f;i++)if(r=this.itemList[i],t==r[n])return r;for(i--;i>-1;i--)if(r=this.itemList[i],r.controlType=="widget.custom"&&r.itemList&&(u=this._getControl.call(r,n,t),u))return u;return null},validate:function(n){for(var u=[],t=null,i=null,r=0,f=this.itemList.length;r<f;r++)i=this.itemList[r],t=i.validate.call(i,null,null,n),t.length>0&&u.push(t);return u},isActive:function(){return this.active},activate:function(){this.active=!0;this.$el.addClass("active")},deactivate:function(){this.active=!1;this.$el.removeClass("active")},isResizable:function(){return this.useResizable},reset:function(n){var t=this.getVisibleWidget();t.forEach(function(t){var i;n&&(i=n[t.id]);t.reset(i)})},redrawControl:function(n){this.itemList.forEach(function(t){t.reflowContainer&&t.reflowContainer();t.hasError()?n||t.showError():t.controlType=="widget.custom"&&t.showErrorOfItemList()})},serialize:function(){var n=this.getVisibleWidget(this.itemList);return ecount.widget.serialize(n)},serializeById:function(){var n=this.getVisibleWidget(this.itemList);return ecount.widget.serialize(n,!0)},serializeByRowIndex:function(n){var t=this.getVisibleWidget(this.itemListByRow[n]);return ecount.widget.serialize(t)},serializeByRow:function(n){var i=[],t;if(!$.isNull(n))return this.serializeByRowIndex(n);for(t=0;t<this.tableLength;t++)i.push(this.serializeByRowIndex(t));return i},getVisibleWidget:function(n){for(var r=[],t,i=0;i<n.length;i++)t=n[i],columnID=this.columnSet[t.columnIdxTable].id,t._lazyRenderTarget||this.isHideColumn(columnID)||r.push(t);return r},saveByColumn:function(n){return this.save(null,n)},save:function(n,t){for(var r,u=n?[]:{},o=n?function(t){u.push(n(t))}:function(n){u[n.key]=n.value},f=[],i=null,e=0;e<this.itemList.length;e++)r=this.itemList[e],t==undefined?f.push(r):r.columnIdxTable==t&&f.push(r);return $(f).each(function(n,t){i=t.save.call(t);i&&($.isArray(i)?$(i).each(function(n,t){t&&o(t)}):o(i))}),u},restore:function(n,t){var i,r;if(t)n.forEach(function(n){n=t(n);i=this.getControl(n.key);i&&i.restore(n.value)});else for(r in n)i=this.getControl(r),i&&i.restore(n[r])},extract:function(){return ecount.widget.extract(this.itemList)},hasInvalidControl:function(){return this.invalidControlList&&this.invalidControlList.length>0},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.redrawControl();this.showFormLayer&&this.setShowFormLayer();this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},setShowFormLayer:function(){var n=this.$el.closest(".wrapper-header-search");n.length>0?n.show():this.$el.parent().show()},onSyncHandler:function(n){this.onSync&&this.delegator&&this.delegator.triggerEvent("form.sync",n)},_ON_POPUP:function(n){this.delegator.triggerEvent("control.openPopup",n)},ADJUST_HEADERSEARCH_DIMENSIONS:function(n){this.delegator.triggerEvent("page.adjustHeaderSearchDimensions",n)},transferEvent:function(n){this.delegator.triggerEvent(n.type,n)},_ON_MOVE_FOCUS:function(n){for(var f=n.pcid||n.cid,r=0,t,i=0,u=this.itemList.length;i<u;i++){if(this.itemList[i].id==f){if(i==u-1){this.itemList[r].onFocusOut();break}if(t=this.itemList[i+1],t.preventOnFocusAtLastIndex){i==u-2&&this.itemList[r].onFocusOut();continue}if(t.isVisibleElement()&&!t.isReadOnly())return this.itemList[r].onFocusOut(),t.setFocus(0),!1;r--;f=t.id}r++}this.delegator.triggerEvent("form.focusout",{__self:this,type:"form.focusout",target:this.containerName,tabId:this.tabId,control:n})},_ON_SHOWERROR_CONTROL:function(n,t){var i=!1;for(k=0,len=this.invalidControlList.length;k<len;k++)if(n.cid==this.invalidControlList[k].cid){i=!0;break}i||(this.invalidControlList.push(n),!t&&this.delegator&&this.delegator.triggerEvent("control.changeValidate",{__self:this,control:n.instance,method:"control.showError",target:this.__target,tabId:this.tabId,invalidControlList:this.invalidControlList}))},_ON_HIDEERROR_CONTROL:function(n,t){for(k=0,len=this.invalidControlList.length;k<len;k++)if(n.cid==this.invalidControlList[k].cid){this.invalidControlList.splice(k,1);!t&&this.delegator&&this.delegator.triggerEvent("control.changeValidate",{__self:this,control:n.instance,method:"control.hideError",target:this.__target,tabId:this.tabId,invalidControlList:this.invalidControlList});break}},tableCheckboxChange:function(n){if(n.__self&&n.__self.columnIdxTable===this._useTableHeaderCheckbox){var t=n.__self.getCheckedValue();t.contains(this._tableCheckboxValue)?this.tableCheckboxCount++:t.length==0&&this.tableCheckboxCount--;this.$el.find("input#tableHeaderCheckbox").prop("checked",this.tableCheckboxCount==this.tableLength)}},getCheckedValues:function(){var n=[];return this.checkboxList.find(function(t,i){var r={};r[i]=this.checkboxList[i].id;t.getStandardValue()==!0&&n.push(r)},this),n},resetControlErrorStatus:function(){this.invalidControlList.length=0},getRealInsertIdx:function(n){var r,t=this.itemListByRow,i;return!t.length||t[t.length-1][0].absoluteIdxTable<=n?r=t.length:(i=t.map(function(n){return n[0].absoluteIdxTable}),i.push(n),i.sort(function(n,t){return n-t}),i.filter(function(t,i){t==n&&(r=i)})),r},addTableRowData:function(n,t){if(!this.tableRowData)return!1;this.tableRowData[n]?this.tableRowData.splice(n,0,t[0]):this.tableRowData.push(t[0])},insertWidgetToFormTable:function(n,t){if(!this.tableRowData)return!1;this.tableRowData.length||this.emptyRowActive?(this.emptyRowActive&&this.removeEmptyRow(this.$el),n&&(n=n-1,insertIdx=this.getRealInsertIdx(n),t&&this.addTableRowData(insertIdx,t.rowInfo),this.addDataRow(this.columnSet,insertIdx,n))):this.addEmptyRow(this.$el,this.emptyMsg)},deleteWidgetToFormTable:function(n){var r,i,s,t;if(!this.tableRowData)return!1;if($.isArray(n)&&n.length){for(r=0,i=0;i<n.length;i++)if(!$.isNull(n[i])){var u=Object.keys(n[i])[0],h=n[i][u],f=this.itemList,e=null,o=null;if($.each(f,function(n,t){t.id==h&&(e=n,o=t.rowIdxTable)}),!$.isNull(e)&&!$.isNull(o)){for(this.itemList[e].ecview.$el.parent().parent().remove(),t=0;t<this.columnSet.length;t++)this.itemList[e+t].destroy();for(foundObj=f.filter(function(n){return n.rowIdxTable===o}),foundObj.forEach(function(n){return f.splice(f.findIndex(function(t){return t.id===n.id}),1)}),this.itemListByRow.splice(u-r,1),this.checkboxList.splice(u-r,1),this.tableRowData.splice(u-r,1),s=o;s<this.itemListByRow.length;s++)for(t=0;t<this.columnSet.length;t++)this.itemListByRow[s][t].rowIdxTable--}r++}return!this.tableRowData||this.tableRowData.length||this.emptyRowActive||this.addEmptyRow(this.$el,this.emptyMsg),this}},addEmptyRow:function(n,t){var i=this.$el.find("col").length,r=$('<tr><td class="text-center" colspan="'+i+'" columnId="EMPTY_ROW_'+this.id+'">'+t+"<\/td><\/tr>");n.append(r);this.emptyRowActive=!0},removeEmptyRow:function(n){n.find("td[columnId ^= EMPTY_ROW_]").remove();this.emptyRowActive=!1},_ON_CHANGE_SHOWGROUP:function(n,t,i,r,u){if(u&&this.delegator){var f={syncHandler:r?this.showRowGroup:this.hideRowGroup,args:[n,t,i,!1],__self:this};this.delegator.triggerEvent("form.change",f)}},executeSimpleSearch:function(n){n.name="SIMPLE_SEARCH";this._ON_CLICK_CONTROL(n)},showColumn:function(n){var u,r=this.$el.find("col[columnId='"+n+"']"),t,i;if(this._useTableRowIndex&&r.hasClass("hide")){if(r.length==0)return!1;u=Number(r.css("width").replace("px",""));this.totalWidth+=u;this.$el.css("width",this.totalWidth+"px")}for($.isArray(this.lazyRenderList[n])&&this.lazyRenderList[n].forEach(function(n){n._lazyRenderTarget&&n.render(n._lazyRenderTarget);n._lazyRenderTarget=null}),this.$el.find("[columnId='"+n+"']").removeClass("hide"),t=0;t<this.tableLength;t++)i=this.getControl(n+"_"+t.toString()),i&&i.reflowContainer&&i.reflowContainer()},hideColumn:function(n){var i,t=this.$el.find("col[columnId='"+n+"']");if(this._useTableRowIndex&&!t.hasClass("hide")){if(t.length==0)return!1;i=Number(t.css("width").replace("px",""));this.totalWidth-=i;this.$el.css("width",this.totalWidth+"px")}this.$el.find("[columnId='"+n+"']").addClass("hide")},isHideColumn:function(n){this.$el.find("[columnId='"+n+"']").hasClass("hide")},addClassCell:function(n,t){var i=this.$el.find("[data-table-cid='"+n+"']");i&&i.addClass(t)},removeClassCell:function(n,t){var i=this.$el.find("[data-table-cid='"+n+"']");i&&i.removeClass(t)},_ON_CHANGE_CONTROL:function(n){(this.onSync&&this.delegator&&this.delegator.triggerEvent("form.sync",n),n.preventTriggerEvent)||(n.__self&&n.__self._useTableRowIndex&&(n.originID=n.__self.originControlID,n.rowIndex=n.__self.rowIdxTable,n.useTableRowIndex=!0),$.isNull(this._useTableHeaderCheckbox)||this.tableCheckboxChange(n),this.delegator.triggerEvent("control.change",n))},ON_FOCUSIN:function(n,t,i,r){r&&r.mode&&ecount.global.setTimeout(this.ecPageID,function(){var n=r.id,t=this.getIsDualClick(n);t==!1?(this._ON_DUAL_MODE_BUTTON_DISPLAY({id:n,isShow:!0}),this.setIsDualClick(n,!0)):(this._ON_DUAL_MODE_BUTTON_DISPLAY({id:n,isShow:!1}),this.setIsDualClick(n,!1))}.bind(this),100)},ON_KEYDOWN_ENTER:function(n,t,i){i&&!i.useAsyncFocusChange&&i.onNextFocus(n.cindex)},ON_CLICK:function(n,t,i,r){var i=r.__self||this.getControl(r.controlID||r.cid);i&&r.type=="dropdown.click"?r.rowIndex=i.rowIdxTable:i&&i._useTableRowIndex&&(r.rowIndex=i.rowIdxTable,r.useTableRowIndex=!0);this.delegator.triggerEvent(r.type,r)}},create:function(){var n=$.extend({},this.prop);ecount.layout.form.table=$.Class(ecount.layout,n)}}};ecount.layout.toolbar=function(n){return n._groups?(ecount.layout.toolbar.group._export&&(ecount.layout.toolbar.group._export().create(),ecount.layout.toolbar.group._export=null),new ecount.layout.toolbar.group(n)):n.remark?(ecount.layout.toolbar.remark._export&&(ecount.layout.toolbar.remark._export().create(),ecount.layout.toolbar.remark._export=null),new ecount.layout.toolbar.remark(n)):n.search?(ecount.layout.toolbar.search._export&&(ecount.layout.toolbar.search._export().create(),ecount.layout.toolbar.search._export=null),new ecount.layout.toolbar.search(n)):n.drag?(ecount.layout.toolbar.drag._export&&(ecount.layout.toolbar.drag._export().create(),ecount.layout.toolbar.drag._export=null),new ecount.layout.toolbar.drag(n)):n.report?(ecount.layout.toolbar.report._export&&(ecount.layout.toolbar.report._export().create(),ecount.layout.toolbar.report._export=null),new ecount.layout.toolbar.report(n)):(ecount.layout.toolbar.general._export&&(ecount.layout.toolbar.general._export().create(),ecount.layout.toolbar.general._export=null),new ecount.layout.toolbar.general(n))};ecount.layout.toolbar.general||(ecount.layout.toolbar.general={});ecount.layout.toolbar.general._export=function(){return{prop:{template:'<div class="wrapper-toolbar {{collapseToolbarCSS}} {{wholeRow}} {{customCss}}"><div class="pull-left"/><div class="pull-right"/><\/div>',collapseButtonTemplate:'<button class="btn btn-default btn-toolbar-more {{smallButton}}"><\/button>',collapseToolbarCSS:"",cssFloatRight:"pull-right",cssFloatLeft:"pull-left",css:"btn btn-default",customCss:"",prefix:"btn",ignorePrimaryButton:!1,itemCount:0,columns:null,isWholeRow:!1,init:function(n){var t=ecount.global.findViewBag(n.ecPageID);ecount.layout.prototype.init.apply(this,arguments);this._isUseCollapseButton=!!n._isUseCollapseButton;this._defaultFoldState=!!n._defaultFoldState;this._isCollapseSmallButton=!!n._isCollapseSmallButton;this.collapseToolbarCSS=this._isUseCollapseButton?"toolbar-collapse"+(this._defaultFoldState?"":" collapsed"):"";this.resizeCallBack=n.resizeCallBack;_.isNil(n.formStateSize)||(this.customCss=this.customCss+" form-state-imitate-width-"+n.formStateSize);this.useToolbarChangeObserve=n.useToolbarChangeObserve===!0;this.containerName=="header"&&this.notUseCollapseToolbarCSS!=!0&&(this.collapseToolbarCSS="header-search-btn-group");this.customToolbarCss&&(this.template='<div class="wrapper-toolbar '+this.customToolbarCss+' {{wholeRow}} {{customCss}}"><div class="pull-left"/><div class="pull-right"/><\/div>');this.columns?this.template='<div class="wrapper-toolbar '+this.collapseToolbarCSS+' {{css}}  {{wholeRow}} {{customCss}}"><div class="row"><\/div><\/div>':this.attachList&&(this.template='<div class="wrapper-toolbar '+this.collapseToolbarCSS+' {{css}}  {{wholeRow}} {{customCss}}"><\/div>');this.useFormSetting&&(this.cssToolbar+=" wrapper-table-template-setup-preview-btn overlay");this.controls={};this.itemList=[];this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,scope:this})},render:function(n){(this.template=ecount.widget.replaceAttr(this.template,{customCss:this.customCss,collapseToolbarCSS:this.collapseToolbarCSS,wholeRow:this.isWholeRow?"whole-row":"",css:this.cssToolbar||""}),this.parentWidth=n.width(),ecount.layout.prototype.render.apply(this,arguments),this._isShow=this.hidden===!0?!1:this._isShow,this.itemList.length>0&&!_.isFunction(this.itemList[0].end))||(this.itemLeft&&this.add(this.itemLeft),this.itemRight&&this.add(this.itemRight,!0),this.attachList&&this.attachControl(this.attachList),this.ecTransaction.start(),this._width&&this.$el.css("width",this._width),this._maxWidth&&this.$el.css("maxWidth",this._maxWidth),this._isUseCollapseButton&&(this.renderCollapseButton(n),ecount.control.registerLazyRender(this,function(){this.reflowContainer();ecount.runtime.observe("resize",this.ecPageID,this.reflowContainer.bind(this))})),this.resizeCallBack&&ecount.control.registerLazyRender(this,function(){this.resizeCallBack();ecount.runtime.observe("resize",this.ecPageID,this.resizeCallBack)}))},renderCollapseButton:function(){var n=this.$el.find("."+this.cssFloatRight);this._isCollapseSmallButton&&(this.collapseButtonTemplate=ecount.widget.replaceAttr(this.collapseButtonTemplate,{smallButton:"btn-sm"}));this.$collapseButton=$(this.collapseButtonTemplate);this.$collapseButton.on("click",this.onCollapseClickHandle.bind(this));n.append(this.$collapseButton)},onCollapseClickHandle:function(){this.toggleUpDown();this.reflowContainer();this.useToolbarChangeObserve&&this.triggerToolbarChange({changeType:"collapse"})},toggleUpDown:function(n){var t=this.$el;n===!0?t.addClass("collapsed"):n===!1?t.removeClass("collapsed"):t.hasClass("collapsed")?t.removeClass("collapsed"):t.addClass("collapsed")},redrawControl:function(){},reflowContainer:function(){function f(n){return n*2<=this.$el[0].clientHeight}var e,o,i,s,u,r,n,t,h;if(!(this.$el&&this.$el.length>0&&this.$el[0].scrollHeight>0)||!this._isUseCollapseButton||this.itemList.length==0){this.$collapseButton&&this.$collapseButton.addClass("hidden");return}for(u=this.itemList.find(function(n){return n.controlType=="widget.keyHelper"}),u&&u.hideDropdown(),n=0;n<this.itemList.length;n++)this.itemList[n].isVisibleElement()&&(_.isEmpty(i)||i&&i.getContainerBoundary().height<this.itemList[n].getContainerBoundary().height)&&(i=this.itemList[n]);if(!i){this.$collapseButton&&this.$collapseButton.addClass("hidden");return}if(e=this.$el,o=!e.hasClass("collapsed"),s=Math.ceil(i.getContainerBoundary().height),o){for(n=0;n<this.itemList.length;n++){if(r=this.itemList[n].getContainerBoundary().height,this.itemList[n].isVisible()&&f.call(this,r))break;t=this.itemList[n];!t.isVisible()&&t.getToggledByToolbar()&&(t.setToggledByToolbar(!1),t.show())}for(n=this.itemList.length-1;n>=0;n--){if(r=this.itemList[n].getContainerBoundary().height,this.itemList[n].isVisible()&&r>0&&!f.call(this,r))break;t=this.itemList[n];t.isVisible()&&r>0&&(t.setToggledByToolbar(!0),t.hide())}}else for(n=0;n<this.itemList.length;n++)t=this.itemList[n],!t.isVisible()&&t.getToggledByToolbar()&&(t.setToggledByToolbar(!1),t.show());h=!!this.itemList.find(function(n){return n.getToggledByToolbar()});f.call(this,s)||h?this.$collapseButton.removeClass("hidden"):this.$collapseButton.addClass("hidden")},setWidth:function(n){n||(n="");this._width=n;this.$el.css("width",n)},setMaxWidth:function(n){this._maxWidth=n;this.$el.css("maxWidth",n)},destroy:function(){ecount.layout.prototype.destroy.call(this)},addLeft:function(n){var t=this.add($.isArray(n)?n:[n]);this.itemList=this.itemList.concat(t)},addRight:function(n){var t=this.add($.isArray(n)?n:[n],!0);this.itemList=this.itemList.concat(t)},add:function(n,t){for(var f=t?this.$el.find("."+this.cssFloatRight):this.$el.find("."+this.cssFloatLeft),i,u=[],e=this._primIndex||0,n=$.isArray(n)?n:[n],r=0,o=n.length;r<o;r++)i=n[r],i.__direction=t==!0?"right":"left",i.controlType==="widget.button"||i.controlType==="widget.button.otherSlip"?((i.css===null||i.css===undefined)&&(i.css=this.css),this.ignorePrimaryButton||t||r!=e||(i.css=i.css.replace("default","primary"))):i.controlType==="widget.button.approval"&&(i.isPrimary=r==0?!0:!1),u.push(this.addItem(i,f));return u},addItem:function(n,t,i){var e,u,s=null,r=$.extend({},n),f,o;if(this.initializer){u=widget.generator.control();u.define(r.controlType,r.id,r.name,r.subTitle,r.groupId);this.initializer(r.id,u);u=u.end();for(f in u)f==="data"&&u[f]&&u[f].length===0||(r[f]=u[f])}if(r.__type===widget.generator.CONTROL){s=ecount.common.createNamespace(r.controlType);r.id||(r.id=ecount.common.uuid(r.controlType));switch(r.controlType){case"widget.searchGroup":this.isWholeRow=!0;this.$el.addClass("whole-row")}}return r.containerName=this.containerName,r.__pnode=this.__type,r.delegator=this.delegator,r.ecTransaction=this.ecTransaction,r.containerDelegator=this.events,r.ecPageID=this.ecPageID,r.pId=this.tabId,r.tabId=this.tabId,e=new s(r),i?(o=$('<div class="col-xs-'+i.column+'"><\/div>'),e.render(o),t.find(".row").append(o)):e.render(t),e},attachControl:function(n){for(var i,r=this.$el,t=0,u=n.length;t<u;t++)i=this.columns?this.columns[t]:undefined,this.addItem(n[t],r,i)},cID:function(n){return[this.prefix||"btn",this.containerName,n].join("-")},remove:function(){this.removeControl("__all__")},removeControl:function(n){var t=this;t.itemList&&t.itemList.forEach(function(t,i){if(n==="__all__")t.destroy(),t=null;else if(n==t.id){t.destroy();this.splice(i,1);t=null;return}});n==="__all__"&&(t.itemList=[])},getControl:function(n){for(var t,i,r=0,u=this.itemList.length;r<u;r++)if(t=this.itemList[r],t){if(t.id==this.cID(n)||t.id==n)return t;if(t.controlType=="widget.button.formStyleLayer"&&(i=t.get(n),i))return i}return null},getControlByIndex:function(n){return this.itemList[n]},getControls:function(){return this.itemList},setFocus:function(){},rearrange:function(n,t){this.remove();this.add(n);this.add(t,!0)},show:function(){ecount.layout.prototype.show.apply(this,arguments);this._isUseCollapseButton&&this.reflowContainer();this.useToolbarChangeObserve&&this.triggerToolbarChange({id:this.id,__type:"toolbar",changeType:"show"})},hide:function(){ecount.layout.prototype.hide.apply(this,arguments);this.useToolbarChangeObserve&&this.triggerToolbarChange({id:this.id,__type:"toolbar",changeType:"hide"})},isShow:function(){return this._isShow},hideAll:function(){this.itemList.forEach(function(n){n.hide()})},onLoadItem:function(n){var t=n.__self;t.$el&&t.$el.after(" ");this.itemList.push(t)},onLoadComplete:function(){var n={target:this.containerName,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},triggerToolbarChange:function(n){this.delegator&&this.delegator.triggerEvent("page.customPageInvoke",_.merge({commandName:"onLayoutToolbarChange"},n))}},create:function(){var n=$.extend({},this.prop);ecount.layout.toolbar.general=$.Class(ecount.layout,n)}}};ecount.layout.toolbar.drag||(ecount.layout.toolbar.drag={});ecount.layout.toolbar.drag._export=function(){return{prop:{template:'<div class="wrapper-toolbar {{collapseToolbarCSS}} {{wholeRow}} {{customCss}}" data-draggable-place="{{draggablePlace}}"><div class="pull-left"/><div class="pull-right"/><\/div>',collapseToolbarCSS:"",cssFloatRight:"pull-right",cssFloatLeft:"pull-left",css:"btn btn-default",customCss:"",prefix:"btn",isWholeRow:!1,init:function(){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,scope:this})},render:function(n){(this.cssToolbar&&(this.template=ecount.widget.replaceAttr(this.template,{css:this.cssToolbar})),this.template=ecount.widget.replaceAttr(this.template,{customCss:this.customCss,collapseToolbarCSS:this.collapseToolbarCSS,wholeRow:this.isWholeRow?"whole-row":"",draggablePlace:this.draggablePlace?"toolbar"+ecount.delimiter+this.id:""}),this.parentWidth=n.width(),ecount.layout.prototype.render.apply(this,arguments),this.itemList.length>0&&!_.isFunction(this.itemList[0].end))||(this.itemLeft&&this.add(this.itemLeft),this.ecTransaction.start(),this._width&&this.$el.css("width",this._width))},destroy:function(){ecount.layout.prototype.destroy.call(this)},addLeft:function(n){var t=this.add($.isArray(n)?n:[n]);this.itemList=this.itemList.concat(t)},add:function(n,t){for(var f=t?this.$el.find("."+this.cssFloatRight):this.$el.find("."+this.cssFloatLeft),i,u=[],o=this._primIndex||0,n=$.isArray(n)?n:[n],r=0,e=n.length;r<e;r++)i=n[r],(i.controlType==="widget.button"||i.controlType==="widget.button.otherSlip")&&(i.css===null||i.css===undefined)&&(i.css=this.css),u.push(this.addItem(i,f));return u},addItem:function(n,t){var u=null,f=null,i=$.extend({},n),r;if(this.initializer){userSettings=widget.generator.control();userSettings.define(i.controlType,i.id,i.name,i.subTitle,i.groupId);this.initializer(i.id,userSettings);userSettings=userSettings.end();for(r in userSettings)r==="data"&&userSettings[r]&&userSettings[r].length===0||(i[r]=userSettings[r])}return i.__type===widget.generator.CONTROL&&(f=ecount.common.createNamespace(i.controlType),i.id||(i.id=ecount.common.uuid(i.controlType))),i.containerName=this.containerName,i.__pnode=this.__type,i.delegator=this.delegator,i.ecTransaction=this.ecTransaction,i.containerDelegator=this.events,i.ecPageID=this.ecPageID,i.pId=this.tabId,i.tabId=this.tabId,u=new f(i),u.render(t),u},cID:function(n){return[this.prefix||"btn",this.containerName,n].join("-")},setChangePosition:function(n){var i=this.getControl(n.startTargetID),r=n.position.split("insert").join("").toLowerCase(),u=this.getTargetIndex(i.id),t=this.getTargetIndex(n.targetID),f;r==="before"&&t!==0&&(t-=1);u>-1&&(f=this.itemList.splice(u,1));t>-1&&this.itemList.splice(t,0,f[0]);_.isNull(i)||this.$el.find(n.target)[r](i.getContainerElement())},addItemList:function(n,t){var i=this.createControl(n,t.selectedContainerID),r=t.position.split("insert").join("").toLowerCase(),f=r==="after"?1:0,u=this.getTargetIndex(t.targetID)+f;u>-1&&!_.isNull(i)&&(this.itemList.splice(u,0,i[0]),this.itemList.pop(),this.$el.find(t.target).length>0?this.$el.find(t.target)[r](i[0].getContainerElement()):this.$el.find(this.getControl(t.targetID).ecview.$el[0])[r](i[0].getContainerElement()))},addControl:function(n,t){var i=t.target.attr("id"),f=t.target.attr("data-ecpath").split(ecount.separator.ecPath)[5],r=this.getControl(i==="buttonAddArea"?f:i),u=r.id,n=r.addComponent(n,t);u&&this.reDrawControl(u)},removeControl:function(n){var e=n.selectedContainerID,r=n.startTargetID,t=this.getControl(r),i={},u,f;if(!_.isNull(t))return i.dropdownOptions=t.dropdownOptions,e==="enabled"||t.id!==r?i.dragButtons=t.removeComponent(r):(i.dragButtons=t.getDragButtons(),t.destroy(),t.setDragButtons([])),i.dragButtons.forEach(function(n){n.isSingle=t.isSingle;n.isPrimary=t.isPrimary;n.isSendNotice=t.isSendNotice;n.isFlag=t.isFlag;n.isCheck=t.isCheck}),t.getDragButtons().length===0?(u=this.getTargetIndex(r),this.itemList.splice(u,1)):(f=t.getComponent(0).id,this.reDrawControl(f)),i},reDrawControl:function(n){var t=null,i=-1,r;this.itemList.forEach(function(r,u){r.id===n&&(t=r,i=u)});t&&(r=this.createControl({dragButtons:t.getDragButtons(),dropdownOptions:t.dropdownOptions}),i>-1&&(this.itemList.splice(i,1,r[0]),this.itemList.pop()),t.getContainerElement().replaceWith(r[0].getContainerElement()))},createControl:function(n,t){var r,o,u,s;if(n)for(r=n.dragButtons,o=n.dropdownOptions,u=0,s=r.length;u<s;u++){var i=r[u],f=i.id,h=widget.generator.control(),e=h.define("widget.button.dragButton",f,f,f);if(t==="disabled"){if(i.isDelete)continue;e.addDragButtons([{id:f,label:i.label,defaultLabel:i.defaultLabel,labelData:i.labelData}]).setOptions({isSingle:i.isSingle===!0?"only":"dink",isPrimary:i.isPrimary?i.isPrimary:!1,isSendNotice:i.isSendNotice?i.isSendNotice:!1,isFlag:i.isFlag?i.isFlag:!1,isCheck:i.isCheck?i.isCheck:!1}).addGroup(o);this.add(e.end())}else return e.addDragButtons(r).setOptions({isSingle:i.isSingle===!0||i.isSingle==="only"?!0:!1,isPrimary:i.isPrimary?i.isPrimary:!1,isSendNotice:i.isSendNotice?i.isSendNotice:!1,isFlag:i.isFlag?i.isFlag:!1,isCheck:i.isCheck?i.isCheck:!1}).addGroup(o),this.add(e.end())}return null},getTargetIndex:function(n){var t=-1;return this.itemList.forEach(function(i,r){i.id===n&&(t=r)}),t},getItemList:function(n){return n?this.itemList[n]:this.itemList},setItemList:function(n){this.itemList=n},getControl:function(n){for(var t,r,u,o,f,i=0,e=this.itemList.length;i<e;i++)if(t=this.itemList[i],r=t.getComponents(),t&&r){if(t.id===n)return t;for(u=0,o=r.length;u<o;u++)if(f=r[u],f.id==this.cID(n)||f.id==n)return t}return null},serialize:function(){return this.itemList.map(function(n){return ecount.widget.serialize(n)[n.cid]}.bind(this))},serializeById:function(){return ecount.widget.serialize(this.itemList,!0)},onLoadItem:function(n){var t=n.__self;t.$el&&t.$el.after(" ");this.itemList.push(t)},onLoadComplete:function(){var n={target:this.containerName,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)}},create:function(){var n=$.extend({},this.prop);ecount.layout.toolbar.drag=$.Class(ecount.layout,n)}}};ecount.layout.toolbar.group||(ecount.layout.toolbar.group={});ecount.layout.toolbar.group._export=function(){return{prop:{template:'<div class="wrapper-toolbar"><\/div>',templateItem:'<div class="inline-group"><\/div>',_groups:null,prefix:"ectoolbar-",init:function(){ecount.layout.toolbar.general.prototype.init.apply(this,arguments);this.delegator.register("control.change",this,this.onChangeHandler,!0)},render:function(){ecount.layout.toolbar.general.prototype.render.apply(this,arguments);this._groups&&this.addGroups(this._groups)},addGroups:function(n){for(var t,r,i,f,e,s=function(){},u=0,o=n.length;u<o;u++){for(t=n[u],r=$(this.templateItem),r.attr("id",this.prefix+t.key),i=0,f=t.members.length;i<f;i++)e=t.members[i],t.members[i]=this.addItem(e,r),this.itemList.push(t.members[i]);t.display||r.hide();this.$el.append(r)}},findGroup:function(n){for(var t=0,i=this._groups.length;t<i;t++)if(this._groups[t].key===n)return this._groups[t];return null},toggleGroup:function(n){var t=this.findGroup(n);t&&(t.display?this.hideGroup(n):this.showGroup(n))},showGroup:function(n,t){var i=this.findGroup(n);i&&(i.display=!0,this.$el.find("#"+this.prefix+n).show());t&&this.showMembers(n)},hideGroup:function(n,t){var i=this.findGroup(n);i&&(i.display=!1,this.$el.find("#"+this.prefix+n).hide());t&&this.hideMembers(n)},showMembers:function(n,t){this._setDisplay(n,!0,ecount.control.prototype.show,t)},hideMembers:function(n,t){this._setDisplay(n,!1,ecount.control.prototype.hide,t)},_setDisplay:function(n,t,i,r){var u=this.findGroup(n),f,e;r!==undefined?(r=$.isArray(r)?r:[r],f=typeof r[0]=="string"):r=[];u.members&&(e=u.hasKeyControl,u.members.forEach(function(n,t){n.__GROUP_KEY||(r.length==0?i.call(n):f?r.contains(n.id)&&i.call(n):r.contains(e?t-1:t)&&i.call(n))}))},addMember:function(){},removeMember:function(){},onChangeHandler:function(n){var t=n.__self;t.__GROUP_KEY&&(n.value?this.showMembers(t.__GROUP_KEY):this.hideMembers(t.__GROUP_KEY))}},create:function(){var n=$.extend({},this.prop);ecount.layout.toolbar.group=$.Class(ecount.layout,n)}}};ecount.layout.toolbar.remark||(ecount.layout.toolbar.remark={});ecount.layout.toolbar.remark._export=function(){return{prop:{template:'<div class="wrapper-toolbar text-remark {{css}}">{{remark}}<\/div>',init:function(){ecount.layout.prototype.init.apply(this,arguments)},render:function(){this.template=ecount.widget.replaceAttr(this.template,this);ecount.layout.prototype.render.apply(this,arguments)},destroy:function(){ecount.layout.prototype.destroy.call(this)}},create:function(){var n=$.extend({},this.prop);ecount.layout.toolbar.remark=$.Class(ecount.layout,n)}}};ecount.layout.toolbar.search||(ecount.layout.toolbar.search={});ecount.layout.toolbar.search._export=function(){return{prop:{template:'<div class="wrapper-toolbar {{collapseToolbarCSS}}">\n<div class="pull-left">\n<div class="control-set" />\n<\/div>\n<div class="pull-right"/>\n<\/div>',collapseButtonTemplate:'<button class="btn btn-sm btn-default btn-header-search-btn-more"><\/button>',searchItem:[],collapseToolbarCSS:"",cssFloatRight:"pull-right",cssFloatLeft:".pull-left",css:"btn btn-default btn-sm",cssCollapseButton:".btn-header-search-btn-more",cssControlContainer:".control-set",prefix:"btn",itemType:null,itemNames:["formList","search","multiSearch","save","simpleSearch","rewrite"],ignorePrimaryButton:!1,toolbarType:"header.search",init:function(n){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.customItemList=n.itemLeft;this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"button.click":this.transferEvent,"anchor.click":this.transferEvent,"control.change":this.transferEvent,"form.simpleSearch":this.transferEvent,middleTransfer:this.transferEvent,"dropdown.click":this.transferEvent,scope:this})},render:function(n){var i=this.itemType=="pageCustom",t;if(this.containerName=="header"&&n.hasClass("wrapper-header-search")&&(this.collapseToolbarCSS="header-search-btn-group"),this.template=ecount.widget.replaceAttr(this.template,{collapseToolbarCSS:this.collapseToolbarCSS}),ecount.layout.prototype.render.apply(this,arguments),$.isArray(this.itemType)?(this.itemNames=this.itemType,this.itemType="custom"):this.itemNames=this.itemType=="status"?["formList","search","multiSearch","save","simpleSearch","rewrite"]:this.itemType=="list"?["search","multiSearch","save","simpleSearch","rewrite"]:i?[]:["formList","search","multiSearch","save","simpleSearch","rewrite"],this._appendOption&&this._appendOption.deleteButtonList)for($.isArray(this._appendOption.deleteButtonList)||(this._appendOption.deleteButtonList=[this._appendOption.deleteButtonList]),t=this.itemNames.length-1;t>=0;t--)this._appendOption.deleteButtonList.contains(this.itemNames[t])&&this.itemNames.splice(t,1);this.customItemList.length>0&&i?this.addCustom():this.add();this.renderCollapseButton(n);this.ecTransaction.start();ecount.control.registerLazyRender(this,function(){this.toggleUpDown();this.reflowContainer();ecount.runtime.observe("resize",this.ecPageID,this.reflowContainer.bind(this))})},transferEvent:function(n){if(this.delegator){switch(n.cid){case"search":case"rewrite":case"excel":case"save":n.targetID=this.getCId(n.cid);break;case"simpleSearch":n.originTargetID=this.getCId("search")}this.delegator.triggerEvent(n.type,n)}},getCId:function(n){return"on-"+this.containerName+"-"+n},toggleUpDown:function(){var n=this.$collapseButton;n.hasClass("collapsed")?n.removeClass("collapsed"):n.addClass("collapsed")},add:function(){for(var t,n=0;n<this.itemNames.length;n++)if(!$.isNull(this.itemOptions)||this.itemNames[n]!="formList"){t=widget.generator.control();switch(this.itemNames[n]){case"formList":t.define("widget.select",this.itemNames[n],this.itemNames[n]);$.isNull(this.itemOptions.option)?t.readOnly(!0):t.option(this.itemOptions.option).select(this.itemOptions.select);break;case"multiSearch":t.define("widget.button.group",this.itemNames[n],this.itemNames[n]).css("btn btn-sm btn-primary").hide().label(ecount.resource.BTN00113).addGroup([{id:"ModifySave",label:ecount.resource.BTN00832}]).hide();break;case"search":t.define("widget.button",this.itemNames[n],this.itemNames[n]).css(this.css.replace(/btn-default/g,"btn-primary")).label(ecount.resource.BTN00113);break;case"simpleSearch":t.define("widget.button.simpleSearch",this.itemNames[n],this.itemNames[n]).setOptions({simpleSearch:!0,isUseButtonType:!0}).setSearchList(["today","yesterday","week","lastWeek","month","lastMonth","endDay"]);break;case"rewrite":t.define("widget.button",this.itemNames[n],this.itemNames[n]).label(ecount.resource.BTN00007).css(this.css);break;case"save":t.define("widget.button",this.itemNames[n],this.itemNames[n]).css("btn btn-sm btn-primary").label(ecount.resource.BTN00833).hide();break;case"excel":t.define("widget.button",this.itemNames[n],this.itemNames[n]).label(ecount.resource.BTN00079).css(this.css).permission([ecount.config.user.USE_EXCEL_CONVERT,String.format("{0}{1}- {2}",ecount.resource.MSG00141,"\r\n",ecount.resource.LBL07436)]);break;case"searchFormApply":t.define("widget.button",this.itemNames[n],this.itemNames[n]).css("btn btn-sm btn-primary").label(ecount.resource.BTN00070)}this.addItem(this.itemNames[n],t)}},addCustom:function(){for(var n,i,t=0;t<this.customItemList.length;t++)n=this.customItemList[t],n.end&&(n=n.end()),i=n.id,this.itemNames.push(i),this.addItem(i,n)},addItem:function(n,t){var r=null,u=null,i;if(this.initializer){t.end&&(t=t.end());userSettings=widget.generator.control();userSettings.define(t.controlType,t.id,t.name,t.subTitle,t.groupId);this.initializer(t.id,userSettings);userSettings=userSettings.end();for(i in userSettings)i==="data"&&userSettings[i]&&userSettings[i].length===0||(t[i]=userSettings[i])}if(t.__type===widget.generator.CONTROL){u=ecount.common.createNamespace(t.controlType);t.id||(t.id=ecount.common.uuid(t.controlType));switch(t.controlType){case"widget.select":t.css="btn btn-default btn-selectbox btn-group-select-inline btn-sm";break;case"widget.input":t.css="form-control textbox-inline"}}t.useWrapperSet=!1;t.containerName=this.containerName;t.__pnode=this.__type;t.delegator=this.events;t.ecTransaction=this.ecTransaction;t.ecPageID=this.ecPageID;r=new u(t);this.itemList.push(r);r.render(this.$el.find(this.cssControlContainer));r.$el&&r.$el.after(" ")},setWidth:function(n){n||(n="");this._width=n;this.$el.css("width",n)},setMaxWidth:function(n){this._maxWidth=n;this.$el.css("maxWidth",n)},destroy:function(){ecount.layout.prototype.destroy.call(this)},renderCollapseButton:function(){var t=this.$el.find("."+this.cssFloatRight),n;this.$collapseButton=$(this.collapseButtonTemplate);this.$collapseButton.on("click",this.onCollapseClickHandle.bind(this));t.append(this.$collapseButton);n=this.$collapseButton;n.hasClass("collapsed")||n.addClass("collapsed")},redrawControl:function(){this.reflowContainer()},reflowContainer:function(){for(var u,o=this.itemList.filter(function(n){return n.isVisible()})[0],s=o.getContainerBoundary().zoomedHeight,i=this.$el.find(this.cssControlContainer),r=i.children().not(".hidden").eq(0).outerHeight(!0)+this.$el.css("padding").split("px")[0]*2,f=!1,e,t,n=this.itemList.length-1;n>=0;n--)if(this.itemList[n].controlType=="widget.button.simpleSearch"){t=this.itemList[n];break}if(t)if(u=t.getComponentSize(),this.$collapseButton.hasClass("hidden")&&i.height()>r&&this.$collapseButton.removeClass("hidden"),this.$collapseButton.hasClass("collapsed")!=!0){for(n=0;n<u;n++){if(i.height()>=r)break;t.showByReflow(n)}for(n=u-1;n>=0;n--){if(i.height()<=r)break;t.setState(ecount.constValue.CONTROL_UPDATE_IT_SELF,"opt.toggledByToolbar",!0);t.hideByReflow(n);f=!0}}else for(n=0,e=u;n<e;n++)!t.isVisible(n)&&t.isToggledByToolbar()&&t.toggleByToolbar(!0);this.$collapseButton.hasClass("collapsed")!=!0||i.height()>r||f!=!1||this.$collapseButton.hasClass("hidden")||this.$collapseButton.addClass("hidden");this.currentMode==2&&this.$collapseButton.addClass("hidden");this.delegator&&this.delegator.triggerEvent("page.adjustHeaderSearchDimensions")},onCollapseClickHandle:function(){this.toggleUpDown();this.reflowContainer()},onLoadComplete:function(){var n={target:this.containerName,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},getControl:function(n){return typeof n=="string"?this.itemList.find(function(t){return t.id==n}):this.itemList[i]},hideControl:function(n){for(var t=0;t<n.lenght;t++)this.getControl(n[t]).addClass("hidden")},showControl:function(n){for(var t=0;t<n.lenght;t++)this.getControl(n[t]).addClass("hidden")},setFormsetList:function(n){var t=this.getControl("formList");t&&(t.removeOption(),t.addOption(n,!0))},changeMode:function(n){this.currentMode!=n&&(this.currentMode=n,n==1||n==3?(n==1?(this.getControl("search")&&this.getControl("search").show(),this.getControl("multiSearch")&&this.getControl("multiSearch").hide()):(this.getControl("search")&&this.getControl("search").hide(),this.getControl("multiSearch")&&this.getControl("multiSearch").show()),this.getControl("rewrite")&&this.getControl("rewrite").show(),this.getControl("simpleSearch")&&this.getControl("simpleSearch").show(),this.getControl("save")&&this.getControl("save").hide()):n==2&&(this.getControl("save")&&this.getControl("save").show(),this.getControl("simpleSearch")&&this.getControl("simpleSearch").hide(),this.getControl("rewrite")&&this.getControl("rewrite").hide(),this.getControl("search")&&this.getControl("search").hide(),this.getControl("multiSearch")&&this.getControl("multiSearch").hide(),this.$collapseButton.addClass("hidden")))},ON_CLICK:function(n,t,i,r){switch(r.cid){case"search":case"rewrite":case"excel":case"save":r.targetID=this.getCId(r.cid);break;case"simpleSearch":r.searchCommand=["on",this.containerName,"search"].join("_").ecCamelize(!0)}}},create:function(){var n=$.extend({},this.prop);ecount.layout.toolbar.search=$.Class(ecount.layout,n)}}};ecount.layout.toolbar.report||(ecount.layout.toolbar.report={});ecount.layout.toolbar.report._export=function(){return{prop:{template:'<div class="wrapper-report-toolbar" {{style}}>\n<\/div>',titleTemplate:'<div class="category-header"><div class="category-title">{{name}}<\/div><\/div>',groupList:["actionGroup","insertGroup","fontGroup","formGroup","layoutGroup"],init:function(n){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.setTemplate(n);this.events=new ecount.events(this);this.events.on({"button.click":this.transferEvent,"anchor.click":this.transferEvent,"control.change":this.transferEvent,"control.select":this.transferEvent,middleTransfer:this.transferEvent,"dropdown.click":this.transferEvent,"dropdown.focusin":this.transferEvent,"dropdown.focusout":this.transferEvent,"dropdown.keydown":this.transferEvent,"image.upload":this.transferEvent,"image.uploadComplete":this.transferEvent,"control.openPopup":this.transferEvent,scope:this})},setTemplate:function(n){this.template=ecount.widget.replaceAttr(this.template,{style:ecount.convertor.convertToStyle(n.style)})},render:function(){ecount.layout.prototype.render.apply(this,arguments);this.itemLeft&&this.add(this.itemLeft);this.ecTransaction.start()},transferEvent:function(n){switch(n.type){case"button.click":case"dropdown.click":if(!n.key)break;n.command="onReportToolbar";break;case"image.upload":case"dropdown.focusin":case"dropdown.focusout":case"dropdown.keydown":if(!n.key)break;n.command="onReportToolbar";n.type="report.toolbar";this.delegator.triggerEvent("report.toolbar",n);n.command=null;break;case"image.uploadComplete":n.key="imageComplete";n.command="onReportToolbar";n.type="report.toolbar";this.delegator.triggerEvent("report.toolbar",n);n.command=null;break;case"control.change":n.key=n.cid;n.command="onReportToolbar";n.type="report.toolbar";this.delegator.triggerEvent("report.toolbar",n);n.command=null;break;case"control.openPopup":this.delegator.triggerEvent(n.type,n);n.command=null;break;case"control.select":n.key=n.cid;n.command="onReportToolbar";this.delegator.triggerEvent(n.type,n);n.command=null}},getCId:function(n){return"on-"+this.containerName+"-"+n},add:function(n){for(var t,u,r=[],i=0;i<n.length;i++)t=n[i],this.$el.append('<div class="report-category" report-id="'+t.id+'"><\/div>'),t.title&&(u=this.titleTemplate.replace("{{name}}",t.title),this.$el.find('div[report-id="'+t.id+'"]').append(u)),t.headerControl&&r.push(this.addItem(t.id,t.headerControl,!0)),r.push(this.addItem(t.id,t.control))},addItem:function(n,t,i){var u=null,f=null,r;if(this.initializer){t.end&&(t=t.end());userSettings=widget.generator.control();userSettings.define(t.controlType,t.id,t.name,t.subTitle,t.groupId);this.initializer(t.id,userSettings);userSettings=userSettings.end();for(r in userSettings)r==="data"&&userSettings[r]&&userSettings[r].length===0||(t[r]=userSettings[r])}t.__type===widget.generator.CONTROL&&(f=ecount.common.createNamespace(t.controlType),t.id||(t.id=ecount.common.uuid(t.controlType)));t.containerName=this.containerName;t.__pnode=this.__type;t.delegator=this.events;t.ecTransaction=this.ecTransaction;t.ecPageID=this.ecPageID;t.tabId=this.tabId;u=new f(t);this.itemList.push(u);i?u.render(this.$el.find('div[report-id="'+n+'"]').find("div.category-header")):u.render(this.$el.find('div[report-id="'+n+'"]'))},destroy:function(){ecount.layout.prototype.destroy.call(this)},onLoadComplete:function(){var n={target:this.containerName,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},getControl:function(n){return typeof n=="string"?this.itemList.find(function(t){return t.id==n}):null},hideControl:function(n){for(var t=0;t<n.lenght;t++)this.getControl(n[t]).addClass("hidden")},showControl:function(n){for(var t=0;t<n.lenght;t++)this.getControl(n[t]).addClass("hidden")},ON_CLICK:function(n,t,i,r){switch(r.cid){case"search":case"rewrite":case"excel":case"save":r.targetID=this.getCId(r.cid);break;case"simpleSearch":r.searchCommand=["on",this.containerName,"search"].join("_").ecCamelize(!0)}}},create:function(){var n=$.extend({},this.prop);ecount.layout.toolbar.report=$.Class(ecount.layout,n)}}};ecount.layout.toolbar.group=$.Class(ecount.layout.toolbar,{template:'<div class="wrapper-toolbar"><\/div>',templateItem:'<div class="inline-group"><\/div>',_groups:null,init:function(){ecount.layout.toolbar.prototype.init.apply(this,arguments)},render:function(){ecount.layout.toolbar.prototype.render.apply(this,arguments);this._groups&&this.addGroups(this._groups)},addGroups:function(n){for(var t=0,i=n.length;t<i;t++);},toggleGroup:function(n){var t=this._groups[n];t&&(t.display?this.hideGroup(n):this.showGroup(n))},showGroup:function(n){this._setDisplay(n,!0,function(){this.show()})},hideGroup:function(n){this._setDisplay(n,!1,function(){this.hide()})},_setDisplay:function(n,t,i){var r=this._groups[n];r.display!=t&&(r.members&&r.members.forEach(function(n){i.call(n)}),r.display=t)},addMember:function(){},removeMember:function(){}});ecount.layout.grid||(ecount.layout.grid={});ecount.layout.grid._export=function(){return{prop:{template:'<div id="{{id}}" data-gid="{{id}}" class="__ecGridContainer {{css}} wrapper-grid" data-layouttype="grid" style="{{style}}">{{childrenContainer}}<\/div>',grid:null,delegator:null,parameter:null,isInitialized:!1,_hasRowData:!1,_renderComplete:!1,css:"",style:"",__layoutSettings:null,_overrayButtonHTML:'<div class="overlay"><button class="btn btn-primary btn-lg">{{value}}<\/button><\/div>',init:function(n){this._options=n;this.parameter={currentPage:0};ecount.layout.prototype.init.apply(this,arguments);this.invalidControlList=[];this.itemList=[];this.ecIKey=ecount.global.registerEcInstance(this)},render:function(){var n,t,i;if(this.settings.__ecGridHidden&&(this.css+=" hidden"),delete this.settings.__ecGridHidden,this.settings.__layoutSettings){if(this.__layoutSettings=this.settings.__layoutSettings,this.__layoutSettings.css&&(this.css+=" "+this.__layoutSettings.css),this.__layoutSettings.style){n="";for(t in this.__layoutSettings.style)n+=t+":"+this.__layoutSettings.style[t]+";";this.style+=n}this.__layoutSettings.isPrintable&&(this.css+=" "+ecount.constValue.printArea);delete this.settings.__layoutSettings}ecount.gridV2&&ecount.gridV2.setting&&this.settings instanceof ecount.gridV2.setting?(i=this.settings._getSettings(),this.template=i.form.version==ecount.grid.constValue.formVersion.fourth&&i.form.layoutTemplateType==ecount.grid.constValue.formLayoutTemplateType.report?this.template.replace("{{childrenContainer}}","<div data-childcontainer-id='childcontainer-grid0' class='wrapper-areaselect "+ecount.constValue.drawingPaper.containerSelector+"'><div class='areaselect-content'><\/div><\/div>"):this.template.replace("{{childrenContainer}}","")):this.template=this.template.replace("{{childrenContainer}}","");this.template=this.template.replaceAll("{{id}}",this.id).replace("{{css}}",this.css).replace("{{style}}",this.style);ecount.layout.prototype.render.apply(this,arguments);ecount.global.setTimeout(this.ecPageID,function(){var n=this,t;this.events=this.settings&&this.settings.getEventWidgetDelegatorObj&&this.settings.getEventWidgetDelegatorObj()||new ecount.events;this.events.on({"control.showError":this._ON_SHOWERROR_CONTROL,"control.hideError":this._ON_HIDEERROR_CONTROL,scope:this});this.delegator&&this.delegator.triggerEvent("grid.append",{__self:this});ecount.runtime.observe(ECountEvent.Type.LAYER_SHOW,this.ecPageID,function(n){/ESD012R_\d+/.test(this.ecPageID)&&n.containerName=="header"&&n.type=="dropdown"&&this.invertZindexOfECContainer("invert")}.bind(this));ecount.runtime.observe(ECountEvent.Type.LAYER_HIDE,this.ecPageID,function(n){/ESD012R_\d+/.test(this.ecPageID)&&n.containerName=="header"&&n.type=="dropdown"&&this.invertZindexOfECContainer("normal")}.bind(this));this.settings&&(this.settings.setCommonIsPossibleRenderOnLoad(!0),this.settings.setEventWidgetDelegatorObj(this.events),this.settings.setEditableUseViewMode(ecount.config.user.IS_SLIP_INPUTTYPE_MOVE,!0),this.settings.setCommonEcIKey(this.getEcIKey()),this.settings.setCommonEcContainerName(this.containerName));this.grid=this.settings.getCommonGridVersion&&this.settings.getCommonGridVersion()=="v3"?new ecount.gridV3(this.id,this.settings):ecount.gridV2(this.id,this.settings);this.grid.isPossibleRenderOnLoad()&&(this._hasRowData=!0,this.delegator._triggerEvent("grid.onRendering",{__self:this,__eventType:"grid.onRendering"}));this.grid.on(ecount.grid.event.list.tableReady,function(t){var i={};i.__eventType=ecount.grid.event.list.tableReady;n.delegator._triggerEvent(ecount.grid.event.list.tableReady,i,t,n)});this.grid.on(ecount.grid.event.list.preInit,function(t,i){t=t||{};t.__eventType=ecount.grid.event.list.preInit;n.delegator._triggerEvent(ecount.grid.event.list.preInit,t,i,n)});this.grid.on(ecount.grid.event.list.renderingError,function(t,i){t=t||{};t.__eventType=ecount.grid.event.list.renderingError;n.delegator._triggerEvent(ecount.grid.event.list.renderingError,t,i,n)});this.grid.on(ecount.grid.event.list.renderComplete,function(t,i){if(t=t||{},n.__layoutSettings&&n.__layoutSettings.isOverlay){var r=$(n._overrayButtonHTML.replace(/{{value}}/g,n.__layoutSettings.overlayButtonValue));r.find("button").bind("click",n._ON_CLICK_OVERLAY.bind(n));n.$el.prepend(r)}t.target=t.target||{};t.target.id=t.target.id||i.containerId;t.__eventType=ecount.grid.event.list.renderComplete;t.type=t.type||"gridEvent";t.preventDefault=function(){};n.delegator._triggerEvent(ecount.grid.event.list.renderComplete,t,i,n)});this.grid.on(ecount.gridV2.event.detach,function(t){var i={};i.__eventType=ecount.gridV2.event.detach;n.delegator._triggerEvent(ecount.gridV2.event.detach,i,t,n)});this.grid.on(ecount.grid.event.list.afterRowDataLoad,function(t,i){t=t||{};t.__eventType=ecount.grid.event.list.afterRowDataLoad;n.delegator._triggerEvent(ecount.grid.event.list.afterRowDataLoad,t,i,n)});this.grid.on(ecount.grid.event.list.afterFormLoad,function(t,i){t=t||{};t.target=t.target||{};t.target.id=t.target.id||i.containerId;t.__eventType=ecount.grid.event.list.renderComplete;t.__eventType=ecount.grid.event.list.afterFormLoad;n.delegator._triggerEvent(ecount.grid.event.list.afterFormLoad,t,i,n)});this.grid.on(ecount.grid.event.list.initAddRow,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.initAddRow,n.delegator._triggerEvent(ecount.grid.event.list.initAddRow,t,i,n)});this.grid.on(ecount.grid.event.list.renderAllRowComplete,function(t,i){t=t||{};t.__eventType=ecount.grid.event.list.renderAllRowComplete;n.delegator._triggerEvent(ecount.grid.event.list.renderAllRowComplete,t,i,n)});this.grid.on(ecount.grid.event.list.activate,function(t,i){t=t||{};t.__eventType=ecount.grid.event.list.activate;n.delegator._triggerEvent(ecount.grid.event.list.activate,t,i,n)});this.grid.on(ecount.grid.event.list.gridResized,function(t,i){t=t||{};t.__eventType=ecount.grid.event.list.gridResized;n.delegator._triggerEvent(ecount.grid.event.list.gridResized,t,i,n)});this.grid.on(ecount.grid.event.list.preInitDrag,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.preInitDrag,n.delegator._triggerEvent(ecount.grid.event.list.preInitDrag,t,i,n)});this.grid.on(ecount.gridV2.constEvent.drag.beforeMovingStart,function(t,i){return t=t||{},t.__eventType=ecount.gridV2.constEvent.drag.beforeMovingStart,n.delegator._triggerEvent(ecount.gridV2.constEvent.drag.beforeMovingStart,t,i,n)});this.grid.on(ecount.grid.event.list.dragEndPreInit,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.dragEndPreInit,n.delegator._triggerEvent(ecount.grid.event.list.dragEndPreInit,t,i,n)});this.grid.on(ecount.grid.event.list.dragEndCompleted,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.dragEndCompleted,n.delegator._triggerEvent(ecount.grid.event.list.dragEndCompleted,t,i,n)});this.grid.on(ecount.grid.event.list.resizing,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.resizing,n.$el.syncLineHandler(),n.delegator._triggerEvent(ecount.grid.event.list.resizing,t,i,n)});this.grid.on(ecount.grid.event.list.resizeEndCompleted,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.resizeEndCompleted,n.delegator._triggerEvent(ecount.grid.event.list.resizeEndCompleted,t,i,n)});this.grid.on(ecount.grid.event.list.formBeforeSetting,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formBeforeSetting,n.delegator._triggerEvent(ecount.grid.event.list.formBeforeSetting,t,i,n)});this.grid.on(ecount.grid.event.list.formSetting,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formSetting,n.delegator._triggerEvent(ecount.grid.event.list.formSetting,t,i,n)});this.grid.on(ecount.grid.event.list.formBeforeShowText,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formBeforeShowText,n.delegator._triggerEvent(ecount.grid.event.list.formBeforeShowText,t,i,n)});this.grid.on(ecount.grid.event.list.formShowText,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formShowText,n.delegator._triggerEvent(ecount.grid.event.list.formShowText,t,i,n)});this.grid.on(ecount.grid.event.list.formBeforeHideText,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formBeforeHideText,n.delegator._triggerEvent(ecount.grid.event.list.formBeforeHideText,t,i,n)});this.grid.on(ecount.grid.event.list.formHideText,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formHideText,n.delegator._triggerEvent(ecount.grid.event.list.formHideText,t,i,n)});this.grid.on(ecount.grid.event.list.formBeforeAddedColumn,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formBeforeAddedColumn,n.delegator._triggerEvent(ecount.grid.event.list.formBeforeAddedColumn,t,i,n)});this.grid.on(ecount.grid.event.list.formAddedColumn,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formAddedColumn,n.delegator._triggerEvent(ecount.grid.event.list.formAddedColumn,t,i,n)});this.grid.on(ecount.grid.event.list.formBeforeRemovedColumn,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formBeforeRemovedColumn,n.delegator._triggerEvent(ecount.grid.event.list.formBeforeRemovedColumn,t,i,n)});this.grid.on(ecount.grid.event.list.formRemovedColumn,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formRemovedColumn,n.delegator._triggerEvent(ecount.grid.event.list.formRemovedColumn,t,i,n)});this.grid.on(ecount.grid.event.list.formBeforeAddedRow,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formBeforeAddedRow,n.delegator._triggerEvent(ecount.grid.event.list.formBeforeAddedRow,t,i,n)});this.grid.on(ecount.grid.event.list.formAddedRow,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formAddedRow,n.delegator._triggerEvent(ecount.grid.event.list.formAddedRow,t,i,n)});this.grid.on(ecount.grid.event.list.formBeforeRemovedRow,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formBeforeRemovedRow,n.delegator._triggerEvent(ecount.grid.event.list.formBeforeRemovedRow,t,i,n)});this.grid.on(ecount.grid.event.list.formRemovedRow,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formRemovedRow,n.delegator._triggerEvent(ecount.grid.event.list.formRemovedRow,t,i,n)});this.grid.on(ecount.grid.event.list.formSetBeforeFixed,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formSetBeforeFixed,n.delegator._triggerEvent(ecount.grid.event.list.formSetBeforeFixed,t,i,n)});this.grid.on(ecount.grid.event.list.formSetFixed,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formSetFixed,n.delegator._triggerEvent(ecount.grid.event.list.formSetFixed,t,i,n)});this.grid.on(ecount.grid.event.list.formSetBeforeCancelFixed,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formSetBeforeCancelFixed,n.delegator._triggerEvent(ecount.grid.event.list.formSetBeforeCancelFixed,t,i,n)});this.grid.on(ecount.grid.event.list.formSetCancelFixed,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formSetCancelFixed,n.delegator._triggerEvent(ecount.grid.event.list.formSetCancelFixed,t,i,n)});this.grid.on(ecount.grid.event.list.fixedChange,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.fixedChange,n.delegator._triggerEvent(ecount.grid.event.list.fixedChange,t,i,n)});this.grid.on(ecount.grid.event.list.selectorBeforeSelect,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.selectorBeforeSelect,n.delegator._triggerEvent(ecount.grid.event.list.selectorBeforeSelect,t,i,n)});this.grid.on(ecount.grid.event.list.selectorSelect,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.selectorSelect,n.delegator._triggerEvent(ecount.grid.event.list.selectorSelect,t,i,n)});this.grid.on(ecount.grid.event.list.formSetDragPrepareComplete,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formSetDragPrepareComplete,n.delegator._triggerEvent(ecount.grid.event.list.formSetDragPrepareComplete,t,i,n)});this.grid.on(ecount.grid.event.list.formSetDragComplete,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formSetDragComplete,n.delegator._triggerEvent(ecount.grid.event.list.formSetDragComplete,t,i,n)});this.grid.on(ecount.grid.event.list.formBeforeMerged,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formBeforeMerged,n.delegator._triggerEvent(ecount.grid.event.list.formBeforeMerged,t,i,n)});this.grid.on(ecount.grid.event.list.formMerged,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formMerged,n.delegator._triggerEvent(ecount.grid.event.list.formMerged,t,i,n)});this.grid.on(ecount.grid.event.list.formBeforeDivided,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formBeforeDivided,n.delegator._triggerEvent(ecount.grid.event.list.formBeforeDivided,t,i,n)});this.grid.on(ecount.grid.event.list.formDivided,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formDivided,n.delegator._triggerEvent(ecount.grid.event.list.formDivided,t,i,n)});this.grid.on(ecount.grid.event.list.formAdd,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formAdd,n.delegator._triggerEvent(ecount.grid.event.list.formAdd,t,i,n)});this.grid.on(ecount.grid.event.list.formAddItem,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formAddItem,n.delegator._triggerEvent(ecount.grid.event.list.formAddItem,t,i,n)});this.grid.on(ecount.grid.event.list.formConnectItem,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formConnectItem,n.delegator._triggerEvent(ecount.grid.event.list.formConnectItem,t,i,n)});this.grid.on(ecount.grid.event.list.formDeleteItem,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formDeleteItem,n.delegator._triggerEvent(ecount.grid.event.list.formDeleteItem,t,i,n)});this.grid.on(ecount.grid.event.list.formBeforeBatchSetting,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formBeforeBatchSetting,n.delegator._triggerEvent(ecount.grid.event.list.formBeforeBatchSetting,t,i,n)});this.grid.on(ecount.grid.event.list.formBatchSetting,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formBatchSetting,n.delegator._triggerEvent(ecount.grid.event.list.formBatchSetting,t,i,n)});this.grid.on(ecount.grid.event.list.formBeforeTotalSetting,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formBeforeTotalSetting,n.delegator._triggerEvent(ecount.grid.event.list.formBeforeTotalSetting,t,i,n)});this.grid.on(ecount.grid.event.list.formTotalSetting,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formTotalSetting,n.delegator._triggerEvent(ecount.grid.event.list.formTotalSetting,t,i,n)});this.grid.on(ecount.grid.event.list.formBeforeDisplaySetting,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formBeforeDisplaySetting,n.delegator._triggerEvent(ecount.grid.event.list.formBeforeDisplaySetting,t,i,n)});this.grid.on(ecount.grid.event.list.formDisplaySetting,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.formDisplaySetting,n.delegator._triggerEvent(ecount.grid.event.list.formDisplaySetting,t,i,n)});this.grid.on(ecount.grid.event.list.initMoveContainer,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.initMoveContainer,n.delegator._triggerEvent(ecount.grid.event.list.initMoveContainer,t,i,n)});this.grid.on(ecount.grid.event.list.containerMoving,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.containerMoving,n.delegator._triggerEvent(ecount.grid.event.list.containerMoving,t,i,n)});this.grid.on(ecount.grid.event.list.beforeOpeningContextmenu,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.beforeOpeningContextmenu,n.delegator._triggerEvent(ecount.grid.event.list.beforeOpeningContextmenu,t,i,n)});this.grid.on(ecount.grid.event.list.afterOpeningContextmenu,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.afterOpeningContextmenu,n.delegator._triggerEvent(ecount.grid.event.list.afterOpeningContextmenu,t,i,n)});this.grid.on(ecount.grid.event.list.completedOpenContextmenu,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.completedOpenContextmenu,n.delegator._triggerEvent(ecount.grid.event.list.completedOpenContextmenu,t,i,n)});this.grid.on(ecount.grid.event.list.movedContainer,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.movedContainer,n.delegator._triggerEvent(ecount.grid.event.list.movedContainer,t,i,n)});this.grid.on(ecount.grid.event.list.beforeSelection,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.beforeSelection,n.delegator._triggerEvent(ecount.grid.event.list.beforeSelection,t,i,n)});this.grid.on(ecount.grid.event.list.checkAllStart,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.checkAllStart,n.delegator._triggerEvent(ecount.grid.event.list.checkAllStart,t,i,n)});this.grid.on(ecount.grid.event.list.checkAllEnd,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.checkAllEnd,n.delegator._triggerEvent(ecount.grid.event.list.checkAllEnd,t,i,n)});this.grid.on(ecount.grid.event.list.multiChecked,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.list.multiChecked,n.delegator._triggerEvent(ecount.grid.event.list.multiChecked,t,i,n)});this.grid.on(ecount.grid.event.list.afterAppendToPage,function(t,i){return n.delegator._triggerEvent(ecount.grid.event.list.afterAppendToPage,t,i,n)});this.grid.on(ecount.grid.event.list.createWidgetInstance,function(t,i){_.remove(n.itemList,function(n){return n.cid==i.instance.id||n.id==i.instance.id});n.itemList.push(i.instance)});this.grid.on(ecount.grid.event.list.destroyWidgetInstance,function(t,i){for(var r=0;r<n.itemList.length;)i.id&&(n.itemList[r].cid==i.id||n.itemList[r].id==i.id)?(n.itemList[r].destroy(),n.itemList.splice(r,1)):r++});this.grid.on(ecount.grid.event.list.focus,function(t,i){return t=t||{},t.__eventType=ecount.grid.event.focus,n.delegator._triggerEvent(ecount.grid.event.list.focus,t,i,n)});this.grid.on(ecount.gridV2.cellEvent.renderCompleted,function(t,i){return t=t||{},t.__eventType=ecount.gridV2.cellEvent.renderCompleted,n.delegator._triggerEvent(ecount.gridV2.cellEvent.renderCompleted,t,i,n)});t={target:this.containerName,type:this.__type,gridId:this.id,tabId:this.tabId,isDynamic:this.isDynamic,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",t):this.delegator&&this.delegator.triggerEvent("item.onload",t)}.bind(this),0)},setCss:function(n){this.$el.addClass(n)},getCss:function(n){return this.$el.hasClass(n)},isShow:function(){return!this.$el.hasClass("hidden")},show:function(){this.$el.hasClass("hidden")&&(this.$el.removeClass("hidden"),this.grid.hasShown&&this.grid.hasShown())},hide:function(){this.$el.hasClass("hidden")||(this.$el.addClass("hidden"),this.grid.hasHidden&&this.grid.hasHidden())},toggle:function(){this.settings.getCommonGridVersion&&this.settings.getCommonGridVersion()=="v3"?this.isShow()?this.hide():this.show():ecount.layout.prototype.toggle.apply(this,arguments)},setLeft:function(n,t,i,r){if(arguments.length==1&&(r="px",i=arguments[0],this.$el.css({left:i+r})),arguments.length==2)r=arguments[1]||"px",i=arguments[0],this.$el.css({left:i+r});else if(r=r||"px",n){var u=this.$el.find(n);u&&u.length&&_.isNumber(t)&&u[t]&&u.eq(t).css({left:i+r})}},increaseLeft:function(n,t,i,r){var u=paserFloat(this.$wrapperEl.css("left"));this.setLeft(n,t,u+i,r)},decreaseLeft:function(n,t,i,r){var u=paserFloat(this.$wrapperEl.css("left"));this.setLeft(n,t,u-i,r)},setHeight:function(n,t,i,r){if(arguments.length==1&&(r="px",i=arguments[0],this.$el[0].style.height=i+r),arguments.length==2)r=arguments[1]||"px",i=arguments[0],this.$el[0].style.height=i+r;else if(r=r||"px",n){var u=this.$el.find(n);u&&u.length&&_.isNumber(t)&&u[t]&&(u[t].style.height=i+r)}},getLeft:function(n,t){var i,r;return n?(i=this.$el.find(n),i&&i.length)?_.isNumber(t)?i[t]?parseFloat(i[t].style.left):0:(r=0,i.each(function(n,t){r+=parseFloat(t.style.left)}),r):0:parseFloat(this.$el[0].style.left)},getContainerLeft:function(n){var i,t;return ecount.gridV2&&ecount.gridV2.setting&&this.settings instanceof ecount.gridV2.setting&&(i=this.settings._getSettings(),i.form.version==ecount.grid.constValue.formVersion.fourth&&i.form.layoutTemplateType==ecount.grid.constValue.formLayoutTemplateType.report&&(n=n||"childcontainer-grid0",t=this.$el.find("> [data-childcontainer-id='"+n+"']"),t&&t.length))?parseFloat(t[0].style.left):0},offsetHeight:function(n,t){var i,r;if(n){if(i=this.$el.find(n),i&&i.length)if(_.isNumber(t))if(i[t])i[t].offsetHeight;else return 0;else return r=0,i.each(function(n,t){r+=t.offsetHeight}),r;return 0}return this.$el[0].offsetHeight},getMaxWidth:function(){var n=this.getLeft(),t=this.grid.getMaxWidthForPrint();return n+t},invertZindexOfECContainer:function(n){var t=this.$el.find(".ec-container");switch(n){case"invert":t.each(function(n,t){parseInt(t.style.zIndex,10)>-1&&(t.style.zIndex*=-1)});break;case"normal":t.each(function(n,t){parseInt(t.style.zIndex,10)<0&&(t.style.zIndex*=-1)})}},destroy:function(){ecount.runtime.stopObserving(ECountEvent.Type.LAYER_SHOW,this.ecPageID);ecount.runtime.stopObserving(ECountEvent.Type.LAYER_HIDE,this.ecPageID);this.dragableInstance&&this.dragableInstance.destroy();this.dragableInstance=null;delete this.dragableInstance;this.grid.destroy(!0);ecount.layout.prototype.destroy.call(this);this.grid=null;delete this.grid},draw:function(n){n&&(this.parameter=$.extend({},n));var t=this.grid.settings();t.setCommonEcIKey(this.getEcIKey());t.setRowDataParameter(this.parameter);this.grid.render()},reloadData:function(n){this.grid.setRowData(n);this.grid.render()},getSettings:function(){return this.grid.settings()},setSettings:function(n){this.grid.settings(n)},getGrid:function(){return this},getCheckedItem:function(){return this.grid.getChecked()},onInitialize:function(){this.draw(this.parameter)},activate:function(){},deactivate:function(){},invisibleResize:function(){this.$el.invisibleResize()},visibleResize:function(){this.$el.visibleResize()},_ON_SHOWERROR_CONTROL:function(n,t){var i=!1;for(k=0,len=this.invalidControlList.length;k<len;k++)if(n.cid==this.invalidControlList[k].cid){i=!0;break}i||(this.invalidControlList.push(n),!t&&this.delegator&&this.delegator.triggerEvent("control.changeValidate",{__self:this,control:n.instance,method:"control.showError",target:this.containerName,tabId:this.tabId,invalidControlList:this.invalidControlList}))},_ON_HIDEERROR_CONTROL:function(n,t){for(k=0,len=this.invalidControlList.length;k<len;k++)if(n.cid==this.invalidControlList[k].cid){this.invalidControlList.splice(k,1);!t&&this.delegator&&this.delegator.triggerEvent("control.changeValidate",{__self:this,control:n.instance,method:"control.hideError",target:this.containerName,tabId:this.tabId,invalidControlList:this.invalidControlList});break}},resetControlErrorStatus:function(){this.invalidControlList.length=0},_ON_CLICK_OVERLAY:function(n){var i=$(n.target),t={cid:this.id,cname:this.name,targetID:"on-grid-overlay-button",event:n,__self:this};this.delegator&&this.delegator.triggerEvent("button.click",t)},_ON_INPUT:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_INPUT",n,t,i,r)},_ON_CHANGE:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_CHANGE",n,t,i,r)},_ON_FOCUSIN:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_FOCUSIN",n,t,i,r)},_ON_FOCUSOUT:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_FOCUSOUT",n,t,i,r)},_ON_MOUSEDOWN:function(n,t,i,r){var u,f,e;return this.settings.getCommonGridVersion&&this.settings.getCommonGridVersion()=="v3"||this.settings._getSettings().form.version==ecount.grid.constValue.formVersion.fourth&&(u=$(t.target),(u.hasClass(ecount.constValue.drawingPaper.moveableTopSelector)||u.hasClass(ecount.constValue.drawingPaper.moveableBottomSelector)||u.hasClass(ecount.constValue.drawingPaper.moveableLeftSelector)||u.hasClass(ecount.constValue.drawingPaper.moveableRightSelector))&&(f=this.$el.find(ecount.constValue.drawingPaper.containerPrefix+ecount.constValue.drawingPaper.containerSelector),f&&f.length>0&&(e={isAttachMousemoveEvent:!0,attachMousemoveElement:$(document.body),isAttachMouseupEvent:!0,attachMouseupElement:$(document.body),dragableSelector:ecount.constValue.drawingPaper.dragPrefix+ecount.constValue.drawingPaper.dragSelector,containerSelector:ecount.constValue.drawingPaper.containerPrefix+ecount.constValue.drawingPaper.containerSelector,mousedownHandler:this.ON_DRAG_MOUSEDOWN.bind(this),mousemoveHandler:this.ON_DRAG_MOUSEMOVE.bind(this),mouseupHandler:this.ON_DRAG_MOUSEUP.bind(this)},this.delegator._triggerEvent(ecount.grid.event.list.initMoveContainer,{__self:this,__eventType:ecount.grid.event.list.initMoveContainer},{},this),this.dragableInstance||(this.dragableInstance=new ecount.report.dragable),this.dragableInstance.init().setConfig(_.extend({ecPageID:this.ecPageID},e)).setElement(f[0]).ON_MOUSEDOWN(t))),this.visibleResize()),ec$.safeCall(this.grid,"_ON_MOUSEDOWN",n,t,i,r)},_ON_MOUSEUP:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_MOUSEUP",n,t,i,r)},ON_DRAG_MOUSEDOWN:function(n,t){var i=this.$el.find(ecount.constValue.drawingPaper.containerPrefix+ecount.constValue.drawingPaper.containerSelector);i&&i.length!=0&&(this.mousedownPoint=ecount.common.getEventPoint(t),this.mousedownElementPoint=ecount.common.getElementPoint(i[0],!0,!0),document.body.classList.contains("noselection")||document.body.classList.add("noselection"))},ON_DRAG_MOUSEMOVE:function(n){var t,i;this.mousedownPoint&&this.mousedownElementPoint&&(t=this.$el.find("[data-gridid]"),t.length!=0)&&(this.$el.syncLineHandler(),i=ecount.common.moveHorizontalElement(t[0],this.mousedownElementPoint,this.mousedownPoint,{x:n.clientX,y:n.clientY}),this.delegator._triggerEvent(ecount.grid.event.list.containerMoving,{__self:this,__eventType:ecount.grid.event.list.containerMoving,position:i},{},this))},ON_DRAG_MOUSEUP:function(){this.mousedownPoint=null;this.mousedownElementPoint=null;document.body.classList.remove("noselection");this.delegator._triggerEvent(ecount.grid.event.list.movedContainer,{__self:this,__eventType:ecount.grid.event.list.movedContainer},{},this)},_ON_KEYUP:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_KEYUP",n,t,i,r)},ON_KEYDOWN_TAB:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_KEYDOWN_TAB",n,t,i,r)},_ON_KEYDOWN_F8:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_KEYDOWN_F8",n,t,i,r)},_ON_MOUSEOVER:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_MOUSEOVER",n,t,i,r)},_ON_MOUSEOUT:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_MOUSEOUT",n,t,i,r)},_ON_CLICK:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_CLICK",n,t,i,r)},_ON_DBLCLICK:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_DBLCLICK",n,t,i,r)},_ON_CLICK_SERVICE:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_CLICK_SERVICE",n,t,i,r)},_ON_CONTEXTMENU:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_CONTEXTMENU",n,t,i,r)},_ON_GRID_RESIZE_MAXIMIZE:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_RESIZE_MAXIMIZE",n,t,i,r)},_ON_CLICK_MENU_TOGGLE:function(){return ec$.safeCall(this.grid,"_ON_CLICK_MENU_TOGGLE")},_ON_GRID_CHANGE_CHILD_DISPLAY:function(n){return ec$.safeCall(this.grid,"_ON_GRID_CHANGE_CHILD_DISPLAY",n)},_ON_GRID_PASTE:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_PASTE",n,t,i,r)},_ON_GRID_KEYDOWN_SPACE:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYDOWN_SPACE",n,t,i,r)},_ON_GRID_KEYDOWN_ENTER:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYDOWN_ENTER",n,t,i,r)},_ON_GRID_KEYUP:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYUP",n,t,i,r)},_ON_GRID_KEYUP_ENTER:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYUP_ENTER",n,t,i,r)},_ON_GRID_KEYUP_ARROW_UP:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYUP_ARROW_UP",n,t,i,r)},_ON_GRID_KEYUP_ARROW_DOWN:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYUP_ARROW_DOWN",n,t,i,r)},_ON_GRID_KEYUP_ARROW_LEFT:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYUP_ARROW_LEFT",n,t,i,r)},_ON_GRID_KEYUP_ARROW_RIGHT:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYUP_ARROW_RIGHT",n,t,i,r)},_ON_GRID_KEYDOWN_ARROW_UP:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYDOWN_ARROW_UP",n,t,i,r)},_ON_GRID_KEYDOWN_ARROW_DOWN:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYDOWN_ARROW_DOWN",n,t,i,r)},_ON_GRID_KEYDOWN_ARROW_LEFT:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYDOWN_ARROW_LEFT",n,t,i,r)},_ON_GRID_KEYDOWN_ARROW_RIGHT:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYDOWN_ARROW_RIGHT",n,t,i,r)},_ON_GRID_KEYDOWN_ESC:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYDOWN_ESC",n,t,i,r)},_ON_GRID_KEYDOWN_BACKSPACE:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYDOWN_BACKSPACE",n,t,i,r)},_ON_GRID_KEYDOWN_F8:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYDOWN_F8",n,t,i,r)},_ON_GRID_KEYDOWN_OTHERS:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYDOWN_ARROW_OTHERS",n,t,i,r)},_ON_GRID_KEYDOWN_DELETE:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYDOWN_DELETE",n,t,i,r)},_ON_GRID_KEYUP_SPACE:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_KEYUP_SPACE",n,t,i,r)},_ON_GRID_DEACTIVATE:function(n,t,i,r){return this.settings.getCommonGridVersion&&this.settings.getCommonGridVersion()=="v3"||this.settings._getSettings().form.version==ecount.grid.constValue.formVersion.fourth&&this.invisibleResize(),ec$.safeCall(this.grid,"_ON_GRID_DEACTIVATE",n,t,i,r)},_ON_GRID_ACTIVATE:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_ACTIVATE",n,t,i,r)},_ON_GRID_FOCUS_IN:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_FOCUS_IN",n,t,i,r)},_ON_GRID_FOCUS_OUT:function(n,t,i,r){return ec$.safeCall(this.grid,"_ON_GRID_FOCUS_OUT",n,t,i,r)}},create:function(){var n=$.extend({},this.prop);ecount.layout.grid=$.Class(ecount.layout,n)}}};ecount.layout.dataView||(ecount.layout.dataView={});ecount.layout.dataView._export=function(){return{prop:{useTemplateOnlyRender:!0,config:null,outputForm:null,headerData:null,bodyData:null,footData:null,headerColumnMap:null,headerColumnList:null,bodyColumnMap:null,bodyColumnList:null,headerRowList:null,bodyRowList:null,footColumnMap:null,totalWidth:0,tableColumnBuffer:3,tableRowBuffer:15,$scrollMaker:null,$headerContainer:null,$bodyContainer:null,$table:null,$thead:null,$tbody:null,$tfoot:null,generator:null,constValue:ecount.grid.constValue,rowVariableNames:ecount.grid.constValue.rowVariableNames,rowType:ecount.grid.constValue.rowType,init:function(){var n=this;ecount.layout.prototype.init.apply(this,arguments);this.initializeSettings(this.settings.end());this.generator=this.settings;this.settings=function(){return{getCommonColumnType:function(){return n.config.columnType}}}},initializeSettings:function(n){var t={columnType:n.columnType};this.config=t},render:function(n){this.$scrollMaker=document.createElement("div");this.$headerContainer=document.createElement("div");this.$bodyContainer=document.createElement("div");this.$scrollMaker.id=this.id+"ScrollMaker";this.$headerContainer.className="__ecGridContainer  wrapper-grid";this.$bodyContainer.className="__ecGridContainer  wrapper-grid";this.$el=$([this.$scrollMaker,this.$headerContainer,this.$bodyContainer]);n.append(this.$el);this.onLoadItem()},onLoadItem:function(){this.delegator.triggerEvent("container.onload",{target:this.__type,self:this})},setTable:function(n){var t=document.createElement("table");t.id=n;t.className="table table-bordered table-hover table-list";this.$table=t;this.$bodyContainer.appendChild(t)},destroy:function(){ecount.runtime.stopObserving("scroll.page.eventContainer",[this.ecPageID,"grid"].join("_"));ecount.layout.prototype.destroy.apply(this,arguments)},setColgroup:function(n){var t=0,e=document.createElement("colgroup"),i,o;for(this.headerColumnMap={},this.headerColumnList=[],i=0,o=n.length;i<o;i++){var r=n[i],u=document.createElement("col"),f={line:0,__dom:u,__state:"none",__renderIndex:i,__renderLeft:t,__renderRight:t+r.width,prop:r};t=f.__renderRight;u.style.width=r.width+"px";e.appendChild(u);this.headerColumnMap[r.propertyName]=f;this.headerColumnList.push(f)}this.totalWidth=t;this.$table.style.width=t+"px";this.$table.appendChild(e)},setTheadColumns:function(n){var r=document.createElement("thead"),h=this.rowVariableNames.mergeSet,c={},i,f,e,u,t,o,s;for(this.headerRowList=[],i=0,f=n.length;i<f;i++)for(e=n[i][h],u=this.splitMergeSet(e),t=0,o=u.length;t<o;t++)s=this.createTheadRow(u[t],t,c),r.appendChild(s);this.$thead=r;this.$table.appendChild(r)},splitMergeSet:function(n){for(var i=this.headerColumnList.length,r=[],t=0,u=n.length;t<u;t+=i)r.push(n.slice(t,t+i));return r},createTheadRow:function(n,t,i){for(var r,f,s,h=document.createElement("tr"),e=this.rowVariableNames.rowspanCount,o=this.rowVariableNames.colspanCount,c=this.rowVariableNames.rowTitle,l=0,a=this.headerRowList[t]=[],u=0,v=n.length;u<v;u++)(r=n[u],i[u]&&i[u][t])||--l>0||(f=document.createElement("th"),s=document.createElement("span"),f.setAttribute("data-rowkey",t),f.setAttribute("data-column-index",u),s.innerHTML=r[c]===""?"&nbsp;":r[c],r[e]>0&&(this._updateRowSpanMap(i,r[e],u,t),f.setAttribute("rowspan",r[e])),r[o]>1&&(l=r[o],f.setAttribute("colspan",r[o])),a.push(r),f.appendChild(s),h.appendChild(f));return h},setTbodyColumns:function(n){var u=0,i,f,t,r;for(this.bodyColumnMap={},this.bodyColumnList=[],i=0,f=n.length;i<f;i++)t=n[i],r=ecount.convertor.getConvertorByFormInfo(t),col={__state:"none",__renderIndex:i,__renderLeft:u,__renderRight:u+t.width,classNames:this._getCellClassNames(t),converter:r.convertor,dataType:r.dataType,id:(t.id||"").toUpperCase(),prop:t},this.bodyColumnMap[t.id.toUpperCase()]=col,this.bodyColumnList.push(col)},setTbodyRowData:function(n){var t=document.createElement("tbody"),f={},r,u,i;if(this.bodyRowList=[],!n.length)return i=this.createEmptyTbodyRow(),this.bodyRowList=[],t.appendChild(i.__dom),this.$table.appendChild(t),t;for(r=0,u=n.length;r<u;r++)i=this.createTbodyRow(n[r],r,f),this.bodyRowList.push(i),t.appendChild(i.__dom);return this.$table.appendChild(t),t},createEmptyTbodyRow:function(){var t=document.createElement("tr"),n=document.createElement("td"),i=document.createElement("span"),u=this.bodyColumnList.length,r={__renderTop:0,__renderBottom:0,__dom:t,mergeSetList:[],__data:{},__cells:{}};return r.__cells[0]={__dom:n,__index:0,value:"",displayValue:ecount.resource.MSG00205,isBold:!1},i.innerHTML=ecount.resource.MSG00205,n.setAttribute("colspan",u),n.className="text-center",n.appendChild(i),t.appendChild(n),r},createTbodyRow:function(n,t,i){var o=new Array(this.bodyColumnList.length),s=document.createElement("tr"),l={},h={},a=!1,v={__renderTop:0,__renderBottom:0,__dom:s,mergeSetList:o,__data:n,__cells:l},r,y;for(h[t]=0,this._updateTrPropFromMergeSet(n,o,s),r=0,y=this.bodyColumnList.length;r<y;r++){var u=this.bodyColumnList[r],w=n[u.id]!==undefined?n[u.id]:n[u.id.toLowerCase()],p=o[r],f,e,c;i[r]&&i[r][t]||--h[t]>0||(e=document.createElement("td"),c=document.createElement("span"),f={__dom:e,__index:r,value:w,displayValue:"",isBold:!1},p?(this.updateTbodyMergeSetInfo(u,f,p,i,h,t),f.isBold&&(a=!0)):this.updateTbodyCommonCellInfo(u,f),l[u.id]=f,c.innerHTML=f.displayValue||"",e.appendChild(c),s.appendChild(e))}return this.updateTrClassNames(v,{hasBoldMergeset:a}),v},updateTbodyCommonCellInfo:function(n,t){var i=n.prop;!t.displayValue&&t.value&&(t.displayValue=n.converter?n.converter(t.value,{dataType:n.dataType,amtCalc:i.amtCalc,isCheckZero:i.isCheckZero,thousandSeparator:i.thousandSeparator,decimalSeparator:i.decimalSeparator}):t.value);n.classNames&&(t.__dom.className+=n.classNames)},updateTbodyMergeSetInfo:function(n,t,i,r,u,f){var s=this.headerColumnList.length*f,e=i[this.rowVariableNames.rowspanCount],o=i[this.rowVariableNames.colspanCount];e>1&&(this._updateRowSpanMap(r,e,t.__index,f-1),t.__dom.setAttribute("rowspan",e));o>1&&(u[f]=o,t.__dom.setAttribute("colspan",o));i[this.rowVariableNames.rowTitle]&&(t.displayValue=i[this.rowVariableNames.rowTitle],n.converter&&(t.displayValue=n.converter(t.displayValue)));i[this.rowVariableNames.isBold]&&(t.isBold=!0);t.__dom.className=this._getMergeSetClassNames(i)},updateTrClassNames:function(n,t){var i=n.__dom,r=n.__data;[this.rowType.total,this.rowType.subtotal].includes(r[this.rowVariableNames.rowType])&&(t.hasBoldMergeset&&(i.className+="text-bold"),i.className+=" muted")},setTfootColumns:function(){var n=document.createElement("tfoot")},mesureResultHeight:function(){var n=document.createDocumentFragment()},renderHeaderToolbar:function(n){var i=document.createElement("div"),r=widget.generator.control(),t=widget.generator.toolbar().setOptions({ecPageID:this.ecPageId,containerName:this.containerName,customToolbarCss:"grid-header-toolbar",tabId:this.tabId,delegator:this.delegator}),u;t=t.width(this.totalWidth+"px").addLeft(r.define("widget.gridCell.label").label(n.headerLeftHTML)).addRight(r.define("widget.gridCell.label").label(n.headerRightHTML)).end();u=ecount.layout.toolbar(t);u.render($(i));this.$bodyContainer.insertBefore(i.firstChild,this.$table)},renderTable:function(n){var t=n.tableId||this.id+"dataViewTable";this.setTable(t);this.setColgroup(n.theadColumns);this.setTheadColumns(n.theadColumnRowCustomData||n.theadColumns);this.setTbodyColumns(n.tbodyColumns);this.setTfootColumns(n.tfootColumns);this.setTbodyRowData(n.tbodyRowData)},renderFooterToolbar:function(n){var i=widget.generator.control(),t=widget.generator.toolbar().setOptions({ecPageID:this.ecPageId,containerName:this.containerName,customToolbarCss:"grid-header-toolbar",tabId:this.tabId,delegator:this.delegator}),r;t=t.width(this.totalWidth+"px").addLeft(i.define("widget.gridCell.label").label(n.footerLeftHTML)).addRight(i.define("widget.gridCell.label").label(n.footerRightHTML)).end();r=ecount.layout.toolbar(t);r.render($(this.$bodyContainer))},setFixdTable:function(n){this.layer=this.popupID?this.$el.closest("div.panel-body")[0]:this.$el.closest("div.wrapper-frame-body")[0]||$("body")[0];this.contents=this.containerDelegator.object.$el[0];this.tableSelector="#"+(n.tableId||this.id+"dataViewTable");this.fixOptions={};this.fixOptions.title=this.layer.querySelector(".header .wrapper-title");this.fixOptions.titleTop=null;this.fixOptions.titleHeight=null;this.fixOptions.titleWidth=null;this.fixOptions.contents=this.contents;this.fixOptions.container=this.$bodyContainer;this.fixOptions.table=this.fixOptions.container.querySelector(this.tableSelector);this.fixOptions.tableBoundary=this.fixOptions.table.getBoundingClientRect();this.moveTop=!1;this.moveTopChanged=!1;this.moveBottomChanged=!1;this.isPopup=this.layer.classList.contains("ui-dialog");this.cloneTopBoundary={};var t,i,r;t=document.createElement("div");i=this.fixOptions.table.cloneNode(!1);this.cloneTable(i,this.fixOptions.table);t.style.position="fixed";t.style.overflow="hidden";t.style.zIndex=3;t.style.paddingLeft="5px";t.style.paddingTop="0px";r=this.layer!==window?this.layer.getBoundingClientRect().left:0;t.style.left=(this.isPopup?r+1:r)+"px";t.setAttribute("id",this.constValue.fix.gridTopDiv);i.style.position="relative";i.style.marginBottom="0px";i.setAttribute("id",this.constValue.fix.gridTop);t.className="fix-clone fix-clone-top table-clone-top hidden";t.appendChild(i);$(this.fixOptions.table).after(t);this.cloneTop=t;this.cloneTopTable=i;ecount.runtime.observe("scroll.page.eventContainer",[this.ecPageID,"grid"].join("_"),function(n){this.scrollCloneTable(n)}.bind(this));ecount.runtime.observe("resize",this.ecPageID,function(){n.theadColumnFix&&this.setCloneTablePosition()}.bind(this))},cloneTable:function(n,t){for(var r,h,e={},o=document.createElement("thead"),u,f,s,i=0,c=t.children.length;i<c;i++){switch(t.children[i].tagName){case"COLGROUP":f=t.children[i].cloneNode(!0);n.appendChild(f);break;case"THEAD":for(n.appendChild(o),u=t.children[i],e.thead=0,r=0,h=u.children.length;r<h;r++)f=u.children[r].cloneNode(!0),s=u.children[r],o.appendChild(f),e.thead+=_.parseInt(s.style.height)}this.cloneTopBoundary=e}},scrollCloneTable:function(n){if(this.setTitleBoundary(),this.fixOptions.contents!==n.target)return!1;if(this.fixOptions.table.parentNode){var t=this.fixOptions.table.getBoundingClientRect();this.fixOptions.table.offsetHeight>0&&(this.fixOptions.titleTop+this.fixOptions.titleHeight>=t.top?(this.moveTop=!0,this.toggleTopArea(),this.cloneTop&&(this.cloneTopTable.style.left=-n.target.scrollLeft+"px",this.cloneTop.style.width=this.fixOptions.titleRight-ecount.gridV2.view.util.getScrollbarWidth()>t.right?t.right-this.cloneTop.getBoundingClientRect().left+"px":this.fixOptions.title.offsetWidth-ecount.gridV2.view.util.getScrollbarWidth()+"px")):(this.moveTop=!1,this.toggleTopArea()))}},setTitleBoundary:function(){this.fixOptions.titleBoundary=this.fixOptions.title.getBoundingClientRect();this.fixOptions.titleTop=this.fixOptions.titleBoundary.top;this.fixOptions.titleRight=this.fixOptions.titleBoundary.right;this.fixOptions.titleHeight=this.fixOptions.title.offsetHeight;this.fixOptions.titleWidth=this.fixOptions.title.offsetWidth},toggleTopArea:function(){var n;this.moveTop?this.moveTopChanged||(this.setCloneTop(),n=this.fixOptions.title,n.style.top=this.fixOptions.titleTop+"px",this.cloneTop&&(this.cloneTop.style.top=_.parseInt(n.style.top)+n.offsetHeight+"px",this.cloneTop.classList.remove("hidden")),this.cloneLeft&&this.cloneTop&&(this.cloneLeft.style.top=this.cloneTop.style.top,this.cloneLeftTable.style.position="relative"),this.moveTopChanged=!0,this.moveBottomChanged=!1):this.moveBottomChanged||(this.cloneTop&&this._removeCloneTop(),this.moveTopChanged=!1,this.moveBottomChanged=!0)},setCloneTop:function(){var n,t,i;return n=document.createElement("div"),t=this.fixOptions.table.cloneNode(!1),this.cloneTable(t,this.fixOptions.table),n.style.position="fixed",n.style.overflow="hidden",n.style.zIndex=3,n.style.paddingLeft="5px",n.style.paddingTop="0px",i=this.layer!==window?this.layer.getBoundingClientRect().left:0,n.style.left=(this.isPopup?i+1:i)+"px",n.setAttribute("id",this.constValue.fix.gridTopDiv),t.style.position="relative",t.style.marginBottom="0px",t.setAttribute("id",this.constValue.fix.gridTop),n.className="fix-clone fix-clone-top table-clone-top hidden",n.appendChild(t),$(this.fixOptions.table).after(n),this.cloneTop=n,this.cloneTopTable=t,this.checkBoxColumnWidth>0&&(n.style.left=this.checkBoxColumnWidth+"px"),!0},_removeCloneTop:function(){this.cloneTop&&this.cloneTop.parentNode&&this.cloneTop.parentNode.removeChild(this.cloneTop);this.cloneTop=null},setCloneTablePosition:function(){var n,t,i;this.setTitleBoundary();n=this.fixOptions.table.getBoundingClientRect();i=this.layer!==window?this.layer.getBoundingClientRect().left:0;this.cloneTop&&(t=this.fixOptions.titleTop+this.fixOptions.titleHeight+"px",this.cloneTop.style.top!==t&&(this.cloneTop.style.top=t),this.cloneTop.style.left=(this.isPopup?i+1:i)+"px",this.cloneTop.style.width=this.fixOptions.titleRight-ecount.gridV2.view.util.getScrollbarWidth()>n.right?n.right-this.cloneTop.getBoundingClientRect().left+"px":this.fixOptions.titleWidth-ecount.gridV2.view.util.getScrollbarWidth()+"px",this.freeSizeWidth&&(this.cloneTopTable.style.width=table.offsetWidth+"px"))},draw:function(n){var t=n.dataViewSettings.end();this.initializeSettings(t);this.$bodyContainer.innerHTML="";this.mesureResultHeight();this.renderTable(t);this.renderHeaderToolbar(t);this.renderFooterToolbar(t);t.theadColumnFix&&this.setFixdTable(t);this.delegator&&this.delegator._triggerEvent("dataView.renderComplete",{type:"dataViewEvent"},{__type:"dataView",id:this.id,ecPageID:this.ecPageID,ecIKey:this.ecIKey,containerName:this.containerName,inIncludePage:this.inIncludePage,settings:this.settings()},this)},getTbodyColumnInfoList:function(){for(var i,t=[],n=0,r=this.bodyColumnList.length;n<r;n++)i=JSON.parse(JSON.stringify(this.bodyColumnList[n].prop)),t.push(i);return t},getTheadColumnInfoList:function(){for(var i,t=[],n=0,r=this.headerColumnList.length;n<r;n++)i=JSON.parse(JSON.stringify(this.headerColumnList[n].prop)),t.push(i);return t},getTfootColumnInfoList:function(){return[]},getTbodyRowList:function(n,t){for(var r,i,e=!!(t&&t.filterFunc&&typeof t.filterFunc=="function"),o=t&&t.filterFunc,f=[],u=0,s=this.bodyRowList.length;u<s;u++)r=this.bodyRowList[u].__data,(!e||o(r))&&(i={},n?i[n]=r[n.toUpperCase()]:i=JSON.parse(JSON.stringify(r)),i[this.constValue.keyColumnPropertyName]=i.id,f.push(i));return f},getTbodyGroupedRowList:function(n,t){for(var i,e,f,o,s=!!(t&&t.filterFunc&&typeof t.filterFunc=="function"),h=t&&t.filterFunc,r={},u=0,c=this.bodyRowList.length;u<c;u++)if(i=this.bodyRowList[u].__data,!s||h(i)){for(e=Object.Keys(i),f=0,o=e.length;f<o;f++);n?r[n]=i[n.toUpperCase()]:r=JSON.parse(JSON.stringify(i));list.push(r)}return list},getTheadRowList:function(n,t){for(var r,i,e=!!(t&&t.filterFunc&&typeof t.filterFunc=="function"),f=[],u=0,o=this.headerRowList.length;u<o;u++)r=_.extend({},this.headerRowList[u]),(!e||filter(r))&&(i={},n?i[n]=r[n.toUpperCase()]:i=JSON.parse(JSON.stringify(r)),i[this.constValue.keyColumnPropertyName]=i.id,f.push(i));return f},getTfootRowList:function(){return[]},getTbodyRowItem:function(){},getTheadRowItem:function(){},getTfootRowItem:function(){},getTbodyColumnInfo:function(n){if(n&&(n=n.toUpperCase()),this.bodyColumnMap&&this.bodyColumnMap[n]){var t=JSON.parse(JSON.stringify(this.bodyColumnMap[n].prop));return t.propertyName=t.id,t.converter=this.bodyColumnMap[n].converter,t}},getTheadColumnInfo:function(n){if(n&&(n=n.toUpperCase()),this.headerColumnMap&&this.headerColumnMap[n]){var t=JSON.parse(JSON.stringify(this.headerColumnMap[n].prop));return t.propertyName=t.id,t.converter=this.headerColumnMap[n].converter,t}},getTfootColumnInfo:function(){return!1},addTbodyCellClass:function(){},addTheadCellClass:function(){},addTfootCellClass:function(){},getTbodyRowKeyByIndex:function(){},getTheadRowKeyByIndex:function(){},getTfootRowKeyByIndex:function(){},getGridRowdataBundle:function(){return[this.bodyRowList]},getTbodyRowCount:function(){return this.bodyRowList.length},getTheadRowCount:function(){return this.headerRowList.length},getTfootRowCount:function(){},removeTbodyCellClass:function(){},removeTheadCellClass:function(){},removeTfootCellClass:function(){},getHTML:function(){var t=this.$bodyContainer.cloneNode(!0),n=$(t),i,u,r;for(n.find('div[fixedgrid="true"]').remove(),n.find("#tempIframeForPrint").remove(),n.find("#gridChromeDummy").remove(),n.find(".fix-clone").remove(),n.find("#grid-fixedtop-div").remove(),t=n[0],i=0,u=t.childElementCount;i<u;i++)r=t.children[i],r.id==this.$table.id&&ecount.document.adjustPrintTable(r);return t.innerHTML},getMaxWidthForPrint:function(){var t,n,i;if(this.bodyColumnList){for(t=0,n=0,i=this.bodyColumnList.length;n<i;n++)t+=this.bodyColumnList[n].prop.width;return t}},_getMergeSetClassNames:function(n){var t=[];n[this.rowVariableNames.cssBgColor]&&t.push(n[this.rowVariableNames.cssBgColor]);n[this.rowVariableNames.isFontItalic]&&t.push("text-italic");n[this.rowVariableNames.isFontStrike]?n[this.rowVariableNames.isFontUnderline]?t.push("grid-text-uline-through"):t.push("text-line-through"):n[this.rowVariableNames.isFontUnderline]&&t.push("text-uline");switch(n[this.rowVariableNames.isCenterAlign]){case"center":case"true":t.push("text-center");break;case"left":t.push("text-left");break;case"right":t.push("text-right")}return n[this.rowVariableNames.vAlignType]&&t.push("valign-"+n[this.rowVariableNames.vAlignType]),t.join(" ")},_getCellClassNames:function(n){var t=[];return n.align&&t.push("text-"+n.align),n.valign&&t.push("valign-"+n.valign),n.font&&t.push("font-"+n.font),ecount.common.isTrue(n.fontSize)&&t.push("font-"+n.fontSize),ecount.common.isTrue(n.fontBold)&&t.push("text-bold"),ecount.common.isTrue(n.fontItalic)&&t.push("text-italic"),ecount.common.isTrue(n.isShadow)&&t.push("bg-muted"),ecount.common.isTrue(n.fontStrike)?ecount.common.isTrue(n.fontUnderline)?t.push("grid-text-uline-through"):t.push("text-line-through"):ecount.common.isTrue(n.fontUnderline)&&t.push("text-uline"),t.join(" ")},_updateRowSpanMap:function(n,t,i,r){var u=r+t;for(n[i]={};u>r;)n[i][u--]=!0},_updateTrPropFromMergeSet:function(n,t){var e=this.rowVariableNames.mergeStartIndex,r=n[this.rowVariableNames.mergeSet],i,f,u;if(r)for(i=0,f=r.length;i<f;i++)u=r[i],t[u[e]]=u}},create:function(){var n=$.extend({},this.prop);ecount.layout.dataView=$.Class(ecount.layout,n)}}};ecount.class("ecount.layout.titlebar","ecount.layout",{template:'<div class="wrapper-report-title" style="{{width}}"><div class="report-title" style="{{underline}}"><div class="title">{{title}}<\/div>{{titleInfo}}<\/div><div class="approval-line"><\/div>{{customTemplate}}<\/div>',serNo:0,bSignBox:"1",boxTitle:"TITLE",boxWidth:750,bBrTag:!0,bTitle:!0,isSignBoxLeftHeaderWidthFix:!0,signBoxleftHeaderWidth:24,isSecondLine:!1,serNo2:1,hidden:!0,useTemplateOnlyRender:!0,init:function(){this._super.init.apply(this,arguments)},render:function(){var n,t,i,r,f,e;if(this.template=ecount.widget.replaceAttr(this.template,{title:this.bTitle==!0?this.boxTitle:"",titleInfo:this.bTitle==!0&&this.titleInfo?'<span class="title-info">'+this.titleInfo.join("<br/>")+"<span>":"",width:"width:"+(this.boxWidth=="MAX"?"100%;":this.boxWidth+"px;"),underline:this.underline?"text-decoration: underline;":"",customTemplate:this.customTemplate?this.customTemplate:""}),this.customTemplate&&(n=$(document.querySelectorAll("#titleContents")),n.length>0))for(t=0,i=n.length;t<i;t++)r=n.eq(t),r.addClass("settinged-title");if(this._super.render.apply(this,arguments),this.bSignBox=="1"){var o=widget.generator,u=o.control(),s=u.define("widget.signbox",this.id,this.name).setOptions({serNo:this.serNo,isLeftHeaderWidthFix:this.isSignBoxLeftHeaderWidthFix,leftHeaderWidth:this.signBoxleftHeaderWidth}).end(),h=this._createControl(s);h.render(this.$el.find(".approval-line"));this.isSecondLine&&(f=u.define("widget.signbox",this.id,this.name).setOptions({serNo:this.serNo2,isLeftHeaderWidthFix:this.isSignBoxLeftHeaderWidthFix,leftHeaderWidth:this.signBoxleftHeaderWidth}).end(),e=this._createControl(f),e.render(this.$el.find(".approval-line")))}this.$el.show()},_createControl:function(n){n.delegator=this.delegator;n.pId=this.pId;n.__target=this.id;n.pcid=this.id;n.onSync=this.onSync;n.parentPageID=this.parentPageID;n.responseID=this.responseID;ecount.widget.createDisplayID(n,"btn",this.__target);t=ecount.common.createNamespace(n.controlType);var t=ecount.common.createNamespace(n.controlType);return new t(n)},destroy:function(){ecount.widget.removeChild(this.$el[0])},setDefault:function(){},getHTML:function(){var n=this.$el.parent().clone();return this.bSignBox!="1"&&n.find(".approval-line").append($('<table class="" style="width:0px;display:none;">  <colgroup> <col><\/col> <\/colgroup> <tbody> <tr> <th><\/th> <\/tr> <\/tbody><\/table>')),n.html()}});ecount.layout.subTitle||(ecount.layout.subTitle={});ecount.layout.subTitle._export=function(){return{prop:{wrapperTemplate:'<div class="control-set {{wrapperCss}}">\n<div class="control">\n{{subTitle}}\n<\/div>\n<\/div>',template:'<div class="wrapper-sub-title {{css}}">{{title}}{{helpMark}}<\/div>',inlineTemplate:['<span class="wrapper-sub-title {{css}}">',"{{title}}","<\/span>",].join(""),popoverTemplate:'<span class="user-help-mark" data-listid="{{listid}}" data-ecpath="{{ecpath}}" data-role="popover"><\/span>',title:"",css:"",_items:null,itemList:null,_loadedItemCount:0,init:function(n){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.popoverOptions=n.addonPopoverOptions||!1;this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItems,scope:this})},setDefault:function(){this.data=[{css:this.css,title:this.title}]},setSubTitle:function(n){this.$el.text(n)},hide:function(){this.$el.hide()},show:function(){this.$el.show()},render:function(){if(this.popoverOptions&&(this.popoverTemplate=ecount.widget.replaceAttr(this.popoverTemplate,{listid:this.id,ecpath:this.ecPath})),this.template=this.wrap?ecount.widget.replaceAttr(this.wrapperTemplate,{subTitle:ecount.widget.replaceAttr(this._inline?this.inlineTemplate:this.template,{css:this.css,title:this.title}),wrapperCss:$.isNull(this.wrapperCss)?this._inline?"":"whole-row":this.wrapperCss}):ecount.widget.replaceAttr(this._inline?this.inlineTemplate:this.template,{css:this.css,title:this.title}),this.template=this.template.replace("{{helpMark}}",this.popoverOptions?this.popoverTemplate:""),ecount.layout.prototype.render.apply(this,arguments),this._items&&this._items.length>0)this.$el.append("&nbsp;"),this.createControl(this.$el);else this.onLoadItems(null)},createControl:function(n){for(var u,t,r,i=0;i<this._items.length;i++)ecount.control.initializeByUserSetting(this.initializer,this._items[i]),ecount.widget.createDisplayID(this._items[i],"btn",this.containerName),u=ecount.common.createNamespace(this._items[i].controlType),t=this._items[i],t.__pnode=this.__type,t.containerName=this.containerName,t.__type=widget.generator.CONTROL,t.pId=this.tabId,t.gridID="",t.tabID=this.tabId,t.ecTransaction=this.ecTransaction,t.delegator=this.delegator,t.containerDelegator=this.events,r=new u(t),this.itemList.push(r),r.render(n)},onLoadItems:function(){var t=this.getItemCount(),n;this._loadedItemCount++;(t===0||this._loadedItemCount==t)&&(n={target:this.__target,type:this.__type,__self:this},this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n))},getItemCount:function(){return this._items.length},ON_MOUSEOVER:function(n){if(n.ecRole==="popover"&&this.popoverOptions){var t=this.$el.find(".user-help-mark");t&&this.setPopover(t,{content:this.popoverOptions.message,placement:this.popoverOptions.placement,popupContext:this.popoverOptions.popupContext||!1})}},ON_MOUSEOUT:function(){if(!this._clicked){var n=this.$el.find(".user-help-mark");this.destroyPopover(n)}}},create:function(){var n=$.extend({},this.prop);ecount.layout.subTitle=$.Class(ecount.layout,n)}}};ecount.layout.panel||(ecount.layout.panel={});ecount.layout.panel._export=function(){return{prop:{template:'<div class="panel {{css}}"><\/div>',css:"panel-default",_loadedItemCount:0,_isUsingCollapse:!1,_isUsingToggle:!1,_isUsingPanelGroup:!1,_isPreventCutOffContent:!1,collapseCss:"collapsed",init:function(n){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this._isSchedulerMode=!!n._isSchedulerMode;this.cogwheel=this._isSchedulerMode&&n.cogwheel?n.cogwheel:!1;this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,scope:this})},destroy:function(){this._isSchedulerMode||this.$el.find(".panel-body").unbind("scroll."+this.ecPageID);ecount.layout.prototype.destroy.apply(this,arguments)},render:function(){this.template=this._isSchedulerMode?'<div class="panel panel-primary panel-inverse"><\/div>':ecount.widget.replaceAttr(this.template,{css:this.css});ecount.layout.prototype.render.apply(this,arguments);this.header&&this.createHeader(this.header);this.items&&this.createBody(this.items);this.footer&&this.createFooter(this.footer);this._isSchedulerMode||this.$el.find(".panel-body").bind("scroll."+this.ecPageID,function(n){ecount.runtime.notify("scroll.page.eventContainer","clearLayer",n);ecount.runtime.notify("scroll.page.eventContainer",this.ecPageID,n)}.bind(this));this.ecTransaction.start();this._width&&this.$el.css("width",this._width)},setWidth:function(n){n||(n="");this._width=n;this.$el.css("width",n)},createHeader:function(n){var t=$('<div class="panel-heading"><\/div>'),i,e,o,s,r,u,h,f;if(this._isUsingCollapse==!0&&(n.title=String.format('<a data-toggle="collapse" href="#{0}" class="{1}"><span class="collapse-arrow"><\/span>{2}<\/a>',this.id,this._defaultCollapse?"":this.collapseCss,n.title||"")),this.isCrossPanel&&(n.title=String.format('<a href="#{0}" data-parent="#layoutPanelGroup" data-toggle="collapse" class="{1}"><span class="collapse-arrow"><\/span>{2}<\/a>',this.id,this.isPanelOpen?"":"collapsed",n.title||""),t.addClass("cursor-default")),n.items){for(_.isArray(n.items)||(n.items=[n.items]),n.isTitleControl?(e=t,this._isUsingCollapse==!0&&this._isUsingCollapseArrow===!0&&(t.append(n.title),o=t.find("a[data-toggle='collapse']"),o&&o.append('<span class="collapse-arrow"><\/span>'))):(u=$("<div class='wrapper-toolbar'><\/div>").appendTo(t),n.title&&u.append($('<div class="pull-left">'+n.title+"<\/div>")),e=$('<div class="pull-right"><\/div>').appendTo(u)),r=0;r<n.items.length;r++)ecount.control.initializeByUserSetting(this.initializer,n.items[r]),ecount.widget.createDisplayID(n.items[r],"btn",this.containerName),s=ecount.common.createNamespace(n.items[r].controlType),i=new s(n.items[r]),this._setControlOptions(i),this.itemList.push(i),i.render(e);this.$el.append(t)}else if(n.layout){for(r=0;r<n.layout.length;r++)i=n.layout[r],i.end&&(i=i.end()),this._setLayoutOptions(i),i=new ecount.layout[i.__type](i),this.itemList.push(i),i.render(t);this.$el.append(t)}else this._isSchedulerMode?(u=$("<div class='wrapper-toolbar'><\/div>").appendTo(t),u.append($('<div class="pull-left">'+n.title+"<\/div>")),h=$('<div class="pull-right">'+(this.cogwheel?'<button class="btn btn-sm btn-default btn-transparant btn-setup" data-service="layer.dropdown" data-service-attr="layer.fixed" data-cid="panel_cogwheel" data-name="cogwheel" id="'+this.id+'_cogwheel"><\/button>':"")+"<\/div>").appendTo(u),t.html(u),this.$el.append(t)):(n._align&&n._align=="center"&&t.addClass("text-center"),$.isArray(n.title)&&(f=[],n.title.forEach(function(n){n.linkId?f.push('<a href="javascript:;" id="'+n.linkId+'" data-function="panelLayerHeaderLinkClick" >'+n.contents+"<\/a>"):f.push(n.contents)}),n.title=f.join('<span class="inline-divider"><\/span>')),t.html(n.title),this.$el.append(t));if(this._isUsingToggle){this._hidden=!1;this.$el.find(".panel-heading").on("click",this.panelHeaderClickHandler.bind(this))}},createFooter:function(n){var u,i,f,r,t,e;if(n)if(u=$('<div class="panel-footer"><\/div>'),n.layout){for(t=0;t<n.layout.length;t++)i=n.layout[t],i.end&&(i=i.end()),this._setLayoutOptions(i),i=new ecount.layout[i.__type](i),this.itemList.push(i),i.render(u);this.$el.append(u)}else if(n.toolbar){for(r=n.toolbar,t=0,e=r.length;t<e;t++)r[t].delegator=this.delegator,r[t].containerDelegator=this.event,r[t].ecPageID=this.ecPageID,f=new ecount.layout.toolbar(r[t]),this.itemList.push(f),f.render(u);this.$el.append(u)}},createBody:function(n){var u=String.format('<div class="panel-body" data-scroll-container-id="{{0}}"><\/div>',this.id),c=0,r,t,f,e,i,o,s,h;for(this.hidePanelScroll&&(u=String.format('<div class="panel-body {0}" data-scroll-container-id="{1}"><\/div>',"position-relative",this.id)),this._isUsingCollapse&&(u=String.format('<div id="{0}" class="panel-collapse collapse {1}" '+(this._isSchedulerMode?"":'style="height: auto;"')+">{2}<\/div>",this.id,this._defaultCollapse?"in":"",this._isSchedulerMode?'<div class="panel-body"><\/div>':u)),this._isUsingPanelGroup&&!this.isCrossPanel&&(u=String.format('<div id="{0}" class="panel-collapse collapse" style="height: auto;"><\/div>',this.id),f=String.format('<div class="panel-title"><a href="#{0}" data-parent="#layoutPanelGroup" class="" data-toggle="collapse">{1}<\/a><\/div>',this.id,this.title)),this.isCrossPanel?(e=String.format('<div id="{0}" class="panel-collapse collapse {1}" style="height: auto;"><\/div>',this.id,this.isPanelOpen?"in":""),r=$(e),r.append(u)):r=$(u),this._isPreventCutOffContent==!0&&r.css("overflow","visible"),this._align&&this._align=="center"&&r.addClass("text-center"),i=0,o=n.length;i<o;i++)n[i].ecPageID=this.ecPageID,n[i].panelID=this.id,n[i].eventContainer=this.eventContainer,this._isUsingPanelGroup&&(n[i]._isUsingPanelGroup=!0),n[i].controlType?(ecount.control.initializeByUserSetting(this.initializer,n[i]),ecount.widget.createDisplayID(n[i],"btn",this.containerName),s=ecount.common.createNamespace(n[i].controlType),t=new s(n[i]),this._setControlOptions(t)):(t=n[i],this._setLayoutOptions(t),t=new ecount.layout[t.__type](t)),this.itemList.push(t),t.__type=="form"&&this.noBorderTable&&(t.noBorderTable=!0,t.id=this.id,t.formIndex=c++),this._isUsingCollapse!=!1||this.isCrossPanel?this._isSchedulerMode?(h=$('<div class="wrapper-toolbar"><\/div>').appendTo(r.children(".panel-body")),t.render(h)):t.render(r.children(".panel-body")):t.render(r);this._isUsingPanelGroup&&!this.isCrossPanel&&this.$el.append(f);this.$el.append(r)},_setLayoutOptions:function(n){n.ecPageID=this.ecPageID;n.itemIndex=this.itemIndex;n.tabId=this.tabId;n.colSize=n.colSize||this.colSize;n.onSync=this.onSync;n.containerName=this.containerName;this.pageType&&n.__type==widget.generator.FORM&&(n.pageType=this.pageType);n.delegator=this.delegator;n.containerDelegator=this.event},_setControlOptions:function(n){n.ecPageID=this.ecPageID;n.__pnode=this.__type;n.containerName=this.containerName;n.__type=widget.generator.CONTROL;n.pId=this.tabId;n.gridID="";n.tabID=this.tabId;n.ecTransaction=this.ecTransaction;n.delegator=this.delegator;n.containerDelegator=this.event},panelHeaderClickHandler:function(){this._hidden?(this._hidden=!1,this.$el.find(".panel-body").show()):(this._hidden=!0,this.$el.find(".panel-body").hide())},onLoadComplete:function(){var n={containerName:this.containerName,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},ON_CLICK:function(n,t,i,r){if(n.handler==="click.panelLayerHeaderLinkClick")r.command||(r.command=["on",this.containerName,n.id].join("_").ecCamelize(!0));else if(n.dataName=="cogwheel"){if(_.isArray(this.cogwheel)){var u={cid:t.target.id,ownerCid:t.target.getAttribute("data-cid")};this.setCogwheelDropdown(n,t,u)}r.command=["on",this.containerName,n.dataName].join("_").ecCamelize(!0);r.cogwheelId=n.id;r.panelId=this.id;r.targetInstance=n.targetInstance}},setCogwheelDropdown:function(n,t,i){var i=i||{},r=n.cid||i.cid,u=i.ownerCid,f=this.getDropdownOption(u,r,t.target);ecount.layer.show(f)},getDropdownOption:function(n,t,i){return{type:"dropdown",showingUpDelay:0,ecPageID:this.ecPageID,serviceKey:ecount.common.makeServiceKey(this.ecPath,n),ownerKey:this.ecIKey,items:this.cogwheel||[],boundary:ec$.getZoomedBoundary(i)}}},create:function(){var n=$.extend({},this.prop);ecount.layout.panel=$.Class(ecount.layout,n)}}};ecount.class("ecount.layout.panelModal","ecount.layout",{template:null,itemList:null,categoryTemplate:"<div class='panel panel-primary panel-inverse' data-listid='{{categoryId}}'><div class='panel-heading'><a data-role='panel-modal-toggle' data-cid='{{categoryId}}' class='text-default text-bold'><span data-role='panel-modal-toggle' data-cid='{{categoryId}}' class='collapse-arrow'><\/span>{{subTitle}}<\/a><\/div><div class='panel-collapse collapse in' style='height: auto;' data-cid='{{categoryId}}''><div class='panel-body'><table class='table table-hover table-expand table-striped table-layout-auto table-border-no-a table-th-left table-th-dot'><tbody>{{contents}}<\/tbody><\/table><\/div><\/div><\/div>",init:function(){ecount.layout.prototype.init.apply(this,arguments);this.pinned=!!this.pinned;this.isVisible=this.isVisible===!1?!1:!0;this.containment=this.containment||"document";this.offset=this.offset||{WIDTH:350,HEIGHT:300,LEFT:0,TOP:0};this.bodyOffset={width:this.offset.WIDTH,height:this.offset.HEIGHT-32};this.bodyData=this.bodyData||{};this.draggableStopHandler=this.draggableStopHandler||this.updateOffsetHandler||this.defaultStopHandler;this.resizableStopHandler=this.resizableStopHandler||this.updateOffsetHandler||this.defaultStopHandler;this.itemList=[];this.scrollTop=0;this.scrollLeft=0},render:function(){this.setTemplate();ecount.layout.prototype.render.apply(this,arguments);this.$el.draggable({handle:"div.panel-heading",cancel:"div.modal-option",containment:this.containment,scroll:!1,start:function(){var n=this.$el.attr("style");this.$el.attr("style",n.replace(/\s*(right|top)[^;]+;\s*/g,""))}.bind(this),stop:this.draggableStopHandler}).resizable({customEventType:"resizePanelModal",minHeight:200,minWidth:200,containment:this.containment,resizePanelModal:function(){if(this.collapsed==!1){var r=ec$.getZoomedBoundary(this.$el[0]),t=ec$.getZoomedBoundary(this.$el.find("div.panel-heading")[0]),n=this.$el.find("div.panel-body[data-role='panel-modal-mainBody']"),i=parseInt(n.css("padding"),10)+5;this.bodyOffset.height=r.height-t.height-i;this.bodyOffset.width=t.width-i;n.width(this.bodyOffset.width);n.height(this.bodyOffset.height)}}.bind(this),stop:this.resizableStopHandler});this.onLoadComplete()},setTemplate:function(){var n=ecount.resource.LBL19216,t='<div class="panel panel-light panel-modal {{isVisible}} {{collapsed}}" {{offset}}><div class="panel-heading" data-role="panel-modal-toggle-header"><div class="modal-title" data-role="panel-modal-toggle-header"><div class="modal-name"  data-role="panel-modal-toggle-header">{{title}}<\/div><\/div><div class="modal-option"><div class="pin {{pinned}}" data-role="panel-modal-pin"><\/div><\/div><\/div><div class="panel-body" data-role="panel-modal-mainBody" {{bodyOffset}}>{{bodyData}}<\/div><\/div>';this.template=ecount.widget.replaceAttr(t,{collapsed:!this.collapsed?"":"panel-collapsed",pinned:!this.pinned?"":"pinned",isVisible:!this.isVisible?"hide":"",offset:ecount.convertor.convertToStyle(this.offset),bodyOffset:ecount.convertor.convertToStyle(this.bodyOffset),title:n,bodyData:this.initBodyData()})},destroy:function(){this.$el.draggable("destroy").resizable("destroy");ecount.layout.prototype.destroy.apply(this,arguments)},onLoadComplete:function(){var n={containerName:this.containerName,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n);ecount.runtime.observe("scroll.page.eventContainer",this.ecPageID,function(n){this.setOffset(n)}.bind(this))},setDisabledResize:function(n){this.$el.resizable("option","disabled",n!==!1)},getBodyData:function(){return this.bodyData},initBodyData:function(){for(var i,t=Object.getOwnPropertyNames(this.bodyData),r="",n=0;n<t.length;n++)i=this.bodyData[t[n]],r+=ecount.widget.replaceAttr(this.categoryTemplate,{subTitle:i.subTitle,contents:this.setContentsData(i.data,t[n]),categoryId:t[n]});return r},setBodyData:function(n){var i,r,t,u;if(_.isPlainObject(n))for(i=Object.getOwnPropertyNames(n),t=0;t<i.length;t++)u="",r=n[i[t]],u=ecount.widget.replaceAttr(this.categoryTemplate,{subTitle:r.subTitle,contents:this.setContentsData(r.data,i[t]),categoryId:i[t]}),this.bodyData[i[t]]?this.$el.find("div[data-listid='"+i[t]+"']").replaceWith(u):this.$el.find("div[data-role='panel-modal-mainBody']").append(u),this.bodyData[i[t]]=r},setContentsData:function(n,t){for(var r=[],i,u,f,e=0;e<n.length;e++)i=n[e],u=i.title?_.isString(i.title)?i.title.escapeHTML(!0):i.title:"",f=i.contents?_.isString(i.contents)?i.contents.escapeHTML(!0):i.contents:"",i.type=="img"&&i.contentsUrl?r.push(["<tr>","<th class='nowrap'>",u,"<\/th>","<td><A href='javascript:;'>",'<IMG src="'+i.contentsUrl+'" data-pcid="'+t+'" data-cid="'+i.id+'" data-role="panel-modal-popup"/>',"<\/A><\/td>","<\/tr>"].join("")):i.type=="link"?r.push(["<tr>","<th class='nowrap'>",u,"<\/th>","<td>","<A href='javascript:;' data-pcid='"+t+"' data-cid='"+i.id+"' data-role='panel-modal-popup' >",f,"<\/a>","<\/td>","<\/tr>"].join("")):r.push(["<tr>","<th class='nowrap'>",u,"<\/th>","<td>",f,"<\/td>","<\/tr>"].join(""));return r.join("")},resetBodyData:function(){this.$el.find("tbody").html("")},setOffset:function(n){var t=this.getOffset(),i,r;t.width==0&&t.height==0||(this.scrollTop=$(n.target).scrollTop(),this.scrollLeft=$(n.target).scrollLeft(),i=_.merge(t,{top:t.top+this.scrollTop,left:t.left+this.scrollLeft}),r=ecount.convertor.convertToStyle(i).replace("style=","").replace("'",""),this.$el.attr("style",r))},getOffset:function(){var n=this.$el;return{left:parseInt(n.css("left"),10)-this.scrollLeft,top:parseInt(n.css("top"),10)-this.scrollTop,width:this.bodyOffset.width,height:this.bodyOffset.height+32}},isPinned:function(){return this.pinned},isCollapsed:function(){return this.collapsed},togglePanelModal:function(n){var r=n.cid,i=this.$el.find("a[data-cid='"+r+"']"),t=this.$el.find("div.panel-collapse[data-cid='"+r+"']");i.hasClass("collapsed")?(i.removeClass("collapsed"),t.attr("style","height:auto;"),t.addClass("in")):(i.addClass("collapsed"),t.attr("style","height:0px;"),t.removeClass("in"))},togglePanelModalHeader:function(){this.collapsed?(this.collapsed=!1,this.$el.removeClass("panel-collapsed"),this.$el.find("div.panel-body").removeClass("hidden"),this.setDisabledResize(!1)):(this.collapsed=!0,this.$el.addClass("panel-collapsed"),this.$el.find("div.panel-body").addClass("hidden"),this.setDisabledResize(!0))},togglePin:function(){this.isPinned()?(this.pinned=!1,this.$el.find("div.modal-option > div.pin").removeClass("pinned")):(this.pinned=!0,this.$el.find("div.modal-option > div.pin").addClass("pinned"))},defaultStopHandler:function(){},setPosition:function(n){var t=this.getOffset(),i=_.merge(t,n),r=ecount.convertor.convertToStyle(i).replace("style=","").replace("'","");this.$el.attr("style",r)},show:function(){this.$el.removeClass("hide")},hide:function(){this.$el.addClass("hide")},ON_CLICK:function(n,t,i,r){var u=n.ecRole;u&&(r.command=("on-"+u).ecCamelize());switch(u){case"panel-modal-toggle":this.togglePanelModal(n);break;case"panel-modal-toggle-header":this.togglePanelModalHeader();break;case"panel-modal-pin":this.togglePin();break;case"panel-modal-popup":r.data={id:n.cid,formType:n.pcid,codeData:this.bodyData[n.pcid]}}}});ecount.layout.cloud||(ecount.layout.cloud={});ecount.layout.cloud._export=function(){return{prop:{template:'<div class="wrapper-cloud {{css}}" id="cloud"><\/div>',init:function(){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.changeStateHandler=this.changeStateHandler||function(){return};this.uploadCompleteHandler=this.uploadCompleteHandler||function(){return};this.beforeUploadHandler=this.beforeUploadHandler||function(){return};this.uploadErrorHandler=this.uploadErrorHandler||function(){return};this.completeTimeout=this.completeTimeout||0;this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,"control.change":this.transferEvent,"control.openPopup":this.transferEvent,"control.openLayer":this.transferEvent,"control.changeValidate":this._onChangeControlValidateState,"grid.append":this.transferEvent,"page.afterLoad":this.transferEvent,"page.beforeLoad":this.transferEvent,"form.change":this.onSyncHandler,"tabContents.onInit":this._onInitTabContents,"page.adjustHeaderSearchDimensions":this.transferEvent,"page.adjustContentsDimensions":this.transferEvent,"tree.select":this.transferEvent,"tree.exceed":this.transferEvent,"tree.onload":this.transferEvent,"tree.loadnode":this.transferEvent,"tree.opennode":this.transferEvent,"tree.refresh":this.transferEvent,"tree.ready":this.transferEvent,"tree.rename":this.transferEvent,"tree.beforeAdd":this.transferEvent,"tree.focusNode":this.transferEvent,"tree.add":this.transferEvent,"tree.addMenu":this.transferEvent,"tree.setup":this.transferEvent,"tree.move":this.transferEvent,"tree.delete":this.transferEvent,"tree.deactivate":this.transferEvent,"tree.activate":this.transferEvent,"tree.viewAuthor":this.transferEvent,"tree.dropComplete":this.transferEvent,"tree.anchor":this.transferEvent,"tree.select":this.transferEvent,"tree.exceed":this.transferEvent,"tree.onload":this.transferEvent,"tree.loadnode":this.transferEvent,"tree.opennode":this.transferEvent,"tree.refresh":this.transferEvent,"tree.ready":this.transferEvent,"tree.rename":this.transferEvent,"tree.beforeAdd":this.transferEvent,"tree.focusNode":this.transferEvent,"tree.add":this.transferEvent,"tree.addMenu":this.transferEvent,"tree.setup":this.transferEvent,"tree.move":this.transferEvent,"tree.delete":this.transferEvent,"tree.deactivate":this.transferEvent,"tree.activate":this.transferEvent,"tree.viewAuthor":this.transferEvent,"tree.backup":this.transferEvent,"tree.deleteContents":this.transferEvent,"tree.dropComplete":this.transferEvent,"tree.anchor":this.transferEvent,"tree.getType":this.transferEvent,scope:this});this.events.register(ecount.gridV2.event.ready,this,this.transferEvent);this.events.register(ecount.grid.event.list.preInit,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderingError,this,this.transferEvent);this.events.register(ecount.grid.event.list.afterFormLoad,this,this.transferEvent);this.events.register(ecount.grid.event.list.initAddRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderAllRowComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.afterRowDataLoad,this,this.transferEvent);this.events.register(ecount.grid.event.list.preInitDrag,this,this.transferEvent);this.events.register(ecount.grid.event.list.dragEndPreInit,this,this.transferEvent);this.events.register(ecount.grid.event.list.dragEndCompleted,this,this.transferEvent);this.events.register(ecount.grid.event.list.resizeEndCompleted,this,this.transferEvent);this.events.register(ecount.grid.event.list.gridResized,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeAddedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeRemovedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formRemovedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeAddedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeRemovedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formRemovedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeMerged,this,this.transferEvent);this.events.register(ecount.grid.event.list.formMerged,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeDivided,this,this.transferEvent);this.events.register(ecount.grid.event.list.formDivided,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAdd,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeBatchSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBatchSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeTotalSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formTotalSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetBeforeFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetBeforeCancelFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetCancelFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetDragPrepareComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetDragComplete,this,this.transferEvent);this.events.register(ecount.gridV2.cellEvent.renderCompleted,this,this.transferEvent);this.events.register("grid.onRendering",this,this.transferEvent)},render:function(){this.template=ecount.widget.replaceAttr(this.template,{css:this.css||""});ecount.layout.prototype.render.apply(this,arguments);this._menuPanel&&this.createMenuPanel(this._menuPanel.items);this._filePanel&&this.createFilePanel(this._filePanel.items);this._setFileUpload();this.ecTransaction.start()},setWidth:function(n){n||(n="");this._width=n;this.$el.css("width",n)},createMenuPanel:function(n){for(var i,u,r=$('<div class="cloud-menu-panel"><\/div>'),t=0,f=n.length;t<f;t++)n[t].ecPageID=this.ecPageID,n[t].panelID=this.id,n[t].controlType?(ecount.control.initializeByUserSetting(this.initializer,n[t]),u=ecount.common.createNamespace(n[t].controlType),i=new u(n[t]),this._setControlOptions(i)):(i=n[t],this._setLayoutOptions(i),i=new ecount.layout[i.__type](i)),this.itemList.push(i),i.render(r);this.$el.append(r);this.$el.find("div.cloud-menu-panel").resizable({handles:"e",minWidth:200,containment:this.$el})},createFilePanel:function(n){for(var i,u,r=$('<div class="cloud-file-panel"><input type="file" id="fileUpload" style="display:none"/><input type="file" id="directoryUpload" style="display:none"/><\/div>'),t=0,f=n.length;t<f;t++)n[t].ecPageID=this.ecPageID,n[t].panelID=this.id,n[t].controlType?(ecount.control.initializeByUserSetting(this.initializer,n[t]),u=ecount.common.createNamespace(n[t].controlType),i=new u(n[t]),this._setControlOptions(i)):(i=n[t],this._setLayoutOptions(i),i=new ecount.layout[i.__type](i)),this.itemList.push(i),i.render(r);this.$el.append(r)},_setFileUpload:function(){this._defaultUploaderConfig={url:"/ECAPI/Common/Infra/SaveTempFile",autostart:!1,chunk_size:ecount.common.parseSize("20mb"),dragdrop:!0,attach_file_size:0,max_file_size:ecount.common.parseSize("2gb"),max_file_count:10,multi_selection:!0,prevent_duplicates:!1,tot_size_lmt:{size:"102400000",flag:!1},driveUrl:""};this._defaultNewFileStorageConfig={collection:null,partition:null,comcode:"",owner_key:"",storage_host_number:0,upload_path:"/SaveTempFile/",temp_file_lifetime:ecenum.tempfileLifetime.infinity,severalOwner_key:!0};this.defaultParam={AFlag:4};this.options={DtCreateKey:"",UserFlag:"",MaxFileSize:0,UsedFileSize:0,RestFileSize:0,AttachSize:0};var n=this._uploaderConfigs&&this._uploaderConfigs.length>0?this._uploaderConfigs[0][1]:{},t=this._newFileStorageConfigs&&this._newFileStorageConfigs.length>0?this._newFileStorageConfigs[0][1]:{};_.merge(this,{initData:{uploaderConfig:_.merge(!0,this._defaultUploaderConfig,n),newFileStorageConfig:_.merge(!0,this._defaultNewFileStorageConfig,t),usingUploader:!0,usingNewFileStorage:!0,usingAlwaysCreateOwnerkey:!0}})},_setLayoutOptions:function(n){n.ecPageID=this.ecPageID;n.itemIndex=this.itemIndex;n.tabId=this.tabId;n.colSize=n.colSize||this.colSize;n.onSync=this.onSync;n.containerName=this.containerName;this.pageType&&n.__type==widget.generator.FORM&&(n.pageType=this.pageType);n.delegator=this.delegator;n.containerDelegator=this.event},_setControlOptions:function(n){n.ecPageID=this.ecPageID;n.__pnode=this.__type;n.containerName=this.containerName;n.__type=widget.generator.CONTROL;n.pId=this.tabId;n.gridID="";n.tabID=this.tabId;n.ecTransaction=this.ecTransaction;n.delegator=this.delegator;n.containerDelegator=this.event},getControl:function(n){for(var t,i=0,r=this.itemList.length;i<r;i++)if((t=this.itemList[i],t)&&t.id==n)return t;return null},setUploadDriveUrl:function(n){this.initData.uploaderConfig.driveUrl=n},fileUpload:function(){$("#fileUpload").click()},directoryUpload:function(){$("#directoryUpload").click()},initUploader:function(){var r=this,n=this.initData.uploaderConfig,t={filters:{mime_types:n.filters.mime_types,max_file_size:n.max_file_size,prevent_duplicates:n.prevent_duplicates},dragdrop:n.dragdrop,chunk_size:n.chunk_size,drop_element:["cloud"],autostart:n.autostart,init:{FilesAdded:null},prevent_duplicates:n.prevent_duplicates,multi_selection:n.multi_selection,max_file_count:n.max_file_count,tot_size_lmt:n.tot_size_lmt,allowZeroSize:n.allowZeroSize||!1,checkFileAllowed:function(){ecmodule.common.fileSecurity.checkFileAllowed.apply(this,arguments)},byPassCheckFileAllowed:n.byPassCheckFileAllowed},i;t.init.FilesAdded=function(n,i){var r=this.beforeUploadHandler(i,t);r===!0&&i.forEach(function(n){return this.handlerFilesAdded(n,t)}.bind(this))}.bind(this);i=this.$el.find("#fileUpload").plupload(t);r.uploader=i.plupload;i.bind("error",function(t,i,r){if(this.onErrorMessage)this.onErrorMessage=!1;else{this.onErrorMessage=!0;var u=r.message;r.code==plupload.FILE_EXTENSION_ERROR&&(u=plupload.translate(String.format(ecount.resource.MSG05733,n.extensions.toUpperCase().replaceAll(",",", "))));ecount.alert(u)}})},initUploader2:function(){var r=this,n=this.initData.uploaderConfig,t={filters:{mime_types:n.filters.mime_types,max_file_size:n.max_file_size,prevent_duplicates:n.prevent_duplicates},chunk_size:n.chunk_size,autostart:n.autostart,init:{FilesAdded:null},chunk_size:n.chunk_size,extensions:n.extensions,prevent_duplicates:n.prevent_duplicates,multi_selection:n.multi_selection,max_file_count:n.max_file_count,directory:!0,tot_size_lmt:n.tot_size_lmt,allowZeroSize:n.allowZeroSize||!1,checkFileAllowed:function(){ecmodule.common.fileSecurity.checkFileAllowed.apply(this,arguments)},byPassCheckFileAllowed:n.byPassCheckFileAllowed},i;t.init.FilesAdded=function(n,i){var r=this.beforeUploadHandler(i,t);r===!0&&i.forEach(function(n){return this.handlerFilesAdded(n,t)}.bind(this))}.bind(this);i=this.$el.find("#directoryUpload").plupload(t);r.uploader2=i.plupload;i.bind("error",function(t,i,r){if(this.onErrorMessage)this.onErrorMessage=!1;else{this.onErrorMessage=!0;var u=r.message;r.code==plupload.FILE_EXTENSION_ERROR&&(u=plupload.translate(String.format(ecount.resource.MSG05733,n.extensions.toUpperCase().replaceAll(",",", "))));ecount.alert(u)}})},initFileManager:function(){this.fileManager=new ecount.fileManager({ecPageID:this.ecPageID,initData:$.extend(!0,{},this.initData)})},handlerFilesAdded:function(n,t){var i=this,u=n.getNative();n.getNative=function(){return u};n.uploadDate=i.currDate;n.provider_seq=ecount.cloudStorage.INNER;var r={FTYPE:"",FPSIZE:n.size,FSIZE:n.size},e=u.webkitRelativePath||n.name,f=this.initData.uploaderConfig.driveUrl+"/"+e;ecount.common.api({url:"/SVC/Groupware/ECDrive/File",data:Object.toJSON({CMD:"FILEUPLOADSTART",OPATH:f,FILE:r}),reqErrorRawResult:!0,error:function(t,r,u){i.uploadErrorHandler({file:n,type:"beforeUpload",data:u})},success:function(u){if(i.checkUploadProcessHandler&&!i.checkUploadProcessHandler(n.id)){console.log("cancelled file upload 1 start========");console.log(n);console.log("cancelled file upload 1 end========");i.uploadErrorHandler({file:n,type:"cancel1",data:u});return}var e=Object.clone(t,!0);e.url=u.Data.URL;e.httpMethod="PUT";e.multipart=!1;r.REPOID=u.Data.REPOID;r.VERSION=u.Data.VER;n.REQDATA={OID:u.Data.OID,TID:u.Data.TID,VER:u.Data.VER,FILE:r};e.FILE=n;e.handler={onError:function(n,t){i.uploadErrorHandler({file:t,type:"uploading",data:n})},onComplete:function(){if(i.checkUploadProcessHandler&&!i.checkUploadProcessHandler(n.id)){console.log("cancelled file upload 2 start========");console.log(n);console.log("cancelled file upload 2 end========");i.uploadErrorHandler({file:n,type:"cancel2",data:u});return}var t=n.REQDATA;ecount.common.api({url:"/SVC/Groupware/ECDrive/File",data:Object.toJSON({CMD:"FILEUPLOADEND",OPATH:f,OID:t.OID,TID:t.TID,VERSION:t.VER,FILE:r}),reqErrorRawResult:!0,error:function(t,r,u){i.uploadErrorHandler({file:n,type:"afterUpload",data:u})},success:function(){i.changeStateHandler(n,100);ecount.global.setTimeout(i.ecPageID,function(){i.uploadCompleteHandler(n);i.removeFile(n.id)},i.completeTimeout)}})}.bind(this)};e.uploadFile=n.getNative();i.fileManager._startUpload(e)}});this.changeStateHandler(n,0)},canceledUpload:function(){this.uploader.splice();this.uploader2.splice();this.uploader.refresh();this.uploader2.refresh()},retryUpload:function(n){var t=this.uploader.files.find(function(t){return t.id==n}),i=this.uploader2.files.find(function(t){return t.id==n});t&&(this.uploader.removeFile(t),this.uploader.addFile(t));i&&(this.uploader2.removeFile(i),this.uploader2.addFile(i))},removeFile:function(n){var t=this.uploader.files.find(function(t){return t.id==n}),i=this.uploader2.files.find(function(t){return t.id==n});t&&(this.uploader.removeFile(t),this.uploader2.removeFile(t));i&&(this.uploader.removeFile(i),this.uploader2.removeFile(i))},getUploadList:function(){var n=this.uploader.files||[],t=this.uploader2.files||[];return n.concat(t)},onLoadComplete:function(){var n={containerName:this.containerName,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n);this.initUploader();this.initUploader2();this.initFileManager()}},create:function(){var n=$.extend({},this.prop);ecount.layout.cloud=$.Class(ecount.layout,n)}}};ecount.layout.explainDiv||(ecount.layout.explainDiv={});ecount.layout.explainDiv._export=function(){return{prop:{template:'<div class="wrapper-step-explain"><\/div>',init:function(){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,scope:this})},render:function(){ecount.layout.prototype.render.apply(this,arguments);this.items&&this.createItems(this.items);this.ecTransaction.start()},createItems:function(n){for(var f,i,r,s,u,t=0,e=n.length;t<e;t++){var h=String.format("<div class='step'>{0}<\/div>","Step "+(t+1)),c=String.format("<div data-step='{0}' class='explain'>{1}<\/div>",t,n[t].content||""),l=String.format("<div class='item'>{0}<div>",h+c),o=$(l);if(n[t].controls)for(f=o.find("div[data-step='"+t+"']"),f.append("<div class='wrapper-toolbar text-center'><\/div>"),i=0;i<n[t].controls.length;i++)r=n[t].controls[i],ecount.control.initializeByUserSetting(this.initializer,r),s=ecount.common.createNamespace(r.controlType),u=new s(r),this._setControlOptions(u),u.render(f.find("div.wrapper-toolbar")),this.itemList.push(u);this.$el.append(o)}},_setControlOptions:function(n){n.ecPageID=this.ecPageID;n.__pnode=this.__type;n.containerName=this.containerName;n.__type=widget.generator.CONTROL;n.pId=this.tabId;n.gridID="";n.tabID=this.tabId;n.ecTransaction=this.ecTransaction;n.delegator=this.delegator;n.containerDelegator=this.event},onLoadComplete:function(){var n={containerName:this.containerName,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},getControl:function(n){return this.itemList.find(function(t){return t.id==n})}},create:function(){var n=$.extend({},this.prop);ecount.layout.explainDiv=$.Class(ecount.layout,n)}}};ecount.layout.panelGroup||(ecount.layout.panelGroup={});ecount.layout.panelGroup._export=function(){return{prop:{template:'<div class="panel-group signup {{css}}" id="layoutPanelGroup"><\/div>',_loadedItemCount:0,_isPreventCutOffContent:!1,init:function(){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.panelList=[];this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,scope:this})},destroy:function(){ecount.layout.prototype.destroy.apply(this,arguments)},render:function(){this.template=ecount.widget.replaceAttr(this.template,{css:this.css});ecount.layout.prototype.render.apply(this,arguments);this.items&&this.createBody(this.items);this.ecTransaction.start();this._width&&this.$el.css("width",this._width)},setWidth:function(n){n||(n="");this._width=n;this.$el.css("width",n)},createBody:function(n){for(var r,t,i=0,u=n.length;i<u;i++)n[i].ecPageID=this.ecPageID,n[i].controlType?(ecount.control.initializeByUserSetting(this.initializer,n[i]),ecount.widget.createDisplayID(n[i],"btn",this.containerName),r=ecount.common.createNamespace(n[i].controlType),t=new r(n[i]),this._setControlOptions(t)):(t=n[i],this._setLayoutOptions(t),t=new ecount.layout[t.__type](t)),this.itemList.push(t),t.__type=="panel"&&(this.panelList.push(t),t._isUsingPanelGroup=!0),t.render(this.$el),t.$el.after(" ")},setPanelChecked:function(n,t){if(this.panelList[n]){var i=this.panelList[n].$el.find(".panel-title");t?i.addClass("complete"):i.removeClass("complete")}},getPanelChecked:function(n){var i,r,t;if(n==undefined){for(r=[],t=0;t<this.panelList.length;t++)i=this.panelList[t].$el.find(".panel-title"),i.hasClass("complete")&&r.push(t);return r}if(this.panelList[n])return i=this.panelList[n].$el.find(".panel-title"),i.hasClass("complete")},openPanel:function(n){var t=this.panelList[n].$el;t.find("a[data-parent=#layoutPanelGroup]").removeClass("collapsed");t.find(".panel-collapse").css("height","auto");t.find(".panel-collapse").addClass("in")},closePanel:function(n){var t=this.panelList[n].$el;t.find("a[data-parent=#layoutPanelGroup]").addClass("collapsed");t.find(".panel-collapse").removeClass("in")},togglePanel:function(n,t){for(var i=0;i<this.panelList.length;i++)n==i?t?this.openPanel(i):this.closePanel(i):this.closePanel(i)},getPanel:function(n){for(var t=0;t<this.panelList.length;t++)if(this.panelList[t].id==n)return this.panelList[t]},validate:function(n,t){for(var r,u,f,e=[],i=0;i<this.panelList.length;i++){for(this.openPanel(i),f=!0,r=0;r<this.panelList[i].itemList.length;r++)u=this.panelList[i].itemList[r],u.__type=="form"&&u.itemList.forEach(function(n){var i=n.validate.call(n,t);i.length>0&&(e.push(i),f=!1)}.bind(this));f&&this.closePanel(i)}return e},_setLayoutOptions:function(n){n.itemIndex=this.itemIndex;n.tabId=this.tabId;n.colSize=n.colSize||this.colSize;n.onSync=this.onSync;n.__target=this.__target;this.pageType&&n.__type==widget.generator.FORM&&(n.pageType=this.pageType);n.delegator=this.delegator;n.containerDelegator=this.event},_setControlOptions:function(n){n.__pnode=this.__type;n.controlType==="widget.custom"&&(n.__target=this.__target);n.__type=widget.generator.CONTROL;n.pId=this.tabId;n.gridID="";n.tabID=this.tabId;n.ecTransaction=this.ecTransaction;n.delegator=this.delegator;n.containerDelegator=this.event},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)}},create:function(){var n=$.extend({},this.prop);ecount.layout.panelGroup=$.Class(ecount.layout,n)}}};ecount.layout.calendar||(ecount.layout.calendar={});ecount.layout.calendar._export=function(){return{prop:{_addGridCount:0,_loadedItemCount:0,template:"<div><\/div>",init:function(){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,scope:this})},destroy:function(){ecount.layout.prototype.destroy.apply(this,arguments)},render:function(){this.template=ecount.widget.replaceAttr(this.template,{css:this.css});ecount.layout.prototype.render.apply(this,arguments);this.items&&this.createBody(this.items);this.ecTransaction.start();this._width&&this.$el.css("width",this._width)},setWidth:function(n){n||(n="");this._width=n;this.$el.css("width",n)},createBody:function(n){for(var r,i,t=0,u=n.length;t<u;t++)n[t].ecPageID=this.ecPageID,this._isUsingPanelGroup&&(n[t]._isUsingPanelGroup=!0),n[t].controlType?(ecount.control.initializeByUserSetting(this.initializer,n[t]),ecount.widget.createDisplayID(n[t],"btn",this.__target),r=ecount.common.createNamespace(n[t].controlType),i=new r(n[t]),this._setControlOptions(i)):(i=n[t],this._setLayoutOptions(i),i=new ecount.layout[i.__type](i)),this.itemList.push(i),i.render(this.$el)},addItems:function(n){var i,t,r,u;for($.isArray(n)||(n=[n]),t=0,r=n.length;t<r;t++)n[t].ecPageID=this.ecPageID,n[t].controlType?(ecount.control.initializeByUserSetting(this.initializer,n[t]),ecount.widget.createDisplayID(n[t],"btn",this.__target),u=ecount.common.createNamespace(n[t].controlType),i=new u(n[t]),this._setControlOptions(i)):(i=n[t],this._setLayoutOptions(i),i=new ecount.layout[i.__type](i)),this.itemList.push(i),i.render(this.$el)},addGrid:function(n,t,i,r){this._addGridCount++;var u={};u.id=n;u.settings=t||widget.generator.grid();u.__target=widget.generator.CONTENTS;u.__type=widget.generator.GRID;u.settings.__ecGridHidden=i===!1;u.settings.__layoutSettings=r;u._addGrid=!0;this.tabId&&(u.tabId=this.tabId);this.items.push(u);this.addItems(u)},add:function(n){var t=n.end();return t.__target=widget.generator.CONTENTS,this.tabId&&(t.tabId=this.tabId),this.items.push(t),this.addItems(t),this},removeAll:function(){for(var n=0,t=this.itemList.length;n<t;n++)this.itemList[n].destroy(),this.itemList[n]=null,delete this.itemList[n];this.itemList.length=0},_setLayoutOptions:function(n){n.itemIndex=this.itemIndex;n.tabId=this.tabId;n.colSize=n.colSize||this.colSize;n.onSync=this.onSync;n.__target=this.__target;this.pageType&&n.__type==widget.generator.FORM&&(n.pageType=this.pageType);n.delegator=this.delegator;n.containerDelegator=this.events},_setControlOptions:function(n){n.__pnode=this.__type;n.controlType==="widget.custom"&&(n.__target=this.__target);n.__type=widget.generator.CONTROL;n.pId=this.tabId;n.gridID="";n.tabID=this.tabId;n.ecTransaction=this.ecTransaction;n.delegator=this.delegator;n.containerDelegator=this.events},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},onLoadItem:function(n){var t,i,u,r;if(this._loadedItemCount++,n.__self&&n.__self._addGrid){if(t=this.getGrid(!1,!1),t.length>0)for(i=0,u=t.length;i<u;i++)r=t[i],r._hasRowData&&(r.getSettings().setCommonIsLazyInitializeOnLoad(!1),r.grid.render());this._addGridCount=0;return}},getGrid:function(n,t){var i=this.find(function(i){return i&&i.__type==widget.generator.GRID&&(!n||i.id===n)&&(!t||i.tabId===t)});return n===!1&&t===!1?i:i?i[0]:null}},create:function(){var n=$.extend({},this.prop);ecount.layout.calendar=$.Class(ecount.layout,n)}}};ecount.class("ecount.layout.scheduler","ecount.layout.container",{template:'<div class="wrapper-schedule"><div class="wrapper-overlay wrapper-overlay-transparent"><\/div><div class="setting-panel"><div class="setting-panel-toggler" id="panelOpen"><\/div><div class="panel-body"><\/div><\/div><div class="calendar-panel"><\/div><\/div>',itemList:[],init:function(){ecount.layout.container.prototype.init.apply(this,arguments);this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.schedulerStorage=window.localStorage||null;this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,scope:this})},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n);$("#panelOpen").on("click",function(){var t=n&&n.__self&&n.__self.$el,i=!1;t&&(t.hasClass("setting-panel-collapsed")?(t.removeClass("setting-panel-collapsed"),i=!0):(t.addClass("setting-panel-collapsed"),i=!1),n&&n.__self&&n.__self.setLeftOpenFlag(i),ecount.runtime.notify("schdule.changeLeftPanelTogglerState",null,{}))}.bind(this))},getLeftOpenFlag:function(){var n=!0;return this.schedulerStorage&&this.schedulerStorage.getItem&&(n=this.schedulerStorage.getItem("schedulerLeftOpen")!=="false"?!0:!1),n},setLeftOpenFlag:function(n){this.schedulerStorage&&this.schedulerStorage.setItem&&this.schedulerStorage.setItem("schedulerLeftOpen",n!==!1?!0:!1)},clearLeftOpenFlag:function(){this.schedulerStorage&&this.schedulerStorage.clear&&this.schedulerStorage.clear()},onLoadItem:function(n){var t,i,u,r;if(this._loadedItemCount++,n.__self&&n.__self._addGrid){if(t=this.getGrid(!1,!1),t.length>0)for(i=0,u=t.length;i<u;i++)r=t[i],r._hasRowData&&(r.getSettings().setCommonIsLazyInitializeOnLoad(!1),r.grid.render());this._addGridCount=0;return}},render:function(n){this.setEcIKey();this.$el=$(this.template);this.$el[0].ecIKey=this.getEcIKey();this.$leftPanel=this.$el.find(".panel-body");this.$rightPanel=this.$el.find(".calendar-panel");this.$overlay=this.$el.find(".wrapper-overlay-transparent");this.$el.appendTo(n);this.createItems(this.items);this.ecTransaction.start();ecount.isIE&&this.$rightPanel.css("z-index",1);this.$rightPanel.bind("scroll."+this.ecPageID,function(n){ecount.runtime.notify("scroll.page.eventContainer","clearLayer",n);ecount.runtime.notify("scroll.page.eventContainer",this.ecPageID,n);ecount.runtime.notify("scroll.page.eventContainer",[this.ecPageID,"grid"].join("_"),n)}.bind(this));var t=this.getLeftOpenFlag();t||this.$el.addClass("setting-panel-collapsed")},setOverlay:function(n){this.$el&&this.$overlay[n===!0?"addClass":"removeClass"]("show")},createItems:function(n){var t,i,r,u;if(n&&n.length>0)for(r=0,u=n.length;r<u;r++)t=n[r],t.itemIndex=r,t.delegator=this.delegator,t.containerDelegator=this.events,t.ecPageID=this.ecPageID,t.inIncludePage=this.inIncludePage,t.__type===widget.generator.CONTROL?(i=ecount.common.createNamespace(t.controlType),this.initializer&&ecount.control.initializeByUserSetting(this.initializer,t),i=new i(t)):(t.__type===widget.generator.TABPANE?t.colSize=this.colSize:t.__type===widget.generator.TABCONTENTS&&(this.onSingleMode=t.onSingleMode),t.hasScroll===!0&&(t.scrollContainer=parent),t.popupID=this.popupID,t.popupLevel=this.popupLevel,t.eventContainer=this.eventContainer,i=new ecount.layout[t.__type](t)),this.itemList.push(i),this.cItemRender(i,t.panelPosition=="leftPanel"?this.$leftPanel:this.$rightPanel),i=null},_add:function(n,t){var i=n.end();return i.panelPosition=t,this.items.push(i),this.createItems([i]),this},addLeft:function(n){return this._add(n,"leftPanel")},addRight:function(n){return this._add(n,"rightPanel")},addGrid:function(n,t){var e=this.getItemCount(),r,u,i,f;for($.isArray(n)||(n=[n]),t||(t="rightPanel"),this._addGridCount=n.length+e,u=0;u<n.length;u++)i={},r=n[u],i.id=r.id,i.settings=r.grid,i.settings&&(i.settings.__ecGridHidden=r.isHide),i.settings&&(i.settings.__layoutSettings=r.layoutSettings),i.isDynamic=r.isDynamic,i.containerName=this.__type,i.__type=widget.generator.GRID,i.itemIndex=this.itemList.length,i.delegator=this.delegator,i.containerDelegator=this.events,i.ecPageID=this.ecPageID,i.inIncludePage=this.inIncludePage,i.popupID=this.popupID,i.popupLevel=this.popupLevel,i.eventContainer=this.eventContainer,i._addGrid=!0,i.panelPosition=t,f=new ecount.layout[i.__type](i),f.render(t=="leftPanel"?this.$leftPanel:this.$rightPanel),this.itemList.push(f),this.items.push(f)},get:function(n){return this.itemList[n]},getItemList:function(n){return n?(n=n.indexOf("Panel")!=-1?n:n==="left"?"leftPanel":"rightPanel",this.itemList.filter(function(t){return t.panelPosition===n})):this.itemList}});ecount.layout.journalView||(ecount.layout.journalView={});ecount.layout.journalView._export=function(){return{prop:{template:"<div><\/div>",init:function(){this.itemList=[];this.items=[];this.journalData=null;this.defineButtonList=[{id:"invoicePrint",label:ecount.resource.BTN00575},{id:"invoiceUpdate",label:ecount.resource.LBL01155}];this.ISSHOW_JOURNAL=!1;ecount.layout.prototype.init.apply(this,arguments);this.ISSHOW_JOURNAL==!0&&(this.gridSetting(),this.buttonSetting());this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.events=new ecount.events(this);this.events.on({"item.onload":this.onLoadItem,scope:this});this.delegator.register(ecount.grid.event.list.renderComplete,this,function(){this._onGridCellRenderCompleted.apply(this,arguments)}.bind(this))},getInitData:function(n){return ecount.control.getInitData("widget.layout.journalView",n.inIncludePage,n.ecPageID)},setInitData:function(n){n.config&&(this.ISSHOW_JOURNAL=n.config.ISSHOW_JOURNAL);this.ISSHOW_JOURNAL==!0&&n&&n.result&&n.result.Data&&(this.journalData=Object.clone(n.result.Data))},render:function(){ecount.layout.prototype.render.apply(this,arguments);this.ISSHOW_JOURNAL==!0&&this.createJournalView();this.ecTransaction.start()},createJournalView:function(){for(var i,n,t=0,r=this.items.length;t<r;t++)n=this.items[t],n.ecPageID=this.ecPageID,n.containerName=this.containerName,n.controlType?(ecount.control.initializeByUserSetting(this.initializer,n),ecount.widget.createDisplayID(n,"btn",this.__target),i=ecount.common.createNamespace(n.controlType),n=new i(n),this._setControlOptions(n)):(this._setLayoutOptions(n),n=new ecount.layout[n.__type](n)),this.itemList.push(n),n.render(this.$el),n.$el.after(" ")},_setLayoutOptions:function(n){n.itemIndex=this.itemIndex;n.tabId=this.tabId;n.colSize=n.colSize||this.colSize;n.onSync=this.onSync;n.__target=this.__target;this.pageType&&n.__type==widget.generator.FORM&&(n.pageType=this.pageType);n.delegator=this.delegator;n.containerDelegator=this.containerDelegator},gridSetting:function(){var t=widget.generator,i=t.grid(),n="",r;columns=[];contents=t.contents();columns.push({propertyName:"GYE_DES",id:"gye_des",title:ecount.resource.LBL00478,width:n,align:"left",dataType:"0"});columns.push({propertyName:"CUST_DES",id:"cust_des",title:ecount.resource.LBL35004,width:n,align:"left",dataType:"0"});columns.push({propertyName:"DR_AMT",id:"dr_amt",title:ecount.resource.LBL02704,width:n,align:"right",dataType:"9"+ecount.config.company.DEC_AMT});columns.push({propertyName:"CR_AMT",id:"cr_amt",title:ecount.resource.LBL01018,width:n,align:"right",dataType:"9"+ecount.config.company.DEC_AMT});i.setColumns(columns).setPagingUse(!1).setRowData(this.journalData).setHeaderTopLeftHTML(ecount.resource.LBL04386).setFooterBottomRightHTML();r={__target:this.__target,__type:widget.generator.GRID,id:this._gridID||"grid-"+this.ecPageID,itemIndex:this.itemIndex,inIncludePage:this.inIncludePage,containerDelegator:this.containerDelegator,delegator:this.delegator,settings:i};this.items.push(r)},buttonSetting:function(){var n,u;if(this._hideButton)return!1;var r=widget.generator,f=r.control(),t=r.toolbar(),i;for(this.buttonList&&(this.defineButtonList=[],this.defineButtonList=this.buttonList.slice()),n=0,u=this.defineButtonList.length;n<u;n++)i=this.defineButtonList[n],t.addRight(f.define("widget.button",i.id).label(i.label).end());t.setOptions({css:"btn btn-default btn-sm"});this.items.push(t.end())},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},_onGridCellRenderCompleted:function(n,t,i){if(i.grid.isFreeSizeWidth()&&!t.columnForm){var r=i.$el.css("maxWidth");this.traverse(function(n){n.__type=="toolbar"&&n.setMaxWidth(r)})}}},create:function(){var n=$.extend({},this.prop);ecount.layout.journalView=$.Class(ecount.layout,n)}}};ecount.layout.stepProgress||(ecount.layout.stepProgress={});ecount.layout.stepProgress._export=function(){return{prop:{template:'<div class="wrapper-step-progress {{css}}"/>',init:function(){ecount.layout.prototype.init.apply(this,arguments);this.template=this.template=ecount.widget.replaceAttr(this.template,{css:this.css||""})},render:function(){ecount.layout.prototype.render.apply(this,arguments);this.createStep();this.onLoadItems()},createStep:function(){for(var t=$('<ol class="step-progress"/>'),n=0,i=this.step.length;n<i;n++)$('<li data-step="'+(n+1)+'"/>').html(this.step[n].title).addClass(this.step[n].active?"active":"").appendTo(t);this.$el.append(t)},getCurrentStep:function(){return this.$el.find("li.active")[0].getAttribute("data-step")},changeStep:function(n){this.$el.find("li.active").removeClass("active");this.$el.find("li")[n-1].className="active"}},create:function(){var n=$.extend({},this.prop);ecount.layout.stepProgress=$.Class(ecount.layout,n)}}};ecount.layout.settingPanel||(ecount.layout.settingPanel={});ecount.layout.settingPanel._export=function(){return{prop:{template:'<div class="wrapper-function-setup"><\/div>',tableCss:"table table-template-setup",init:function(){ecount.layout.prototype.init.apply(this,arguments);this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.itemList=[];this.events=new ecount.events(this);this.events.on({"control.change":this._ON_CHANGE_CONTROL,"anchor.click":this._ON_CLICK_CONTROL,"button.click":this._ON_CLICK_CONTROL,"dropdown.click":this._ON_CLICK_CONTROL,onClickControl:this._ON_CLICK_CONTROL,"control.focusout":this._ON_MOVE_FOCUS,"control.openPopup":this._ON_CLICK_CONTROL,"control.openLayer":this._ON_LAYER,scope:this});this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer)},render:function(){if(this._isUseBottomLine===!0&&(this._isHideBottomSeparatedLine=!0),this.template=this._isHideBottomSeparatedLine===!0?'<div class=""><\/div>':'<div class="wrapper-function-setup" id="'+this.id+'"><\/div>',!this.id&&ecount.__isTRecordMode()){alert("  .\n  .");throw"  ";}ecount.layout.prototype.render.apply(this,arguments);this.createHeader(this._header);this.createContents(this._contents);this.createFooter(this._footer);this.createBottomLine();this.hidden&&this.$el.hide();this.ecTransaction.start()},createHeader:function(n){if(n){var t=$('<div class="function-setup-header"/>');n.title&&t.append($('<div class="wrapper-sub-title">'+n.title+"<\/div>"));n.description&&t.append($('<div class="description">'+n.description+"<\/div>"));this.$el.append(t)}},createContents:function(n){var f=widget.generator,r,o;if(n&&n.items.length>0){var e=$('<div class="function-setup-contents"/>'),t=this._useFormLayout===!0?f.form():f.toolbar(),i={},u={};for(r=0,o=n.items.length;r<o;r++)u=this._setControlOptions(n.items[r]),this._useFormLayout===!0?t.add(u):(t.attach(u),this.isWholeRow&&t.wholeRow(!0));if(this._useFormLayout===!0&&(this._labelColumnWidth=this._labelColumnWidth||100,t.useBaseForm({_isThShow:!0,_isRowInCount:1}).colgroup([{width:this._labelColumnWidth},{width:""}]).css(this.tableCss).setOptions({_isErrorBorderNone:!0})),t=t.end(),t.tabId=this.tabId,t.ecPageID=this.ecPageID,t.containerName=this.containerName,t.delegator=this.events,t.containerDelegator=this.containerDelegator,this.isWholeRowToolBar&&(t.isWholeRow=!0),this._useFormLayout===!0){i=new ecount.layout.form(t);i.events.on({"control.focusout":this._ON_MOVE_FOCUS.bind(this)})}else i=new ecount.layout.toolbar(t);i.render(e);this.itemList.push(i);this.$el.append(e)}},_setControlOptions:function(n){return n.controlType==="widget.custom"&&(n.containerName=this.containerName),ecount.control.initializeByUserSetting(this.initializer,n),n.__pnode=this.__type,n.__type=widget.generator.CONTROL,n.pId=this.tabId,n.gridID="",n.tabID=this.tabId,ecount.widget.createDisplayID(n,"btn",this.containerName),n.delegator=this.events,n.ecTransaction=this.ecTransaction,n},createFooter:function(n){var e=$('<div class="function-setup-footer"><\/div>'),f={},t=widget.generator.toolbar(),r={},i,u;if(n&&(n.leftItems&&n.leftItems.length>0||n.rightItems&&n.rightItems.length>0)){for(n.leftItems=n.leftItems||[],n.rightItems=n.rightItems||[],i=0,u=n.leftItems.length;i<u;i++)r=this._setControlOptions(n.leftItems[i]),t.addLeft(r);for(i=0,u=n.rightItems.length;i<u;i++)r=this._setControlOptions(n.rightItems[i]),t.addRight(r);t=t.end();t.tabId=this.tabId;t.ecPageID=this.ecPageID;t.containerName=this.containerName;t.delegator=this.events;t.containerDelegator=this.containerDelegator;f=new ecount.layout.toolbar(t);f.render(e);this.itemList.push(f);this.$el.append(e)}},createBottomLine:function(){this._isUseBottomLine===!0&&this.$el.append("<hr>")},createControl:function(n){if(n.controlType=="widget.empty")return null;n.__pnode=this.__type;n.isCombinedControl()&&(n.containerName=this.containerName);n.__type=widget.generator.CONTROL;n.pId=this.tabId;n.gridID="";n.tabID=this.tabId;ecount.widget.createDisplayID(n,"btn",this.containerName);n.delegator=this.events;n.ecTransaction=this.ecTransaction;var t=ecount.common.createNamespace(n.controlType);return new t(n)},onLoadComplete:function(){var n={target:this.containerName,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},setFocus:function(n){var t=this.getControlByIndex(n);t?t.setFocus(n):this.delegator.triggerEvent("panel.focusout",{__self:this,type:"panel.focusout",target:this.containerName,tabId:this.tabId})},setHeaderHtml:function(n,t){var i=this.$el.find("div.function-setup-header");n&&(i.find("div.wrapper-sub-title").length==0?i.append('<div class="wrapper-sub-title">'+n+"<\/div>"):i.find("div.wrapper-sub-title").html(n));t&&(i.find("div.description").length==0?i.append('<div class="description">'+t+"<\/div>"):i.find("div.description").html(t))},getControl:function(n){return this.itemList.length==0?null:this.itemList[0].getControl(n)},getControlByIndex:function(n){return this.itemList.length==0?null:this.itemList[0].getControlByIndex(n)},ON_KEYDOWN_ENTER:function(n,t,i,r){this._ON_MOVE_FOCUS(n,t,i,r)},_ON_CHANGE_CONTROL:function(n){this.delegator&&(this.onSync&&this.delegator.triggerEvent("form.sync",n),this.delegator.triggerEvent("control.change",n))},_ON_CLICK_CONTROL:function(n){this.delegator&&this.delegator.triggerEvent(n.type,n)},_ON_LAYER:function(n){this.delegator&&this.delegator.triggerEvent("control.openLayer",n)},_ON_MOVE_FOCUS:function(n){for(var f,s,o=n.cid,c=ecount.widget.isVisible,r,t,u,i=[],e=0,h=this.itemList.length;e<h;e++)for(i=this.itemList[e].itemList,r=0,f=0,s=i.length;f<s;f++){if(i[f].id==o){if(f==s-1){if(e==h-1)u!=undefined?u.onFocusOut():i[r].onFocusOut();else if(t=this.itemList[e+1].itemList[0],!t.isVisibleElement()||t.isReadOnly()||t.isHideCell)o=t.id;else return u!=undefined?u.onFocusOut():i[r].onFocusOut(),t.setFocus(0),!1;break}if(t=i[f+1],!t.isVisibleElement(0)||t.isReadOnly()||t.isHideCell)r--,o=t.id;else return u!=undefined?u.onFocusOut():i[r].onFocusOut(),t.setFocus(0),!1}r++;u=i[r]}this.delegator.triggerEvent("panel.focusout",{__self:this,type:"panel.focusout",target:this.containerName,tabId:this.tabId})}},create:function(){var n=$.extend({},this.prop);ecount.layout.settingPanel=$.Class(ecount.layout,n)}}};ecount.layout.remark||(ecount.layout.remark={});ecount.layout.remark._export=function(){return{prop:{template:'<div class="text-remark {{css}}">{{title}}<\/div>',title:"",css:"text-danger",init:function(){ecount.layout.prototype.init.apply(this,arguments)},setDefault:function(){this.data=[{css:this.css,title:this.title}]},render:function(){this.template=ecount.widget.replaceAttr(this.template,{css:this.css,title:this.title});ecount.layout.prototype.render.apply(this,arguments);this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",event):this.delegator&&this.delegator.triggerEvent("item.onload",event)}},create:function(){var n=$.extend({},this.prop);ecount.layout.remark=$.Class(ecount.layout,n)}}};ecount.layout.div||(ecount.layout.div={});ecount.layout.div._export=function(){return{prop:{template:'<div id="{{id}}" class="{{css}}" style="{{style}}"/>',init:function(){ecount.layout.prototype.init.apply(this,arguments);this.itemList=[];this.hasScrollBar=null;this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadItems.bind(this));this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer)},render:function(){this.template=this.template.replace("{{id}}",this.id||"").replace("{{css}}",this.css||"").replace("{{style}}",this.style||"");ecount.layout.prototype.render.apply(this,arguments);this.createDivContents();this.hideDiv&&this.$el.hide();this.setScrollEvent();this._setObserve();this.ecTransaction.start()},setScrollEvent:function(){_.isFunction(this.scrollCallback)&&this.$el.bind("scroll.div."+this.ecPageID,this._scrollFunc.bind(this))},_scrollFunc:function(n){var i=this.$el[0].scrollHeight,t=Math.ceil(this.$el[0].scrollTop),r=this.$el[0].clientHeight,u={event:n,target:this.$el[0],scrollTop:t,scrollHeight:i,clientHeight:r,isShowScrollBtn:t>100,isScrollEnd:i-(t+r)<40};this.scrollCallback&&this.scrollCallback(u)},setScrollTop:function(n){this.$el.animate({scrollTop:n||0},200)},getScrollTop:function(){return this.$el.scrollTop()},_setObserve:function(){ecount.runtime.observe("resize",this.ecPageID,function(n){var t=this.hasVertivalScrollbar();if(this.hasScrollBar!==t){if(this.hasScrollBar===null){this.hasScrollBar=t;return}this.hasScrollBar=t;_.isFunction(this.resizeChangeScrollBarEvent)&&this.resizeChangeScrollBarEvent({event:n,target:this.$el[0],hasScrollBar:t})}}.bind(this))},_stopObserving:function(){ecount.runtime.stopObserving(this.ecPageID,"resize")},destroy:function(){this._stopObserving();ecount.layout.prototype.destroy.apply(this,arguments)},createDivContents:function(){this.html?this.$el.html(this.html):this.items&&this.createItems(this.items)},createItems:function(n){var t;n.forEach(function(i,r){if(i.ecPageID=this.ecPageID,i.containerName=this.containerName,i.tabID=this.tabId,i.controlType){ecount.control.initializeByUserSetting(this.initializer,i);ecount.widget.createDisplayID(n[r],"btn",this.__target);var u=ecount.common.createNamespace(i.controlType);t=new u(i);t.ecPageID=this.ecPageID;t.__pnode=this.__type;t.containerName=this.containerName;t.__type=widget.generator.CONTROL;t.pId=this.tabId;t.gridID="";t.tabID=this.tabId;t.ecTransaction=this.ecTransaction;t.delegator=this.delegator}else i.__target=this.__target,this.pageType&&i.__type==widget.generator.FORM&&(i.pageType=this.pageType),i.delegator=this.delegator,i.ecPageID=this.ecPageID,i.itemIndex=this.itemIndex,i.tabId=this.tabId,i.colSize=i.colSize||this.colSize,i.onSync=this.onSync,i.containerName=this.containerName,this.pageType&&i.__type==widget.generator.FORM&&(i.pageType=this.pageType),t=new ecount.layout[i.__type](i);this.itemList.push(t);t.render(this.$el)}.bind(this))},addItems:function(n){_.isArray(n)&&n.forEach(function(n){this.add(n)},this)},add:function(n){this.items.push(n.end?n.end():n);this.createItems([this.items[this.items.length-1]])},removeAllItems:function(){this.itemList.forEach(function(n){n.destroy()},this);this.items=[];this.itemList=[]},modifyHtml:function(n){this.$el.html(n)},getHtml:function(){return this.$el.html()},get$Elements:function(n){return $.isEmpty(n)?this.$el:this.$el.find(n)},addClass:function(n,t,i,r){var u=this.get$Elements(t);u&&u.addClass(n,i||0,r)},removeClass:function(n,t,i,r){var u=this.get$Elements(t);u&&u.removeClass(n,i||0,r)},hasClass:function(n,t){var i=this.get$Elements(t);return i?i.hasClass(n):!1},getContentsWidth:function(){return this.$el.width()},getContentsHeight:function(){return this.$el.height()},setFixedPosition:function(n){var r=ecount&&ecount.config&&ecount.config.user,u=_.get(window,"webmail.config",null),i,f,t;u&&(r=u);i=ecount.stylist.convertDarkModeValue(r.SCREEN_THEME_TYPCD,!0);f=i==="B"||i==="A"?"#ffffff":"#3e3e3e";_.isPlainObject(n)&&(t={position:"fixed",backgroundColor:f,paddingRight:"5px"},n.isFixed?(n.top&&(t.top=n.top),n.width&&(t.width=n.width),n.zIndex&&(t.zIndex=n.zIndex)):t={position:"",backgroundColor:"",top:"",width:"",zIndex:"",paddingRight:""},this.$el.css(t))}},create:function(){var n=$.extend({},this.prop);ecount.layout.div=$.Class(ecount.layout,n)}}};ecount.layout.fileList||(ecount.layout.fileList={});ecount.layout.fileList._export=function(){return{prop:{template:'<div><div class="wrapper-attach-file" id="attachFile"><div class="panel panel-default"><div class="panel-heading"><\/div><div class="panel-body"><table class="table"><colgroup><col class="attach-file-col1"><col class="attach-file-col2"><col class="attach-file-col3"><\/colgroup><tbody><\/tbody><\/table><\/div><\/div><\/div><\/div>',templateItem:'<tr id="{{id}}"><td class="text-center cursor-pointer"><\/td><td>{{filename}}<\/td><td class="text-right">{{filesize}}<\/td><\/tr>',_attach_file_size:0,uploadedFileCount:0,currentFileCount:0,_total_size_limit_format:null,removeFileList:[],uploadFileList:[],extensions:"ai,alz,bmp,cp,csv,doc,docx,dwg,gif,gul,hst,hts,htst,hwp,hwx,jpeg,jpg,mht,odp,ods,odt,pdf,ppt,pptx,rar,tif,tiff,txt,xls,xlsm,xlsx,zip,png,drw,hwpx,hwt,cell,nxl,hcdt,show,hpt,dxf,egg,numbers",onErrorMsg:!1,init:function(){ecount.layout.prototype.init.apply(this,arguments);this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this._tmpFileLifeTime||(this._tmpFileLifeTime=ecenum.tempfileLifetime.infinity);this._newFilestorage?(this.storageHostNumber=this.storageHostNumber||0,this.fileStorageHost=ecmodule.common.fileStorage.getFileStorageHost(this.storageHostNumber),this.tempUploadUrl=this.tempUploadUrl||"/SaveTempFile/"+this._tmpFileLifeTime+encodeURIComponent([ecmodule.common.fileStorage.tempComCode,ecount.company.COM_CODE].join(ecount.delimiter)),this.uploadUrl=window.requestUrl.protocol+"://"+this.fileStorageHost+this.tempUploadUrl):(this.tempUploadUrl=this.tempUploadUrl||"/ECAPI/Common/Basic/SaveTempFile",this.uploadUrl=ecount.common.buildSessionUrl(this.tempUploadUrl));this.uploadFileList=[];this.removeFileList=[]},render:function(){ecount.layout.prototype.render.apply(this,arguments);this.ecTransaction.start();this.noHead&&this.$el.find("#attachFile .panel-heading").css("display","none");this.autoHeightBody&&(this.$el.find("#attachFile").addClass("height-auto"),this.setDisplay("none"));this.width&&this.$el.find("#attachFile").width(this.width)},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n);this.initUploader()},initUploader:function(){var n=this,t=this.$el.parents().find("[data-cid='"+this._fileLinkId+"']").plupload({url:this.uploadUrl,filters:{mime_types:[{title:"all files",extensions:this.extensions}],max_file_size:this.max_file_size!=undefined?this.max_file_size:"20480000",prevent_duplicates:this.prevent_duplicates!=undefined?this.prevent_duplicates:!0},multi_selection:this.multi_selection!=undefined?this.multi_selection:!0,max_file_count:this.max_file_count||5,chunk_size:"20mb",dragdrop:!0,drop_element:"attachFile",autostart:this.autostart!=undefined?this.autostart:!1,tot_size_lmt:this.tot_size_lmt.size,com_storage_size:this.com_storage_size.size,use_storage_size:this.use_storage_size.size});n.uploader=t.plupload;n.storageInfoView();t.bind("addFiles",function(t,i,r){n.handleAddFiles(r,i)});t.bind("beforeUpload",function(t,i,r){n.handleBeforeUpload(i,r)});t.bind("changeStatus",function(t,i,r){n.handleFileStatus(r)});t.bind("uploaded",function(t,i,r,u){n.handleFileUploaded(t,i,r,u)});t.bind("complete",function(t,i,r){n.handleUploadComplete(t,i,r)});t.bind("error",function(t,i,r){switch(r.code){case plupload.FILE_EXTENSION_ERROR:details=n.extensionErrorMsg?String.format(ecount.resource.MSG05733,n.extensions.toUpperCase()):ecount.resource.MSG03646;break;case plupload.FILE_SIZE_ERROR:details=String.format(ecount.resource.MSG03587,plupload.formatSize(i.settings.filters.max_file_size));break;case plupload.FILE_DUPLICATE_ERROR:details=ecount.resource.MSG03657;break;case plupload.FILE_COUNT_ERROR:details=String.format(ecount.resource.MSG04180,i.settings.max_file_count);break;case plupload.TOT_SIZE_LMT_ERROR:details=String.format(ecount.resource.MSG03611,plupload.formatSize(i.settings.tot_size_lmt));break;case plupload.COM_STORAGE_SIZE_ERROR:details=r.message;break;case plupload.IMAGE_FORMAT_ERROR:details="Image format either wrong or not supported.";break;case plupload.IMAGE_MEMORY_ERROR:details="Runtime ran out of available memory.";break;case plupload.HTTP_ERROR:details="Upload URL might be wrong or doesn't exist.";r.file.status=plupload.QUEUED;break;case plupload.FILE_NAME_ERROR:details=r.message}n.onErrorMsg||(n.onErrorMsg=!0,ecount.alert(unescape(details),function(){n.onErrorMsg=!1}));i.settings.autostart&&i.removeFile(r.file)});this._fileList&&!$.isEmptyObject(this._fileList[0])&&this.handleAddFiles(this._fileList)},handleAddFiles:function(n,t){var i=this,e,o,r,s,u,f;if($.isArray(n)||(n=[n]),!i._ownerKey&&i._newFilestorage){for(e=0,r=0,s=n.length;r<s;r++)o=n[r],e+=o.size;u=[e];i.collection&&(f=i.getNowDate(),u.push(i.collection,f.year,f.month,f.day));i.partition&&u.push(i.partition);ecmodule.common.fileStorage.checkStorageQuota(u,this.storageHostNumber,function(r){if(r.Data=="false"){i.removeAll();ecount.alert("Lack of capacity");return}r.Domain&&(i.fileStorageHost=r.Domain);!i._ownerKey&&r.OwnerKey&&(i._ownerKey=r.OwnerKey);url=window.requestUrl.protocol+"://"+i.fileStorageHost;i.uploadUrl=url+i.tempUploadUrl;t.settings.url=i.uploadUrl;i._handleAddFiles(n,t)})}else i._handleAddFiles(n,t)},_handleAddFiles:function(n){var t=this,i=[],u,r;if($.each(n,function(n,r){var f,u,e;if(r.size==null&&(r.size=0),r.status==plupload.DONE)t.uploader.files.push(r),r.uptype=0;else{if(t.com_storage_size.flag&&t.uploader.settings.com_storage_size!=0&&Number(t.uploader.settings.com_storage_size)<Number(t.uploader.settings.use_storage_size)+t._attach_file_size+r.size)return f=String.format(ecount.resource.MSG05976,plupload.formatSize(t._attach_file_size+r.size-(Number(t.uploader.settings.com_storage_size)-Number(t.uploader.settings.use_storage_size)))),t.uploader.trigger("Error",{code:plupload.COM_STORAGE_SIZE_ERROR,message:f}),i[i.length]=r,!0;if(t.tot_size_lmt.flag&&t.uploader.settings.tot_size_lmt<t._attach_file_size+r.size)return t.uploader.trigger("Error",{code:plupload.TOT_SIZE_LMT_ERROR}),i[i.length]=r,!0;t._attach_file_size+=r.size;r.uptype=1}u=$(ecount.widget.replaceAttr(t.templateItem,{filename:r.name,filesize:plupload.formatSize(r.size),id:r.id}));u.data("file",r);e=u.find(".text-center");e.bind("click",t.remove.bind(t,u));t.$el.find("tbody").append(u);t.storageInfoView();t.currentFileCount++}),this.autoHeightBody&&this.currentFileCount>0&&this.setDisplay("block"),this.callbackChangeList(),i.length>0)for(u=0;u<i.length;u++)for(r=0;r<n.length;r++)if(n[r].id==i[u].id){this.uploader.removeFile(n[r]);n.splice(r,1);break}},callbackChangeList:function(){if(this._callbackChangeList){var n={_fileLinkId:this._fileLinkId};this._callbackChangeList(n)}},setMultipartParams:function(n){this._multipartParams=$.extend({},n)},storageInfoView:function(){this._total_size_limit_format=" / "+plupload.formatSize(this.uploader.settings.com_storage_size);this.$el.find(".panel-heading").html(plupload.formatSize(Number(this.uploader.settings.use_storage_size)+Number(this._attach_file_size))+this._total_size_limit_format)},handleBeforeUpload:function(n,t){t.uptype==1&&this._multipartParams&&(n.settings.multipart_params=$.extend({},this._multipartParams));this._newFilestorage&&this._ownerKey&&(n.settings.url=this.uploadUrl+"/"+encodeURIComponent(t.name)+"/"+encodeURIComponent(this._ownerKey))},handleFileUploaded:function(n,t,i,r){if(r&&r.response){var u=r.response;$.isEmpty(u)||(u=typeof u=="string"?$.parseJSON(u):u,u.Status!="200"&&(this._resultRespones=u))}},handleFileStatus:function(n){var i=this.$el.find("tr[id='"+n.id+"']"),t="";switch(n.status){case plupload.DONE:t="uploaded";break;case plupload.FAILED:t="";break;case plupload.QUEUED:t="";break;case plupload.UPLOADING:t="uploading";i.find("td.text-center").removeClass("cursor-pointer").unbind("click")}i.attr("class",t)},handleUploadComplete:function(n,t,i){var i=this.$el.find("tr"),r=this;i.each(function(){var t=$(this),n=t.data("file");n.status==plupload.DONE&&(r.uploadedFileCount++,n.uptype>0&&r.addUploadFileList(n.id,n.name,n.size))});this.uploader.files.length==r.uploadedFileCount&&r._callBack&&r._callBack(this._resultRespones)},remove:function(n){var t=n.data("file");t.uptype>0?this.uploader.removeFile(t):(this.addRemoveFileList(t.name,t.fileIdentity,t.size),this.uploader.files.splice(this.uploader.files.indexOf(t),1));this._attach_file_size-=t.size;this.storageInfoView();n.unbind("click");n.remove();this.currentFileCount--;this.currentFileCount==0&&this.autoHeightBody&&this.setDisplay("none");this.callbackChangeList()},addUploadFileList:function(n,t,i){this.uploadFileList[this.uploadFileList.length]={fileId:n,fileName:t,fileSize:i}},addRemoveFileList:function(n,t,i){var r=t.split("@");this.removeFileList[this.removeFileList.length]={fileName:n,fileTable:r[0],fileId:r[1],fileSerNo:r[2],fileSize:i}},uploadStart:function(){this.uploader.start()},mergeFile:function(n,t){var i=this;n.each(function(){var e=$(this),u=e.data("file"),n,r,f;u.uptype==1&&(n=new XMLHttpRequest,n.onreadystatechange=function(){n.readyState==4&&n.responseText&&(i.uploadFileList[i.uploadFileList.length]=n.responseText,i.uploadFileList.length==t&&i._callBack&&i._callBack())},typeof FormData!="undefined"?(r=new FormData,r.append("name",encodeURIComponent(u.name)),r.append("GUID",i.uploader.settings.GUID),r.append("Reg-Date",i.uploader.settings.RegDate),n.open("POST",i.mergeHandlerURL,!0),n.setRequestHeader("Myheader",i.uploader.settings.GUID),n.send(r)):(f="name="+encodeURIComponent(u.name)+"&GUID="+i.uploader.settings.GUID.toString()+"&Reg-Date="+i.uploader.settings.RegDate.toString(),navigator.userAgent.toLowerCase().indexOf("msie 7.0")!=-1?(n.open("post",i.mergeHandlerURL+"?"+f,!0),n.send(r)):$jq1102.ajax({cache:!1,type:"POST",crossDomain:!0,dataType:"text",url:i.mergeHandlerURL+"?"+f,contentType:"application/text; charset=utf-8",success:function(n){n&&(uploadFileList[uploadFileList.length]=n,uploadFileList.length==t&&executeSubmit())}})))})},removeAll:function(){for(var i=this.uploader.files,r=i.length,n=null,t=r-1;t>=0;t--)n=i[t],n.uptype>0?this.uploader.removeFile(n):(this.addRemoveFileList(n.name,n.fileIdentity,n.size),this.uploader.files.splice(this.uploader.files.indexOf(n),1)),this.$el.find("tr[id='"+n.id+"']").unbind("click"),this._attach_file_size-=n.size,this.currentFileCount--;this.$el.find("tbody > tr").remove();this.storageInfoView();this.callbackChangeList()},serialize:function(n){var t={key:n||this._fileLinkId,value:this.getFileInfo()||""};return this._newFilestorage&&(t.ownerKey=this._ownerKey),t},getFileInfo:function(){var n,i;if(this.useEditMode)n={},n.uploadFile=this.uploadFileList.slice(),n.removeFile=this.removeFileList.slice();else{var r=Object.clone(this.uploader.files,!0),e=r.length,t=null,u,f;for(n=[],i=0;i<e;i++)t=r[i],u=t.name.lastIndexOf("."),f=t.name.length,n.push({id:t.id+t.name.substring(u,f),name:t.name})}return n},setDisplay:function(n){this.$el.find("#attachFile").css("display",n)},getNowDate:function(){var n=ecount.global.executeCallbak(this.ecPageID,ecount.widget.serverNowDate);return n?(year=n.substr(0,4),month=n.substr(5,2),day=n.substr(8,2),{year:year,month:month,day:day}):null},getOwnerKey:function(){return this._ownerKey},getFileTotalSize:function(){var t=Object.clone(this.uploader.files),n=0;return t.forEach(function(t){n+=t.size}),n},commit:function(n){var i=this.isDeleteFile(ecount.delimiter),t;if($.isEmpty(i)){if(this.uploadFileList.length<1)return n&&n(!0),!1;t=[this._tmpFileLifeTime,this.fileUpComCode,this._ownerKey];ecmodule.common.fileStorage.commit(t,this.storageHostNumber,function(){n&&n(!0)},function(){n&&n(!1)})}else t=[ecenum.tempfileLifetime.infinity,this.fileUpComCode,i,this._ownerKey],ecmodule.common.fileStorage.deleteFile(t,this.storageHostNumber,function(){if(this.uploadFileList.length<1)return n&&n(!0),!1;var t=[this._tmpFileLifeTime,this.fileUpComCode,this._ownerKey];ecmodule.common.fileStorage.commit(t,this.storageHostNumber,function(){n&&n(!0)},function(){n&&n(!1)})}.bind(this),function(){n&&n(!1)})},isDeleteFile:function(){var t=[],i,n;if(this.removeFileList.length>0)for(n=0;n<this.removeFileList.length;n++)i=this.removeFileList[n],t.push(i.fileName);return t.join(ecount.delimiter)},getAttachedFiles:function(){var n=Object.clone(this.uploader.files,!0),t=[];return $.isEmpty(n)||n.each(function(n){t.push({fileName:n.name,fileSize:n.size})}),t},isChangeFileList:function(){return this.removeFileList.length>0||(this.uploader.files.find(function(n){return n.status==plupload.QUEUED&&n.uptype==1})?!0:!1)}},create:function(){var n=$.extend({},this.prop);ecount.layout.fileList=$.Class(ecount.layout,n)}}};ecount.class("ecount.layout.attachFileList","ecount.layout",{template:'<div class="article-attached-file"><ul>{{attachfiles}}<\/ul><\/div>',templateFile:'<li><a href="javascript:;" data-function="click" data-fileid="{0}">{1}<\/a><\/li>',init:function(){this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));ecount.layout.prototype.init.apply(this,arguments)},render:function(){this.createAttachFile();ecount.layout.prototype.render.apply(this,arguments);this.bindEvent();this.ecTransaction.start()},createAttachFile:function(){var t=this.attachFileList||[],n="";t.forEach(function(t){n+=String.format(this.templateFile,t.file_id,t.name)}.bind(this));this.template=this.template.replace(/{{attachfiles}}/,n)},bindEvent:function(){this.$el.find("a[data-function='click']").bind("click",this.clickHandler.bind(this))},getFile:function(n){return this.attachFileList.length?this.attachFileList.find(function(t){return t.file_id==n}):[]},clickHandler:function(n){var t=$(n.target),i=t.data("fileid"),r=this.getFile(i);this.delegator&&this.delegator.triggerEvent("anchor.click",{type:this.__type,cid:this.id,name:this.name,file:r,targetID:String.format("on-{0}-click",this.id||"file")})},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)}});ecount.layout.line||(ecount.layout.line={});ecount.layout.line._export=function(){return{prop:{template:"<hr />",_items:null,init:function(){ecount.layout.prototype.init.apply(this,arguments)},render:function(){var t,n,i;if(this._items){for(t="",n=0;n<this._items.length;n++)switch(this._items[n]){case"hr":t+="<hr />"}this.template=t}ecount.layout.prototype.render.apply(this,arguments);i={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",i):this.delegator&&this.delegator.triggerEvent("item.onload",i)}},create:function(){var n=$.extend({},this.prop);ecount.layout.line=$.Class(ecount.layout,n)}}};ecount.class("ecount.layout.scoreBox","ecount.layout",{template:'<div class="wrapper-score-box"><\/div>',items:null,prefix:"scorebox",init:function(){ecount.layout.prototype.init.apply(this,arguments);this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this))},render:function(){this.template='<div class="wrapper-score-box"><\/div>';ecount.layout.prototype.render.apply(this,arguments);this._items&&this.addItems(this._items.toArray());this.ecTransaction.start()},destroy:function(){this.hide();this.removeItems();ecount.widget.removeChild(this.$el[0]);this.$el=null;delete this.$el},addItems:function(n){var f,t,r,u;for(i=0,len=n[0].length;i<len;i++){if(f=this.ppcid?this.ppcid:this.pcid||"",t="",r=n[0][i].active?"score-box-primary":"",n[0][i].subItem)for(t='<ul class="dropdown-menu">',k=0,sublen=n[0][k].subItem.length;k<sublen;k++)t+='<li id="'+n[0][k].subItem[k].id+'"><a href="#false">'+n[0][k].subItem[k].subTitle+'<span class="badge">'+n[0][k].subItem[k].subCnt+"<\/span><\/a><\/li>";u=n[0][i].hidden?"none":"";this.$el.append('<div  class="score-box '+r+'" id="'+this.prefix+"-"+n[0][i].id+'" style="display:'+u+'"><div class="score-box-heading" data-cid="'+n[0][i].id+'"  id="'+n[0][i].id+'">'+n[0][i].count+'<\/div><div class="score-box-body" data-cid="'+n[0][i].id+'"  id="'+n[0][i].id+'">'+n[0][i].title+"<\/div>"+t+"<\/div>")}this.$el.on("click",this.clickHandler.bind(this))},onLoadComplete:function(){var n={target:this.__target,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},clickHandler:function(n){var i=$(n.target),t={id:n.target.id};return this.__handler&&this.__handler.click&&this.__handler.click(t,this),n.preventDefault(),!1}});ecount.layout.boardView||(ecount.layout.boardView={});ecount.layout.boardView._export=function(){return{prop:{template:'<div class="wrapper-board-view"/>',templateArticle:'<div class="article {{indent}}" data-function-index="{{functionIndex}}">\n<div class="panel panel-default {{panelDefaultClass}}"  data-no="{{no}}">\n<div class="panel-heading {{reply}}">\n<div class="article-title" data-headno="{{no}}" data-action="{{action}}">\n{{titleTemplate}}\n{{descriptionToggle}}\n<\/div>\n{{description}}\n{{description2}}\n{{attech}}\n<\/div>\n<div class="panel-body" {{folderStyle}} {{panelBodyCss}}>{{preface}}{{contents}}<\/div>\n<div class="panel-footer" {{folderStyle}} {{panelFooterCss}}>{{videoReply}}{{footer}}<\/div>\n<\/div>\n<\/div>',_editable:!0,init:function(){ecount.layout.prototype.init.apply(this,arguments)},render:function(n){this._draw(n);this.$panelHeading=this.$el.find("div.panel-heading");this.onLoadItems();ecount.control.registerLazyRender(this,function(){var t=ecount.config.company.FONT_SIZE_STRING,n;switch(t){case"lg":n=27;break;case"xl":n=34;break;default:n=20}this.toggleShotenClass(n);this._syncOverflowedSize&&this.setSizeByOverflowedSize();ecount.runtime.observe("resize",this.ecPageID,this.toggleShotenClass.bind(this,n))})},imageLoadComplete:function(n,t){var i=0;return function(r){i++;n===i&&t(r)}},setSizeByOverflowedSize:function(n){function t(t){var i=ecount.common.getOverflowedSizeOf(t),r;n.padding>0&&(i.width+=n.padding,i.height+=n.padding);r=i.height>t.offsetHeight;r&&(console.log("test height changed"),$(t).height(i.height))}function i(n){return!!n.naturalHeight}n=n||{};this.$el.find(".panel-body").each(function(n,r){var u,f;if(r.style.position="relative",t(r),u=r.querySelectorAll("img"),f=u.length>0,f){var o=_.filter(u,function(n){return i(n)}).length,s=u.length-o,e=this.imageLoadComplete(s,t);_.forEach(u,function(n){n.addEventListener("load",function(){e(r)},{once:!0});n.addEventListener("error",function(){e(r)},{once:!0})})}}.bind(this))},toggleShotenClass:function(n){this.$el.find("li > div").each(function(t,i){var r=$(i);r.parent().hasClass("ellipsis")?r.height()<=n&&r.parent().removeClass():r.parent().data("shorten-flag")&&r.height()>n&&r.parent().addClass("ellipsis")})},_draw:function(n){for(var s,t=[],i=[],o=[],u=15,e,f=this,r=0,c=this.data.length;r<c;r++)s=this.data[r],s.indent?i.push(this.createArticle(this.data[r],r)):(t.push('<div class="board-view-article">'),t.push(this.createArticle(this.data[r],r)),t.push("<\/div>"));if(this.data.length<=u+1?(t.push('<div class="board-view-reply">'),t.push(i.join("")),t.push("<\/div>")):t.push('<div class="board-view-reply"><\/div>'),$.isEmpty(n)?this.$el.html(t.join("")):(this.$el=$(this.template),this.$el.append(t.join("")).appendTo(n)),this.bindEvent(this.$el),this.data.length>u+1){e=this.$el.find(".board-view-reply");function h(){o=i.length>u?i.splice(0,u):i.splice(0,i.length);e.append($(o.join("")));i.length>0?ecount.global.setTimeout(f.ecPageID,function(){h()},0):(f.bindEvent.call(f,e),f.adjustPopupSize())}h()}else this.adjustPopupSize()},bindEvent:function(n){n.find("a[data-action='descriptionLink'], a[data-no], button[data-no], div.panel-heading.reply > .article-title").on("click",this._ON_CLICK.bind(this));n.find(".panel-heading a[data-findex]").on("click",this._ON_FILE_CLICK.bind(this));n.find(".panel-heading a[data-function='profile']").on("click",this._ON_PROFILE_CLICK.bind(this));n.find(".panel-heading .dropdown-menu a").on("click",this._ON_DESCRIPTION_TOGGLE.bind(this));n.find(".article-attached-file li a").filter(function(n,t){return $(t).hasClass("file-name")&&$(t).attr("data-tooltip-title")!="undefined"}).each(function(t,i){bootstrapFunc.tooltip.call($(i),{container:n.closest(".panel-modal"),placement:"top",trigger:"hover",title:$(i).attr("data-tooltip-title"),delay:{show:ecount.common.mouseHoverInTime,hide:ecount.common.mouseHoverOutTime}})})},setFocus:function(n,t,i){var o=String.format("div.article a[data-headno='{0}']",n),f=this.$el.find(o),r,u,e;$.isEmpty(f)||(r=f.contents().eq(2),u=f.parents(".article"),!$.isEmpty(r)&&r[0]&&r[0].nodeType==3&&r.replaceWith(String.format('<span class="text-primary-inverse pa-2" >{0}<\/span>',r.text())),this.expand(n),t==!0&&u&&u.length>0&&(e=u.offset().top-11,$.isNumeric(i)&&(e-=i),ecount.runtime.notify("page.move.scroll",null,{ecPageID:this.ecPageID,animate:500,scroll:{scrollTop:e}})))},adjustPopupSize:function(){this._collapseList&&this.collapse(this._collapseList);this.delegator&&this.delegator.triggerEvent("page.adjustPopupSize",{target:this.$el.children(".board-view-article"),isIncludeHeaderHeight:!0,callback:function(n){this.currentBoardSeq&&this.setFocus.call(this,this.currentBoardSeq,!0,n)}.bind(this)})},createArticle:function(n,t){var f=n.indent,e=this.autoCloseHTMLTag(n.title),o=ecount.resource,s,i,r,u;return n.isFocus==!0&&(this.currentBoardSeq=n.no),s=!n.indent,i="",n.description.length>0&&!(n.description.length==1&&n.description[0]=="")&&(i=String.format('<div class="wrapper-toolbar article-info'+(this._hideDescription?" hide":"")+'"><div class="pull-left">{0}<\/div><\/div>',n.description.join('<span class="inline-divider"><\/span>'))),r=this._createDescription2(n,n.description2),u=this._createAttech(n,t),ecount.widget.replaceAttr(this.templateArticle,{titleTemplate:n.isUseLinkTitle===!0?String.format('<a href="javascript:;" data-headno="{0}" data-action="toggleHead" class="article-name">{1}<\/a>',n.no,e):String.format('<span class="article-name">{0}<\/span>',e),title:n.title,indent:f?"indent"+f:"",functionIndex:t,preface:this._createPreface(n,t),contents:n.contents,videoReply:this.createVideoReply(n,t),no:n.no,description:i,description2:r,attech:u,descriptionToggle:(r||u)&&s?['<div class="btn-group">','<button class="btn btn-default dropdown-toggle" data-toggle="dropdown"><\/button>','<ul class="dropdown-menu dropdown-menu-right">','<li><a href="javascript:;">'+(this._hideDescription?o.LBL02244:o.LBL02265)+"<\/a><\/li>","<\/ul>","<\/div>"].join(""):"",footer:this.createArticleFooter(n,t),folderStyle:n.isOldPost?"style='display:none;'":"",panelBodyCss:n.panelBodyCss||"",panelFooterCss:n.panelFooterCss||"",panelDefaultClass:n.panelDefaultClass||"",reply:n.indent?"reply":"",action:n.indent?"toggleHead":""})},_createAttech:function(n,t){var u=[],f="",s=this._editable==!1?' style="cursor: not-allowed;"':"",e="",r,o,i;if(e=this.setOnlyDownload(t),n.attachment)for(r=0,o=n.attachment.length;r<o;r++)i=n.attachment[r],i.url&&i.url.indexOf("FILE")==0&&(i.type="file",i.url.indexOf("FILEV")==0&&(i.type="ecdrive")),u.push("<li"+(i.type?" class='attached-"+i.type+"'":"")+'><a href="javascript:;" data-tooltip-title="'+i.title+'" data-function-index="'+t+'" data-index="'+t+'" data-findex="'+r+'" class="file-name">'+n.attachment[r].name+'<\/a><a href="javascript:;" data-index="'+t+'" data-findex="'+r+'"'+e+s+"><\/a><\/li>");return u.length>0&&(f=String.format('<div class="wrapper-toolbar article-info'+(this._hideDescription?' hide"':'"')+'><div class="wrapper-toolbar article-attached-file"><ul>{0}<\/ul><\/div><\/div>',u.join(""))),f},_createDescription2:function(n,t){var i={},s="",r=[],h=this.infoVisible||0,u="",e="",o="",f;if(t=t||[],$.isArray(t)||(t=[t]),t.length>0){for(f=0;f<t.length;f++)i=t[f],(i.visible==undefined||i.visible==0||i.visible==2&&i.label)&&(u="",e="",o="",t.length===1&&(u=" width-auto"),i.type!==!0&&(u+=" ellipsis",e=" data-shorten-flag=true"),o=u?"class="+u:"",r.push("<li "+o+e+">"),r.push("<div>"),$.isString(i)&&i.length>0?r.push(i):i.name?r.push(String.format("<span class='text-bold'>{0}<\/span> : {1}",i.name,i.label||"")):i.label&&r.push(i.label),r.push("<\/div><\/li>"));r.length>0&&(s=String.format('<div class="wrapper-toolbar article-info'+(this._hideDescription?" hide":"")+'" {1}><ul class="article-info-detail">{0}<\/ul><\/div>',r.join(""),n.isOldPost?"style='display:none;'":""))}return s},_createPreface:function(n,t){var i,r,u,f;if(!n.preface||(i=$(n.preface),!i||i&&i.length==0))return"";if(r=i.find("a"),r&&r.length>0)for(u=0;u<r.length;u++)f=r.eq(u),f.attr({href:"javascript:;","data-function-index":t,"data-no":n.no,"data-action":"preface","data-preface-index":u});return i.outerHTML()},setOnlyDownload:function(n){var t="";return this._onlyDownloadTarget?(this._onlyDownloadTarget=this._onlyDownloadTarget.toUpperCase(),this._onlyDownloadTarget==="N"?t=n===0?"":' class="file-delete"':this._onlyDownloadTarget==="R"&&(t=n>0?"":' class="file-delete"')):t=' class="file-delete"',t},createVideoReply:function(n,t){var i=[];return n.videoReply&&(i.push('<div class="wrapper-toolbar">'),i.push(String.format('<a href="javascript:;" data-function-index="'+t+'" data-no="{{no}}" data-action="video" class="text-danger">[{0}]<\/a>',ecount.resource.LBL02840)),i.push("<\/div>")),i.join("\n").replace(/{{no}}/gi,n.no)},createArticleFooter:function(n,t){var i=[],r=ecount.resource,u=this._editable==!1?' style="cursor: not-allowed;"':"";return i.push('<div class="wrapper-toolbar">'),i.push('<div class="pull-left">'),i.push('<div class="control-set">'),this.disableInProgress||n.disableInProgress||(i.push('<div class="control">'),i.push(String.format('<button class="btn btn-sm btn-default" data-function-index="'+t+'" data-no="{{no}}" data-action="inProgress">{0}<\/button>',r.LBL04731)),i.push("<\/div>")),this.disableReply||n.disableReplyItem||(i.push('<div class="control">'),i.push(String.format('<button class="btn btn-sm btn-default" data-function-index="'+t+'" data-no="{{no}}" data-action="reply">{0}<\/button>',r.LBL01000+(n.isMainContents?"(F8)":""))),i.push("<\/div>")),this.disableCopy||n.showCopyItem!==!0||(i.push('<div class="control">'),i.push(String.format('<button class="btn btn-sm btn-default" data-function-index="'+t+'" data-no="{{no}}" data-action="copy">{0}<\/button>',r.BTN00028)),i.push("<\/div>")),this.disableVideoReply||n.disableVideoReplyItem||(i.push('<div class="control">'),i.push(String.format('<button class="btn btn-sm btn-default" data-function-index="'+t+'" data-no="{{no}}" data-action="videoReply">{0}<\/button>',r.BTN00447)),i.push("<\/div>")),this.disableModify||n.disableModifyItem||(i.push('<div class="control">'),i.push(String.format('<button class="btn btn-sm btn-default" data-function-index="'+t+'" data-no="{{no}}" data-action="modify">{0}<\/button>',r.LBL01732)),i.push("<\/div>")),this.disableDelete||n.disableDeleteItem||(i.push('<div class="control">'),i.push(String.format('<button class="btn btn-sm btn-default" data-no="{{no}}" data-action="delete">{0}<\/button>',r.LBL06157)),i.push("<\/div>")),this.disableHistory||n.showHistoryItem!==!0||(i.push('<div class="control">'),i.push(String.format('<button class="btn btn-sm btn-default" data-no="{{no}}" data-action="history">{0}<\/button>',"H")),i.push("<\/div>")),this.disableClose||n.disableCloseItem||(i.push('<div class="control">'),i.push(String.format('<button class="btn btn-sm btn-default" data-no="{{no}}" data-action="close">{0}<\/button>',r.BTN00008)),i.push("<\/div>")),i.push("<\/div>"),i.push("<\/div>"),i.push('<div class="pull-right">'),i.push('<div class="control-set">'),this.disablelike||n.disableLikeItem||(i.push('<div class="control">'),i.push(String.format('<button class="btn btn-default board-recommend-up {0}" data-no="{{no}}" id="btnLike-{{no}}" data-action="like">{1}<\/button>',n.useyn==1?" active":n.useyn==0?" deactivate":"",n.totallike)),i.push("<\/div>")),this.disabledislike||n.disableDislikeItem||(i.push('<div class="control">'),i.push(String.format('<button class="btn btn-default board-recommend-down {0}" data-no="{{no}}" id="btnDislike-{{no}}" data-action="dislike">{1}<\/button>',n.useyn==0?" active":n.useyn==1?" deactivate":"",n.totaldislike)),i.push("<\/div>")),i.push("<\/div>"),i.push("<\/div>"),i.push("<\/div>"),i.join("\n").replace(/{{no}}/gi,n.no)},getHTML:function(){var n=this.$el.clone();return n.find(":input").remove(),n.find("select").contents().unwrap(),n.append($('<table class="" style="width:0px;display:none;"><colgroup><col><\/col><\/colgroup><tbody><tr><th><\/th><\/tr><\/tbody><\/table>')),n.html()},toggle:function(n){var t={},r=0,i;for($.isArray(n)||(n=[n]),i=0;i<n.length;i++)r=n[i],t=this.$el.find("div[data-no="+r+"]"),t.find(".panel-body").toggle(),t.find(".panel-footer").toggle(),t.find(".article-info").toggle()},collapse:function(n){var t={},r=0,i;for($.isArray(n)||(n=[n]),i=0;i<n.length;i++)r=n[i],t=this.$el.find("div[data-no="+r+"]"),t.find(".panel-body").hide(),t.find(".panel-footer").hide(),t.find(".article-info").hide()},expand:function(n){var t={},r=0,i;for($.isArray(n)||(n=[n]),i=0;i<n.length;i++)r=n[i],t=this.$el.find("div[data-no="+r+"]"),t.find(".panel-body").show(),t.find(".panel-footer").show(),t.find(".article-info").show()},collapseAll:function(){this.$el.find(".panel-body").hide();this.$el.find(".panel-footer").hide();this.$el.find(".article-info").hide()},expandAll:function(){this.$el.find(".panel-body").show();this.$el.find(".panel-footer").show();this.$el.find(".article-info").show()},autoCloseHTMLTag:function(n){var t=n;return $.isString(n)&&n.length>0&&(t+=this.autoInsertCloseTag(n,["b","i","u"])),t},autoInsertCloseTag:function(n,t){for(var f,i="",e="",r="",o="",s=0,h=0,u=0;u<t.length;u++)for(i=t[u],e="<"+i+">",r="<\/"+i+">",s=this.countWord(n,e),h=this.countWord(n,r),f=0;f<s-h;f++)o+=r;return o},countWord:function(n,t){var i=new RegExp(t,"g");return(n.match(i)||[]).length},_ON_CLICK:function(n){var u;n.preventDefault();var t=$(n.target),r=0,i="";if(t.length>0&&t[0].nodeName!="A"&&t[0].nodeName!="BUTTON"&&(t=t.hasClass("reply")==!0||this.$panelHeading.find(t)?$(n.currentTarget):$(t.closest("a"))),t&&t.data("function")==="profile")return!1;r=t.data("no");i=t.data("action");linkTargetId=t.data("linkTargetId");i==="toggleHead"?(r=t.data("headno"),this.toggle(r)):i==="descriptionLink"?this.delegator&&this.delegator.triggerEvent("boardView.button.click",{command:"onBoardAction",action:i,linkTargetId:linkTargetId}):i==="preface"?(u={event:n},this.delegator&&this.delegator.triggerEvent("page.customPageInvoke",_.merge({commandName:_.camelCase("on_"+this.containerName+"_preface_click")},u,t.data()))):this.delegator&&this.delegator.triggerEvent("boardView.button.click",{command:"onBoardAction",action:i,no:r})},_ON_FILE_CLICK:function(n){var t=$(n.target),i=t.data("index"),e=t.data("findex"),r=t.hasClass("file-delete")?"file-delete":"file-download",u,f=this;if(r==="file-delete"){if(this._editable==!1)return;u=function(){t.parent().remove()}}f.data[i]&&this.delegator.triggerEvent("boardView.button.click",{command:"onBoardAction",action:r,file:f.data[i].attachment[e],deleteHandler:u})},_ON_PROFILE_CLICK:function(n){var t=$(n.target),i=t.attr("data-value");ecount.common.api({url:"/Common/Menu/GetProfileUserInfomation",ecPageID:this.ecPageID,data:{WRITER_ID:i},success:function(n){var t,i;n.Status=="200"&&n.Data.length!=0&&(t=n.Data.Data.IS_EXIST?n.Data.Data.FILE_PATH:n.Data.Data.DefaultImage,i={ID:n.Data.Data.data.ID,name:n.Data.Data.data.UNAME,phone:n.Data.Data.data.HP_NO,email:n.Data.Data.data.EMAIL,message:n.Data.Data.CHAT_STATUS_PHRASE,url:t,chatYN:n.Data.Data.CHAT_YN,userName:n.Data.Data.data.UNAME,SessionData:n.Data.Data.SessionData,profileViewData:n.Data.Data.profileViewData},ecount.profile.show(i))},complete:function(){}.bind(self)});n.preventDefault()},_ON_DESCRIPTION_TOGGLE:function(n){var r=$(n.target),t=this.$el.find(".article-info"),u=ecount.resource,i="";t.is(":visible")?(r.html(u.LBL02244),t.addClass("hide"),i="hide"):(r.html(u.LBL02265),t.removeClass("hide"),i="show");this.delegator.triggerEvent("boardView.dropdown.click",{command:"onExpendClick",value:i,control:this,event:n})},redraw:function(n){this.data=n;this._draw()}},create:function(){var n=$.extend({},this.prop);ecount.layout.boardView=$.Class(ecount.layout,n)}}};ecount.layout.boardListView||(ecount.layout.boardListView={});ecount.layout.boardListView._export=function(){return{prop:{template:'<ul class="online-inquiry-list"><\/ul>',templateSubject:'<div class="subject {{subjectClass}}">\n<div class="num">[{{index}}]<\/div>\n<div class="title">{{title}}<\/div>\n<div class="state {{stateClass}}">{{state}}<\/div>\n<div class="date">{{date}}<\/div>\n<\/div>',templateQuestion:'<div class="question">\n<\/div>',templateAnswer:'<div class="answer">\n<\/div>',templateAttach:'<div class="inquiry-attach">\n<\/div>',templateFile:'<div class="inquiry-attach-file">\n<ul class="wrapper-attach-file">\n<\/ul>\n<\/div>',openDefault:!1,init:function(){ecount.layout.prototype.init.apply(this,arguments)},render:function(n){this.$el=$(this.template);this.$noData=$('<li class="nodata collapsed">'+(this.noDataTitle?this.noDataTitle:ecount.resource.MSG00205)+"<\/li>");this.$el.append(this.$noData);n.append(this.$el);this.draw(this.data);this._setObserve();this._bindEvent()},_setObserve:function(){},_stopObserving:function(){},_bindEvent:function(){this.$el.off("click."+this.ecPageID).on("click."+this.ecPageID,this.ON_CLICK.bind(this))},_unBindEvent:function(){this.$el.off("click."+this.ecPageID)},destroy:function(){this._stopObserving();this._unBindEvent();ecount.layout.prototype.destroy.apply(this,arguments)},draw:function(n){this.removeAllDraw();this._draw(n,!1)},addDraw:function(n){this._draw(n,!0)},removeAllDraw:function(){this.data=[];this.$el.children().not(".nodata").remove();this.setNoDataDisplay(!0)},setNoDataDisplay:function(n){this.$noData[n?"removeClass":"addClass"]("hidden")},_draw:function(n,t){var e,c,i,f;if(!(_.isArray(n)&&n.length>0)){t||this.removeAllDraw();return}var o=document.createDocumentFragment(),s=null,r=null,f=null,u=null,h=null;for(this.setNoDataDisplay(!1),e=0,c=n.length;e<c;e++)i=n[e],i.groupIndex==0?(s=i.groupId,r=document.createElement("li"),r.className=i.active||this.openDefault?"active":"collapsed",r.setAttribute("data-index",i.index),r.setAttribute("data-group",i.groupId),f=ecount.widget.replaceAttr(this.templateSubject,{index:i.index,title:i.title,state:i.state,subjectClass:this.openDefault?"cursor-default":"",stateClass:i.isEditor?"inprogress":"",date:i.date}),r.appendChild($(f).get(0)),u=document.createElement("div"),u.className="content",i.contents&&(h=ecount.widget.replaceAttr('<div class="question">{{contents}}{{attachBox}}{{editBtn}}<\/div>',{contents:i.contents,attachBox:this._createAttach(i),editBtn:this._createEditBtn(i)}),u.appendChild($(h).get(0))),r.appendChild(u),o.appendChild(r)):s===i.groupId&&i.contents&&(f=ecount.widget.replaceAttr('<div class="answer">{{contents}}{{attachBox}}{{date}}<\/div>',{contents:i.contents,attachBox:this._createAttach(i),date:'<div class="date">'+i.date+"<\/div>"}),u.appendChild($(f).get(0)));this.$el[0].appendChild(o);this.data=t?this.data.concat(n):n},_createAttach:function(n){var o='<div class="inquiry-attach-file"><ul class="wrapper-attach-file">{{attachList}}<\/ul><\/div>',f='<li>\n<span class="label label-default label-light">{{typeName}}<\/span>\n<a href="javascript:;" data-id="{{id}}" data-type="{{type}}" data-tooltip-title="{{typeName}}" data-index="{{index}}" data-group="{{group}}" data-gindex="{{gindex}}" data-findex="{{findex}}" >{{name}}<\/a>&nbsp;{{size}}\n<span data-id="{{id}}" data-type="{{type}}" data-index="{{index}}" data-group="{{group}}" data-gindex="{{gindex}}" data-findex="{{findex}}" class="file-status {{useDeleteAttach}}"><\/span>\n<\/li>',s="",h="",u=[],e,i,r,t;if(_.isArray(n.attachInfo)&&n.attachInfo.length>0)for(i=0,r=n.attachInfo.length;i<r;i++)t=n.attachInfo[i],t.url&&t.url.indexOf("FILE")==0&&(t.type="file",t.url.indexOf("FILEV")==0&&(t.type="ecdrive")),u.push(ecount.widget.replaceAttr(f,{type:t.type||"file",attachType:"",typeName:t.typeName,name:t.name,id:t.id||"",index:n.index,group:n.groupId,gindex:n.groupIndex,findex:i,size:n.size||"",useDeleteAttach:n.useDeleteAttach?"":"hidden"}));if(_.isArray(n.manualInfo)&&n.manualInfo.length>0)for(i=0,r=n.manualInfo.length;i<r;i++)t=n.manualInfo[i],u.push(ecount.widget.replaceAttr(f,{type:t.type||"article",typeName:t.typeName,name:t.name,id:t.id||"",index:n.index,group:n.groupId,gindex:n.groupIndex,findex:i,size:n.size||"",useDeleteAttach:n.useDeleteAttach?"":"hidden"}));if(_.isArray(n.videoInfo)&&n.videoInfo.length>0)for(i=0,r=n.videoInfo.length;i<r;i++)t=n.videoInfo[i],u.push(ecount.widget.replaceAttr(f,{type:t.type||"movie",typeName:t.typeName,name:t.name,id:t.id,index:n.index,group:n.groupId,gindex:n.groupIndex,findex:i,size:"",useDeleteAttach:n.useDeleteAttach?"":"hidden"}));if(u.length>0&&(s=ecount.widget.replaceAttr(o,{attachList:u.join("\n")})),_.isArray(n.recordInfo)&&n.recordInfo.length>0){for(e=[],i=0,r=n.recordInfo.length;i<r;i++)t=n.recordInfo[i],e.push(ecount.widget.replaceAttr(f,{type:t.type||"record",typeName:t.typeName,name:t.name,id:t.id,index:n.index,group:n.groupId,gindex:n.groupIndex,findex:i,size:"",useDeleteAttach:n.useDeleteAttach?"":"hidden"}));e.length>0&&(h=ecount.widget.replaceAttr(o,{attachList:e.join("\n")}))}return ecount.widget.replaceAttr('<div class="inquiry-attach">{{fileAndManual}}{{video}}<\/div>',{fileAndManual:s,video:h})},_createEditBtn:function(n){if(!n.isEditor)return"";var t='<div class="wrapper-toolbar">\n<div class="control-set">\n<div class="control">\n<button data-type="edit" data-index="{{index}}" data-group="{{group}}" data-gindex="{{gindex}}" class="btn btn-sm btn-default">{{editName}}<\/button>\n<\/div>\n<div class="control">\n<button data-type="delete" data-index="{{index}}" data-group="{{group}}" data-gindex="{{gindex}}" class="btn btn-sm btn-default">{{deleteName}}<\/button>\n<\/div>\n<\/div>\n<\/div>';return ecount.widget.replaceAttr(t,{index:n.index,group:n.groupId,gindex:n.groupIndex,editName:ecount.resource.LBL80149,deleteName:ecount.resource.LBL06157})},ON_CLICK:function(n){n.preventDefault();var t=null,r=n.target.className=="subject"?$(n.target):$(n.target).parents(".subject"),i=r&&r.length>0?r.parent():n.target.tagName=="LI"?$(n.target):null;_.isNil(n.target.getAttribute("data-findex"))?n.target.tagName==="BUTTON"?t=this.getButtonClickParam(n):i&&i.length>0&&!this.openDefault&&(t={action:"click",index:i.attr("data-index"),groupId:i.attr("data-group")}):t=this.getAttachClickParam(n);t&&this.delegator&&this.delegator.triggerEvent("boardView.button.click",_.merge({event:n,command:"onBoardAction"},t))},getAttachClickParam:function(n){function l(n,t,i){var r="";switch(t){case"file":r="attachInfo";break;case"article":r="manualInfo";break;case"movie":r="videoInfo";break;case"record":r="recordInfo"}return _.get(n,[r,i])}var t=$(n.target),r=t.data("index"),h=t.data("id"),u=t.data("type"),c=t.data("group"),f=t.data("findex"),i=this.data.find(function(n){return n.index==r}),e=i.useDeleteAttach&&t.hasClass("file-status")?"file-delete":"file-download",o,s;return e==="file-delete"&&(o=function(){t.parent().remove()}),i&&(s={action:e,index:r,id:h,type:u,group:c,findex:f,file:l(i,u,f),deleteHandler:o}),s},getButtonClickParam:function(n){var t=$(n.target),i=t.data("index"),u=t.data("group"),f=t.data("type"),e=this.data.find(function(n){return n.index==i}),r;return e&&(r={action:f,index:i,group:u}),r}},create:function(){var n=$.extend({},this.prop);ecount.layout.boardListView=$.Class(ecount.layout,n)}}};ecount.implements(ecount.class("ecount.layout.drawingPaper","ecount.layout",{template:['<div id="{{id}}" class="__ecReportContainer {{css}}" data-layouttype="drawingPaper" {{style}}>',"{{text}}","<\/div>",].join(""),renderStatus:"rendering",useTemplateOnlyRender:!0,init:function(n){this._options=n;this.constValue=ecount.constValue;this.reportConstValue=ecount.constValue.drawingPaper;ecount.layout.prototype.init.apply(this,arguments);this.invalidControlList=[];this.itemList=[];this.ecIKey=ecount.global.registerEcInstance(this);this.shapeUtils=new ecount.report.lib.shapeUtils;this.convertor=new ecount.report.lib.convertor;this.isFirstArea=!1},render:function(){this.beforeRender&&this.beforeRender();delete this.style["background-image"];delete this.style["background-image-width"];delete this.style["background-image-height"];this.template=this.renderTemplate();ecount.layout.prototype.render.apply(this,arguments);ecount.global.setTimeout(this.ecPageID,this.callbackRender.bind(this),0)},callbackRender:function(){var n,i,f,r,u,t;this.initEvent&&this.initEvent();this.declareEvent&&this.declareEvent();this.config.mode==this.reportConstValue.mode.edit&&(this.actionInstanceManager.selectableRangeActionInstance=this.getActionInstance("ecount.report.shape.selectableRange"),this.config.dragable.use&&(this.instanceManager.dragableInstance=new ecount.report.dragable),this.instanceManager.historyInstance=this._options.historyInstance||new ecount.report.history({isEqual:function(n,t){return n.status==t.status&&n.innerHTML==t.innerHTML&&n.scrollTop==t.scrollTop&&n.scrollLeft==t.scrollLeft?!0:!1}}),this.instanceManager.clipboardInstance=this._options.clipboardInstance||new ecount.report.clipboard({isContract:this.isContract}),this.config.contextmenu.use&&(this.instanceManager.contextmenuInstance=new ecount.report.contextmenu[this.config.contextmenu.type]({},this.events)));this.createWrapperEl();this._lineHandlerPool=new ecount.report.lib.lineHandler({poolMaximumSize:200,poolMinimumSize:5},this.events);this.entityTree=new ecount.report.lib.entityTree({_nodeApi:this._nodeApi,_node:this._node,isDocumentEvidence:this.isDocumentEvidence},this.events);n=this.getOldHtmlElement();n&&(n.addClass("cursor-text"),n.find(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector).attr("contenteditable","true"),n.find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector).addClass("cursor-pointer"));this.config.mode==this.reportConstValue.mode.edit?(this._options.smartguide.use&&(this._options.smartGuideManagerInstance?this.actionInstanceManager.smartGuideManagerActionInstance=this._options.smartGuideManagerInstance:(this.actionInstanceManager.smartGuideManagerActionInstance=new ecount.report.shape.smartGuideManager.action({controlSelector:"[data-controltype]",scrollContainer:this.scrollContainer,scrollContainerSelector:this.config.scrollContainerSelector},this.events),this.actionInstanceManager.smartGuideManagerActionInstance.render(this.$wrapperEl))),this.bindContextmenuEvent(),this.config.stageSelector&&(this.$stage=this.$el.closest(this.config.stageSelector)),this.$stage&&this.$stage.length&&this.config.scrollContainerSelector&&(this.$scrollContainer=this.$stage.closest(this.config.scrollContainerSelector),this.scrollContainer=this.$scrollContainer&&this.$scrollContainer.length&&this.$scrollContainer[0]),this.bindMousedownEvent(),this.bindMousemoveEvent(),this.bindMouseupEvent(),this.bindKeydownEvent(),this.bindCopyEvent(),this.bindPasteEvent(),this.bindCutEvent(),this.constValue.isIE&&(document.body.addEventListener("mscontrolselect",function(n){n.preventDefault()}),document.execCommand("AutoUrlDetect",!1,!1))):this.config.mode==this.reportConstValue.mode.view&&this._options.shape.sign.currentUserSignInfo&&(i=this._options.shape.sign.currentUserSignInfo.step,f=this.$wrapperEl.find("[data-step]").filter(function(n,t){var r=$(t);return r.attr("data-step")!=i}));r=$.extend({resizeType:"all",resizeTarget:"all",heightSections:["tbody"],groupColumns:{},isInGrid:!1},this.defaultTableResizeOptions||{});u=$.extend({container:null,body:this.scrollContainer,isAttachMousedownEvent:!1,isAttachMousemoveEvent:!1,isAttachMouseupEvent:!1,resizeWidthSelector:this.reportConstValue.resizeWidthCellSelector,resizeHeightSelector:this.reportConstValue.resizeHeightCellSelector,resizeEnableSelector:[this.reportConstValue.resizeWidthCellSelector,this.reportConstValue.resizeHeightCellSelector],resizeBothSelector:[this.reportConstValue.resizeWidthCellSelector,this.reportConstValue.resizeHeightCellSelector],calculateScroll:!1,isPossibleWidthCallback:function(n,t){return ecount.common.canResizeTableCelLWidthByBoundingClientRect(ecount.common.getEventPoint(t),n.boundary,n)}.bind(this),isPossibleWidthLeftCallback:function(n,t){return ecount.common.canResizeTableLeftWidthByBoundingClientRect(ecount.common.getEventPoint(t),n.boundary,n)}.bind(this),isPossibleWidthRightCallback:function(n,t){return ecount.common.canResizeTableRightWidthByBoundingClientRect(ecount.common.getEventPoint(t),n.boundary,n)}.bind(this),isPossibleHeightCallback:function(n,t){return ecount.common.canResizeTableCellHeightByBoundingClientRect(ecount.common.getEventPoint(t),n.boundary,n)}.bind(this),isPossibleHeightTopCallback:function(n,t){return ecount.common.canResizeTableTopHeightInCellByBoundingClientRect(ecount.common.getEventPoint(t),n.boundary,n)}.bind(this),isPossibleHeightBottomCallback:function(n,t){return ecount.common.canResizeTableBottomHeightByBoundingClientRect(ecount.common.getEventPoint(t),n.boundary,n)}.bind(this)},this.defaultTableResizeDetailOptions||{});this.shape.table.use&&this.config.mode==this.reportConstValue.mode.edit&&this.config.resizable&&this.shape.table.resizable.use&&(this.instanceManager.tableResize||(this.instanceManager.tableResize=new ecount.resizeTable(r,u)));this._options.useNotEditableBox&&this._options.useNotEditableBox.use&&this.createNotEditableBox();this.customTriggerEvent("drawingPaper.renderComplete",{id:this.id});this.entityTree.loadElements(this.$wrapperEl);this.bindScrollEvent(this.$wrapperEl);this.initPinFixedItem();this.loadMappingData();this.initShapeLayout();this._options.useDefaultBox&&this.createDefaultBox();this.resizeHandler();this.renderStatus="rendered";this.notifyFinishJobAtParent();this.hidden&&(this.$wrapperEl.hasClass("hidden")||this.$wrapperEl.addClass("hidden"));for(t in this.actionInstanceManager)this.actionInstanceManager.hasOwnProperty(t)&&this.itemList.push(this.actionInstanceManager[t]);this.config.mode==this.reportConstValue.mode.edit&&ecount.runtime.observe("scroll.page.eventContainer","clearLayer",function(n){this._ON_SCROLL({},n)}.bind(this));this.__afterRender&&this.__afterRender();this.config.mode==this.reportConstValue.mode.edit&&this.addDataInHistory()},initPinFixedItem:function(){var t=this.$wrapperEl.find("div.ec-container[class*='pin-fixed-']"),n,u;if(t.length)for(n=0,u=t.length;n<u;n++){var i=$(t[n]),e=i.attr("class")||"",f=(e.match(/pin-fixed-(top|bottom)-(left|center|right)/)||[])[0]||"",r=f.split("-")[3];_.isEmpty(r)||this.addPositionCollection({id:i.find("[data-controltype]").attr("id"),position:r,elClass:"ec-fixed-"+r,wrapperClass:f,left:Number(i[0].style.left.replace("px","")||0),gridWidth:Number(this.userData.gridWidth||0),gridLeft:Number(this.userData.gridLeft||0)})}},destroy:function(){var n;this.beforeDestroy&&this.beforeDestroy();this.unbindCopyEvent();this.unbindCutEvent();this.unbindPasteEvent();this.unbindKeydownEvent();this.unbindKeypressEvent();this.unbindKeyupEvent();this.unbindMousedownEvent();this.unbindMousemoveEvent();this.unbindMouseupEvent();this.unbindScrollEvent();for(n in this.actionInstanceManager)this.actionInstanceManager.hasOwnProperty(n)&&this.actionInstanceManager[n]&&this.actionInstanceManager[n].destroy&&this.actionInstanceManager[n].destroy();for(n in this.formActionInstanceManager)this.formActionInstanceManager.hasOwnProperty(n)&&this.formActionInstanceManager[n]&&this.formActionInstanceManager[n].destroy&&this.formActionInstanceManager[n].destroy();for(n in this.instanceManager)this.instanceManager.hasOwnProperty(n)&&this.instanceManager[n]&&this.instanceManager[n].destroy&&this.instanceManager[n].destroy();for(n in this.formInstanceManager)this.formInstanceManager.hasOwnProperty(n)&&this.formInstanceManager[n]&&this.formInstanceManager[n].destroy&&this.formInstanceManager[n].destroy();if(this.tempActionInstanceManager)for(n in this.tempActionInstanceManager)this.tempActionInstanceManager.hasOwnProperty(n)&&this.tempActionInstanceManager[n]&&this.tempActionInstanceManager[n].destroy&&this.tempActionInstanceManager[n].destroy();if(this.tempInstanceManager)for(n in this.tempInstanceManager)this.tempInstanceManager.hasOwnProperty(n)&&this.tempInstanceManager[n]&&this.tempInstanceManager[n].destroy&&this.tempInstanceManager[n].destroy();this.report&&this.report.destroy(!0);ecount.layout.prototype.destroy.call(this);this.report=null;delete this.report;this.afterDestroy&&this.afterDestroy()},__beforeInit:function(){},__afterInit:function(n){function i(){return!t.config.selectable.use&&(t.shape.horizontalline.selectable.use||t.shape.verticalline.selectable.use||t.shape.table.selectable.use||t.shape.rectangle.selectable.use||t.shape.image.selectable.use||t.shape.sign.selectable.use||t.shape.checkbox.selectable.use)}function r(){return!t.config.moveable.use&&(t.shape.horizontalline.moveable.use||t.shape.verticalline.moveable.use||t.shape.table.moveable.use||t.shape.rectangle.moveable.use||t.shape.image.moveable.use||t.shape.sign.moveable.use||t.shape.checkbox.moveable.use)}function u(){return!t.config.resizable.use&&(t.shape.horizontalline.resizable.use||t.shape.verticalline.resizable.use||t.shape.table.resizable.use||t.shape.rectangle.resizable.use||t.shape.image.resizable.use||t.shape.sign.resizable.use||t.shape.checkbox.resizable.use)}var t=this;this._global=new ecount.report.lib.global;this._doc=new ecount.report.lib.document;this._selection=new ecount.report.lib.selection(this._doc);this._node=new ecount.report.lib.node(this._doc,this._selection);this._range=new ecount.report.lib.range(this._doc,this._selection,this._node);this._cursor=new ecount.report.lib.cursor(this._doc,this._selection,this._range,this._node);this._font=new ecount.report.lib.font(this._doc,this._selection,this._range,this._node,this._cursor);this._clipboard=new ecount.report.lib.clipboard(this._doc);this._bookmark=new ecount.report.lib.bookmark(this._doc,this._selection,this._range,this._node);this._rangeApi=new ecount.report.api.range({_doc:this._doc,_selection:this._selection,_range:this._range,_node:this._node});this._nodeApi=new ecount.report.api.node({_doc:this._doc,_selection:this._selection,_range:this._range,_node:this._node});this.config={mode:this.mode||this.reportConstValue.mode.edit,inputMode:n.inputMode||this.reportConstValue.viewNEdit,status:this.reportConstValue.canvasStatus.selectable,drawShapeType:"none",resizeType:"none",editableId:null,active:n.initialAtive||!1,keyEventPreventDefault:!1,dragMouseDownSelector:"body",dragMouseMoveSelector:"body",dragMouseUpSelector:ecount.runtime.root.document,eventContainerBoundingClientRect:null,stageSelector:n.stageSelector,scrollContainerSelector:n.scrollContainerSelector,wrapperBoundingClientRect:null,layoutContainerPrefix:".",layoutContainerSelector:"wrapper-report-stage",dropdownmenu:{suffix:"drawingPaper",serviceKey:null,serviceKeyType:null},outline:{suffix:"drawingPaper",serviceKey:null,serviceKeyType:null},savedCursorInfo:[],isCloneShape:!1,isBeginHistoryTransaction:!1,isBeginSaveCursorTransaction:!1,isSyncFont:!0,cancelEvent:!1,deselectElementId:null,resizingRatios:null,shapeConfig:{},dragable:{use:!1},selectable:{use:!1},moveable:{use:!1},resizable:{use:!1},contextmenu:{use:n.contextmenu&&n.contextmenu.use||!1,type:n.contextmenu&&n.contextmenu.type||"type1",items:[]}};i()&&(this.config.selectable.use=!0);r()&&(this.config.moveable.use=!0);u()&&(this.config.resizable.use=!0);(this.config.selectable.use||this.config.moveable.use||this.config.resizable.use)&&(this.config.dragable.use=!0);this.collection=new ecountlib.data.collection;this.positionCollection=new ecountlib.data.collection;this.previousCollection=null;this.mappingDataCollection=n.mappingDataCollection||new ecountlib.data.collection;this.imageHyperlinkDataCollection=new ecountlib.data.collection;this.instanceManager={};this.formInstanceManager={};this.setActionInstanceManager({});this.setFormActionInstanceManager({});_.forEach(n.mappingDatas,function(n){this.mappingDataCollection.add(n)}.bind(this));_.forEach(n.imageHyperlinkDatas,function(n){this.imageHyperlinkDataCollection.add(n)}.bind(this))},__beforeRender:function(){},__afterRender:function(){},__beforeDestroy:function(){},__afterDestroy:function(){},renderTemplate:function(){var n="";return this.content&&this.content.replaceAll&&(n=this.content.replaceAll("$","$$")),this.template.replaceAll("{{id}}",this.id).replace("{{css}}",this.css).replace("{{style}}",ecount.convertor.convertToStyle(this.style)).replace("{{text}}",n||"")},initShapeLayout:function(){var n=this.entityTree.getEntities();n.list.forEach(function(n){var i=n.getDataProperty("container"),r=n.getDataProperty("el"),u=i.attr(this.reportConstValue.oldHTMLAttributeKey),t;u||this.useNotEditableBox.use||(t=r.find(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector),t.addClass("cursor-text"),t.find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector).addClass("cursor-pointer"))}.bind(this));this._options.isAdjustOutline&&this.addSelectOutline(this.$el);this.$wrapperEl.css("position")!="relative"&&this.$wrapperEl.css("position","relative")},addGrid:function(n){var i,r,t,u,f;for($.isArray(n)||(n=[n]),r=0;r<n.length;r++)t={},i=n[r],t.id=i.id,t.settings=i.grid,t.settings&&(t.settings.__ecGridHidden=i.isHide),t.settings&&(t.settings.__layoutSettings=i.layoutSettings),t.isDynamic=i.isDynamic,t.containerName=this.__type,t.__type=widget.generator.GRID,t.itemIndex=this.itemList.length,t.delegator=this.delegator,t.containerDelegator=this.events,t.ecPageID=this.ecPageID,t.inIncludePage=this.inIncludePage,t.popupID=this.popupID,t.popupLevel=this.popupLevel,t.eventContainer=this.eventContainer,t._addGrid=!0,u=new ecount.layout[t.__type](t),f=this.getControlTextContainer(this.useNotEditableBox.id),u.render(f),this.itemList.push(u)},createLineHandler:function(){return{element:this._node.appendLineHandler(this.$wrapperEl[0],this.getLineHandlerDefaultTemplate())}},getLineHandlerDefaultTemplate:function(){return{items:[{tagName:"div",className:"wrapper-areaselect-adjust draggable hide",children:[{tagName:"div",className:"areaselect-top hide ",children:[{tagName:"div",className:"areaselect-handle left nw-resize hide "},{tagName:"div",className:"areaselect-handle right ne-resize hide "},{tagName:"div",className:"areaselect-handle middle n-resize hide "}]},{tagName:"div",className:"areaselect-bottom hide ",children:[{tagName:"div",className:"areaselect-handle left sw-resize hide "},{tagName:"div",className:"areaselect-handle right se-resize hide "},{tagName:"div",className:"areaselect-handle middle s-resize hide "}]},{tagName:"div",className:"areaselect-left hide ",children:[{tagName:"div",className:"areaselect-handle middle w-resize hide "}]},{tagName:"div",className:"areaselect-right hide ",children:[{tagName:"div",className:"areaselect-handle middle e-resize hide "}]}]}]}},releaseLineHandler:function(n){var r,t,f,s,i;for(this.hideSuperParentLine(n),r=this.entityTree.getEntityFamilyById(n),t=0,f=r.length;t<f;t++){var u=r[t],e=u.getPool(),o=e&&e.id;if(o){if(s=u.getDataProperty("controlType"),i=this.getActionInstance(s),!i)continue;i.$el&&i.isEmptyDefaultBox()===!0||(this._lineHandlerPool.setUsePoolById(o),u.clearPool())}}},getInitData:function(n){$.extend({defaultZIndex:ecount.constValue.drawingPaper.defaultZIndex},n)},setActionInstanceManager:function(n){this.actionInstanceManager=n},setFormActionInstanceManager:function(n){this.formActionInstanceManager=n},getOldHtmlElement:function(){var n=this.$wrapperEl.find(this.reportConstValue.oldHTMLSelector);return n&&n.length?n:null},clearLineHandler:function(){this._lineHandlerPool.removeAll()},loadOutsideElements:function(n,t){var i=n;t&&(i=document.createElement("div").appendChild(n));var r=function(){}.bind(this),u=function(){}.bind(this),f=function(){}.bind(this);this._node.isElement(i)&&Array.prototype.slice.call(i.children).forEach(function(n){switch(n.tagName){case"TABLE":r(n);break;case"DIV":u(n);break;case"IMG":f(n)}}.bind(this))},loadLineHandler:function(){this._lineHandlerPool.createPool()},loadLineHandlerSync:function(n){var t=n.find(this.reportConstValue.lineHandlerPrefix+this.reportConstValue.lineHandlerSelector);t.each(function(n,t){var i=t.getAttribute("data-refid"),r,u;i?(r=this.getEntityById(i),u=this._lineHandlerPool.setLineHandler(t,!0),r.setPool(u)):this._lineHandlerPool.setLineHandler(t,!1)}.bind(this))},createWrapperEl:function(){var t="["+this.reportConstValue.wrapperAttrKey+"='"+this.reportConstValue.canvasWrapperSelector+"']",n;if(this.$wrapperEl=this.$el.find(t),!this.$wrapperEl.length){var i={position:"relative"},u=this.$el.html(),r="100%";this._options.initHeight&&(r=this._options.initHeight);i.height=r;n=$("<div "+this.reportConstValue.wrapperAttrKey+'="'+this.reportConstValue.canvasWrapperSelector+'">'+u+"<\/div>");n.css(i);this.$el.append(n);this.$wrapperEl=this.$el.find(t)}this._options.initMinHeight&&this.getCanvasHeight()<this._options.initMinHeight&&this.setHeight(this._options.initMinHeight)},createDefaultBox:function(){var n=this.getAllControls(),t,i;n&&n.length||(t=this.getDefaultBoxOptions(),i={directFocus:!1,directSelect:!1},this.drawDirectRectangle(t,i))},getDefaultBoxOptions:function(){var n={};return n[this.reportConstValue.defaultBoxAttrKey]=!0,_.extend({action:this.reportConstValue.shapeStatus.directDrawing,style:{top:"0",left:"0",width:"728px",height:"100px",border:"none"},attr:n,placeHolder:ecount.resource.MSG10840,isDragable:!0,isResizable:!0,isVisibleMove:!0},this._options.defaultBoxOptions,{})},createNotEditableBox:function(){var n={};n.id=this._options.useNotEditableBox.id;n[this.reportConstValue.notEditableBoxAttrKey]=!0;this.drawDirectRectangle({action:this.reportConstValue.shapeStatus.directDrawing,style:{top:"1",left:"1",border:"none"},textContainerClass:"word-break-word pr-1",attr:n,isDragable:!1,isResizable:!1,isNotEditable:!0},{directFocus:!1,directSelect:!1})},resetBoundingClientRect:function(){this.config.wrapperBoundingClientRect=null},getWrapperBoundingClientRect:function(){return this.config.wrapperBoundingClientRect||(this.config.wrapperBoundingClientRect=this.$wrapperEl[0].getBoundingClientRect()),this.config.wrapperBoundingClientRect},setTableResizeInstance:function(n,t){t=$.isBoolean(t)?t:!0;this.config.resizable&&this.config.table.resizable.use&&(this.actionInstanceManager.tableResize&&t&&(this.actionInstanceManager.tableResize.destroy&&this.actionInstanceManager.tableResize.destroy(),this.actionInstanceManager.tableResize=null),this.actionInstanceManager.tableResize=n)},setClipboardInstance:function(n){this.instanceManager.clipboardInstance=n},getControl:function(n){var t=this.$el.find("#"+n),r,i;return t&&t.length?(r=t.attr("data-controltype"),i=this.getActionInstance(r),i?i:null):null},getControlTextContainer:function(n){var t=this.getControl(n);return t?t.$textContainer:null},setCss:function(n){this.$wrapperEl.addClass(n)},getCss:function(n){return this.$wrapperEl.hasClass(n)},isShow:function(){return!this.$wrapperEl.hasClass("hidden")},show:function(){this.$wrapperEl.hasClass("hidden")&&this.$wrapperEl.removeClass("hidden")},hide:function(){this.$wrapperEl.hasClass("hidden")||this.$wrapperEl.addClass("hidden")},showShape:function(n){var i=this.getEntityById(n),t;i&&(t=this.getTempItem(i),t)&&t.show()},hideShape:function(n){var i=this.getEntityById(n),t;i&&(t=this.getTempItem(i),t)&&t.hide()},toggle:function(){this.settings.getCommonGridVersion&&this.settings.getCommonGridVersion()=="v3"?this.isShow()?this.hide():this.show():ecount.layout.prototype.toggle.apply(this,arguments)},isLastShape:function(n,t){var i=this.getItemById(n);if(!i)return null;i.setConfig({isLastShape:t})},active:function(){this.config.active||(this.config.active=!0,this.keyEventPreventDefault(!1),this.customTriggerEvent("drawingPaper.changeActive",{id:this.id,value:this.config.active}))},deactive:function(){this.config.active&&(this.config.active=!1,this.cloneCollectionData(),this.clearCollection(),this.resetCanvasConfig(),this.checkPaperMinHeight(),this.customTriggerEvent("drawingPaper.changeActive",{id:this.id,value:this.config.active}))},checkPaperMinHeight:function(){this._options.initHeight&&this.getCanvasHeight()<10&&this.setHeight(_.replace(this._options.initHeight,"px",""))},isActive:function(){return this.config.active},setFinTest:function(n){this.config.isFin=n},getFinTest:function(){return this.config.isFin},cloneCollectionData:function(){this.previousCollection=this.collection.cloneData()},keyEventPreventDefault:function(n){this.config.keyEventPreventDefault=n===!0},draw:function(n,t,i){var r,u;(i=$.extend({isClearCollection:!0},i||{}),t=t||{},t.style===void 0&&(t.style={}),t.className===void 0&&(t.className=[]),t.attr===void 0&&(t.attr={}),this.clearCollection(),r=this.getActionInstance(n),r)&&(t.action||(t.action=this.reportConstValue.shapeStatus.mouseDrawing),t.defaultZIndex=_.isNumber(t.defaultZIndex)?t.defaultZIndex:this.reportConstValue.defaultZIndex,r.setConfig(_.extend(this.getDefaultConfig(),t)),this.isResetCanvasBoundingClientRect(n)&&(r.resetCanvasBoundingClientRect(),this.setResetCanvasBoundingClientRect(!1,n)),r.setCanvas(this.$wrapperEl),r.setLineHandlerPool(this._lineHandlerPool),this.setDrawShapeType(n),t.action==this.reportConstValue.shapeStatus.mouseDrawing?(this.setStatus(this.reportConstValue.canvasStatus.drawable),r.setAction(this.reportConstValue.canvasStatus.drawable),this.addNoselectionInBody()):t.action==this.reportConstValue.shapeStatus.directDrawing&&(t.style&&(t.style.top||t.style.left)||(u=this.getBlankPosition(this.createDefaultBlankPoistion({initX:0,initY:0})),u.left!=-1&&u.top!=-1&&(t.style=t.style||{},t.style.top=u.top,t.style.left=u.left,r.setConfig(_.extend(this.getDefaultConfig(),t)))),r.draw(null,function(n){t.directSelect&&(r.$parent&&r.$parent.trigger("mousedown",{which:1,target:r.$el[0],notPreventTriggerEvent:!0}),r.$parent&&r.$parent.trigger("mouseup",{which:1,target:r.$el[0],notPreventTriggerEvent:!0}));t.callback&&t.callback(n)})))},drawDirectShape:function(n,t,i){i=i||this.reportConstValue.shapeType.rectangle;n=_.extend({action:this.reportConstValue.shapeStatus.directDrawing,isDragable:!0,isResizable:!0,style:{width:"100"},attr:{},className:[]},n||{});t=_.extend({directFocus:!1,directSelect:!1},t||{});this.draw(i,n);var r=this.getActionInstance(i);if(r)return t.directSelect&&(r.$el.trigger("mousedown",{which:1,target:r.$el[0],notPreventTriggerEvent:!0}),r.$el.trigger("mouseup",{which:1,target:r.$el[0],notPreventTriggerEvent:!0})),t.directFocus?(r.setFocusInTextContainer(),r.setFocusOutTextContainer()):r.setFocusOutTextContainer(),r.$el},drawDirectRectangle:function(n,t){var r,i;if(n=_.extend({action:this.reportConstValue.shapeStatus.directDrawing,isDragable:!0,isResizable:!0,style:{width:"100"},attr:{},className:[]},n||{}),t=_.extend({directFocus:!1,directSelect:!1},t||{}),r=this.reportConstValue.shapeType.rectangle,this.draw(r,n),i=this.getActionInstance(r),i)return t.directSelect&&(i.$el.trigger("mousedown",{which:1,target:i.$el[0],notPreventTriggerEvent:!0}),i.$el.trigger("mouseup",{which:1,target:i.$el[0],notPreventTriggerEvent:!0})),t.directFocus?(i.setFocusInTextContainer(),i.setFocusOutTextContainer()):i.setFocusOutTextContainer(),i.$el},getActiveCollection:function(){return this.previousCollection||this.collection},merge:function(){for(var n,i=!1,t=0,r=this.collection.list.length;t<r;t++){if(n=this.getItemById(this.collection.list[t].id),!n)return;n.merge&&(n.merge(),i=!0)}this.customTriggerEvent("drawingPaper.shapeStyle",{});this.customTriggerEvent("drawingPaper.layout",{});i&&this.addDataInHistory()},divide:function(){for(var n,i=!1,t=0,r=this.collection.list.length;t<r;t++){if(n=this.getItemById(this.collection.list[t].id),!n)return;n.divide&&(n.divide(),i=!0)}this.customTriggerEvent("drawingPaper.shapeStyle",{});this.customTriggerEvent("drawingPaper.layout",{});i&&this.addDataInHistory()},addUpRow:function(){for(var n,i=!1,t=0,r=this.collection.list.length;t<r;t++){if(n=this.getItemById(this.collection.list[t].id),!n)return;n.addUpRow&&(n.addUpRow(),i=!0)}this.customTriggerEvent("drawingPaper.shapeStyle",{});this.customTriggerEvent("drawingPaper.layout",{});i&&this.addDataInHistory()},addDownRow:function(){for(var n,i=!1,t=0,r=this.collection.list.length;t<r;t++){if(n=this.getItemById(this.collection.list[t].id),!n)return;n.addDownRow&&(n.addDownRow(),i=!0)}this.customTriggerEvent("drawingPaper.shapeStyle",{});this.customTriggerEvent("drawingPaper.layout",{});i&&this.addDataInHistory()},addLeftColumn:function(){for(var n,i=!1,t=0,r=this.collection.list.length;t<r;t++){if(n=this.getItemById(this.collection.list[t].id),!n)return;n.addLeftColumn&&(n.addLeftColumn(),i=!0)}this.customTriggerEvent("drawingPaper.shapeStyle",{});this.customTriggerEvent("drawingPaper.layout",{});i&&this.addDataInHistory()},addRightColumn:function(){for(var n,i=!1,t=0,r=this.collection.list.length;t<r;t++){if(n=this.getItemById(this.collection.list[t].id),!n)return;n.addRightColumn&&(n.addRightColumn(),i=!0)}this.customTriggerEvent("drawingPaper.shapeStyle",{});this.customTriggerEvent("drawingPaper.layout",{});i&&this.addDataInHistory()},deleteRow:function(){for(var n,i=!1,t=0,r=this.collection.list.length;t<r;t++){if(n=this.getItemById(this.collection.list[t].id),!n)return;n.deleteRow&&(n.deleteRow(),i=!0)}this.customTriggerEvent("drawingPaper.shapeStyle",{});this.customTriggerEvent("drawingPaper.layout",{});i&&this.addDataInHistory()},deleteColumn:function(){for(var n,i=!1,t=0,r=this.collection.list.length;t<r;t++){if(n=this.getItemById(this.collection.list[t].id),!n)return;n.deleteColumn&&(n.deleteColumn(),i=!0)}this.customTriggerEvent("drawingPaper.shapeStyle",{});this.customTriggerEvent("drawingPaper.layout",{});i&&this.addDataInHistory()},_cut:function(){var n,t;this.config.beforeCursorPosition&&this.config.beforeCursorPosition.editableId&&(n=this.getItemById(this.config.beforeCursorPosition.editableId),n&&(n.controlType===this.reportConstValue.shapeType.table?n.setCellEditable(!0):n.controlType===this.reportConstValue.shapeType.rectangle?n.setFocusInTextContainer():n.controlType===this.reportConstValue.shapeType.textbox&&n.setFocusInTextContainer()));this.restoreCursor();t=window.getSelection();this.collection.list.length==1?[this.reportConstValue.shapeType.rectangle,this.reportConstValue.shapeType.textbox].contains(this.collection.list[0].controlType)?t.isCollapsed?this.cutClipboard():this.cutClipboard():this.collection.list[0].controlType==this.reportConstValue.shapeType.table?t.isCollapsed?this.cutClipboard():this.cutClipboard():this.cutClipboard():this.cutClipboard()},_copy:function(){if(this.config.beforeCursorPosition&&this.config.beforeCursorPosition.editableId){var n=this.getItemById(this.config.beforeCursorPosition.editableId);n&&(n.controlType===this.reportConstValue.shapeType.table?n.setCellEditable(!0):n.controlType===this.reportConstValue.shapeType.rectangle?n.setFocusInTextContainer():n.controlType===this.reportConstValue.shapeType.textbox&&n.setFocusInTextContainer())}this.restoreCursor();this.copyClipboard()},_paste:function(){if(this.config.beforeCursorPosition&&this.config.beforeCursorPosition.editableId){var n=this.getItemById(this.config.beforeCursorPosition.editableId);n&&(n.controlType===this.reportConstValue.shapeType.table?n.setCellEditable(!0):n.controlType===this.reportConstValue.shapeType.rectangle?n.setFocusInTextContainer():n.controlType===this.reportConstValue.shapeType.textbox&&n.setFocusInTextContainer())}this.restoreCursor();this.pasteClipboard(null,null,null,{})},_pastePlainText:function(){if(this.config.beforeCursorPosition&&this.config.beforeCursorPosition.editableId){var n=this.getItemById(this.config.beforeCursorPosition.editableId);n&&(n.controlType===this.reportConstValue.shapeType.table?n.setCellEditable(!0):n.controlType===this.reportConstValue.shapeType.rectangle?n.setFocusInTextContainer():n.controlType===this.reportConstValue.shapeType.textbox&&n.setFocusInTextContainer())}this.restoreCursor();this.pasteClipboard(null,null,null,{isPlainText:!0})},_delete:function(){for(var t,u,i,n=0,r=this.collection.list.length;n<r;n++)if((t=this.getEntityById(this.collection.list[n].id),t)&&(u=t.getDataProperty("controlType"),[this.reportConstValue.shapeType.table,this.reportConstValue.shapeType.rectangle,this.reportConstValue.shapeType.textbox,"ecount.report.shape.image"].contains(u))){if(i=this.getItemById(this.collection.list[n].id),!i)continue;i.remove()}this.addDataInHistory()},onInitialize:function(){},activate:function(){},deactivate:function(){},setStatus:function(n){this.config.status=n;this.config.status==this.reportConstValue.canvasStatus.drawable?this.setCursorType(this.reportConstValue.canvasCursorType.add):this.setCursorType(this.reportConstValue.canvasCursorType.none)},setCursorType:function(n){switch(n){case this.reportConstValue.canvasCursorType.add:this.$wrapperEl.css("cursor","crosshair");this.$wrapperEl.find("."+this.reportConstValue.enableDrawingPaper).css("cursor","crosshair");this.$wrapperEl.find("[data-controltype]").css("cursor","crosshair");break;case this.reportConstValue.canvasCursorType.none:this.$wrapperEl.css("cursor","");this.$wrapperEl.find("."+this.reportConstValue.enableDrawingPaper).css("cursor","");this.$wrapperEl.find("[data-controltype]").css("cursor","")}},setResizeType:function(n){this.config.resizeType=n},setDrawShapeType:function(n){this.config.drawShapeType=n},setEditableId:function(n){this.config.editableId=n},setBorderStyle:function(n){switch(n.type){case this.reportConstValue.borderType.TOPLINE:n.style&&this.setTopBorderStyle(n.style);n.color&&this.setTopBorderColor(n.color);n.width&&this.setTopBorderWidth(n.width);break;case this.reportConstValue.borderType.BOTTOMLINE:n.style&&this.setBottomBorderStyle(n.style);n.color&&this.setBottomBorderColor(n.color);n.width&&this.setBottomBorderWidth(n.width);break;case this.reportConstValue.borderType.LEFTLINE:n.style&&this.setLeftBorderStyle(n.style);n.color&&this.setLeftBorderColor(n.color);n.width&&this.setLeftBorderWidth(n.width);break;case this.reportConstValue.borderType.RIGHTLINE:n.style&&this.setRightBorderStyle(n.style);n.color&&this.setRightBorderColor(n.color);n.width&&this.setRightBorderWidth(n.width);break;case this.reportConstValue.borderType.OUTERLINE:n.style&&this.setTopBorderStyle(n.style);n.color&&this.setTopBorderColor(n.color);n.width&&this.setTopBorderWidth(n.width);n.style&&this.setBottomBorderStyle(n.style);n.color&&this.setBottomBorderColor(n.color);n.width&&this.setBottomBorderWidth(n.width);n.style&&this.setLeftBorderStyle(n.style);n.color&&this.setLeftBorderColor(n.color);n.width&&this.setLeftBorderWidth(n.width);n.style&&this.setRightBorderStyle(n.style);n.color&&this.setRightBorderColor(n.color);n.width&&this.setRightBorderWidth(n.width);break;case this.reportConstValue.borderType.NONELINE:this.setTopBorderStyle(n.style);this.setTopBorderColor(n.color);this.setTopBorderWidth(n.width);this.setBottomBorderStyle(n.style);this.setBottomBorderColor(n.color);this.setBottomBorderWidth(n.width);this.setLeftBorderStyle(n.style);this.setLeftBorderColor(n.color);this.setLeftBorderWidth(n.width);this.setRightBorderStyle(n.style);this.setRightBorderColor(n.color);this.setRightBorderWidth(n.width)}},setTopBorderStyle:function(n){n!=null&&n!=undefined&&this.$wrapperEl.css({"border-top-style":n})},setLeftBorderStyle:function(n){n!=null&&n!=undefined&&this.$wrapperEl.css({"border-left-style":n})},setBottomBorderStyle:function(n){n!=null&&n!=undefined&&this.$wrapperEl.css({"border-bottom-style":n})},setRightBorderStyle:function(n){n!=null&&n!=undefined&&this.$wrapperEl.css({"border-right-style":n})},setTopBorderColor:function(n){n!=null&&n!=undefined&&(this.reportConstValue.nativeColorname[n]||(n=ecount.convertor.convertRGBToHex(n),n=n.indexOf("#")!=0?"#"+n:n),this.$wrapperEl.css({"border-top-color":n}))},setLeftBorderColor:function(n){n!=null&&n!=undefined&&(this.reportConstValue.nativeColorname[n]||(n=ecount.convertor.convertRGBToHex(n),n=n.indexOf("#")!=0?"#"+n:n),this.$wrapperEl.css({"border-left-color":n}))},setBottomBorderColor:function(n){n!=null&&n!=undefined&&(this.reportConstValue.nativeColorname[n]||(n=ecount.convertor.convertRGBToHex(n),n=n.indexOf("#")!=0?"#"+n:n),this.$wrapperEl.css({"border-bottom-color":n}))},setRightBorderColor:function(n){n!=null&&n!=undefined&&(this.reportConstValue.nativeColorname[n]||(n=ecount.convertor.convertRGBToHex(n),n=n.indexOf("#")!=0?"#"+n:n),this.$wrapperEl.css({"border-right-color":n}))},setTopBorderWidth:function(n){n!=null&&n!=undefined&&this.$wrapperEl.css({"border-top-width":n+"px"})},setLeftBorderWidth:function(n){n!=null&&n!=undefined&&this.$wrapperEl.css({"border-left-width":n+"px"})},setBottomBorderWidth:function(n){n!=null&&n!=undefined&&this.$wrapperEl.css({"border-bottom-width":n+"px"})},setRightBorderWidth:function(n){n!=null&&n!=undefined&&this.$wrapperEl.css({"border-right-width":n+"px"})},removeLeftBorderStyle:function(){this.$wrapperEl.css({"border-left-style":""})},removeTopBorderStyle:function(){this.$wrapperEl.css({"border-top-style":""})},removeRightBorderStyle:function(){this.$wrapperEl.css({"border-right-style":""})},removeBottomBorderStyle:function(){this.$wrapperEl.css({"border-bottom-style":""})},removeLeftBorderColor:function(){this.$wrapperEl.css({"border-left-color":""})},removeTopBorderColor:function(){this.$wrapperEl.css({"border-top-color":""})},removeRightBorderColor:function(){this.$wrapperEl.css({"border-right-color":""})},removeBottomBorderColor:function(){this.$wrapperEl.css({"border-bottom-color":""})},removeTopBorderWidth:function(){this.$wrapperEl.css({"border-left-width":""})},removeTopBorderWidth:function(){this.$wrapperEl.css({"border-top-width":""})},removeRightBorderWidth:function(){this.$wrapperEl.css({"border-right-width":""})},removeBottomBorderWidth:function(){this.$wrapperEl.css({"border-bottom-width":""})},addCollectionByEvent:function(n,t){var f=n,r=$(f),i,u;r.length!=0&&(i=r.find("#"+t),i.length!=0)&&(u=i[0],this.addCollectionByElement(u))},addCollectionById:function(n){var t=this.$wrapperEl.find("#"+n);t&&t.length!=0&&this.addCollectionByElement(t[0])},addCollectionByElement:function(n){var i,t;if(n&&(i=$(n),t=i.closest(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),t.length!=0)){var r=t[0],u=n.getAttribute("id"),f=n.getAttribute("data-controltype"),e={id:u,container:t,controlType:f,mousedownElementPoint:this.getElementPoint(n,!0,!0,{isIgnoreBorder:!0},r),mousedownElementSize:this.getElementSize(n)};this.collection.add(e)}},clearCollection:function(){var n=this.collection.removeAll();n&&n.list&&n.list.some(function(n){this.deselectInstance(n)}.bind(this))},getSelectedShapes:function(){var n=[];return this.collection.list.forEach(function(t){var i=this.getItemById(t.id);n.push({id:t.id,controlType:t.controlType,isManagedShape:i&&i.config.isManagedShape,step:i&&i.$el.attr("data-step")})}.bind(this)),n},deselectAll:function(){this.clearCollection()},deselectInstance:function(n){var t=this.getItemById(n.id,{action:this.reportConstValue.shapeStatus.deselect});if(!t)return!1;this.isContract&&t.controlType==this.reportConstValue.shapeType.textbox&&t.hideError();t.ON_MOUSEDOWN({targetSelector:"#"+n.id},{})},_ON_SELECTABLERANGE:function(n,t){if(n.startMousePoint&&n.endMousePoint){var i=0,r=this.$wrapperEl.find("[data-controltype]");r.filter(function(n,t){return t.classList.contains(this.reportConstValue.dragSelector)}.bind(this)).filter(function(t,i){return this.isSelectControlByRange(n,i)}.bind(this)).each(function(r,u){var s=$(u),o=u.getAttribute("data-controltype"),e,f;if(this.isDocumentEvidence==!0&&o!=this.reportConstValue.shapeType.sign)return!0;e=u.getAttribute("id");f=this.getItemById(e,{action:this.reportConstValue.shapeStatus.selectable,style:{},areaDivisionCalculation:"each"});f&&(n.targetSelector="#"+e,n.isMultiSelect=!0,f.ON_MOUSEDOWN(n,t),i==r&&f.setFocusInTextContainer&&f.setFocusInTextContainer(!1,!0),i+=1);this.addCollectionByElement(u)}.bind(this));i?(this.setStatus(this.reportConstValue.canvasStatus.moveable),this.addDataInHistory()):this.setStatus(this.reportConstValue.canvasStatus.selectable)}},isSelectControlByRange:function(n,t){var i=t.getBoundingClientRect(),r={top:n.startMousePoint.y,left:n.startMousePoint.x,bottom:n.endMousePoint.y,right:n.endMousePoint.x};return this._options.selectableRangeType==this.reportConstValue.selectableRangeType.CONTAIN?i.left>=n.startMousePoint.x&&i.right<=n.endMousePoint.x&&i.top>=n.startMousePoint.y&&i.bottom<=n.endMousePoint.y:this.getIntersectRect(i,r)},getIntersectRect:function(n,t){function r(n,t,i){return n>t&&n<i||n>i&&n<t}var i={};if(r(n.left,t.left,t.right))i.left=n.left;else if(r(t.left,n.left,n.right))i.left=t.left;else return null;if(r(n.right,t.left,t.right))i.right=n.right;else if(r(t.right,n.left,n.right))i.right=t.right;else return null;if(r(n.top,t.bottom,t.top))i.top=n.top;else if(r(t.top,n.bottom,n.top))i.top=t.top;else return null;if(r(n.bottom,t.bottom,t.top))i.bottom=n.bottom;else if(r(t.bottom,n.bottom,n.top))i.bottom=t.bottom;else return null;return i},_ON_SELECT_MAPPINGDATA:function(n,t){var r=this.mappingDataCollection.getById(n.mappingDataId),u,i;r&&r.type&&(u=[n.targetId,n.columnId,n.rowId,n.mappingDataId].join(ecount.separator.ecPath),this.config.dropdownmenu.serviceKey=this.getServiceKey(this.ecPath,u),this.config.dropdownmenu.serviceKeyType="mappingData",this.setMappingItemSettingData(n.mappingDataId),i=ec$.getZoomedBoundary(t.target),ecount.layer.show({type:"mappingdataoption",ecPageID:this.ecPageID,ownerKey:this.ecIKey,serviceKey:this.config.dropdownmenu.serviceKey,css:"dropdown-menu-icon-list dropdown-menu-report context-menu",_onClicked:!0,showingUpDelay:0,items:[{label:"",value:"setting",divCss:"config"}],boundary:{top:i.top,bottom:i.top+i.height,left:i.left+i.width,right:i.left+i.width},zIndex:9999}))},_ON_DESELECT_MAPPINGDATA:function(){this.config.dropdownmenu.serviceKey&&ecount.layer.hide(this.config.dropdownmenu.serviceKey)&&(this.config.dropdownmenu.serviceKey=null)},beginHistoryTransaction:function(){return this.config.isBeginHistoryTransaction?!1:(this.config.isBeginHistoryTransaction=!0,!0)},commitHistoryTransaction:function(){return this.config.isBeginHistoryTransaction?(this.config.isBeginHistoryTransaction=!1,!0):!1},setEditable:function(n,t){var i=this.getItemById(n);i&&(i.controlType===this.reportConstValue.shapeType.table?i.setCellEditable(t):i.controlType===this.reportConstValue.shapeType.rectangle?i.setFocusInTextContainer():i.controlType===this.reportConstValue.shapeType.textbox&&i.setFocusInTextContainer())},updateElementSize:function(n){var i,t,r;if(n.targetId){if(i=this.collection.getById(n.targetId),i)if($.isNull(n.width)||$.isNull(n.height)){if(r=this.getEntityById(n.targetId),r){if(t=r.getDataProperty("el"),r.isManagedShapeByEntity()&&!t.hasClass(this.reportConstValue.containerSelector)&&(t=r.getDataProperty("container"),!t||t.length==0))return;i.mousedownElementSize=this.getElementSize(t[0])}}else i.mousedownElementSize.width=n.width,i.mousedownElementSize.height=n.height;this.resizeHandler(n)}},updateElementPoint:function(n){var t,i,r,u;if(n.targetId&&(t=this.collection.getById(n.targetId),t))if($.isNull(n.x)||$.isNull(n.y)){if(i=this.getEntityById(n.targetId),!i)return;if(r=i.getDataProperty("el"),!r||r.length==0)return;if(u=i.getDataProperty("container"),!u||u.length==0)return;t.mousedownElementPoint=this.getElementPoint(r[0],!0,!0,{isIgnoreBorder:!0},u[0])}else t.mousedownElementPoint.x=n.x,t.mousedownElementPoint.y=n.y},getCursorPosition:function(){return this.config.editableId?this.$wrapperEl.find("#"+this.config.editableId).getCursorPosition():null},saveCursor:function(n){var t;if(!this.config.isBeginSaveCursorTransaction&&this.config.editableId){if(t=this.getItemById(this.config.editableId),!t)return;if(t.isEditable()){var r=window.getSelection(),i=r.rangeCount&&r.getRangeAt(0);i?(this.config.beforeCursorPosition={},this.config.beforeCursorPosition.editableId=this.config.editableId,this.config.beforeCursorPosition.sourceId=n,this.config.beforeCursorPosition.range=i):this.config.beforeCursorPosition=null;console.log("save cursor");console.log(i);console.log(this.config.beforeCursorPosition)}}},restoreCursor:function(n){var r={deleteCursorInfo:!0},t,u,i;return n=n&&_.extend(r,n)||r,console.log("restoreCursor"),console.log(this.config.beforeCursorPosition),t=null,this.config.beforeCursorPosition&&(t=this.config.beforeCursorPosition.editableId,u=this.$wrapperEl.find("#"+t),u.removeClass("noselection"),i=window.getSelection(),i.removeAllRanges(),i.addRange(this.config.beforeCursorPosition.range)),n.deleteCursorInfo&&delete this.config.beforeCursorPosition,t},restoreMappingDataLayer:function(){var n=this._range.getRange(),t,i,u,f,e,o,r;n&&(t=this._node.isElement(n.commonAncestorContainer)&&n.commonAncestorContainer.classList.contains(this.reportConstValue.mappingDataSelector)?$(n.commonAncestorContainer):!n.collapsed&&this._node.isElement(n.commonAncestorContainer.childNodes[n.startOffset])&&n.commonAncestorContainer.childNodes[n.startOffset].classList.contains(this.reportConstValue.mappingDataSelector)?$(n.commonAncestorContainer.childNodes[n.startOffset]):$(n.commonAncestorContainer).closest(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector),t&&t.length&&(i=t.closest("[data-controltype]"),i&&i.length&&(u=i.attr("data-controltype"),f=i.attr("id"),u==this.reportConstValue.shapeType.table&&(r=t.closest("th, td"),r&&r.length&&(e=r.attr("data-columnid"),o=r.attr("data-key"))),this._ON_SELECT_MAPPINGDATA({shapeType:u,targetId:f,columnId:e,rowId:o,mappingDataId:t.attr("id")},{target:t[0]}))))},clearCursor:function(){this.config.beforeCursorPosition=null},moveLeftCursor:function(){var n=this.getCursorPosition(),t,i;n&&n.startContainer&&this._node.isText(n.startContainer)&&(t=$(n.startContainer),i=t.closest(this.reportConstValue.barcodePrefix+this.reportConstValue.barcodeSelector),i.moveCursorLastPosition())},moveRightCursor:function(){var n=this.getCursorPosition(),t,i;n&&n.startContainer&&this._node.isText(n.startContainer)&&(t=$(n.startContainer),i=t.closest(this.reportConstValue.barcodePrefix+this.reportConstValue.barcodeSelector),i.moveCursorLastPosition())},moveUpCursor:function(){var n=this.getCursorPosition(),t,i;n&&n.startContainer&&this._node.isText(n.startContainer)&&(t=$(n.startContainer),i=t.closest(this.reportConstValue.barcodePrefix+this.reportConstValue.barcodeSelector),i.moveCursorLastPosition())},moveDownCursor:function(){var n=this.getCursorPosition(),t,i;n&&n.startContainer&&this._node.isText(n.startContainer)&&(t=$(n.startContainer),i=t.closest(this.reportConstValue.barcodePrefix+this.reportConstValue.barcodeSelector),i.moveCursorLastPosition())},addMappingData:function(n,t){var i,r;return t=_.extend({action:this.reportConstValue.shapeStatus.directDrawing},t),i=150,n&&n.text&&(i=n.text.length*14+20),t.style=_.extend({width:i},t.style),r=this.drawDirectShape(t,{directFocus:!0,directSelect:!0},this.reportConstValue.shapeType.rectangle),{id:r&&r.attr("id")||""}},insertMappingDatas:function(){},insertMappingDataToLastCursor:function(n){var t,i;if(_.isArray(n)?t=n:n&&(t=[n]),t)for(i=0;i<t.length;i++)this._insertMappingDataToLastCursor(t[i],i==0)},_insertMappingDataToLastCursor:function(n,t){var f,v,i,s,r,h,y,b,u,c;if(n.id){if(v="",f=[],this.constValue.isIE?(f.push('<span style="display:inline-block;" id="'+n.id+'" class="'+this.reportConstValue.mappingDataSelector+' cursor-pointer" contenteditable="false">'),f.push(n.text||""),f.push("<\/span> ")):(f.push('<span class="'+this.reportConstValue.beforeMappingDataSelector+'"><\/span>'),f.push('<span style="display:inline-block;" id="'+n.id+'" class="'+this.reportConstValue.mappingDataSelector+' cursor-pointer" contenteditable="false">'),f.push(n.text||""),f.push("<\/span>"),f.push('<span class="'+this.reportConstValue.afterMappingDataSelector+'"><\/span> ')),v=f.join(""),this.mappingDataCollection.add(n),t&&this.collection.list.length==1)if(this.config.beforeCursorPosition&&this.config.beforeCursorPosition.editableId==this.collection.list[0].id){if(s=this.getEntityById(this.collection.list[0].id),!s)return;if(r=s.getDataProperty("controlType"),i=this.getItemById(this.collection.list[0].id),!i)return;r==this.reportConstValue.shapeType.table?i.setCellEditable(!0):r==this.reportConstValue.shapeType.rectangle?i.setFocusInTextContainer():r==this.reportConstValue.shapeType.textbox&&i.setFocusInTextContainer();this.restoreCursor();this.setStatus(this.reportConstValue.canvasStatus.editing)}else{if(s=this.getEntityById(this.collection.list[0].id),!s)return;if(r=s.getDataProperty("controlType"),i=this.getItemById(this.collection.list[0].id),!i)return;if(r==this.reportConstValue.shapeType.table){var u=this.instanceManager.tableSelector,c=this.instanceManager.tableStructure,l=u.getFromSectionType(),a=u.getFromSectionIndex(),e=u.getSelectedBoundary();e.isValidate()?i.setCellEditable(l,a,e.config.left,e.config.top,!0,!0)||i.moveCursorLastPosition(c.getTd(l,a,e.config.left,e.config.top)):i.setFirstCellEditable()}else r==this.reportConstValue.shapeType.rectangle?i.setFocusInTextContainer(!0):r==this.reportConstValue.shapeType.textbox&&i.setFocusInTextContainer(!0);this.setStatus(this.reportConstValue.canvasStatus.editing)}if(h=window.getSelection(),h.rangeCount!=0){if(y=h.getRangeAt(0),this.collection.list.length==1){if(s=this.getEntityById(this.collection.list[0].id),!s)return;if(r=s.getDataProperty("controlType"),i=this.getItemById(this.collection.list[0].id),!i)return;var k=$(y.commonAncestorContainer),p=k.closest("th, td"),d=k.closest(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector);if(r==this.reportConstValue.shapeType.table){var u=this.instanceManager.tableSelector,c=this.instanceManager.tableStructure,l=u.getFromSectionType(),a=u.getFromSectionIndex(),e=u.getSelectedBoundary(),w=c.getTd(l,a,e.config.left,e.config.top);d&&d.length!=0?p&&p.length&&p[0]!=w&&(i.setCellEditable(!0),i.moveCursorLastPosition(w)):e.isValidate()&&i.moveCursorLastPosition(w)}else r==this.reportConstValue.shapeType.rectangle&&(b=i.$parent.find(y.commonAncestorContainer),b&&b.length!=0||i.moveCursorLastPosition())}this.insertBefore(v);var o=this.$wrapperEl.find("#"+n.id),g=o.closest("u").length>0,nt=o.closest("strike").length>0;if(o.closest("b, strong").length&&o.addClass("text-bold"),o.closest("i, em").length&&o.addClass("text-italic"),g&&nt?o.addClass("grid-text-uline-through"):g?o.addClass("text-uline"):nt&&o.addClass("text-line-through"),this.setMappingItemTooltip(o,n),r==this.reportConstValue.shapeType.table){if(u=i.getTableSelector(),c=i.getTableStructure(),u&&c){var l=u.getFromSectionType(),a=u.getFromSectionIndex(),e=u.getSelectedBoundary(),tt=c.getTd(l,a,e.config.left,e.config.top);i.selectorReselect();i.changeMaxHeight(tt);i.syncLineHandlerSize({delay:!1})}}else r==this.reportConstValue.shapeType.rectangle?i.syncLineHandlerSize({delay:!1}):r==this.reportConstValue.shapeType.textbox&&(i.changeMaxHeight(i.$el),i.syncLineHandlerSize({delay:!1}));(h=window.getSelection(),h.rangeCount!=0)&&(r==this.reportConstValue.shapeType.table?(i.setCellEditable(!0),this.setStatus(this.reportConstValue.canvasStatus.editing)):r==this.reportConstValue.shapeType.rectangle?(i.setFocusInTextContainer(),this.setStatus(this.reportConstValue.canvasStatus.editing)):r==this.reportConstValue.shapeType.textbox&&(i.setFocusInTextContainer(),this.setStatus(this.reportConstValue.canvasStatus.editing)),this.constValue.isIE?h.getRangeAt(0).collapse(!0):h.collapseToEnd(),i.isEditable()&&this.setEditableId(i.$el.attr("id")),this.resizeHandler({delay:!1}))}}},findTextnodesFromAToB:function(n,t,i,r){var f,u,e;for(r=$.extend({isIncludeFromNode:!1,isIncludeToNode:!1,isIncludeZWS:!1,isIncludeNBSP:!1,isIncludeBlank:!1},r||{}),f=[],e=!1;;)if(u=n.nextNode(),e){if(!u||u==i){r.isIncludeToNode&&f.push(u);break}if(this._node.isText(u)){var o=this._node.getText(u),s=" "==o,h=this._doc._ZWS==o,c=/&nbsp;/g.test(u.innerHTML);r.isIncludeBlank&&s&&f.push(u);r.isIncludeZWS&&h&&f.push(u);r.isIncludeNBSP&&c&&f.push(u);s||h||c||o==""||f.push(u)}}else e=u==t,r.isIncludeFromNode&&f.push(u);return f},findHyperlinksFromAToB:function(n,t,i,r){r=$.extend({isIncludeFromNode:!1,isIncludeToNode:!1},r||{});for(var f=[],u,e=!1;;)if(u=n.nextNode(),e){if(!u||u==i){r.isIncludeToNode&&f.push(u);break}this._node.isElement(u)&&u.tagName=="A"&&f.push(u)}else e=u==t,r.isIncludeFromNode&&f.push(u);return f},removeHyperlink:function(n){var f=this._selection.getSelection(),e,r,i,t,u;if(n=n||this._range.getRange(),n){if(this.config.beforeCursorPosition&&this.config.beforeCursorPosition.editableId==this.collection.list[0].id){if(i=this.getEntityById(this.collection.list[0].id),!i)return;if(controlType=i.getDataProperty("controlType"),t=this.getItemById(this.collection.list[0].id),!t)return;controlType==this.reportConstValue.shapeType.table?t.setCellEditable(!0):controlType==this.reportConstValue.shapeType.rectangle?t.setFocusInTextContainer():controlType==this.reportConstValue.shapeType.textbox&&t.setFocusInTextContainer();this.restoreCursor();this.setStatus(this.reportConstValue.canvasStatus.editing)}document.execCommand("unlink",!1,!1)}else if(this.collection.list.length==1)if(this.collection.list[0].controlType==this.reportConstValue.shapeType.table){if(i=this.getEntityById(this.collection.list[0].id),!i)return;if(t=this.getItemById(i.id),!t)return;if(e=t.getTableStructure(),r=t.getTableSelector(),!r)return;var o=r.getFromSectionType(),s=r.getFromSectionIndex(),h=r.getSelectedBoundary(),c=e.getTdsByBoundary(o,s,h);t.applyFontToTable(c,function(n,i){t.selectNodeContents(i);f.selectAllChildren(i);document.execCommand("unlink",!1,!1)})}else if([this.reportConstValue.shapeType.textbox,this.reportConstValue.shapeType.rectangle].contains(this.collection.list[0].controlType)){if(i=this.getEntityById(this.collection.list[0].id),!i)return;if(t=this.getItemById(i.id),!t)return;u=t.$el.find(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector);t.textContainerEditable();t.connectItemEnableEditable(u);u.each(function(n,t){f.selectAllChildren(t);document.execCommand("unlink",!1,!1)});t.connectItemDisabledEditable(u);t.textContainerDisabledEditable();t.removeAllRanges()}else this.collection.list[0].controlType==this.reportConstValue.shapeType.image&&this.imageHyperlinkDataCollection.removeById(this.collection.list[0].id)},pasteHyperlinkToLastCursor:function(n,t){var o,l,f,e,i,r,a;if(t&&this.collection.list.length==1)if(this.config.beforeCursorPosition&&this.config.beforeCursorPosition.editableId==this.collection.list[0].id){if(entity=this.getEntityById(this.collection.list[0].id),!entity)return;if(controlType=entity.getDataProperty("controlType"),actionInstance=this.getItemById(this.collection.list[0].id),!actionInstance)return;controlType==this.reportConstValue.shapeType.table?actionInstance.setCellEditable(!0):controlType==this.reportConstValue.shapeType.rectangle?actionInstance.setFocusInTextContainer():controlType==this.reportConstValue.shapeType.textbox&&actionInstance.setFocusInTextContainer();this.restoreCursor();this.setStatus(this.reportConstValue.canvasStatus.editing)}else{if(o=this._selection.getSelection(),entity=this.getEntityById(this.collection.list[0].id),!entity)return;if(controlType=entity.getDataProperty("controlType"),actionInstance=this.getItemById(this.collection.list[0].id),!actionInstance)return;if(controlType==this.reportConstValue.shapeType.table){var s=this.instanceManager.tableSelector,v=this.instanceManager.tableStructure,h=s.getFromSectionType(),c=s.getFromSectionIndex(),u=s.getFromBoundary();if(u.isValidate()&&(l=v.getTd(h,c,u.config.left,u.config.top),actionInstance.setCellEditable(h,c,u.config.left,u.config.top,!0,!0))){actionInstance.applyFontToTable([l],function(t,i){var r,u,f;if(this._node.getText(i).trim()==""){var u=String.format('<a id=\'{1}\' href="{2}" target="{3}" title="{4}">{0}<\/a>',n.displayText||"",n.id,n.URL||"#",n.target||"_blank",n.title||""),f=this.insertBefore(u),r=this._range.getRange();r&&r.collapse(!1)}else o.selectAllChildren(i),r=this._range.getRange(),r&&r.deleteContents(),u=String.format('<a id=\'{1}\' href="{2}" target="{3}" title="{4}">{0}<\/a>',n.displayText||"",n.id,n.URL||"#",n.target||"_blank",n.title||""),f=this.insertBefore(u),r&&r.collapse(!1)}.bind(this));this.setStatus(this.reportConstValue.canvasStatus.editing);return}}else if([controlType==this.reportConstValue.shapeType.textbox,this.reportConstValue.shapeType.rectangle].contains(controlType)){if(actionInstance.setFocusInTextContainer(!0),this._node.getText(actionInstance.$el[0]).trim()==""){var r=String.format('<a id=\'{1}\' href="{2}" target="{3}" title="{4}">{0}<\/a>',n.displayText||"",n.id,n.URL||"#",n.target||"_blank",n.title||""),a=this.insertBefore(r),i=this._range.getRange();i&&i.collapse(!1);this.setStatus(this.reportConstValue.canvasStatus.editing);return}if(f=actionInstance.$el.find(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector),f&&f.length){o.selectAllChildren(f[0]);var r=String.format('<a id=\'{1}\' href="{2}" target="{3}" title="{4}">{0}<\/a>',n.displayText||"",n.id,n.URL||"#",n.target||"_blank",n.title||""),a=this.insertBefore(r),i=this._range.getRange();i&&i.collapse(!1);this.setStatus(this.reportConstValue.canvasStatus.editing);return}}}this.collection.list.length&&this.collection.list[0].controlType==this.reportConstValue.shapeType.image?(e=this.imageHyperlinkDataCollection.getById(this.collection.list[0].id),e?e=_.extend(e,n):(n.id=this.collection.list[0].id,this.imageHyperlinkDataCollection.add(n))):(i=this._range.getRange(),i.collapsed?(r=String.format('<a id=\'{1}\' href="{2}" target="{3}" title="{4}">{0}<\/a>',n.displayText||"",n.id,n.URL||"#",n.target||"_blank",n.title||""),a=this.insertBefore(r),i&&i.collapse(!1)):(i.deleteContents(),r=String.format('<a id=\'{1}\' href="{2}" target="{3}" title="{4}">{0}<\/a>',n.displayText||"",n.id,n.URL||"#",n.target||"_blank",n.title||""),a=this.insertBefore(r),i&&i.collapse(!1)))},setMappingItemSettingData:function(n){var t=this.mappingDataCollection.getById(n);t&&(this._mappingItemSettingData=t)},getMappingItemSettingData:function(){return this._mappingItemSettingData},updateMappingData:function(n){var i,t;n.id&&(i=this.mappingDataCollection.getById(n.id),i&&_.extend(i,n),t=this.$wrapperEl.find("#"+n.id),t&&t.length!=0)&&(this.constValue.isIE?t.addClass("noselection"):(t[0].previousElementSibling&&t[0].previousElementSibling.classList.contains(this.reportConstValue.beforeMappingDataSelector)||t.before($('<span class="'+this.reportConstValue.beforeMappingDataSelector+'"><\/span>')),t[0].nextElementSibling&&t[0].nextElementSibling.classList.contains(this.reportConstValue.afterMappingDataSelector)||t.after($('<span class="'+this.reportConstValue.afterMappingDataSelector+'"><\/span>'))),t[0].innerText=i.displayName||i.text||"")},loadMappingData:function(){var n=this.$wrapperEl.find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector);n.each(function(n,t){var i=this.mappingDataCollection.getById(t.id);i&&i.resx&&(i.text=ecount.resource[i.resx]||i.resx,this.updateMappingData(i),this.setMappingItemTooltip(t,i))}.bind(this))},setMappingItemTooltip:function(n,t){var i=$(n),r=_.get(_.find(this._options.codeTable,function(n){return n.INPUT_CD==t.code}),"RESX_CD"),u=t.text+(r?"("+ecount.resource[r]+")":"");bootstrapFunc.tooltip.call(i,{container:i.closest(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),placement:"auto",trigger:"hover",title:u,delay:{show:ecount.common.mouseHoverInTime,hide:ecount.common.mouseHoverOutTime}})},removeTooltip:function(n){var t=n?$(n):this.$wrapperEl;t.find(".tooltip").remove()},deleteMappingData:function(n){this.collection.removeById(n.id)},clearInsertMappingDataControlId:function(){this.insertMappingDataControlId=null},insertBefore:function(n){function k(n){return this._node.isElement(n)&&n.classList.contains(this.reportConstValue.mappingDataSelector)}function d(n){return n.tagName=="BR"}function g(n){return!this._node.isInline(n)&&!b.call(this,n.parentElement)}function b(n){return!this._node.isInlineNodeName(n)&&n.nodeName!="P"}var v=window.getSelection(),e,h,c,y,o,i,f,l,u,p,r,s,t,w,a;if(v.rangeCount!=0){if(t=v.getRangeAt(0),typeof n=="string"){for(e=document.createElement("div"),h=document.createDocumentFragment(),e.innerHTML=n,c=0,y=e.childNodes.length;c<y;c++)h.appendChild(e.childNodes[0]);n=h}else typeof n=="object"&&(n.constructor===Array||n.constructor===DocumentFragment&&n.childNodes.length&&(o=n.childNodes[n.childNodes.length-1],this._node.isElement(o)&&o.classList.contains(this.reportConstValue.mappingDataSelector)&&this._node.append(this._doc.createTextNode(" "),o,!0)));if(i=n.cloneNode(!0),(k.call(this,t.commonAncestorContainer)||d.call(this,t.commonAncestorContainer))&&(f=this._doc.createTextNode(" "),this._node.insertAfter(f,t.commonAncestorContainer),l=this._node.getText(f).replace(/\t|\n|\r/g,"").length,t.setStart(f,l),t.setEnd(f,l)),u=[],u=i.constructor===DocumentFragment?Array.prototype.slice.call(i.childNodes):[i],p=i.childNodes[i.childNodes.length-1],t.insertNode(i),u.some(function(n){return g.call(this,n)}.bind(this))){for(r=u[0].parentElement,s=r.parentElement;!b.call(this,s);)r=s,s=r.parentElement;t=this._range.createRange();t.setStartBefore(r);t.setEndBefore(u[0]);w=t.extractContents();this._node.insertBefore(w,r);a=document.createDocumentFragment();u.forEach(function(n){a.appendChild(n)});this._node.insertBefore(a,r)}return{lastNode:p}}},insertBeforeOnlyEl:function(n){function e(n){return this._node.isElement(n)&&n.classList.contains(this.reportConstValue.mappingDataSelector)}function o(n){return n.tagName=="BR"}var u=window.getSelection(),t,i,r,f;if(u.rangeCount!=0)return t=u.getRangeAt(0),(e.call(this,t.commonAncestorContainer)||o.call(this,t.commonAncestorContainer))&&(i=this._doc.createTextNode(" "),this._node.insertAfter(i,t.commonAncestorContainer),r=this._node.getText(i).replace(/\t|\n|\r/g,"").length,t.setStart(i,r),t.setEnd(i,r)),f=n.childNodes[n.childNodes.length-1],t.insertNode(n),{lastNode:f}},insertBarcodeLabelToCursor:function(){var n=this.getCursorPosition();if(n&&n.startContainer&&n.endContainer){var t=n.endContainer,u=t.parentNode,i=$("<span style='font-weight: bold;' class='"+this.reportConstValue.barcodeSelector+"'>test<\/span>"),r=t.splitText(n.endOffset);i.insertBefore(r)}},deleteSelectTextarea:function(){var t=this.getCursorPosition(),u,i,r,n;return t&&t.collapse&&t.startOffset==t.endOffset?null:(u=this.copySelectTextarea(),i=window.getSelection(),!i.rangeCount)?null:(r=i.getRangeAt(0),n=r.commonAncestorContainer,n&&n.classList&&n.classList.length>0&&n.classList.contains(this.reportConstValue.mappingDataSelector)?this.constValue.isIE?n.parentNode.removeChild(n):n.remove():r.deleteContents(),u)},copySelectTextarea:function(){function p(n){return!this._node.isText(n.startContainer)||!this._node.isText(n.endContainer)?!1:this._node.getLineStartNode(n.startContainer)!=this._node.getLineStartNode(n.endContainer)?!1:n.startContainer.parentNode!=n.endContainer.parentNode?!1:!0}var e=this.getCursorPosition(),t,u,a,v,i,o,s,h,c,l;if(e&&e.collapse&&e.startOffset==e.endOffset)return null;if(t=this._range.getRange(),t&&this._node.isElement(t.startContainer)&&this._node.isElement(t.endContainer)&&t.startContainer.classList.contains(this.reportConstValue.mappingDataSelector)&&t.endContainer.classList.contains(this.reportConstValue.mappingDataSelector))u=document.createDocumentFragment(),a=t.startContainer,v=a.cloneNode(!0),u.appendChild(v);else if(p.call(this,t)){var f=$(t.startContainer).closest("a"),y=f.length>0,n=$("<span style='"+t.startContainer.parentNode.style.cssText+"'><\/span>")[0],r=getComputedStyle(t.startContainer.parentNode);n.style.fontFamily=r.fontFamily;n.style.fontSize=r.fontSize;n.style.color=r.color;n.style.border="";n.style.backgroundColor="";n.removeAttribute("id");n.removeAttribute("color");i=n;r.fontWeight==700?(n.style.fontWeight="",o=this._doc.createElement("b"),i.appendChild(o),i=o):n.style.fontWeight=r.fontWeight;r.fontStyle=="italic"?(n.style.fontStyle="",s=this._doc.createElement("i"),i.appendChild(s),i=s):n.style.fontStyle=r.fontStyle;(/\bunderline\b/gi.test(r.textDecoration)||/\bunderline\b/gi.test(r.webkitTextDecorationsInEffect))&&(n.style.textDecoration=n.style.textDecoration.replace("underline",""),h=this._doc.createElement("u"),i.appendChild(h),i=h);(/\bline-through\b/gi.test(r.textDecoration)||/\bline-through\b/gi.test(r.webkitTextDecorationsInEffect))&&(n.style.textDecoration=n.style.textDecoration.replace("line-through",""),c=this._doc.createElement("strike"),i.appendChild(c),i=c);y&&(l=this._doc.createElement("a",{id:f.attr("id"),href:f.attr("href"),target:f.attr("target"),title:f.attr("title")||f.attr("title")||""}),i.appendChild(l),i=l);i.appendChild(t.cloneContents());u=document.createDocumentFragment();u.appendChild(n)}else u=t.cloneContents();return u},setLeft:function(n,t){t=t||"px";this.$el.css({left:n+t})},increaseLeft:function(n,t){var i=paserFloat(this.$wrapperEl.css("left"));this.setLeft(i+n,t)},decreaseLeft:function(n,t){var i=paserFloat(this.$wrapperEl.css("left"));this.setLeft(i-n,t)},setSelectedShapeFontFamily:function(n){var i,r,e,f,u,t;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=!1,r=0,e=this.collection.list.length;r<e;r++){if(f=this.getEntityById(this.collection.list[r].id),!f)return;if(u=f.getDataProperty("controlType"),t=this.getFormItemById(this.collection.list[r].id),!t)return;if(u==this.reportConstValue.shapeType.table){var s=t.getTableSelector().getFromSectionType(),o=t.getTableSelector().getSelectedBoundary(),h=o.isValidate();this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)&&(t.setCellEditable(!0),this.restoreCursor(),i=!0);t.setFontFamily(n)}else u==this.reportConstValue.shapeType.rectangle?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontFamily(n)):u==this.reportConstValue.shapeType.textbox&&(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontFamily(n))}i&&ecount.global.setTimeout(this.ecPageID,function(){this.restoreMappingDataLayer()}.bind(this));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeFontSize:function(n){var i,r,e,f,u,t;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=!1,r=0,e=this.collection.list.length;r<e;r++){if(f=this.getEntityById(this.collection.list[r].id),!f)return;if(u=f.getDataProperty("controlType"),t=this.getFormItemById(this.collection.list[r].id),!t)return;if(u==this.reportConstValue.shapeType.table){var s=t.getTableSelector().getFromSectionType(),o=t.getTableSelector().getSelectedBoundary(),h=o.isValidate();this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)&&(t.setCellEditable(!0),this.restoreCursor(),i=!0);t.setFontSize(n)}else u==this.reportConstValue.shapeType.rectangle?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontSize(n)):u==this.reportConstValue.shapeType.textbox&&(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontSize(n));i&&ecount.global.setTimeout(this.ecPageID,function(){this.restoreMappingDataLayer()}.bind(this))}this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeFontBold:function(n){var i,r,e,f,u,t;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=!1,r=0,e=this.collection.list.length;r<e;r++){if(f=this.getEntityById(this.collection.list[r].id),!f)return;if(u=f.getDataProperty("controlType"),t=this.getFormItemById(this.collection.list[r].id),!t)return;if(u==this.reportConstValue.shapeType.table){var s=t.getTableSelector().getFromSectionType(),o=t.getTableSelector().getSelectedBoundary(),h=o.isValidate();this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)&&(t.setCellEditable(!0),this.restoreCursor(),i=!0);t.setFontBold(n)}else u==this.reportConstValue.shapeType.rectangle?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontBold(n)):u==this.reportConstValue.shapeType.textbox&&(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontBold(n))}i&&ecount.global.setTimeout(this.ecPageID,function(){this.restoreMappingDataLayer()}.bind(this));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeFontItalic:function(n){var i,r,e,f,u,t;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=!1,r=0,e=this.collection.list.length;r<e;r++){if(f=this.getEntityById(this.collection.list[r].id),!f)return;if(u=f.getDataProperty("controlType"),t=this.getFormItemById(this.collection.list[r].id),!t)return;if(u==this.reportConstValue.shapeType.table){var s=t.getTableSelector().getFromSectionType(),o=t.getTableSelector().getSelectedBoundary(),h=o.isValidate();this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)&&(t.setCellEditable(!0),this.restoreCursor(),i=!0);t.setFontItalic(n)}else u==this.reportConstValue.shapeType.rectangle?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontItalic(n)):u==this.reportConstValue.shapeType.textbox&&(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontItalic(n))}i&&ecount.global.setTimeout(this.ecPageID,function(){this.restoreMappingDataLayer()}.bind(this));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeFontUnderline:function(n){var i,r,e,f,u,t;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=!1,r=0,e=this.collection.list.length;r<e;r++){if(f=this.getEntityById(this.collection.list[r].id),!f)return;if(u=f.getDataProperty("controlType"),t=this.getFormItemById(this.collection.list[r].id),!t)return;if(u==this.reportConstValue.shapeType.table){var s=t.getTableSelector().getFromSectionType(),o=t.getTableSelector().getSelectedBoundary(),h=o.isValidate();this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)&&(t.setCellEditable(!0),this.restoreCursor(),i=!0);t.setFontUnderline(n)}else u==this.reportConstValue.shapeType.rectangle?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontUnderline(n)):u==this.reportConstValue.shapeType.textbox&&(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontUnderline(n))}i&&ecount.global.setTimeout(this.ecPageID,function(){this.restoreMappingDataLayer()}.bind(this));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeFontStrike:function(n){var i,r,e,f,u,t;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=!1,r=0,e=this.collection.list.length;r<e;r++){if(f=this.getEntityById(this.collection.list[r].id),!f)return;if(u=f.getDataProperty("controlType"),t=this.getFormItemById(this.collection.list[r].id),!t)return;u==this.reportConstValue.shapeType.table?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)&&(t.setCellEditable(!0),this.restoreCursor(),i=!0),t.setFontStrike(n)):u==this.reportConstValue.shapeType.rectangle?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontStrike(n)):u==this.reportConstValue.shapeType.textbox&&(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontStrike(n))}i&&ecount.global.setTimeout(this.ecPageID,function(){this.restoreMappingDataLayer()}.bind(this));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeFontBackgroundColor:function(n){var i,r,e,f,u,t;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=!1,r=0,e=this.collection.list.length;r<e;r++){if(f=this.getEntityById(this.collection.list[r].id),!f)return;if(u=f.getDataProperty("controlType"),t=this.getFormItemById(this.collection.list[r].id),!t)return;if(u==this.reportConstValue.shapeType.table){var s=t.getTableSelector().getFromSectionType(),o=t.getTableSelector().getSelectedBoundary(),h=o.isValidate();this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)&&(t.setCellEditable(!0),this.restoreCursor(),i=!0);t.setFontBackgroundColor(n)}else u==this.reportConstValue.shapeType.rectangle?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontBackgroundColor(n)):u==this.reportConstValue.shapeType.textbox&&(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontBackgroundColor(n))}i&&ecount.global.setTimeout(this.ecPageID,function(){this.restoreMappingDataLayer()}.bind(this));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeFontColor:function(n){var i,r,e,f,u,t;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=!1,r=0,e=this.collection.list.length;r<e;r++){if(f=this.getEntityById(this.collection.list[r].id),!f)return;if(u=f.getDataProperty("controlType"),t=this.getFormItemById(this.collection.list[r].id),!t)return;if(u==this.reportConstValue.shapeType.table){var s=t.getTableSelector().getFromSectionType(),o=t.getTableSelector().getSelectedBoundary(),h=o.isValidate();this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)&&(t.setCellEditable(!0),this.restoreCursor(),i=!0);t.setFontColor(n)}else u==this.reportConstValue.shapeType.rectangle?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontColor(n)):u==this.reportConstValue.shapeType.textbox&&(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontColor(n))}i&&ecount.global.setTimeout(this.ecPageID,function(){this.restoreMappingDataLayer()}.bind(this));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeFontVerticalAlign:function(n){var i,r,e,f,u,t;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=!1,r=0,e=this.collection.list.length;r<e;r++){if(f=this.getEntityById(this.collection.list[r].id),!f)return;if(u=f.getDataProperty("controlType"),t=this.getFormItemById(this.collection.list[r].id),!t)return;if(u==this.reportConstValue.shapeType.table){var s=t.getTableSelector().getFromSectionType(),o=t.getTableSelector().getSelectedBoundary(),h=o.isValidate();this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)&&(t.setCellEditable(!0),this.restoreCursor(),i=!0);t.setFontVerticalAlign(n)}else u==this.reportConstValue.shapeType.rectangle?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontVerticalAlign(n)):u==this.reportConstValue.shapeType.textbox&&(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontVerticalAlign(n))}i&&ecount.global.setTimeout(this.ecPageID,function(){this.restoreMappingDataLayer()}.bind(this));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeFontHorizontalAlign:function(n){var i,r,e,f,u,t;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=!1,r=0,e=this.collection.list.length;r<e;r++){if(f=this.getEntityById(this.collection.list[r].id),!f)return;if(u=f.getDataProperty("controlType"),t=this.getFormItemById(this.collection.list[r].id),!t)return;if(u==this.reportConstValue.shapeType.table){var h=t.getTableSelector().getFromSectionType(),o=t.getTableSelector().getSelectedBoundary(),s=o.isValidate();this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)&&(t.setCellEditable(!0),this.restoreCursor(),i=!0);t.config.isManagedShape?t.setFontHorizontalAlign(n):s?t.setFontHorizontalAlign(n):t.setShapeHorizontalAlign(n)}else u==this.reportConstValue.shapeType.rectangle?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontHorizontalAlign(n)):u==this.reportConstValue.shapeType.textbox?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(t.setFocusInTextContainer(),this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontHorizontalAlign(n)):t.config.isManagedShape||t.setShapeHorizontalAlign(n)}i&&ecount.global.setTimeout(this.ecPageID,function(){this.restoreMappingDataLayer()}.bind(this));this.setSelectedShapeSyncLineHandlerPosition();this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeSyncLineHandlerPosition:function(){for(var r,t,n=0,i=this.collection.list.length;n<i;n++){if(r=this.getEntityById(this.collection.list[n].id),!r)return;if(t=this.getFormItemById(this.collection.list[n].id),!t)return;t.syncLineHandlerPosition()}},setSelectedShapeFontOverflowHidden:function(n){var i,r,e,f,u,t;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=!1,r=0,e=this.collection.list.length;r<e;r++){if(f=this.getEntityById(this.collection.list[r].id),!f)return;if(u=f.getDataProperty("controlType"),t=this.getFormItemById(this.collection.list[r].id),!t)return;if(u==this.reportConstValue.shapeType.table){var s=t.getTableSelector().getFromSectionType(),o=t.getTableSelector().getSelectedBoundary(),h=o.isValidate();this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)&&(t.setCellEditable(!0),this.restoreCursor(),i=!0);t.setFontOverflowHidden(n)}else u==this.reportConstValue.shapeType.rectangle?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontOverflowHidden(n)):u==this.reportConstValue.shapeType.textbox&&(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(this.restoreCursor(),i=!0):this.removeAllRanges(),t.setFontOverflowHidden(n))}i&&ecount.global.setTimeout(this.ecPageID,function(){this.restoreMappingDataLayer()}.bind(this));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeBackgroundColor:function(n){var i,r,e,f,u,t;for(n=(n||"").trim(),this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=!1,r=0,e=this.collection.list.length;r<e;r++){if(f=this.getEntityById(this.collection.list[r].id),!f)return;if(u=f.getDataProperty("controlType"),t=this.getFormItemById(this.collection.list[r].id),!t)return;if(u==this.reportConstValue.shapeType.table){var s=t.getTableSelector().getFromSectionType(),o=t.getTableSelector().getSelectedBoundary(),h=o.isValidate();this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)&&(t.setCellEditable(!0),this.restoreCursor(),i=!0);t.setBackgroundColor(n)}else u==this.reportConstValue.shapeType.rectangle?(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(this.restoreCursor(),i=!0):this.removeAllRanges(),t.setBackgroundColor(n)):u==this.reportConstValue.shapeType.textbox&&(this.config.beforeCursorPosition&&this.reportConstValue.fontControlIdList.contains(this.config.beforeCursorPosition.sourceId)?(this.restoreCursor(),i=!0):this.removeAllRanges(),t.setBackgroundColor(n))}i&&ecount.global.setTimeout(this.ecPageID,function(){this.restoreMappingDataLayer()}.bind(this));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeBorderStyle:function(n){var t,r,i;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,t=0,r=this.collection.list.length;t<r;t++){if(i=this.getFormItemById(this.collection.list[t].id),!i)return;i.setBorderStyle(n)}this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeRowShaded:function(n){var t,r,i;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,t=0,r=this.collection.list.length;t<r;t++){if(i=this.getFormItemById(this.collection.list[t].id),!i)return;i.setStripePattern&&i.setStripePattern(n)}this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeIsRatio:function(n){var t,r,i;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,t=0,r=this.collection.list.length;t<r;t++){if(i=this.getFormItemById(this.collection.list[t].id),!i)return;i.setIsRatio&&i.setIsRatio(n)}this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setWidthWithBoundary:function(n,t,i,r){var f,u,s,o,h,e;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,f=this.getActiveCollection(),u=0,s=f.list.length;u<s;u++)(o=this.getEntityById(f.list[u].id),o)&&(h=o.getDataProperty("controlType"),e=this.getFormItemById(o.id),e)&&(h==this.reportConstValue.shapeType.table?e.setCellWidthWithBoundary(n,t,i,r,{isReselectSelector:this.previousCollection==null}):e.setWidth&&e.setWidth(n),this.updateElementSize({targetId:f.list[u].id}),this.updateElementPoint({targetId:f.list[u].id}));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setHeightWithBoundary:function(n,t,i,r){var f,u,s,o,h,e;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,f=this.getActiveCollection(),u=0,s=f.list.length;u<s;u++)(o=this.getEntityById(f.list[u].id),o)&&(h=o.getDataProperty("controlType"),e=this.getItemById(f.list[u].id),e)&&(h==this.reportConstValue.shapeType.table?e.setCellHeightWithBoundary(n,t,i,r,{isReselectSelector:this.previousCollection==null}):e.setHeight&&e.setHeight(n),this.updateElementSize({targetId:f.list[u].id}),this.updateElementPoint({targetId:f.list[u].id}));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setWidthWithShapes:function(n,t){var i,u,r;if(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,t&&t.length!=0){for(i=0,u=t.length;i<u;i++)(r=this.getItemById(t[i].id),r)&&(r.setWidth&&r.setWidth(n),this.updateElementSize({targetId:t[i].id}),this.updateElementPoint({targetId:t[i].id}));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()}},setHeightWithShapes:function(n,t){var i,u,r;if(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,t&&t.length!=0){for(i=0,u=t.length;i<u;i++)(r=this.getItemById(t[i].id),r)&&(r.setHeight&&r.setHeight(n),this.updateElementSize({targetId:t[i].id}),this.updateElementPoint({targetId:t[i].id}));this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()}},setSelectedShapeWidth:function(n){var i,t,f,u,e,r;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=this.getActiveCollection(),t=0,f=i.list.length;t<f;t++){if(u=this.getEntityById(i.list[t].id),!u)return;if(e=u.getDataProperty("controlType"),r=this.getFormItemById(i.list[t].id),!r)return;e==this.reportConstValue.shapeType.table?r.setCellWidth(n):r.setWidth&&r.setWidth(n);this.updateElementSize({targetId:i.list[t].id});this.updateElementPoint({targetId:i.list[t].id})}this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeHeight:function(n){var i,t,f,u,e,r;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,i=this.getActiveCollection(),t=0,f=i.list.length;t<f;t++){if(u=this.getEntityById(i.list[t].id),!u)return;if(e=u.getDataProperty("controlType"),r=this.getFormItemById(i.list[t].id),!r)return;e==this.reportConstValue.shapeType.table?r.setCellHeight(n):r.setHeight&&r.setHeight(n);this.updateElementSize({targetId:i.list[t].id});this.updateElementPoint({targetId:i.list[t].id})}this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSelectedShapeLinebreak:function(n){var t,u,r,f,i;for(this.config.isBeginHistoryTransaction=!0,this.config.isBeginSaveCursorTransaction=!0,this.config.isSyncFont=!1,t=0,u=this.collection.list.length;t<u;t++){if(r=this.getEntityById(this.collection.list[t].id),!r)return;if(f=r.getDataProperty("controlType"),i=this.getFormItemById(this.collection.list[t].id),!i)return;["ecount.report.shape.table","ecount.report.shape.rectangle","ecount.report.shape.textbox"].contains(f)&&i.setLinebreak&&i.setLinebreak(n)}this.config.isSyncFont=!0;this.config.isBeginSaveCursorTransaction=!1;this.config.isBeginHistoryTransaction=!1;this.addDataInHistory()},setSyncOfTableLayout:function(n){var t=n.value,i=this.getEntityById(t.id),r=i.getDataProperty("childrenNodes");r.forEach(function(n){var i=n.getDataProperty("controlType"),t;i===this.reportConstValue.shapeType.table&&(t=this.getTempItem(n,{isNotUseLineHandler:!0}),t.syncOfTableLayout&&t.syncOfTableLayout())}.bind(this))},setConvertTableInOuterHTML:function(n){this.entityTree.convertTableInOuterHTML(n.value.$el,n.value.forceSetAttribute)},setElementsCache:function(n){this.entityTree.elementsCache(n)},setShapeShowError:function(n){var t=this.getItemById(n.id);t&&n&&t.showError({content:n.message})},convertBackgroundImage:function(n){var t=this.getItemById(n),i,r;t&&(i=t.getBackgroundImageElements(),i&&i.length)&&(r=i.map(function(n,t){return{el:t,url:this.shapeUtils.getImageUrl(t)}}.bind(this)).filter(function(n,t){return t.url}),r.each(function(n,i){var u=i.el,f=i.url,e=$(u);ecount.common.requireBackgroundImage(e,function(i){var c=i.target,o=u.getBoundingClientRect(),s={x:u.style.backgroundPositionX||"0px",y:u.style.backgroundPositionY||"0px"},e={border:"none"},l,a,h;_.includes(s.x,"px")?e.left=t.getPosition().left+o.left-t.get$ElBoundingClientRect().left+parseInt(s.x):_.includes(s.x,"%")&&(l=Math.max(o.width-c.naturalWidth,0),e.left=t.getPosition().left+o.left-t.get$ElBoundingClientRect().left+l*parseInt(s.x)/100);_.includes(s.y,"px")?e.top=t.getPosition().top+o.top-t.get$ElBoundingClientRect().top+parseInt(s.y):_.includes(s.y,"%")&&(a=Math.max(o.height-c.naturalHeight,0),e.top=t.getPosition().top+o.top-t.get$ElBoundingClientRect().top+a*parseInt(s.y)/100);u.style.backgroundSize?(h=u.style.backgroundSize.split(" "),_.includes(h[0],"px")&&(e.width=parseInt(h[0])),_.includes(h[1],"px")&&(e.height=parseInt(h[1]))):parseInt(u.style.width)>0&&parseInt(u.style.height)>0?(e.width=parseInt(u.style.width),e.height=parseInt(u.style.height)):(e.width=o.width,e.height=o.height);this.draw("image",{action:this.reportConstValue.shapeStatus.directDrawing,attr:{src:f},style:e,isDragable:!0,isResizable:!0,directSelect:!0});r.length==n+1&&r.each(function(n,t){this.shapeUtils.removeBackgroundImage(t.el)}.bind(this))}.bind(this))}.bind(this)))},addImage:function(n,t){function u(n){return this.hasOnlyOneCollection()&&(n=this.getItemById(this.collection.list[0].id))&&this.hasCursorInShape(n)&&this.getCursorPosition()}var i,r;n&&(Array.isArray(n)||(n=[n]),i=this.getFormItemById(this.config.beforeCursorPosition&&this.config.beforeCursorPosition.editableId),i&&(this.restoreCursor(),r=i.getId(),!this.collection.getById(r)&&i.selectByRange&&i.selectByRange()&&(this.setEditableId(r),this.addCollectionById(r))),u.call(this,i)?this.addImageToShape(n,i):n.forEach(function(n){this.createImage(n,t)}.bind(this)))},createImage:function(n,t){this.draw("image",{action:ecount.constValue.drawingPaper.shapeStatus.directDrawing,attr:{src:n},style:{border:"none"},isDragable:!0,isResizable:!0,directSelect:!0,callback:t})},addImageToShape:function(n,t){if(n){var i=$("<div><\/div>"),r=[];n.forEach(function(n){var t=$("<img src='"+n+"'>");this.shapeUtils.changeIntoImageShape(t[0],{classList:["cursor-default"],isResizable:!0});i.append(t);r.push(t[0])}.bind(this));ecount.common.requireBackgroundImage(r,function(n){var t=n.target;t.naturalWidth>0&&(t.style.width=t.naturalWidth+"px");t.naturalHeight>0&&(t.style.height=t.naturalHeight+"px")},function(){this.pasteShapeWithoutWrapper({value:i.html()});this.setElementsCache(t.$parent);t.setSizeByOverflowedSize&&t.setSizeByOverflowedSize();this.resizeHandler({delay:!1});this.addDataInHistory()}.bind(this),!0)}},moveFirst:function(n){function h(n,t){return n.zIndex>t.zIndex?-1:n.zIndex<t.zIndex?1:0}var s,i,t,u,c,r,o;if(typeof n=="string"&&(n=[{id:n}]),s=n||this.collection.list,i=this.$wrapperEl.find(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),i&&i.length!=0){for(t=[],u=0,c=i.length;u<c;u++){var f=i.eq(u),e=f.find("[data-controltype]"),n=e.attr("id"),v=e.attr("data-controltype"),l=parseInt(f.css("z-index"),10);t.push({id:n,$el:e,$container:f,zIndex:l})}t.sort(h);r=this.getSelectedMoveItem(s);r.sort(h);r.forEach(function(n){var i=t.filter(function(t){return t.id==n.id}),r,u;i&&i.length==1&&(r=i[0],u=t.indexOf(r),t.splice(u,1))}.bind(this));o=this.reportConstValue.defaultZIndex+t.length+r.length;r.forEach(function(n){n.$container.css({"z-index":o--})});t.forEach(function(n){n.$container.css({"z-index":o--})})}},moveForward:function(n){function c(n,t){return n.zIndex>t.zIndex?1:n.zIndex<t.zIndex?-1:0}function l(n,t){return n.zIndex>t.zIndex?-1:n.zIndex<t.zIndex?1:0}var s,i,r,h,o;if(typeof n=="string"&&(n=[{id:n}]),s=n||this.collection.list,i=this.$wrapperEl.find(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),i&&i.length!=0){var t=[],u={},a=ecount.common.maxZIndex(this.$wrapperEl);for(r=0,h=i.length;r<h;r++){var f=i.eq(r),e=f.find("[data-controltype]"),n=e.attr("id"),y=e.attr("data-controltype"),v=parseInt(f.css("z-index"),10);t.push({id:n,$el:e,$container:f,zIndex:v})}t.sort(c);o=this.getSelectedMoveItem(s);o.sort(l);o.forEach(function(n){var f=t.filter(function(t){return t.id==n.id}),o;if(f&&f.length==1){var i=f[0],e=t.indexOf(i),r=t[e+1];i.zIndex==a?u[i.id]=!0:(r&&!u[r.id]&&(r.$container.css({"z-index":i.zIndex}),i.$container.css({"z-index":r.zIndex}),o=t.splice(e,1),o.splice(0,0,e,0),Array.prototype.splice.apply(t,o)),u[i.id]=!0)}}.bind(this))}},moveBack:function(n){function h(n,t){return n.zIndex>t.zIndex?1:n.zIndex<t.zIndex?-1:0}var s,i,r,c,o;if(typeof n=="string"&&(n=[{id:n}]),s=n||this.collection.list,i=this.$wrapperEl.find(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),i&&i.length!=0){var t=[],u={},l=ecount.common.minZIndex(this.$wrapperEl);for(r=0,c=i.length;r<c;r++){var f=i.eq(r),e=f.find("[data-controltype]"),n=e.attr("id"),y=e.attr("data-controltype"),a=parseInt(f.css("z-index"),10);t.push({id:n,$el:e,$container:f,zIndex:a})}t.sort(h);o=this.getSelectedMoveItem(s);o.sort(h);o.forEach(function(n){var f=t.filter(function(t){return t.id==n.id}),o;if(f&&f.length==1){var i=f[0],e=t.indexOf(i),r=t[e-1];i.zIndex==l?u[i.id]=!0:(r&&!u[r.id]&&(r.$container.css({"z-index":i.zIndex}),i.$container.css({"z-index":r.zIndex}),o=t.splice(e-1,1),o.splice(0,0,e,0),Array.prototype.splice.apply(t,o)),u[i.id]=!0)}}.bind(this))}},moveLast:function(n){function h(n,t){return n.zIndex>t.zIndex?1:n.zIndex<t.zIndex?-1:0}var s,i,t,r,c,u,o;if(typeof n=="string"&&(n=[{id:n}]),s=n||this.collection.list,i=this.$wrapperEl.find(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),i&&i.length!=0){for(t=[],r=0,c=i.length;r<c;r++){var f=i.eq(r),e=f.find("[data-controltype]"),n=e.attr("id"),v=e.attr("data-controltype"),l=parseInt(f.css("z-index"),10);t.push({id:n,$el:e,$container:f,zIndex:l})}t.sort(h);u=this.getSelectedMoveItem(s);u.sort(h);u.forEach(function(n){var i=t.filter(function(t){return t.id==n.id}),r,u;i&&i.length==1&&(r=i[0],u=t.indexOf(r),t.splice(u,1))}.bind(this));o=this.reportConstValue.defaultZIndex+1;u.forEach(function(n){n.$container.css({"z-index":o++})});t.forEach(function(n){n.$container.css({"z-index":o++})})}},removeAllRanges:function(){var n=window.getSelection();if(n.rangeCount)try{n.removeAllRanges()}catch(t){}},drawShape:function(n,t){var i=this.getActionInstance(n);i&&(i.setConfig(_.extend(this.getDefaultConfig(),t)),this.isResetCanvasBoundingClientRect(n)&&(i.resetCanvasBoundingClientRect(),this.setResetCanvasBoundingClientRect(!1,n)),i.setCanvas(this.$wrapperEl),i.setAction(this.reportConstValue.shapeStatus.drawDirect),i.draw())},getToolbarParameter:function(){return this.getCommandAllParameter()},getLayoutContainer:function(){return!this.$layoutContainer&&this.$wrapperEl&&(this.$layoutContainer=this.$wrapperEl.closest(this.config.layoutContainerPrefix+this.config.layoutContainerSelector)),this.$layoutContainer},isEmpty:function(){var n=this.$wrapperEl.find(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector);return n&&n.length<1?!0:!1},isContentOfEmpty:function(){var n=this.getContent(),t=$(n);return n==""||t.html()==""?!0:!1},removeDefaultBox:function(n){var t=n.find("["+this.reportConstValue.defaultBoxAttrKey+"]");t.each(function(n,t){this.isValidDefaultBox(t)?($(t).removeAttr(this.reportConstValue.defaultBoxAttrKey),$(t).find(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector).removeAttr(this.reportConstValue.placeholderAttrKey)):$(t).closest(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector).remove()}.bind(this))},isValidDefaultBox:function(n,t){var r=$(n).attr("id"),i=this.getItemById(r,{isNotUseLineHandler:t===0?!1:!0});return i?(i.setConfig({isNotUseLineHandler:!1}),!i.isEmptyDefaultBox())?!0:!1:!1},removeActionInstancePopover:function(){var u=this.entityTree.getEntities(),i=u&&u.list,n,f,e,r,t;if(!(i.length<1))for(n=0,f=i.length;n<f;n++)if(e=i[n],r=e.getDataProperty("controlType"),r===this.reportConstValue.shapeType.textbox){if(t=this.getActionInstance(r),!t)return;t.hideError&&t.hideError()}},removeSelectOutline:function(n){var t,i;if(this._options.isAdjustOutline){if(t=n.find(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),i=!1,t.each(function(n){var r=t.eq(n),u,f;r.hasClass("outline")&&!r.attr(this.reportConstValue.oldHTMLAttributeKey)&&(i=!0,r.removeClass("outline"),u=parseInt(r.css("top"),10),f=parseInt(r.css("left"),10),r.css("top",u+this.reportConstValue.containerTopPadding+"px"),r.css("left",f+this.reportConstValue.containerLeftPadding+"px"))}.bind(this)),i){var f="["+this.reportConstValue.wrapperAttrKey+"='"+this.reportConstValue.canvasWrapperSelector+"']",r=n.find(f),u=r.outerHeight();u>0&&r.css("height",u-this.reportConstValue.containerTopPadding*2+"px")}return n}},addSelectOutline:function(n){var t=n.find(this.reportConstValue.wrapperAreaSelectPrefix+this.reportConstValue.wrapperAreaSelectSelector),i=!1;if(t.each(function(n){var r=t.eq(n),u,f;r.hasClass("outline")||r.attr("data-isoldhtmlbox")||(i=!0,r.addClass("outline"),u=parseInt(r.css("top"),10),f=parseInt(r.css("left"),10),r.css("top",u-this.reportConstValue.containerTopPadding+"px"),r.css("left",f-this.reportConstValue.containerLeftPadding+"px"))}.bind(this)),i){var u="["+this.reportConstValue.wrapperAttrKey+"='"+this.reportConstValue.canvasWrapperSelector+"']",f=n.find(u),r=f.outerHeight();r>0&&this.setHeight(r+this.reportConstValue.containerTopPadding*2)}return n},removeControlByType:function(n,t){var r=$(n),i;t&&(i=t.map(function(n){return"[data-controltype='"+n+"']"}).join(","),r.find(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector).filter(function(n,t){return $(t).find(i).length>0}).remove())},extendUserData:function(n){this.userData||(this.userData={});this.userData[id]||(this.userData[id]={});this.userData=$.extend(!0,this.userData,n)},setUserData:function(n,t,i){function e(n,t){return n[t]}var r,u,f;for(this.userData||(this.userData={}),this.userData[n]||(this.userData[n]={}),r=this.userData[n],u=t.split("."),t=u.pop();f=u.pop();)if(r=e(r,f),!r)break;r&&(r[t]=i)},getUserData:function(n){return this.userData||(this.userData={}),this.userData[n]||(this.userData[n]={}),this.userData&&this.userData[n]},getSerialize:function(){var t=[],n=this.$wrapperEl.find(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector);return!n||n.length==0?t:(n.each(function(i){var s=n.eq(i),u=n.eq(i).find("[data-controltype]"),f;if(u||u.length){var c=u.attr("id"),nt=u.attr("data-controltype"),l=parseFloat(s.css("top")),a=parseFloat(s.css("left")),v=parseFloat(u.css("width")),y=parseFloat(u.css("height")),p=parseInt(s.css("z-index"),10),tt=s.find(".wrapper-areaselect-title").text(),it=ecount.convertor.convertRGBToHex(s.css("background-color")||""),rt=s.css("background-repeat")||"",ut=u.css("border-top-style"),w=parseInt(u.css("border-top-width"),10),ft=ecount.convertor.convertRGBToHex(u.css("border-top-color")||""),et=u.css("border-bottom-style"),b=parseInt(u.css("border-bottom-width"),10),ot=ecount.convertor.convertRGBToHex(u.css("border-bottom-color")||""),st=u.css("border-left-style"),k=parseInt(u.css("border-left-width"),10),ht=ecount.convertor.convertRGBToHex(u.css("border-left-color")||""),ct=u.css("border-right-style"),d=parseInt(u.css("border-right-width"),10),lt=ecount.convertor.convertRGBToHex(u.css("border-right-color")||"");l=l.toString&&l.toString()||l;a=a.toString&&a.toString()||a;v=v.toString()&&v.toString()||v;y=y.toString()&&y.toString()||y;p=p.toString()&&p.toString()||p;w=w.toString&&w.toString()||w;b=b.toString&&b.toString()||b;k=k.toString&&k.toString()||k;d=d.toString&&d.toString()||d;var at=u.attr("data-step")||"",e,o="",h="",g,r=this.getShapeFontInfo(c);switch(nt){case this.reportConstValue.shapeType.rectangle:e=u.find(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector);e&&e.length&&(h=e.html(),o=e.text().replace(this._doc._ZWS,""));break;case this.reportConstValue.shapeType.textbox:e=u.find(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector);e&&e.length&&(h=e.html(),o=e.text().replace(this._doc._ZWS,""));g=o.isContainsLimitedSpecial("name");g.id=c;break;case this.reportConstValue.shapeType.sign:o=u.css("background-image").replace('url("',"").replace(/\"\)$/,"");h=o;break;case this.reportConstValue.shapeType.image:o=u.css("background-image").replace('url("',"").replace(/\"\)$/,"");h=o;break;case this.reportConstValue.shapeType.imagecheckbox:o=u.hasClass("checked")===!0?"1":"0";h=o}f={id:c,controlType:nt,text:o,html:h,title:tt,filter:g,style:{top:l,left:a,width:v,height:y,"z-index":p,"background-color":it,"background-repeat":rt,"border-top-style":ut,"border-top-width":w,"border-top-color":ft,"border-bottom-style":et,"border-bottom-width":b,"border-bottom-color":ot,"border-left-style":st,"border-left-width":k,"border-left-color":ht,"border-right-style":ct,"border-right-width":d,"border-right-color":lt},attr:{"data-step":at},font:{}};r&&(r.family&&(f.font.family=r.family),r.size&&(f.font.size=r.size||""),r.bold&&(f.font.bold=r.bold),r.italic&&(f.font.italic=r.italic),r.underline&&(f.font.underline=r.underline),r.strike&&(f.font.strike=r.strike),r.foreColor&&(f.font.foreColor=r.foreColor),r.fontBackgroundColor&&(f.font.fontBackgroundColor=r.fontBackgroundColor),r.backgroundColor&&(f.font.backgroundColor=r.backgroundColor),r.verticalAlign&&(f.font.verticalAlign=r.verticalAlign),r.horizontalAlign&&(f.font.horizontalAlign=r.horizontalAlign),r.lineBreak&&(f.font.lineBreak=r.lineBreak));this.userData&&this.userData[c]?t.push($.extend(!0,f,this.userData[c])):t.push(f)}}.bind(this)),t)},getCanvasWidth:function(){return this.$wrapperEl.outerWidth()},getCanvasHeight:function(){return this.$wrapperEl.outerHeight()},getMappingData:function(n){return this.mappingDataCollection.getById(n)},getMappingDatas:function(){var n=this.$el.find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector);return _.compact(_.map(n,function(n){return this.mappingDataCollection.getById(n.id)}.bind(this)))},getMappingDataList:function(){return this.mappingDataCollection.serialize().list.clone(!0)},getMappingDataObject:function(){return Object.clone(this.mappingDataCollection.serialize().keys,!0)},getImageHyperlinkData:function(n){return this.mappingDataCollection.getById(n)},getImageHyperlinkDatas:function(){var n=this.$el.find(this.reportConstValue.shapeType.image);return _.compact(_.map(n,function(n){return this.imageHyperlinkDataCollection.getById(n.id)}.bind(this)))},getImageHyperlinkDataList:function(){return this.imageHyperlinkDataCollection.serialize().list.clone(!0)},getImageHyperlinkDataObject:function(){return Object.clone(this.imageHyperlinkDataCollection.serialize().keys,!0)},getSelectedMoveItem:function(n){var t=[];return n.forEach(function(n){var i=this.entityTree.getEntitySuperParentById(n.id),r=i.getDataProperty("container"),u=i.getDataProperty("el"),f=parseInt(r.css("z-index"),10);t.push({id:i.id,$el:u,$container:r,zIndex:f})}.bind(this)),t},copyClipboard:function(){function h(n){if(f=n.isEditable(),n.controlType==this.reportConstValue.shapeType.table){var t=this.instanceManager.tableSelector,i=t&&t.getSelectedBoundary();return o=i.isValidate(),o&&f&&n.isCursorInTextContainer(this.reportConstValue.searchCursorType.range)}return f&&n.isCursorInTextContainer(this.reportConstValue.searchCursorType.range)}var u=this.instanceManager.clipboardInstance,n,e,r,i,s,t;if(u)if(this.hasOnlyOneCollection()){var f=!1,o=!1;if(n=ecount.report.clipboard.getDefaultData({actionId:this.id}),e=this.collection.list[0],t=this.getItemById(e.id,{action:this.reportConstValue.shapeStatus.selectable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"}),!t)return;h.call(this,t)?n.value=this.copySelectTextarea():(n.type=t.isManagedShape()?"shape":"unManagedShape",n.value=this.isContract?t.getParentHTML():t.getHTML(),n.position.push(t.getPosition()));n.refId=e.id;n.option.mappingDatas=this.getMappingDatasInHtml(n.value);u.copy(n)}else{for(n=ecount.report.clipboard.getDefaultData({actionId:this.id,type:"shape"}),r=_.clone(this.collection.list),i=0,s=r.length;i<s;i++){if(t=this.getItemById(r[i].id,{action:this.reportConstValue.shapeStatus.selectable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"}),!t)return;t.isManagedShape()&&(n.value+=this.isContract?t.getParentHTML():t.getHTML(),n.position.push(t.getPosition()),n.refId=r[i].id)}n.option.mappingDatas=this.getMappingDatasInHtml(n.value);u.copy(n)}},getMappingDatasInHtml:function(n){if(n){n.cloneNode&&(n=n.cloneNode(!0));var t=$("<div><\/div>").append(n).html();return this.mappingDataCollection.list.filter(function(n){return _.includes(t,n.id)})}},cutClipboard:function(){var o=this.instanceManager.clipboardInstance,t,i,s,h,u,a,f,v,e,n;if(o){if(this.hasOnlyOneCollection()){if(t=ecount.report.clipboard.getDefaultData({actionId:this.id}),i=this.collection.list[0],s=this.getEntityById(i.id),!s)return;if(h=s.getDataProperty("controlType"),n=this.getItemById(i.id,{action:this.reportConstValue.shapeStatus.selectable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"}),!n)return;if(n.isEditable()&&n.isCursorInTextContainer(this.reportConstValue.searchCursorType.range))t.value=this.deleteSelectTextarea();else{var c=null,l=-1,r=null;if(h==this.reportConstValue.shapeType.table&&(c=n.getTableSelector().getFromSectionType(),l=n.getTableSelector().getFromSectionIndex(),r=n.getTableSelector().getSelectedBoundary()),t.type=n.isManagedShape()?"shape":"unManagedShape",t.value=n.getHTML(),t.position.push(n.getPosition()),h==this.reportConstValue.shapeType.table)if(r.isValidate()){for(u=r.config.top,a=r.config.bottom;u<=a;u++)for(f=r.config.left,v=r.config.right;f<=v;f++)n.setCell(c,l,f,u,"");this.constValue.isIE||this.addDataInHistory()}else n.remove(),this.collection.removeById(i.id);else n.remove(),this.collection.removeById(i.id)}t.refId=i.id;t.option.mappingDatas=this.getMappingDatasInHtml(t.value);o.copy(t)}else{for(t=ecount.report.clipboard.getDefaultData({actionId:this.id,type:"shape"});e=this.collection.list.shift();){if(n=this.getItemById(e.id,{action:this.reportConstValue.shapeStatus.selectable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"}),!n)return;t.type=n.isManagedShape()?"shape":"unManagedShape";t.value+=n.getHTML();t.position.push(n.getPosition());t.refId=e.id;n.remove();this.collection.removeById(e.id)}t.option.mappingDatas=this.getMappingDatasInHtml(t.value);o.copy(t)}this.config.dropdownmenu.serviceKey&&(ecount.layer.removeLayer(this.config.dropdownmenu.serviceKey),this.config.dropdownmenu.serviceKey=null)}},pasteClipboard:function(n,t,i,r){var u=this.instanceManager.clipboardInstance;u&&(this._tempPasteValidMappingDatas=null,u.paste({actionId:this.id,setTimeoutId:this.ecPageID,validate:this.validateClipboardPaste.bind(this),callback:this.executePaste.bind(this),oEvent:t,isPlainText:r&&r.isPlainText}))},hasCursorInShape:function(n,t){if(t=t||n.controlType,t==this.reportConstValue.shapeType.table){var r=this.instanceManager.tableSelector,e=this.instanceManager.tableStructure,u=r&&r.getFromSectionType(),f=r&&r.getFromSectionIndex(),i=r&&r.getSelectedBoundary();if(i.isValidate())return n.isCursorInTextContainer(this.reportConstValue.searchCursorType.range)?(n.setCellEditable(u,f,i.config.left,i.config.top,!0,!0),!0):(n.setCellEditable(u,f,i.config.left,i.config.top,!0,!0),n.moveCursorLastPosition(e.getTd(u,f,i.config.left,i.config.top)),!0)}else if([this.reportConstValue.shapeType.rectangle,this.reportConstValue.shapeType.textbox].contains(t)&&n.isCursorInTextContainer(this.reportConstValue.searchCursorType.range))return!0;return!1},validateClipboardPaste:function(n){var i=n.data,t={valid:[],fail:[]};$("<div><\/div>").append(i.value).find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector).each(function(n,r){var o=$(r),u=o.attr("id"),e=o.text(),f;if(!i.option||!i.option.mappingDatas){t.fail.push({id:u,text:e});return}if(f=i.option.mappingDatas.find(function(n){return n.id==u}),!f){t.fail.push({id:u,text:e});return}if(this.isValidMappingItem&&!this.isValidMappingItem(f)){t.fail.push({id:u,text:e});return}t.valid.push(f)}.bind(this));this._tempPasteValidMappingDatas=t.valid;this._options.validatePaste?this._options.validatePaste({mappingItems:t,callback:n.callback}):n.callback(!0)},isValidMappingItem:function(n){return n?_.some(this._options.codeTable,function(t){return t.INPUT_CD==n.code}):!1},setMappingColumnUniqueId:function(n){var i,r,t;if(n.nodeType==Node.ELEMENT_NODE)$(n).find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector).each(function(n,t){this.copyMappingItem(t,this._tempPasteValidMappingDatas)}.bind(this));else if(n.nodeType==Node.DOCUMENT_FRAGMENT_NODE)for(i=0,r=n.childNodes.length;i<r;i++)t=n.childNodes[i],t.nodeType==Node.ELEMENT_NODE&&(t.classList.contains(this.reportConstValue.mappingDataSelector)?this.copyMappingItem(t,this._tempPasteValidMappingDatas):$(t).find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector).each(function(){this.copyMappingItem(t,this._tempPasteValidMappingDatas)}.bind(this)));return{value:!0,failItems:[]}},setHyperlinkUniqueId:function(n){$(n).find("a").each(function(n,t){t.setAttribute("id",ecount.common.uuid(this.reportConstValue.defaultCanvasConfig.prefixId.hyperlinkPrefix))}.bind(this))},hasOnlyOneCollection:function(){return this.collection.list.length===1},replaceAllShpeIdWithPasteData:function(n){var t=_.cloneDeep(n),i=document.createElement("DIV");return t.value&&(i.innerHTML=t.value,this.shapeUtils.replaceAllShapeIdWithNewId(i),t.value=i.innerHTML,t.value.indexOf("0.5pt")>-1&&(t.value=t.value.replaceAll("0.5pt","1px"))),t.html&&(i.innerHTML=t.html,this.shapeUtils.replaceAllShapeIdWithNewId(i),t.html=i.innerHTML,t.html.indexOf("0.5pt")>-1&&(t.html=t.html.replaceAll("0.5pt","1px"))),t},getPlainText:function(n){var t="";return n&&(t="",$(n).contents().each(function(n,i){t+=i.textContent.length?i.textContent:" "}.bind(this))),t},executePaste:function(n){function l(n){switch(n.type){case"string":this.pasteStringIntoShape(n);break;case"shape":this.pasteShapeWithWrapper(n);break;default:this.pasteExternalFormIntoShapeByType(n)}}var e,t,u,o,s,f,c;if((n=n||{},n.isExecute!==!1)&&(e=this.instanceManager.clipboardInstance,e)&&(t=e.get(),t&&(!this.isContract||t.type!=="IMG"))&&(t.type!=="string"||!t.value||t.value.nodeType!==Node.DOCUMENT_FRAGMENT_NODE||t.value.childNodes.length!=0)){if(t.type!=="string"&&(t=this.replaceAllShpeIdWithPasteData(t)),n.isPlainText&&(t.type="string",t.value=this.getPlainText(t.html)),this.hasOnlyOneCollection()){var h=this.collection.list[0],a=this.$wrapperEl.find("#"+h.id),r=a.attr("data-controltype"),i=this.getItemById(h.id,{action:this.reportConstValue.shapeStatus.selectable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"});if(!i)return;if(this.hasCursorInShape(i,r)&&this.getCursorPosition()){r===this.reportConstValue.shapeType.table&&this.addContentEditableToSelectedTd(i);switch(t.type){case"string":i.config.isManagedShape||r!=this.reportConstValue.shapeType.table||(u=i.getTableSelector().getSelectedTxs(),u&&u.length==1&&(o=this._range.getRange(),u[0].textContent.trim()==o.cloneContents().textContent.trim()&&o.selectNodeContents(u[0])));this.pasteStringWithCursor(t);this.isContract&&r===this.reportConstValue.shapeType.textbox&&i.textContainerMaxlengthCheck(null,null,{pasteValue:t.value})===!1&&i.textContainerSpecialStrCheck(null,null,{pasteValue:t.value});break;case"shape":this.pasteShapeWithoutWrapper(t);this.setElementsCache(i.$parent);(r===this.reportConstValue.shapeType.rectangle||r===this.reportConstValue.shapeType.table)&&(this.shapeUtils.setInnerShapeNotEditable(i.$el),s=i.$el.find("table"),s.each(function(n){var t=this.getTempItem(new ecount.report.entity({data:{controlType:this.reportConstValue.shapeType.table,el:s.eq(n)}}));t.syncOfTableLayout&&t.syncOfTableLayout()}.bind(this)),i.setSizeByOverflowedSize());break;default:this.isContract&&r===this.reportConstValue.shapeType.textbox?(f=this.getPlainText(t.html),t.value=f,this.pasteStringWithCursor(t),i.textContainerMaxlengthCheck(null,null,{pasteValue:f})===!1&&i.textContainerSpecialStrCheck(null,null,{pasteValue:f})):(this.pasteExternalFormWithCursor(),this.pasteExternalFormHTMLInContainer(t.value),(r===this.reportConstValue.shapeType.rectangle||r===this.reportConstValue.shapeType.table)&&(this.shapeUtils.setInnerShapeNotEditable(i.$el),this.setConvertTableInOuterHTML({type:"",value:{$el:i.$el,forceSetAttribute:!0}}),this.setElementsCache(i.$parent),c=i.$el.attr("id"),this.setSyncOfTableLayout({type:"",value:{id:c}}),i.setWrapperContentCss({zIndex:0}),i.setSizeByOverflowedSize(),this.bindScrollEvent(i.$el)))}}else{if(this.isContract&&!this.useOuterPasteData)return;l.call(this,t)}}else{if(this.isContract&&!this.useOuterPasteData)return;l.call(this,t)}ecount.layer.clear();this.resizeHandler({delay:!1});return}},addContentEditableToSelectedTd:function(n){var r=n.tableSelector.getFromSectionType(),u=n.tableSelector.getFromSectionIndex(),t=n.tableSelector.getSelectedBoundary(),i;t.isValidate()&&(i=n.tableStructure.getTdByBoundary(r,u,t),$(i).find(".ec-textcontainer").attr("contenteditable",!0))},setFixPosition:function(n){(this.collection.list||[]).forEach(function(t){(this.positionCollection.getById(t.id)||{}).position!=n.value&&(this.settingFixPosition(_.extend({position:n.value},t)),this.addDataInHistory())}.bind(this))},reFixPosition:function(){(this.positionCollection.list||[]).forEach(function(n){this.settingFixPosition(n)}.bind(this))},selectAllPositionCollectionItem:function(){(this.positionCollection.list||[]).forEach(function(n){var t=this.getItemById(n.id);t&&t.select&&t.select()}.bind(this))},deSelectAllPositionCollectionItem:function(n){(this.positionCollection.list||[]).forEach(function(t){t.id!=n&&this.deselectInstance(t)}.bind(this))},settingFixPosition:function(n){function r(){var r=this.getGrid(),o=r.grid.getResizeResult().resizedTotalWidth||0,e=r.getLeft(".wrapper-areaselect"),u="",i="",f=0;switch(n.position){case"left":u="ec-fixed-left";["header","top"].contains(this.containerArea)?i="pin-fixed-top-left":["bottom","footer"].contains(this.containerArea)&&(i="pin-fixed-bottom-left");f=r.getLeft(".wrapper-areaselect")-5;break;case"center":u="ec-fixed-center";["header","top"].contains(this.containerArea)?i="pin-fixed-top-center":["bottom","footer"].contains(this.containerArea)&&(i="pin-fixed-bottom-center");f=(r.grid.getResizeResult().resizedTotalWidth+3)/2-t.get$parentWidth()/2+e;break;case"right":u="ec-fixed-right";["header","top"].contains(this.containerArea)?i="pin-fixed-top-right":["bottom","footer"].contains(this.containerArea)&&(i="pin-fixed-bottom-right");f=r.grid.getResizeResult().resizedTotalWidth-t.get$parentWidth()+e+5}return{elClass:u,wrapperClass:i,left:f,gridWidth:o,gridLeft:e}}var t=this.getItemById(n.id),i;t&&(i=r.call(this),t.removeClass$parent("pin-fixed-top-left pin-fixed-bottom-left pin-fixed-top-center pin-fixed-bottom-center pin-fixed-top-right pin-fixed-bottom-right"),t.addClass$parent(i.wrapperClass),t.removeClass$El("ec-fixed-left ec-fixed-center ec-fixed-right"),t.addClass$El(i.elClass),t.set$WrapperElPosition("left",i.left),t.set$LineHandlerElPosition("left",this.getLineHandlerElPositionValue(i.left)),this.addPositionCollection(_.extend({id:n.id,position:n.position},i)))},setFixPositionWidth_MoveGrid:function(n){this.positionCollection&&(this.positionCollection.list||[]).forEach(function(t){t.gridLeft=n.position.x;this.adjustFixedPosition(t)}.bind(this))},setFixPositionWidth_ResizeGird:function(){this.positionCollection&&(this.positionCollection.list||[]).forEach(function(n){n.position!=="left"&&this.adjustFixedPosition(n)}.bind(this))},adjustFixedPosition:function(n){var r=this.getGrid(),t,i;n.gridWidth=r.grid.getResizeResult().resizedTotalWidth||0;t=this.getItemById(n.id);t&&(i=0,n.position=="center"?i=(r.grid.getResizeResult().resizedTotalWidth+3)/2-t.get$parentWidth()/2+n.gridLeft:n.position=="right"?i=r.grid.getResizeResult().resizedTotalWidth-t.get$parentWidth()+n.gridLeft+5:n.position=="left"&&(i=n.gridLeft),t.set$WrapperElPosition("left",i),t.set$LineHandlerElPosition("left",this.getLineHandlerElPositionValue(i)))},notExistPositionCollectionItem:function(){for(var t,n=0,i=(this.collection.list||[]).length;n<i;n++)if(t=this.positionCollection.getById(this.collection.list[n].id),!$.isEmpty(t))return!1;return!0},confirmMovePositionCollectionItem:function(){ecount.confirm(ecount.resource.MSG11732,function(n){n&&this.collection.list.forEach(function(n){this.removePositionCollection(n.id)}.bind(this));this.cloneCollectionData();this.clearCollection()}.bind(this))},addPositionCollection:function(n){n&&(this.positionCollection.removeById(n.id),this.positionCollection.add({id:n.id,position:n.position,gridLeft:n.gridLeft,gridWidth:n.gridWidth}))},removePositionCollection:function(n){var t=this.getItemById(n);t&&(t.removeClass$parent("pin-fixed-top-left pin-fixed-bottom-left pin-fixed-top-center pin-fixed-bottom-center pin-fixed-top-right pin-fixed-bottom-right"),this.positionCollection.removeById(n))},getLineHandlerElPositionValue:function(n){return Number(n||0)+5},pasteStringIntoShape:function(n){var u=this.getBlankPosition(this.createDefaultBlankPoistion()),r=this.getStringPasteContainerType(),i=this.transferEvent("drawingPaper.initPasteControl",{},{controlType:r})||{},e=i.id||ecount.common.uuid(this.reportConstValue.defaultCanvasConfig.prefixId[r]),o={action:this.reportConstValue.shapeStatus.directDrawing,id:e,style:$.extend({top:u.top,left:u.left,width:"100"},i.style||{}),attr:$.extend({},i.attr||{"data-maxlength":this.isContract?50:""}),className:$.extend([],i.className||[]),html:n.value instanceof DocumentFragment?n.value.cloneNode(!0):n.value,title:i.title,paste:!0},f=this.isContract?this.reportConstValue.shapeType.textbox:this.reportConstValue.shapeType.rectangle,t;this.drawDirectShape(o,{directFocus:!1,directSelect:!0,controlType:r},f);t=this.getActionInstance(r);t&&t.$container&&(this.setMappingColumnUniqueId(t.$el[0]),this.selectShape(t.$el));this.isContract&&f===this.reportConstValue.shapeType.textbox&&t.textContainerMaxlengthCheck()},pasteShapeWithoutWrapper:function(n){var r=$(n.value),i=this.shapeUtils.getNewLineRawHtml(),t;r.each(function(n,t){var e=$(t),r=this.shapeUtils.getOnlyShapeElWithoutWrapper(e),u,f;r.find(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector).each(function(n,t){this.shapeUtils.needZeroWidthSpace(t)&&this.shapeUtils.fillZeroWidthSpace(t)}.bind(this));this.shapeUtils.isImageShapeType(r)&&(u=this.convertor.convertBackgroundImageToImgElement(r),r=$(u));this.shapeUtils.removeAttributesIn(r[0]);this.setMappingColumnUniqueId(r[0]);f=this.shapeUtils.getLineWrapper(r);i+=f.outerHTML;i+=this.shapeUtils.getNewLineRawHtml()}.bind(this));t=this.getCursorPosition();t&&((t.startContainer!=t.endContainer||t.startOffset!=t.endOffset)&&this.deleteSelectTextarea(),this.insertBefore(i))},pasteShapeWithWrapper:function(n){function r(t){return n.actionId==this.id?this.getBlankPosition(this.createDefaultBlankPoistion({initX:t.left,initY:t.top})):this.getBlankPosition(this.createDefaultBlankPoistion())}function u(){return ecount.common.maxZIndex(this.$wrapperEl,this.reportConstValue.defaultZIndex)+1}document.activeElement&&document.activeElement.blur();var f=this.getContainerElements(),e=this.getCanvasClientRect(),t="",i=$(n.value);i.each(function(i,f){var e=$(f),o,s,c,l;if(this.shapeUtils.hasWrapper(e)||(e=this.shapeUtils.wrap$El(e)),o=this.shapeUtils.getOnlyShapeElWithoutWrapper(e),s=o.attr("id"),this.shapeUtils.removeContentEditableIfTable(o),o.length==1){var a=n.position[i],h=r.call(this,a),v=u.call(this);e.css({zIndex:v,top:h.top+"px",left:h.left+"px"});this.setMappingColumnUniqueId(e[0]);this.setHyperlinkUniqueId(e[0]);t+=e.outerHTML();this.$wrapperEl.append(e);c=o.attr("data-controltype");this.childDelegatorEvent({type:"shape.cloneInstance",value:{id:s,data:{controlType:c,container:e,el:o,refId:n.refId}}});l=i!=0;this.selectShape(o,l);this.bindScrollEvent(o)}}.bind(this));this.setPreviousHTML(n,t);i.length>0&&this.addDataInHistory()},selectShapeById:function(n){var i=this.getEntityById(n),t;i&&(t=this.getTempItem(i),t)&&this.selectShape(t.$el)},selectShapeByIdList:function(n){for(var i,r,t=0,u=n.length;t<u;t++){if(i=this.getEntityById(n[t].id),!i)return;if(r=this.getTempItem(i),!r)return;this.selectShape(r.$el,!0)}},selectShape:function(n,t){var i=n[0];n.trigger("mousedown",{which:1,target:i,ctrlKey:t,notPreventTriggerEvent:!0});n.trigger("mouseup",{which:1,target:i,ctrlKey:t,notPreventTriggerEvent:!0})},getContainerElements:function(){return this.$wrapperEl.find("[data-controltype]").closest(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector)},getCanvasClientRect:function(){return this.$wrapperEl[0].getBoundingClientRect()},createDefaultBlankPoistion:function(n){n=n||{};var i=this.getContainerElements(),t=this.getCanvasClientRect(),r=n.initX===undefined?this.reportConstValue.defaultPasteLeft:n.initX,u=n.initY===undefined?this.reportConstValue.defaultPasteTop:n.initY,f=n.increaseX===undefined?this.reportConstValue.defaultPasteLeft:n.increaseX,e=n.increaseY===undefined?this.reportConstValue.defaultPasteTop:n.increaseY;return{elements:i,initX:r,initY:u,increaseX:f,increaseY:e,minX:t.left,minY:t.top,maxX:t.right,maxY:t.bottom}},pasteExternalFormWithCursor:function(){var n=this.getCursorPosition();n&&(n.startContainer!=n.endContainer||n.startOffset!=n.endOffset)&&this.deleteSelectTextarea()},pasteExternalFormHTMLInContainer:function(n){if(this.instanceManager.clipboardInstance){var t=$("<div><\/div>"),r=this.shapeUtils.getLineWrapper(n),f=this.instanceManager.clipboardInstance.isTextTypeClipboard(r,this._node);if(f){t.append(n);this.setMappingColumnUniqueId(t[0]);this.insertBefore(t.html());return}var i=[r],u=$("<div><\/div>").append(n),e=this.shapeUtils.isAllImageElement(u.children());e&&(i=[],u.children().each(function(n,t){i.push(this.shapeUtils.getLineWrapper(t))}.bind(this)));t.append(this.shapeUtils.getNewLineRawHtml());i.forEach(function(n){t.append(n);t.append(this.shapeUtils.getNewLineRawHtml())}.bind(this));this.setMappingColumnUniqueId(t[0]);this.insertBefore(t.html())}},pasteStringWithCursor:function(n){var r=this.getCursorPosition(),t,i,f,u,e;(r.startContainer!=r.endContainer||r.startOffset!=r.endOffset)&&this.deleteSelectTextarea();this.setMappingColumnUniqueId(n.value);t=this.insertBefore(n.value);t.lastNode&&t.lastNode.nodeType==Node.TEXT_NODE?i=t.lastNode:(f=t.lastNode&&this._node.getTextNodes(t.lastNode),i=f&&f.last());i&&(u=this._range.getRange(),e=this._node.getText(i).replace(/\t|\n|\r/g,"").length,u.setStart(i,e),u.setEnd(i,e),u.collapse(!0))},setPreviousHTML:function(n,t){t&&(n.activity=="cut"||(n.actionId=this.id,n.value=t))},pasteExternalFormIntoShapeByType:function(n){var f,i,t;if(["NESTED","IMG"].includes(n.type)){f=this.getStringPasteContainerType();i=this.transferEvent("drawingPaper.initPasteControl",{},{controlType:f})||{};t=this.isContract?"textbox":n.type==="IMG"?"image":"rectangle";var e=$("<div><\/div>").append(n.html),r=[n],u=null,o=this.shapeUtils.isAllImageElement(e.children());o&&(t="image",r=[],e.children().each(function(t,i){var u=_.extend(_.cloneDeep(n),{html:i.outerHTML,value:i.outerHTML,type:"IMG"});r.push(u)}),u=this.makeImageCompleteCallback(r.length));r.forEach(function(r){var e={action:this.reportConstValue.shapeStatus.directDrawing,value:r.value,html:r.html,type:r.type,isDragable:!0,isResizable:!0,isAutoGeneratorTableProperties:!0,style:_.extend({border:"none"},i.style||{}),syncOfTableLayoutInShape:!0,wrapperContentStyle:{zIndex:0},textContainerClass:"word-break-word pr-1",paste:!0,title:i.title},f=null,o,s,h,c;if(t=="image"&&r.html&&(o=$(r.html),o.prop("tagName")=="IMG"&&(s=this.shapeUtils.getImageUrl(o),s&&_.extend(e,{html:null,attr:{src:s},style:{border:"none",width:parseInt(o.css("width"))||null,height:parseInt(o.css("height"))||null}}))),this.isContract&&t==="textbox"){if(h=this.getPlainText(n.html),e=_.extend(e,{attr:i.attr,value:h,html:h}),this.drawDirectShape(e,{directFocus:!1,directSelect:!0},t),f=this.getActionInstance(t),!f)return;f.textContainerMaxlengthCheck(null,null,{isPaste:!0})}else this.draw(t,e),c=this.getEntityById(e.attr.id),f=this.getTempItem(c),f&&(f.setSizeByOverflowedSize&&f.setSizeByOverflowedSize({padding:10}),u&&u(f),this.bindScrollEvent(f.$el),this.releaseLineHandler(e.attr.id))}.bind(this));this.resizeHandler({delay:!1})}},getScrollManager:function(){return this.scrollManager===undefined&&(this.scrollManager=new ecount.report.lib.scrollManager),this.scrollManager},syncLineHandlerWhenScroll:function(n){var t=n.target;this.collection.list.forEach(function(n){var i=this.getItemById(n.id);i&&this.getScrollManager().isElementInScrollEl(i.$el,t.id)&&i.syncLineHandlerPosition()}.bind(this))},syncTableSelectorWhenScroll:function(){var n=this.instanceManager.tableSelector;n.draw()},removeLineHandlerIfOutOfZone:function(n){var t=n.target,i=[];this.collection.list.forEach(function(n){var r=this.getItemById(n.id);r&&this.getScrollManager().isElementInScrollEl(r.$el,t.id)&&(this.getScrollManager().isElementInView(t,r.$el[0])||(this.deselectInstance(n),i.push(n)))}.bind(this));i.forEach(function(n){this.collection.removeById(n.id)}.bind(this))},getStringPasteContainerType:function(){return this._options.stringPasteContainerType||ecount.constValue.drawingPaper.shapeType.rectangle},copyMappingItem:function(n,t){var i=$(n),e=i.attr("id"),f=t&&t.find(function(n){return n.id==e}),r,u;if(!f){i.remove();return}return r=ecount.common.uuid("mappingItem"),u=_.cloneDeep(f),u.id=r,this.mappingDataCollection.add(u),i.attr("id",r),this.setMappingItemTooltip(i,u),r},addDataInHistory:function(n){function t(){if(!this.config.isBeginHistoryTransaction){var n=this.instanceManager.historyInstance;n&&n.add(this.getHistoryData())}}if(n=n||{},!n.delay){t.call(this);return}this._addDataInHistoryDelay||(this._addDataInHistoryDelay=_.throttle(t.bind(this),n.delay>0?n.delay:1e3));this._addDataInHistoryDelay()},getHistoryData:function(){var f=this.config.status,i,r,n,e,o,t,s,u;switch(f){case this.reportConstValue.canvasStatus.moveable:f=this.reportConstValue.canvasStatus.selectable}i=this.$wrapperEl.clone();r=i.find('[data-controltype="ecount.report.shape.selectableRange"]');r&&r.length&&r.closest(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector).remove();n=this.instanceManager.tableSelector;n&&(e=n.getFromSectionType(),o=n.getFromSectionIndex(),t=n.getSelectedBoundary(),t.isValidate()&&i.find("."+this.reportConstValue.tableSelectorLineDefaultSelector).remove());try{s=this._range.serializeRange(null,null,this.$el[0])}catch(h){}return u={id:this.id,status:this.reportConstValue.canvasStatus.selectable,innerHTML:i.html(),collection:_.cloneDeep(this.collection.serialize()),positionCollection:_.cloneDeep(this.positionCollection.serialize()),mappingDataCollection:this.mappingDataCollection.serialize(),scrollTop:0,scrollLeft:0,serializedRange:s},t&&t.isValidate()&&(u.tableSelector={isValidate:!0,sectionType:e,sectionIndex:o,selectedBoundary:t.clone()}),u},clearHistory:function(){var n=this.instanceManager.historyInstance;n&&n.clear()},getUndoData:function(){var n=this.instanceManager.historyInstance;return n.undoData(this.id)},getRedoData:function(){var n=this.instanceManager.historyInstance;return n.redoData(this.id)},undo:function(){var n=this.getUndoData(),t,r,i,e,u,f;if(n){if(this.setStatus(n.status),n.tableSelector&&n.tableSelector.isValidate&&this.instanceManager.tableSelector.invisible(),this.removeActionInstancePopover(),this.entityTree.clearEntities(),this.clearLineHandler(),this.$wrapperEl.html(n.innerHTML),this.collection.set(n.collection),this.positionCollection.set(n.positionCollection),this.mappingDataCollection.set(n.mappingDataCollection),this.entityTree.loadElements(this.$wrapperEl),this.loadLineHandlerSync(this.$wrapperEl),this.bindScrollEvent(this.$wrapperEl),t=this.instanceManager.tableSelector,r=this.instanceManager.tableStructure,r&&r.reset(),this.collection.list.length==1)for(i=0,e=this.collection.list.length;i<e;i++){if(u=this.getEntityById(this.collection.list[i].id),!u)return;var o=u.getDataProperty("controlType"),s=u.getDataProperty("container"),h=this.getItemById(this.collection.list[i].id,{action:this.reportConstValue.shapeStatus.selectable,resizeType:this.config.resizeType,areaDivisionCalculation:"each"});if(!h)return;o==this.reportConstValue.shapeType.table&&n.tableSelector&&n.tableSelector.isValidate&&(f=r.getTdsByBoundary(n.tableSelector.sectionType,n.tableSelector.sectionIndex,n.tableSelector.selectedBoundary),t.setParent(s),t.select(n.tableSelector.sectionType,n.tableSelector.sectionIndex,f[0],n.tableSelector.sectionType,n.tableSelector.sectionIndex,f[f.length-1]),t.draw(),t.visible())}else t&&t.invisible();n.positionCollection.list.forEach(function(){this.reFixPosition()}.bind(this));this.restoreSerializedRange(n.serializedRange);this.resizeHandler()}},redo:function(){var n=this.getRedoData(this.id),t,r,i,e,u,f;if(n){if(this.setStatus(n.status),n.tableSelector&&n.tableSelector.isValidate&&this.instanceManager.tableSelector.invisible(),this.removeActionInstancePopover(),this.entityTree.clearEntities(),this.clearLineHandler(),this.$wrapperEl.html(n.innerHTML),this.collection.set(n.collection),this.positionCollection.set(n.positionCollection),this.mappingDataCollection.set(n.mappingDataCollection),this.entityTree.loadElements(this.$wrapperEl),this.loadLineHandlerSync(this.$wrapperEl),this.bindScrollEvent(this.$wrapperEl),t=this.instanceManager.tableSelector,r=this.instanceManager.tableStructure,r&&r.reset(),this.collection.list.length==1)for(i=0,e=this.collection.list.length;i<e;i++){if(u=this.getEntityById(this.collection.list[i].id),!u)return;var o=u.getDataProperty("controlType"),s=u.getDataProperty("container"),h=this.getItemById(this.collection.list[i].id,{action:this.reportConstValue.shapeStatus.selectable,resizeType:this.config.resizeType,areaDivisionCalculation:"each"});if(!h)return;o==this.reportConstValue.shapeType.table&&n.tableSelector&&n.tableSelector.isValidate&&(f=r.getTdsByBoundary(n.tableSelector.sectionType,n.tableSelector.sectionIndex,n.tableSelector.selectedBoundary),t.setParent(s),t.select(n.tableSelector.sectionType,n.tableSelector.sectionIndex,f[0],n.tableSelector.sectionType,n.tableSelector.sectionIndex,f[f.length-1]),t.draw(),t.visible())}else t&&t.invisible();n.positionCollection.list.forEach(function(){this.reFixPosition()}.bind(this));this.restoreSerializedRange(n.serializedRange);this.resizeHandler()}},restoreSerializedRange:function(n){try{if(!n)return;var t=this._range.deserializeRange(n,this.$el[0]);this._range.setRange(t)}catch(i){}},setContextmenu:function(n){this.config.contextmenu.items=n},setTxsBoundaryCheckSaveCursor:function(n,t,i,r){var f=this.$el.find("#"+n),e=this.instanceManager.tableStructure,u=e.getTdsByBoundary(t,i,r);u.length==1&&$.contains(u[0],f[0])&&this.setSaveCursor(!0)},setSaveCursor:function(n){this.isSaveCursor=n},setClearCursor:function(n){this.isClearCursor=n},getCellMerge:function(){var n=this.instanceManager.tableSelector,t=this.instanceManager.tableStructure,i=n&&n.getSelectedBoundary();return this.canTableCellMerge(i,n,t)},getCellDivide:function(){var n=this.instanceManager.tableSelector,t=this.instanceManager.tableStructure,i=n&&n.getSelectedBoundary();return this.canTableCellDivide(i,n,t)},getSaveCursor:function(){return this.isSaveCursor},getClearCursor:function(){return this.isClearCursor},getContextmenu:function(){return this.config.contextmenu.items},addContextmenu:function(n,t){var i=this.getContextmenu();return _.isArray(n)||(n=[n]),_.isUndefined(t)&&(t=i.length),n&&n.length&&n.forEach(function(n,r){i.splice(t+r,0,n)}),i},removeContextmenu:function(n,t){var r=t||this.getContextmenu(),i=[];return _.isArray(n)||(n=[n]),i=r.filter(function(t){return t.childItems&&t.childItems.length&&(t.childItems=this.removeContextmenu(n,t.childItems)),!n.some(function(n){return t.id===n.id}.bind(this))}.bind(this)),i[i.length-1]&&i[i.length-1].id==="divider"&&i.pop(),i},getTableColsAndTrs:function(n){var t=this.$el.find("#"+n),i=t.find("col"),r=t.find(this.instanceManager.tableSelector.getFromSectionType()+" tr");if(t&&t.length&&i.length&&r.length)return{cols:i,trs:r}},openContextmenu:function(){},closeContextmenu:function(){},resizeHandler:function(n){function t(){if(!this._options.boundaryLimit||!this._options.boundaryLimit.bottom){var t=this.$wrapperEl[0].getBoundingClientRect(),n=this.getControlMaxBottom({isContainDefaultBox:!0})-t.bottom;n>0&&this.increaseHeight(n)}this.checkBoundaryLimit()}if(n=n||{},n.delay===!1){t.call(this);return}this._resizeHandlerDelay||(this._resizeHandlerDelay=_.debounce(t.bind(this),100));this._resizeHandlerDelay()},getControlMaxBottom:function(n){var e,r,o,i,t,u,f;for(n=n||{},e=this.getAllControls({isContainDefaultBox:n.isContainDefaultBox}),r=[],t=0,u=e.length;t<u;t++)o=e[t],r.push(o.getBoundingClientRect());for(t=0,u=r.length;t<u;t++)f=r[t],t==0?i=f:i.bottom<f.bottom&&(i=f);return i&&i.bottom||0},getAllControls:function(n){return n=n||{},this.$wrapperEl.find(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector).find("[data-controltype]").filter(function(t,i){return!n.isContainDefaultBox&&!this.isValidDefaultBox(i,t)?!1:!0}.bind(this))},getLeft:function(){return ecount.convertor.mmToPixel(parseFloat(this.$el[0].style.left||"0"))},increaseWidth:function(n){var t=parseFloat(this.getCanvasWidth());this.setWidth(t+n)},decreaseWidth:function(n){var t=parseFloat(this.getCanvasWidth());this.setWidth(t-n)},increaseHeight:function(n){var t=parseFloat(this.$wrapperEl.css("min-height")),i=_.isNumber(t),u,r;i||(t=200);u=parseFloat(this.getCanvasHeight());r=u+n;i&&r>t?this.setHeight(r):(i?this.$wrapperEl.css({height:""}):this.setHeight(t),this.resetBoundingClientRect())},decreaseHeight:function(n){var t=parseFloat(this.getCanvasHeight());this.setHeight(t-n)},setWidth:function(n){this.$wrapperEl.css({width:n+"px"});this.resetBoundingClientRect()},setHeight:function(n){this._options.useFreeHeight||(n=Math.max(n,this.getContentsHeight()));this.$wrapperEl.css({height:n+"px"});this.resetBoundingClientRect()},getContentsHeight:function(n){n=n||{};var t=this.$wrapperEl[0].getBoundingClientRect(),i=n.isContainDefaultBox!==!1;return this.getControlMaxBottom({isContainDefaultBox:i})-t.bottom+this.getCanvasHeight()},getCountOf:function(n){return _.size(this.$wrapperEl.find(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector+" div[data-controltype='"+n+"']"))},getBlankPosition:function(n){n=n||{};var r=n.elements,e=n.initX,o=n.initY,u=n.increaseX,f=n.increaseY,s=n.minX,h=n.minY,c=n.maxX,l=n.maxY,t=e+u,i=o+f,a=this.shapeUtils.getElementInPosition(r,{x:t,y:i});return a?this.getBlankPosition({elements:r,initX:t,initY:i,increaseX:u,increaseY:f,minX:s,minY:h,maxX:c,maxY:l}):{left:t,top:i}},getBlankPositionWithoutOverlap:function(n){n=n||{};var r=n.elements,t=n.initX,i=n.initY,f=n.minX,e=n.minY,o=n.maxX,s=n.maxY,u=this.shapeUtils.getElementInPosition(r,{x:t,y:i});return u?this.getBlankPositionWithoutOverlap({elements:r,initX:t,initY:i+u.offsetHeight,minX:f,minY:e,maxX:o,maxY:s}):{left:t,top:i}},setElementPosition:function(n,t){n&&n.style&&(n.style.top=t.top+"px",n.style.left=t.left+"px")},setEachElementPositionInOrder:function(n){n.forEach(function(n){n.style.top="-9999px"});n.forEach(function(n){var t=this.getBlankPositionWithoutOverlap(this.createDefaultBlankPoistion());this.setElementPosition(n,t)}.bind(this))},makeImageCompleteCallback:function(n){var i=[],r=0,t=this;return function(u){var f=u.$parent[0];i.push(f);r++;r===n&&(n>1&&t.collection.list.forEach(function(n){t.deselectInstance(n);t.collection.remove(n)}),t.setEachElementPositionInOrder(i))}},resetCanvasConfig:function(){this.setStatus(this.reportConstValue.canvasStatus.selectable);this.setEditableId(null);this.config.drawShapeType=null;this.config.resizeType=null;this.config.drawColumnCount=0;this.config.drawRowCount=0},isDrawingPaperWrapper:function(n){return $(n).attr(this.reportConstValue.wrapperAttrKey)===this.reportConstValue.canvasWrapperSelector},isDrawingPaperBackgroundImage:function(n){return $(n).hasClass(this.reportConstValue.enableDrawingPaper)},addNoselectionInBody:function(){document.body.classList.contains("noselection")||document.body.classList.add("noselection")},removeNoselectionInBody:function(){document.body.classList.remove("noselection")},addSmartGuideElement:function(n){var t=this.getActionInstance("smartGuideManager");t&&(t.setCanvas(this.$wrapperEl),t.addSmartGuideElements(n))},checkBoundaryLimit:function(){var e,o,n,s,h,t,i,r,u,f;if(this._options.boundaryLimit&&(this._options.boundaryLimit.top||this._options.boundaryLimit.bottom||this._options.boundaryLimit.left||this._options.boundaryLimit.right))for(e=this.getCanvasWidth(),o=this.getCanvasHeight(),n=0,s=this.collection.list.length;n<s;n++)(h=this.$wrapperEl.find("#"+this.collection.list[n].id),t=this.getItemById(this.collection.list[n].id),t)&&(this._options.boundaryLimit.top&&!this.isFirstArea&&(i=this.collection.list[n].mousedownElementPoint.y+this.reportConstValue.containerTopPadding,i<0&&(t.moveDown(-i),this.updateElementPoint({targetId:this.collection.list[n].id}),t.syncLineHandlerPosition())),this._options.boundaryLimit.bottom&&(r=o-this.collection.list[n].mousedownElementPoint.y-this.collection.list[n].mousedownElementSize.height-this.reportConstValue.containerTopPadding,r<0&&(t.moveUp(-r),this.updateElementPoint({targetId:this.collection.list[n].id}),t.syncLineHandlerPosition())),this._options.boundaryLimit.left&&(u=this.collection.list[n].mousedownElementPoint.x+this.reportConstValue.containerLeftPadding,u<0&&(t.moveRight(-u),this.updateElementPoint({targetId:this.collection.list[n].id}),t.syncLineHandlerPosition())),this._options.boundaryLimit.right&&(f=e-this.collection.list[n].mousedownElementPoint.x-this.collection.list[n].mousedownElementSize.width-this.reportConstValue.containerLeftPadding,f<0&&(t.moveLeft(-f),this.updateElementPoint({targetId:this.collection.list[n].id}),t.syncLineHandlerPosition())))},getEntityById:function(n){var t=this.entityTree.getEntityById(n),i;return t?(i=t.getDataProperty("el"),i&&i.length>0&&!i.parent().length&&(t.data.el=$("#"+n)),t):null},getItemById:function(n,t){var i=this.getEntityById(n);return i?this.getItem(i,t,{isLoadCompleteUI:this.renderStatus=="rendered",entity:i}):null},getMaximumWidthAcrossAllEntities:function(){var n=Number.MIN_SAFE_INTEGER,t=0,i=0,r=this.entityTree.getEntities();return r.list.length==0?n=0:r.list.forEach(function(r){var r=this.getItemById(r.id);switch(r.controlType){case ecount.constValue.drawingPaper.shapeType.table:t=parseInt(r.getWidth({isTotal:!0})||0,10);i=r.getContainerLeft();break;default:t=parseInt(r.getWidth()||0,10);i=r.getContainerLeft()}n=Math.max(n,t+i+ecount.constValue.drawingPaper.containerLeftPadding)}.bind(this)),n},getFormItemById:function(n,t){var i=this.getEntityById(n);return i?this.getFormItem(i,t,{isLoadCompleteUI:this.renderStatus=="rendered",entity:i}):null},getSuperParentActionInstanceById:function(n){var t=this.getSuperParentEntityByid(n);return!t||t.id===n?null:this.getTempItem(t)},getSuperParentEntityByid:function(n){return this.entityTree.getEntitySuperParentById(n)},showSuperParentLine:function(n){var t=this.getSuperParentActionInstanceById(n);t&&(t.setLineHandlerByDefault(),t.visibleMove(null,{opacity:.3}))},hideSuperParentLine:function(n){var t=this.getSuperParentActionInstanceById(n);t&&(t.invisibleMove(),t.invisibleOption(),t.deselectParent(),t.resetLineHandler())},getCommandAllParameter:function(){return{history:this.getCommandHistoryParameter(),shape:this.getCommandShapeParameter(),font:this.getCommandFontParameter(),shapeStyle:this.getCommandShapeStyleParameter(),layout:this.getCommandLayoutParameter()}},getCommandHistoryParameter:function(){return[this.getCommandHistoryRedoParamter(),this.getCommandHistoryUndoParamter()]},getCommandHistoryRedoParamter:function(){return{key:"redo",value:!1}},getCommandHistoryUndoParamter:function(){return{key:"undo",value:!1}},getCommandShapeParameter:function(){return[this.getCommandShapeTableParameter(),this.getCommandShapeTextParameter(),this.getCommandShapeHorizontalLineParameter(),this.getCommandShapeVerticalLineParameter(),this.getCommandShapeShareImageParameter(),this.getCommandShapeLocalImageParameter(),this.getCommandShapeImageBoxParameter(),this.getCommandShapeStampParameter(),this.getCommandShapeApprovalParameter(),this.getCommandShapeConnectItemParameter()]},getCommandShapeTableParameter:function(){return{key:"table",rowCount:0,columnCount:0}},getCommandShapeTextParameter:function(){return{key:"text",value:""}},getCommandShapeHorizontalLineParameter:function(){return{key:"horizontalline",value:""}},getCommandShapeVerticalLineParameter:function(){return{key:"verticalline",value:""}},getCommandShapeShareImageParameter:function(){return{key:"shareImage",value:""}},getCommandShapeLocalImageParameter:function(){return{key:"localImage",value:""}},getCommandShapeImageBoxParameter:function(){return{key:"imagebox",value:""}},getCommandShapeStampParameter:function(){return{key:"stamp",value:""}},getCommandShapeApprovalParameter:function(){return{key:"approval",value:""}},getCommandShapeConnectItemParameter:function(){return{key:"connectItem",value:!1}},getCommandFontParameter:function(){var n=this.getCommandFontInfo();return[this.getCommandFontFamilyParameter(n),this.getCommandFontSizeParameter(n),this.getCommandFontBoldParameter(n),this.getCommandFontItalicParameter(n),this.getCommandFontUnderlineParameter(n),this.getCommandFontStrikeParameter(n),this.getCommandFontColorParameter(n),this.getCommandFontBackgroundColorParameter(n),this.getCommandFontHorizontalAlignParameter(n),this.getCommandFontVerticalAlignParameter(n),this.getCommandFontLineBreakParameter(n)]},__getShapeFontResult:function(){return{family:null,size:null,bold:null,italic:null,underline:null,strike:null,foreColor:null,fontBackgroundColor:null,backgroundColor:null,verticalAlign:null,horizontalAlign:null,lineBreak:null,isBreakFamily:!1,isBreakSize:!1,isBreakBold:!1,isBreakItalic:!1,isBreakUnderline:!1,isBreakStrike:!1,isBreakForeColor:!1,isBreakFontBackgroundColor:!1,isBreakBackgroundColor:!1,isBreakVerticalAlign:!1,isBreakHorizontalAlign:!1,isBreakLineBreak:!1}},getShapeFontInfo:function(n,t){var u,f,r,i;if(t=t||this.__getShapeFontResult(),u=this.getEntityById(n),u){if(f=u.getDataProperty("controlType"),[this.reportConstValue.shapeType.table,this.reportConstValue.shapeType.rectangle,this.reportConstValue.shapeType.textbox].contains(f)){if(r=this.getItemById(n),!r)return;i=r.getFontInfo&&r.getFontInfo()||{};t.family==null?t.family=i.family:t.isBreakFamily||t.family==i.family||(t.family="",t.isBreakFamily=!0);t.size==null?t.size=i.size:t.isBreakSize||t.size==i.size||(t.size=i.size,t.isBreakSize=!0);t.bold==null?t.bold=i.bold:t.isBreakBold||t.bold==i.bold||(t.bold=!1,t.isBreakBold=!0);t.italic==null?t.italic=i.italic:t.isBreakItalic||t.italic==i.italic||(t.italic=!1,t.isBreakItalic=!0);t.underline==null?t.underline=i.underline:t.isBreakUnderline||t.underline==i.underline||(t.underline=!1,t.isBreakUnderline=!0);t.strike==null?t.strike=i.strike:t.isBreakStrike||t.strike==i.strike||(t.strike=!1,t.isBreakStrike=!0);t.foreColor==null?t.foreColor=i.foreColor:t.isBreakForeColor||t.foreColor==i.foreColor||(t.foreColor="",t.isBreakForeColor=!0);t.fontBackgroundColor==null?t.fontBackgroundColor=i.fontBackgroundColor:t.isBreakFontBackgroundColor||t.fontBackgroundColor==i.fontBackgroundColor||(t.fontBackgroundColor="",t.isBreakFontBackgroundColor=!0);t.backgroundColor==null?t.backgroundColor=i.backgroundColor:t.isBreakBackgroundColor||t.backgroundColor==i.backgroundColor||(t.backgroundColor="",t.isBreakBackgroundColor=!0);t.verticalAlign==null?t.verticalAlign=i.verticalAlign:t.isBreakVerticalAlign||t.verticalAlign==i.verticalAlign||(t.verticalAlign="",t.isBreakVerticalAlign=!0);t.horizontalAlign==null?t.horizontalAlign=i.horizontalAlign:t.isBreakHorizontalAlign||t.horizontalAlign==i.horizontalAlign||(t.horizontalAlign="",t.isBreakHorizontalAlign=!0);t.lineBreak==null?t.lineBreak=i.lineBreak:t.isBreakLineBreak||t.lineBreak==i.lineBreak||(t.lineBreak="",t.isBreakLineBreak=!0)}return t}},getCommandFontInfo:function(){var e=window.getSelection(),t={family:null,size:null,bold:null,italic:null,underline:null,strike:null,foreColor:null,fontBackgroundColor:null,backgroundColor:null,verticalAlign:null,horizontalAlign:null,lineBreak:null},i={family:null,size:null,bold:null,italic:null,underline:null,strike:null,foreColor:null,fontBackgroundColor:null,backgroundColor:null,verticalAlign:null,horizontalAlign:null,lineBreak:null},n=this.__getShapeFontResult(),u,o,f,r;if(this.collection.list.length){for(u=0,o=this.collection.list.length;u<o;u++)if(this.getShapeFontInfo(this.collection.list[u].id,n),n.isBreakFamily&&n.isBreakSize&&n.isBreakBold&&n.isBreakItalic&&n.isBreakUnderline&&n.isBreakStrike&&n.isBreakForeColor&&n.isBreakFontBackgroundColor&&n.isBreakBackgroundColor&&n.isBreakVerticalAlign&&n.isBreakHorizontalAlign&&n.isBreakLineBreak)break}else e.rangeCount&&document.activeElement!=document.body&&document.activeElement&&document.activeElement.classList&&!document.activeElement.classList.contains("ui-dialog")&&(f=e.getRangeAt(0),r=function(n,t,i){var o,l,s,h,f,e,u,c;if(this._node.isElement(t)){switch(t.tagName){case"B":n.bold=!0;break;case"I":n.italic=!0;break;case"U":n.underline=!0;break;case"STRIKE":n.strike=!0;break;case"FONT":t.getAttribute("size")&&(n.size=t.getAttribute("size"));t.getAttribute("face")&&(n.family=t.getAttribute("face"));break;case"SPAN":t.classList.contains(this.reportConstValue.mappingDataSelector)&&(t.classList.contains("grid-text-uline-through")?(n.underline=!0,n.strike=!0):t.classList.contains("text-uline")?n.underline=!0:t.classList.contains("text-line-through")&&(n.strike=!0),t.classList.contains("text-bold")&&(n.bold=!0),t.classList.contains("text-italic")&&(n.italic=!0),o=this.reportConstValue.fontSizeRex.exec(t.className),o?(l=o[0].replace(/font-/,"").trim(),s=ecount.constValue.fontSizeTable.find(function(n){return n.title==l}),s&&(n.size=s.data)):n.size=t.style["font-size"]||null,h=this.reportConstValue.fontRex.exec(t.className),h&&(n.family=h[0].replace(/font-/,"").trim()));break;case"DIV":t.getAttribute("data-controltype")&&this.reportConstValue.valignRex.test(t.className)&&(f=this.reportConstValue.valignRex.exec(t.className),f&&(f[2]||f[4])&&(n.verticalAlign=f[2]||f[4]));t.classList.contains(this.reportConstValue.textcontainerSelector)&&this.reportConstValue.alignRex.test(t.className)&&(e=this.reportConstValue.alignRex.exec(t.className),e&&(e[2]||e[4])&&(n.verticalAlign=e[2]||e[4]));i==0&&(n.underline=t.querySelector("u")!=undefined,n.strike=t.querySelector("strike")!=undefined,n.bold=t.querySelector("b")!=undefined,n.italic=t.querySelector("i")!=undefined);break;case"TD":case"TH":u=this.reportConstValue.valignRex.exec(t.className);u&&(n.verticalAlign=u[2]||u[4]||"top");c=t.querySelector(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector);c&&(u=this.reportConstValue.alignRex.exec(c.className),u&&(n.horizontalAlign=u[2]||u[4]||"left"))}t.getAttribute("data-controltype")||t==document||t==document.body||r(n,t.parentNode,++i)}else this._node.isText(t)&&r(n,t.parentNode,++i)}.bind(this),e.isCollapsed?r(n,f.endContainer,0):(r(t,f.startContainer,0),r(i,f.endContainer,0),t.family==i.family&&(n.family=t.family==""?"dotum":t.family),t.size==i.size&&(n.size=t.family==""?"11":t.size),t.bold==i.bold&&(n.bold=t.bold),t.italic==i.italic&&(n.italic=t.italic),t.underline==i.underline&&(n.underline=t.underline),t.strike==i.strike&&(n.strike=t.strike),t.verticalAlign==i.verticalAlign&&(n.verticalAlign=t.verticalAlign),t.horizontalAlign==i.horizontalAlign&&(n.horizontalAlign=t.horizontalAlign)));return n},getCommandFontFamilyParameter:function(n){return{key:"family",value:n.family||"dotum"}},getCommandFontSizeParameter:function(n){return{key:"size",value:n.size||"13px"}},getCommandFontBoldParameter:function(n){return{key:"bold",value:$.isBoolean(n.bold)?n.bold:!1}},getCommandFontItalicParameter:function(n){return{key:"italic",value:$.isBoolean(n.italic)?n.italic:!1}},getCommandFontUnderlineParameter:function(n){return{key:"underline",value:$.isBoolean(n.underline)?n.underline:!1}},getCommandFontStrikeParameter:function(n){return{key:"strike",value:$.isBoolean(n.strike)?n.strike:!1}},getCommandFontColorParameter:function(n){return{key:"color",value:n.foreColor||""}},getCommandFontBackgroundColorParameter:function(n){return{key:"backgroundColor",value:n.fontBackgroundColor||""}},getCommandFontHorizontalAlignParameter:function(n){return{key:"horizontalAlign",value:n.horizontalAlign||""}},getCommandFontVerticalAlignParameter:function(n){return{key:"verticalAlign",value:n.verticalAlign||""}},getCommandFontLineBreakParameter:function(n){return{key:"lineBreak",value:$.isBoolean(n.lineBreak)?n.lineBreak:!1}},getCommandShapeStyleParameter:function(){return[this.getCommandShapeStyleBackgroundColorParameter(),this.getCommandShapeStyleInsertLeftColumnParameter(),this.getCommandShapeStyleInsertRightColumnParameter(),this.getCommandShapeStyleInsertUpRowParameter(),this.getCommandShapeStyleInsertDownRowParameter(),this.getCommandShapeStyleMergeParameter(),this.getCommandShapeStyleDivideParameter(),this.getCommandShapeStyleDeleteColumnParameter(),this.getCommandShapeStyleDeleteRowParameter(),this.getCommandShapeStyleBorderParameter(),this.getCommandShapeStyleShadedParameter()]},getCommandShapeStyleBackgroundColorParameter:function(){return{key:"backgroundColor",value:"0f0f0f"}},getCommandShapeStyleInsertLeftColumnParameter:function(){for(var n,i,u,r=this.collection.list.length>0,t=0,f=this.collection.list.length;t<f;t++)if((n=this.$wrapperEl.find("#"+this.collection.list[t].id),n&&n.length!=0)&&(i=n.attr("data-controltype"),u=this.getActionInstance(i),u)&&i!=this.reportConstValue.shapeType.table){r=!1;break}return{key:"insertLeftColumn",value:r}},getCommandShapeStyleInsertRightColumnParameter:function(){for(var n,i,u,r=this.collection.list.length>0,t=0,f=this.collection.list.length;t<f;t++)if((n=this.$wrapperEl.find("#"+this.collection.list[t].id),n&&n.length!=0)&&(i=n.attr("data-controltype"),u=this.getActionInstance(i),u)&&i!=this.reportConstValue.shapeType.table){r=!1;break}return{key:"insertRightColumn",value:r}},getCommandShapeStyleInsertUpRowParameter:function(){for(var n,i,u,r=this.collection.list.length>0,t=0,f=this.collection.list.length;t<f;t++)if((n=this.$wrapperEl.find("#"+this.collection.list[t].id),n&&n.length!=0)&&(i=n.attr("data-controltype"),u=this.getActionInstance(i),u)&&i!=this.reportConstValue.shapeType.table){r=!1;break}return{key:"insertUpRow",value:r}},getCommandShapeStyleInsertDownRowParameter:function(){for(var n,i,u,r=this.collection.list.length>0,t=0,f=this.collection.list.length;t<f;t++)if((n=this.$wrapperEl.find("#"+this.collection.list[t].id),n&&n.length!=0)&&(i=n.attr("data-controltype"),u=this.getActionInstance(i),u)&&i!=this.reportConstValue.shapeType.table){r=!1;break}return{key:"insertDownRow",value:r}},getCommandShapeStyleMergeParameter:function(){for(var r,u,t,i=!1,n=0,f=this.collection.list.length;n<f;n++)if((r=this.getEntityById(this.collection.list[n].id),r)&&(u=r.getDataProperty("controlType"),t=this.getItemById(this.collection.list[n].id),t)){if(u!=this.reportConstValue.shapeType.table){i=!1;break}i=t.isPossibleMerge&&t.isPossibleMerge()}return{key:"merge",value:i}},getCommandShapeStyleDivideParameter:function(){for(var r,u,t,i=!1,n=0,f=this.collection.list.length;n<f;n++)if((r=this.getEntityById(this.collection.list[n].id),r)&&(u=r.getDataProperty("controlType"),t=this.getItemById(this.collection.list[n].id),t)){if(u!=this.reportConstValue.shapeType.table){i=!1;break}i=t.isPossibleDivide&&t.isPossibleDivide()}return{key:"divide",value:i}},getCommandShapeStyleDeleteColumnParameter:function(){for(var r,u,t,i=!1,n=0,f=this.collection.list.length;n<f;n++)if((r=this.getEntityById(this.collection.list[n].id),r)&&(u=r.getDataProperty("controlType"),t=this.getItemById(this.collection.list[n].id),t)){if(u!=this.reportConstValue.shapeType.table){i=!1;break}i=t.isPossibleDeleteColumn&&t.isPossibleDeleteColumn()}return{key:"deleteColumn",value:i}},getCommandShapeStyleDeleteRowParameter:function(){for(var r,u,t,i=!1,n=0,f=this.collection.list.length;n<f;n++)if((r=this.getEntityById(this.collection.list[n].id),r)&&(u=r.getDataProperty("controlType"),t=this.getItemById(this.collection.list[n].id),t)){if(u!=this.reportConstValue.shapeType.table){i=!1;break}i=t.isPossibleDeleteRow&&t.isPossibleDeleteRow()}return{key:"deleteRow",value:i}},getCommandShapeStyleBorderParameter:function(){return{key:"border",value:{position:"",style:"",color:"",width:""}}},getCommandShapeStyleShadedParameter:function(){for(var t,i,n=null,r=0,u=this.collection.list.length;r<u;r++)if(t=this.getItemById(this.collection.list[r].id),t)if(i=t.getStripePattern&&t.getStripePattern()||!1,n==null)n=i;else if(n!=i){n=!1;break}return{key:"stripePattern",value:n===null?!1:n}},getCommandLayoutParameter:function(){return[this.getCommandLayoutSendTopOfTopParameter(),this.getCommandLayoutSendFontParameter(),this.getCommandLayoutSendBottomOfBottomParameter(),this.getCommandLayoutSendBackParameter(),this.getCommandLayoutWidthParameter(),this.getCommandLayoutHeightParameter(),this.getCommandLayoutRatioSizeParameter(),this.getCommandLayoutCanTableCellMerge(),this.getCommandLayoutCanTableCellDivide(),this.getCommandLayoutSectionType(),this.getCommandLayoutSectionIndex(),this.getCommandLayoutSelectedBoundary(),this.getCommandLayoutSelectedShapes(),this.getCommandLayoutCanHorizontalAlign(),]},getCommandLayoutSendTopOfTopParameter:function(){for(var i,n,t=0,r=this.collection.list.length;t<r;t++)(i=this.getItemById(this.collection.list[t].id),i)&&(n=i.config.isManagedShape&&n!==!1);return{key:"sendTopOfTop",value:n}},getCommandLayoutSendFontParameter:function(){for(var i,n,t=0,r=this.collection.list.length;t<r;t++)(i=this.getItemById(this.collection.list[t].id),i)&&(n=i.config.isManagedShape&&n!==!1);return{key:"sendFont",value:n}},getCommandLayoutSendBottomOfBottomParameter:function(){for(var i,n,t=0,r=this.collection.list.length;t<r;t++)(i=this.getItemById(this.collection.list[t].id),i)&&(n=i.config.isManagedShape&&n!==!1);return{key:"sendBottomOfBottom",value:n}},getCommandLayoutSendBackParameter:function(){for(var i,n,t=0,r=this.collection.list.length;t<r;t++)(i=this.getItemById(this.collection.list[t].id),i)&&(n=i.config.isManagedShape&&n!==!1);return{key:"sendBack",value:n}},getCommandLayoutSelectedShapes:function(){var n=(this.getSelectedShapes()||[]).filter(function(n){return n.controlType!=this.reportConstValue.shapeType.table}.bind(this)).map(function(n){return{controlType:n.controlType,id:n.id,isManagedShape:n.isManagedShape}});return{key:"selectedShapes",value:n}},getCommandLayoutSectionType:function(){for(var n,i,r,f,u=null,t=0,e=this.collection.list.length;t<e;t++)if((n=this.$wrapperEl.find("#"+this.collection.list[t].id),n&&n.length!=0)&&(i=n.attr("data-controltype"),i==this.reportConstValue.shapeType.table)){if(r=this.getActionInstance(i),!r)return;f=r.getTableSelector();u=Object.clone(f.getFromSectionType(),!0)}return{key:"sectionType",value:u}},getCommandLayoutSectionIndex:function(){for(var n,i,r,u,f=-1,t=0,e=this.collection.list.length;t<e;t++)if((n=this.$wrapperEl.find("#"+this.collection.list[t].id),n&&n.length!=0)&&(i=n.attr("data-controltype"),i==this.reportConstValue.shapeType.table)){if(r=this.getActionInstance(i),!r)return;u=r.getTableSelector();f=u&&u.getFromSectionIndex()}return{key:"sectionIndex",value:f}},getCommandLayoutSelectedBoundary:function(){for(var n,i,r,f,u=null,t=0,e=this.collection.list.length;t<e;t++)if((n=this.$wrapperEl.find("#"+this.collection.list[t].id),n&&n.length!=0)&&(i=n.attr("data-controltype"),i==this.reportConstValue.shapeType.table)){if(r=this.getActionInstance(i),!r)return;f=r.getTableSelector();u=Object.clone(f.getSelectedBoundary(),!0)}return{key:"selectedBoundary",value:u}},getCommandLayoutWidthParameter:function(){for(var t,i,n=null,r=0,u=this.collection.list.length;r<u;r++)if(t=this.getItemById(this.collection.list[r].id),t)if(i=t.getWidth&&t.getWidth({isStatus:!0})||"",n==null)n=i;else if(n!=i){n="";break}return{key:"width",value:n}},getCommandLayoutHeightParameter:function(){for(var r,t,n=null,i=0,u=this.collection.list.length;i<u;i++)if(r=this.getItemById(this.collection.list[i].id),r)if(t=r.getHeight({isStatus:!0}),n==null)n=t;else if(n!=t){n="";break}return{key:"height",value:n}},getCommandLayoutRatioSizeParameter:function(){var n=!1,i=this.collection.list.length,t;return i==1&&(t=this.$wrapperEl.find("#"+this.collection.list[0].id),$.isEmpty(t.attr("data-sizeisratio"))||(n=!0)),{key:"ratioSize",value:n}},getCommandLayoutCanTableCellMerge:function(){var i=this.getSelectedShapes();if(!i.find(function(n){return n.controlType==this.reportConstValue.shapeType.table}.bind(this)))return{key:"canTableCellMerge",value:!1};var n=this.instanceManager.tableSelector,r=this.instanceManager.tableStructure,t=n.getSelectedBoundary();return t.isValidate()?{key:"canTableCellMerge",value:this.canTableCellMerge(t,n,r)}:{key:"canTableCellMerge",value:!1}},getCommandLayoutCanTableCellDivide:function(){var i=this.getSelectedShapes();if(!i.find(function(n){return n.controlType==this.reportConstValue.shapeType.table}.bind(this)))return{key:"canTableCellDivide",value:!1};var n=this.instanceManager.tableSelector,r=this.instanceManager.tableStructure,t=n.getSelectedBoundary();return t.isValidate()?{key:"canTableCellDivide",value:this.canTableCellDivide(t,n,r)}:{key:"canTableCellDivide",value:!1}},getCommandLayoutCanHorizontalAlign:function(){var n=_.every(this.collection.list,function(n){var t=this.getItemById(n.id);return t&&t.canHorizontalAlign()}.bind(this));return{key:"canHorizontalAlign",value:n}},canTableCellMerge:function(n,t,i){for(var r,o,e,u=[],f=n.config.top,s=n.config.bottom;f<=s;f++){for(r=n.config.left,o=n.config.right;r<=o;r++)e=i.getTd(t.getFromSectionType(),t.getFromSectionIndex(),r,f),u.indexOf(e)==-1&&u.push(e);if(u.length>1)return!0}return!1},canTableCellDivide:function(n,t,i){for(var u,o,f,r=n.config.top,e=n.config.bottom;r<=e;r++)for(u=n.config.left,o=n.config.right;u<=o;u++)if(f=i.getTd(t.getFromSectionType(),t.getFromSectionIndex(),u,r),f.colSpan>1||f.rowSpan>1)return!0;return!1},getCommandConvenienceFunctionParameter:function(){return[this.getCommandConvenienceFunctionHyperlink()]},getCommandConvenienceFunctionHyperlink:function(n){var w={isVirtualUI:!1,isToolbar:!1},r,i,f,s,e,h,o,b,l,a,t,c,y;if((n=n&&_.extend(w,n)||w,r={key:"hyperlinkInfo",value:{items:[]}},i=this._range.getRange(),this.collection.list.length==0||this.collection.list.length>1)||(f=this.getItemById(this.collection.list[0].id),!f))return r;if(f.isCursorInTextContainer(this.reportConstValue.searchCursorType.range)){if(!i)return r;if(s=!1,h="",i.collapsed?(i=n.isVirtualUI?i.cloneRange():i,this.extendHyperlinkSingleCaret(n.isVirtualUI,i),e=this._rangeApi.extractContentsInRange(i,{id:this.reportConstValue.startHyperlinkBookmarkId},{id:this.reportConstValue.endHyperlinkBookmarkId},n),h=e.textContent||""):(i=n.isVirtualUI?i.cloneRange():i,n.isVirtualUI&&(s=this._node.isElement(i.commonAncestorContainer)&&i.commonAncestorContainer.classList.contains(this.reportConstValue.mappingDataSelector)),s||this.extendHyperlinkRangeCaret(n.isVirtualUI,i),n.isVirtualUI?(e=i.cloneContents(),s||e.childNodes.length==1&&e.querySelector(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector)&&(s=!0),h=e.textContent||""):(e=this._rangeApi.extractContentsInRange(i,{id:this.reportConstValue.startHyperlinkBookmarkId},{id:this.reportConstValue.endHyperlinkBookmarkId}),h=e.textContent||"")),s)return{key:"hyperlinkInfo",value:{}};if(o=e.querySelectorAll("a"),o&&o.length)for(t=0,c=o.length;t<c;t++)r.value.items.push({displayText:h,URL:o[t].getAttribute("href")||"",title:o[t].getAttribute("title")||"",target:o[t].getAttribute("target")||"",isImage:"0",mappingDatas:[]});else r.value.items.push({displayText:h,URL:"",title:"",target:"",isImage:"0",mappingDatas:[]})}else if(this.collection.list[0].controlType==this.reportConstValue.shapeType.table){if(b=f.getTableStructure(),l=f.getTableSelector(),!l)return r;var g=l.getFromSectionType(),nt=l.getFromSectionIndex(),p=l.getFromBoundary();if(!p.isValidate()||(a=b.getTd(g,nt,p.config.left,p.config.top),!a))return r;var k=$(a),u=k.find("a"),d=k.find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector),v=_.compact(_.map(d,function(n){return this.mappingDataCollection.getById(n.getAttribute("id"))}.bind(this)));if(u&&u.length)for(t=0,c=u.length;t<c;t++)r.value.items.push({displayText:a.textContent||"",URL:u[t].getAttribute("href")||"",title:u[t].getAttribute("title")||"",target:u[t].getAttribute("target")||"",isImage:"0",mappingDatas:v});else r.value.items.push({displayText:a.textContent||"",URL:"",title:"",target:"",isImage:"0",mappingDatas:v})}else if([this.reportConstValue.shapeType.textbox,this.reportConstValue.shapeType.rectangle].contains(this.collection.list[0].controlType)){var u=f.$el.find("a"),d=f.$el.find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector),v=_.compact(_.map(d,function(n){return this.mappingDataCollection.getById(n.getAttribute("id"))}.bind(this)));if(u&&u.length)for(t=0,c=u.length;t<c;t++)r.value.items.push({displayText:f.getText({isRemoveZWS:!0,isRemoveBr:!0})||"",URL:u[t].getAttribute("href")||"",title:u[t].getAttribute("title")||"",target:u[t].getAttribute("target")||"",isImage:"0",mappingDatas:v});else r.value.items.push({displayText:f.getText({isRemoveZWS:!0,isRemoveBr:!0})||"",URL:"",title:"",target:"",isImage:"0",mappingDatas:v})}else this.collection.list[0].controlType==this.reportConstValue.shapeType.image&&(y=this.imageHyperlinkDataCollection.getById(this.collection.list[0].id)||{},r.value.items.push({displayText:"",URL:y.URL||"",title:y.URL||"",target:y.URL||"",isImage:"1",mappingDatas:[]}));return r},extendHyperlinkRangeCaret:function(n,t){var t=t||this._range.getRange(),f,i;if(!t)return null;if(f=this._rangeApi.extractContentsInRange(t,{id:this.reportConstValue.startHyperlinkBookmarkId},{id:this.reportConstValue.endHyperlinkBookmarkId}),i=f.querySelectorAll(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector),i&&i.length){var r=t.startContainer,u=t.endContainer,e=this.$wrapperEl.find("#"+i[0].getAttribute("id"))[0],o=this.$wrapperEl.find("#"+i[i.length-1].getAttribute("id"))[0],h=this._rangeApi.cutUntilNode(e),s=this._rangeApi.cutFromNode(o);h?(this._node.isElement(r)&&r.tagName=="A"&&this._range.setStartBefore(r,t),this._range.setEndBefore(e,t),this.constValue.isIE&&selection.addRange(t)):s&&this._node.getText(s).trim().length?(this._range.setStartAfter(o,t),this._node.isElement(u)&&u.tagName=="A"&&this._range.setEndAfter(u,t),this.constValue.isIE&&selection.addRange(t)):allMappingData=!0}else this.extendHyperlinkSingleCaret(n,t)},extendHyperlinkSingleCaret:function(n,t){var e=this._selection.getSelection(),t,i,r,u,f;return e?(t=t||this._range.getRange(),!t)?null:(i=!1,this._node.isText(t.startContainer)?(r=$(t.startContainer).closest("a"),r&&r.length==1&&(this._range.setStartBefore(r[0],t),i=!0)):this._node.isElement(t.startContainer)&&(u=$(t.startContainer).closest("a"),t.startContainer.tagName=="A"?(this._range.setStartBefore(t.startContainer,t),i=!0):u&&u.length?(this._range.setStartBefore(u[0],t),i=!0):this.constValue.isIE&&this._node.isElement(t.startContainer.children[t.startOffset])&&t.startContainer.children[t.startOffset].tagName=="A"&&(f=t.startContainer.children[t.startOffset],this._range.setStartBefore(f,t),i=!0)),this._node.isText(t.endContainer)?(r=$(t.endContainer).closest("a"),r&&r.length==1&&(this._range.setEndAfter(r[0],t),i=!0)):this._node.isElement(t.endContainer)&&(u=$(t.endContainer).closest("a"),t.endContainer.tagName=="A"&&(this._range.setEndAfter(t.endContainer,t),i=!0),u&&u.length?(this._range.setEndAfter(u[0],t),i=!0):this.constValue.isIE&&this._node.isElement(t.endContainer.children[t.endOffset])&&t.endContainer.children[t.endOffset].tagName=="A"&&(f=t.endContainer.children[t.endOffset],this._range.setEndAfter(f,t),i=!0)),!n&&i&&e.addRange(t),t):null},setFirstPaper:function(n){this.isFirstArea=n;n||this.checkBoundaryLimit()},setGridWidth:function(n){this.userData.gridWidth=n},setGridLeft:function(n){this.userData.gridLeft=n},layer:function(){return{show:function(){},hide:function(){}}},moveScroll:function(){var i=this.$el.find('[data-controlType="ecount.report.shape.sign"],[data-controlType="ecount.report.shape.imagecheckbox"],[data-controlType="ecount.report.shape.textbox"]'),t=this.scrollContainer.getBoundingClientRect(),n;i.length!=0&&(i.each(function(t,i){var r=i.getBoundingClientRect();i.style.border=="none"||!(!n||n.top>r.top)||(n=r)}),t.top<n.top&&(this.scrollContainer.scrollTop=n.top-t.top-10),t.left<n.left&&(this.scrollContainer.scrollLeft=n.left-t.left-10))},activeSignbox:function(n){var t=this.getItemById(n);t.length!=0&&t.$parent.addClass("active")},deactiveSignbox:function(n){var t=this.getItemById(n);t.length!=0&&t.$parent.removeClass("active")},initializeScroll:function(){this.scrollContainer&&(this.scrollContainer.scrollTop=0,this.scrollContainer.scrollLeft=0)},initEvent:function(){this.events=new ecount.events},notifyFinishJobAtParent:function(n){var t={target:this.containerName,type:this.__type,reportId:this.id,tabId:this.tabId,isDynamic:this.isDynamic,__self:this};n&&(t=$.extend(t,n));this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",t):this.delegator&&this.delegator.triggerEvent("item.onload",t)},bindEvent:function(n,t,i,r){var u=n;n instanceof jQuery||(u=$(n));t=t+(i?"."+i:"");u.on(t,r)},unbindEvent:function(n,t,i){var r=n;n instanceof jQuery||(r=$(n));t=t+(i?"."+i:"");r.off(t)},stopPropagation:function(n){n.stopPropagation=!0},preventDefault:function(n){n.suspend=!0},onShapeChangeSmartGuide:function(n){if(n.id){var t=this.getItemById(n.id);t&&(t.syncLineHandlerPosition(),t.syncLineHandlerSize({delay:!1}))}},_ON_KEYDOWN:function(){},_ON_KEYUP:function(){},_ON_KEYPRESS:function(){},ON_DOCUMENT_KEYDOWN:function(){},ON_DOCUMENT_KEYUP:function(){},ON_MOUSEDOWN:function(){},ON_MOUSEMOVE:function(){},ON_MOUSEUP:function(){},ON_MOUSEOVER:function(){},ON_MOUSEOUT:function(){},ON_CLICK:function(){},_ON_DBLCLICK:function(){},ON_DBLCLICK:function(){},ON_CONTEXTMENU:function(){},ON_FOCUSIN:function(){},ON_FOCUSOUT:function(){},ON_KEYDOWN:function(){},ON_KEYPRESS:function(){},ON_KEYUP:function(){},_ON_SCROLL:function(){},ON_SCROLL:function(){},ON_COPY:function(){},ON_DOCUMENT_COPY:function(){},ON_PASTE:function(){},ON_DOCUMENT_PASTE:function(){},ON_CUT:function(){},ON_DOCUMENT_CUT:function(){},ON_DRAG_MOUSEDOWN:function(){},ON_DRAG_MOUSEMOVE:function(){},ON_DRAG_MOUSEUP:function(){},_ON_CLICK_SERVICE:function(){},_ON_MOUSEDOWN_SERVICE:function(){},_ON_MOUSEMOVE_SERVICE:function(){},_ON_MOUSEUP_SERVICE:function(){},declareEvent:function(){var n=this.childDelegatorEvent.bind(this);this.events.on({"canvas.changeStatus":this.setStatus.bind(this),"canvas.selectableRange":this._ON_SELECTABLERANGE.bind(this),"canvas.dragStart":this.ON_DRAG_START.bind(this),"shape.changeElementSize":this.updateElementSize.bind(this),"shape.changeElementPoint":this.updateElementPoint.bind(this),"shape.superParentEntity":this.getSuperParentEntityByid.bind(this),"shape.getEntity":this.getEntityById.bind(this),"shape.selectMappingdata":this._ON_SELECT_MAPPINGDATA.bind(this),"shape.deselectMappingdata":this._ON_DESELECT_MAPPINGDATA.bind(this),"shape.beginHistoryTransaction":this.beginHistoryTransaction.bind(this),"shape.commitHistoryTransaction":this.commitHistoryTransaction.bind(this),"shape.addHistory":this.addDataInHistory.bind(this),"shape.createLineHandler":this.createLineHandler.bind(this),"shape.syncOfTableLayout":this.setSyncOfTableLayout.bind(this),"shape.elementsCache":this.setElementsCache.bind(this),"shape.convertTableInOuterHTML":this.setConvertTableInOuterHTML.bind(this),"shape.change.smartGuide":this.onShapeChangeSmartGuide.bind(this),"click.contextmenu":this._ON_CLICK_CONTEXTMENU.bind(this),"shape.deleteMappingData":this.deleteMappingData.bind(this),"drawingPaper.shape.initTableCell":this.transferEvent.bind(this),"shape.createInstance":n,"shape.beforedestroyInstance":n,"shape.destroyInstance":n,"shape.dblClick":n,"shape.click":n,"shape.select":n,"shape.deselect":n,"shape.cloneMappingData":n,"shape.cloneInstance":n,"shape.clickBtnOldHtml":n,"shape.focusinIntoShape":n,"shape.clickBtnConvertBackgroundImage":n,"shape.alert":n,scope:this})},bindScrollEvent:function(n){var t=[this.syncLineHandlerWhenScroll.bind(this),this.syncTableSelectorWhenScroll.bind(this),this.removeLineHandlerIfOutOfZone.bind(this),];this.getScrollManager().addScrollEventIn(n[0],t)},bindMousedownEvent:function(){var n=this.getLayoutContainer(),t=n||this.$wrapperEl;t.on("mousedown.canvas-"+this.ecIKey,function(n,t){var i=ec$.getEcEvent(n,t);n.isTrigger&&i.notPreventTriggerEvent!=!0||this.ON_LAYOUT_MOUSEDOWN(i,n)}.bind(this))},bindMousemoveEvent:function(){ecount.common.addMousemoveEventListener(ecount.runtime.root.document,"mousemove.canvas-"+this.ecIKey,function(n,t){var i=ec$.getEcEvent(n,t);this.ON_MOUSEMOVE(i,n)}.bind(this),0)},bindMouseupEvent:function(){ecount.common.addMouseupEventListener(ecount.runtime.root.document,"mouseup.canvas-"+this.ecIKey,function(n,t){var i=ec$.getEcEvent(n,t);i.ecService||this.ON_MOUSEUP(i,n)}.bind(this),0)},bindKeydownEvent:function(){},bindCopyEvent:function(){this.bindEvent(document.body,"copy","canvas-"+this.ecIKey,function(n){return this.ON_DOCUMENT_COPY(ec$.getEcEvent(n),n)}.bind(this))},bindPasteEvent:function(){this.bindEvent(document.body,"paste","canvas-"+this.ecIKey,function(n){return this.ON_DOCUMENT_PASTE(ec$.getEcEvent(n),n)}.bind(this))},bindCutEvent:function(){this.bindEvent(document.body,"cut","canvas-"+this.ecIKey,function(n){return this.ON_DOCUMENT_CUT(ec$.getEcEvent(n),n)}.bind(this))},bindContextmenuEvent:function(){this.bindEvent(this.$wrapperEl,"contextmenu","canvas-"+this.ecIKey,function(){if(!ecount.isMobile)return!1})},unbindScrollEvent:function(){this.getScrollManager().removeScrollEventOfDestroyedScrollEl()},unbindContextmenuEvent:function(){this.unbindEvent(this.$wrapperEl,"contextmenu","canvas-"+this.ecIKey)},unbindMousedownEvent:function(){var n=this.getLayoutContainer();n&&n.off("mousedown.canvas-"+this.ecIKey);this.$wrapperEl.off("mousedown.canvas-"+this.ecIKey)},unbindMousemoveEvent:function(){ecount.common.removeMousemoveEventListener(ecount.runtime.root.document,"mousemove.canvas-"+this.ecIKey)},unbindMouseupEvent:function(){ecount.common.removeMouseupEventListener(ecount.runtime.root.document,"mouseup.canvas-"+this.ecIKey)},unbindKeydownEvent:function(){this.unbindEvent(this.$wrapperEl,"keydown","canvas-"+this.ecIKey);this.unbindEvent(document,"keydown","canvas-"+this.ecIKey)},unbindKeyupEvent:function(){this.unbindEvent(this.$wrapperEl,"keyup","canvas-"+this.ecIKey)},unbindKeypressEvent:function(){this.unbindEvent(this.$wrapperEl,"keypress","canvas-"+this.ecIKey)},unbindCopyEvent:function(){this.unbindEvent(document.body,"copy","canvas-"+this.ecIKey)},unbindCutEvent:function(){this.unbindEvent(document.body,"cut","canvas-"+this.ecIKey)},unbindPasteEvent:function(){this.unbindEvent(document.body,"paste","canvas-"+this.ecIKey)},childDelegatorEvent:function(n){var u=n.type,t=n.value.id,r,l,s,i,e,o,h,f,c;if(u=="shape.cloneMappingData")n.value.mappingData.forEach(function(n){var t,i;n.ref&&n.ref.id&&n.ref.id&&(t=this.mappingDataCollection.getById(n.ref.id),t&&(i=Object.clone(t,!0),i.id=n.id,this.mappingDataCollection.add(i)))}.bind(this));else if(u=="shape.createInstance")i=n.value.data,this.entityTree.addEntity({id:t,children:[],parentId:null,data:{controlType:i.controlType,container:i.container,el:i.el,style:i.style}}),r=this.getEntityById(t),r&&n.value.data.poolId&&r.setPool({id:i.poolId,data:i.poolData}),e=this.imageHyperlinkDataCollection.getById(i.refId),e&&(o=Object.clone(e,!0),o.id=t,this.imageHyperlinkDataCollection.add(o)),n.value.container&&delete n.value.container,n.value.el&&delete n.value.el,this.addDataInHistory();else if(u=="shape.cloneInstance")i=n.value.data,this.entityTree.addEntity({id:t,children:[],parentId:null,data:{controlType:i.controlType,container:i.container,el:i.el,style:i.style}}),r=this.getEntityById(t),r&&r.setPool({id:i.poolId,data:i.poolData}),e=this.imageHyperlinkDataCollection.getById(i.refId),e&&(o=Object.clone(e,!0),o.id=t,this.imageHyperlinkDataCollection.add(o));else if(u=="shape.destroyInstance")this.releaseLineHandler(t),this.unbindScrollEvent(),this.entityTree.removeEntityById(t),this.collection.removeById(t),this.positionCollection.removeById(t),this.imageHyperlinkDataCollection.removeById(t);else if(u=="shape.focusinIntoShape"){if(r=this.getEntityById(t),!r)return;if(l=r.getDataProperty("controlType"),h=this.getItemById(t),!h)return;switch(l){case this.reportConstValue.shapeType.rectangle:f=h.$el;break;case this.reportConstValue.shapeType.rectangle:f=h.$el;break;case this.reportConstValue.shapeType.table:f=h.$el.find('[data-key="'+n.value.rowId+'"][data-columnid="'+n.value.columnId+'"]')}f&&f.length&&(f.trigger("mousedown",{which:1,target:f[0],notPreventTriggerEvent:!0,isMoveLastCursor:!0}),f.trigger("mouseup",{which:1,target:f[0],notPreventTriggerEvent:!0}))}else if(u=="shape.select"){if(r=this.getEntityById(t),!r)return;s=r.getDataProperty("el");switch(n.value.controlType){case this.reportConstValue.shapeType.rectangle:this.config.savedCursorInfo=this.getFullPathToBefore(s[0],this.reportConstValue.containerSelector);break;case this.reportConstValue.shapeType.textbox:case this.reportConstValue.shapeType.imagecheckbox:case this.reportConstValue.shapeType.sign:this.isContract?n.value.currentSelect=s.attr("data-step"):this.config.savedCursorInfo=this.getFullPathToBefore(s[0],this.reportConstValue.containerSelector);break;case this.reportConstValue.shapeType.table:c=s.find(n.value.sectionType).find('[data-columnid="'+n.value.columnId+'"][data-key="'+n.value.rowId+'"]');c&&c.length>0&&(this.config.savedCursorInfo=this.getFullPathToBefore(c[0],this.reportConstValue.containerSelector))}this.showSuperParentLine(t)}else u=="shape.deselect"?this.releaseLineHandler(t):u=="shape.alert";this.customTriggerEvent(u,n.value)},transferEvent:function(n,t,i,r){if(n)return t.__eventType=n,this.delegator._triggerEvent(n,t,i,r)},customTriggerEvent:function(n,t){this.triggerEvent(n,{},{},{},t)},triggerEvent:function(n,t,i,r,u){var e=this.getCommand(i.type,n),f;u=u||{};u.command=e;u.type=n;u.status=this.config.status;u.selectedShapes=this.getSelectedShapes();f={};switch(n){case"drawingPaper.all":f=this.getCommandAllParameter();break;case"drawingPaper.history":f=this.getCommandHistoryParameter();break;case"drawingPaper.shape":f=this.getCommandShapeParameter();break;case"drawingPaper.font":f=this.getCommandFontParameter();break;case"drawingPaper.shapeStyle":f=this.getCommandShapeStyleParameter();break;case"drawingPaper.layout":f=this.getCommandLayoutParameter();break;case"drawingPaper.addMappingData":u.value=f;break;case"drawingPaper.insertMappingData":break;case"drawingPaper.insertHyperlink":case"drawingPaper.editHyperlink":case"drawingPaper.deleteHyperlink":f=this.getCommandConvenienceFunctionParameter();break;case"drawingPaper.viewSamples":f={area:this.containerArea};u.value=f;break;case"drawingPaper.setting":f=this.getMappingItemSettingData();u.value=f;break;case"drawingPaper.allSettings":u.value=f;break;case"report.activeArea":u.activeArea=this.containerArea;break;case"drawingPaper.renderComplete":case"drawingPaper.beginEdit":case"drawingPaper.endEdit":case"drawingPaper.contextmenuData":case"drawingPaper.changeActive":case"drawingPaper.deSelectPositionCollection":case"report.areaClick":break;default:n="drawingPaper."+n;u.type=n;u.command=this.getCommand(i.type,u.type)}u.value=f;this.delegator&&this.delegator.triggerEvent(n,u)}}),[ecount.abstract.report.config,ecount.abstract.report.common,ecount.abstract.report.convertShape,ecount.abstract.report.actionInstance,ecount.abstract.report.util]);ecount.class("ecount.layout.drawingPaperView","ecount.layout.drawingPaper",{getContent:function(n,t,i){var r,f,e,o,s,u;if(n=_.isBoolean(n)?n:!0,i&&(!this.getAllControls()||!this.getAllControls().length))return"";if(r=this.$el.clone(),n&&(r.find(".areaselect-handle").remove(),r.find(this.reportConstValue.lineHandlerPrefix+this.reportConstValue.lineHandlerSelector).remove(),r.find(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector).removeClass("selected"),r.find("."+this.reportConstValue.tableSelectorLineDefaultSelector).remove(),r.find(this.reportConstValue.areaselectOptionPrefix+this.reportConstValue.areaselectOptionSelector).remove()),t){var h="["+this.reportConstValue.wrapperAttrKey+"='"+this.reportConstValue.canvasWrapperSelector+"']",c=r.find(h),l=this.getContentsHeight({isContainDefaultBox:!1});c.css({height:l+"px"})}return this.removeDefaultBox(r),f=r.find("."+this.reportConstValue.beforeMappingDataSelector),f.each(function(n,t){t.childNodes.length||t.parentNode.removeChild(t)}),e=r.find("."+this.reportConstValue.afterMappingDataSelector),e.each(function(n,t){t.childNodes.length||t.parentNode.removeChild(t)}),r.find(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector).removeAttr("contenteditable"),r.find("th, td").css({cursor:""}),r.find(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector).removeClass("cursor-text"),o=r.find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector),o.each(function(n,t){t.innerText="";t.classList.remove("noselection");t.classList.remove("cursor-pointer")}),s=["ecount.report.shape.selectableRange"],this.removeControlByType(r,s),r.find(".noselection").removeClass("noselection"),r.find(".cursor-text").removeClass("cursor-text"),this.removeTooltip(r),this.removeSelectOutline(r),u=this.getActionInstance("smartGuideManager"),u&&u.removeSmartGuideElement(r),r.html()},setContent:function(n,t){var u,r,i;ecount.common.showProgressbar();this.unbindMousedownEvent();this.unbindMousemoveEvent();this.unbindMouseupEvent();this.unbindContextmenuEvent();u=this.$el.find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector);u.each(function(n,t){this.mappingDataCollection.removeById(t.id)}.bind(this));_.forEach(t,function(n){this.mappingDataCollection.add(n)}.bind(this));r=n instanceof jQuery?n:$(n);r.length>1&&r.find("[data-wrapper=drawingPaperWrapper]").length>0&&(r.find(".p_docmanageroot").removeClass("p_docmanageroot"),r.find("[data-wrapper=drawingPaperWrapper]").removeAttr("data-wrapper"),n=$(String.format('<div data-wrapper="drawingPaperWrapper"><div data-isoldhtmlbox="true" style="position: relative; top: 0px; left: 0px; z-index: 0;overflow: visible;" class="ec-container wrapper-areaselect outline" style="overflow:unset"><div class="areaselect-content" style="padding:0;"><div id="rectangle-_00000005" data-controltype="ecount.report.shape.rectangle" class="ec-dragable ec-editable ec-resizable"><div class="ec-textcontainer" style="width: 100%;">{0}<\/div><\/div><\/div><\/div><\/div>',r.outerHTML())).outerHTML());this.$el.html(n||"");this.$el.find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector).each(function(n,i){var f=i.id,u=ecount.common.uuid("mappingItem"),r;i.setAttribute("id",u);r=_.find(t,function(n){return n.id==f});r&&this.mappingDataCollection.add(_.extend({},r,{id:u}))}.bind(this));this.createWrapperEl();i=this.getOldHtmlElement();i&&(this.isDocumentEvidence?i.find(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector).attr("isnoteditable","true"):(i.addClass("cursor-text"),i.find(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector).attr("contenteditable","true"),i.find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector).addClass("cursor-pointer")));this.entityTree.clearEntities();this.entityTree.loadElements(this.$wrapperEl);this.clearLineHandler();this.loadLineHandler();this.loadMappingData();this.initShapeLayout();this._options.useDefaultBox&&this.createDefaultBox();i=this.getOldHtmlElement();i&&!this.isDocumentEvidence&&(i.find(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector).attr("contenteditable","true"),i.find(this.reportConstValue.mappingDataPrefix+this.reportConstValue.mappingDataSelector).addClass("cursor-pointer"));this.clearHistory();this.config.mode==this.reportConstValue.mode.edit&&this.addDataInHistory();this.bindMousedownEvent();this.bindMousemoveEvent();this.bindMouseupEvent();this.bindContextmenuEvent();ecount.common.hideProgressbar()},setTextContent:function(n,t){var i=this.getItemById(n);i&&(i.setTextContent(t),this.resizeHandler())},createOldHtmlBox:function(n){n&&(this.drawDirectShape({action:this.reportConstValue.shapeStatus.directDrawing,style:{top:"0",left:"0",width:"100%",height:"0px",border:"none"},html:n,isOldHtml:!0,isDragable:!0,isResizable:!0},{directFocus:!0,directSelect:!0},this.reportConstValue.shapeType.rectangle),this.resizeHandler())},getElementByRange:function(){var n=this._range.getRange(),t=n&&n.commonAncestorContainer&&$(n.commonAncestorContainer).closest("[data-controltype]");return!t||t.length===0?null:t},_ON_KEYDOWN:function(n,t,i,r){var u=t.which||t.keyCode;t.ctrlKey&&u==this.constValue.keyCode.C||t.ctrlKey&&u==this.constValue.keyCode.V||t.ctrlKey&&u==this.constValue.keyCode.X||this.ON_KEYDOWN(n,t,i,r)},_ON_KEYUP:function(n,t,i,r){this.ON_KEYUP(n,t,i,r)},_ON_KEYPRESS:function(n,t,i,r){this.ON_KEYPRESS(n,t,i,r)},ON_DOCUMENT_KEYDOWN:function(n,t,i,r){var u,o,f,e,s;if(this.config.mode!=this.reportConstValue.mode.view&&!this.config.cancelEvent&&!this.config.keyEventPreventDefault){if(u=t.which||t.keyCode,!this.config.active){if((t.ctrlKey&&u==this.constValue.keyCode.Z||t.ctrlKey&&u==this.constValue.keyCode.Y)&&this.ON_KEYDOWN(n,t,i,r),this.config.status&this.reportConstValue.canvasStatus.drawable&&u==this.constValue.keyCode.ESC){t.stopPropagation();this.setStatus(this.reportConstValue.canvasStatus.selectable);this.removeNoselectionInBody();return}return}if(o=t.target,f=$(o),this._node.isText(o)?f=f.closest(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector):this._node.isElement(o)&&(o.classList.contains(this.reportConstValue.textcontainerSelector)||(f=f.closest(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector))),f=f.closest("[data-controltype]"),e=this.getItemById(f.attr("id")),e&&e.isEditable()){if(!(this.config.status&this.reportConstValue.canvasStatus.selectable)&&!(this.config.status&this.reportConstValue.canvasStatus.drawable)&&this.config.status&this.reportConstValue.canvasStatus.editable&&u==this.constValue.keyCode.ESC&&this.collection.list.length){t.stopPropagation();this.cloneCollectionData();this.clearCollection();this.setStatus(this.reportConstValue.canvasStatus.selectable);return}}else{if(this.config.status&this.reportConstValue.canvasStatus.selectable){if(n.ecService=="service.layer")return;if(u==this.constValue.keyCode.ESC){if(this.collection.list.length){t.stopPropagation();this.cloneCollectionData();this.clearCollection();this.setStatus(this.reportConstValue.canvasStatus.selectable);return}}else u==this.constValue.keyCode.BACKSPACE&&(this.collection.list.length==1?(e=this.getItemById(this.collection.list[0].id),e&&(e.isEditable()||(t.preventDefault(),n.cancelBubbled=!0))):(t.preventDefault(),n.cancelBubbled=!0))}else if(this.config.status&this.reportConstValue.canvasStatus.drawable){if(u==this.constValue.keyCode.ESC){t.stopPropagation();this.setStatus(this.reportConstValue.canvasStatus.selectable);this.removeNoselectionInBody();return}}else if(this.config.status&this.reportConstValue.canvasStatus.editable){if(n.ecService=="service.layer")return;if(u==this.constValue.keyCode.ESC&&this.collection.list.length){t.stopPropagation();this.cloneCollectionData();this.clearCollection();this.setStatus(this.reportConstValue.canvasStatus.selectable);return}}return s=this.ON_KEYDOWN(n,t,i,r),!s&&{cancelBubble:!0}}}},ON_DOCUMENT_KEYUP:function(n,t,i,r){if(this.config.mode!=this.reportConstValue.mode.view&&this.config.active&&!this.config.cancelEvent&&!n.ecService){var e=t.which||t.keyCode,f=t.target,u=$(f);if(this._node.isText(f)?u=u.closest(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector):this._node.isElement(f)&&(f.classList.contains(this.reportConstValue.textcontainerSelector)||(u=u.closest(this.reportConstValue.textcontainerPrefix+this.reportConstValue.textcontainerSelector))),!u||u.length==0){if(this.config.status&this.reportConstValue.canvasStatus.selectable){if(e!=this.constValue.keyCode.ESC&&n.ecService=="service.layer")return}else this.config.status&this.reportConstValue.canvasStatus.drawable||this.config.status&this.reportConstValue.canvasStatus.editable;this.ON_KEYUP(n,t,i,r)}}},ON_LAYOUT_MOUSEDOWN:function(n,t,i,r){if(!this.config.cancelEvent&&(!this._options.isValidTarget||this._options.isValidTarget(t.target&&t.target.classList))){var u=!!this.$el.find(t.target).length;if(u)this.triggerEvent("report.activeArea",n,t,i,r);else{if(!this.config.active){this.customTriggerEvent("drawingPaper.deSelectPositionCollection",{active:!_.isEmpty(n.gridID)});return}if(n.which!=1)return}if(this.config.mode!=this.reportConstValue.mode.view)if(n.which==1)this.onMouseDownLeft(n,t,i,r);else if(n.which==3&&this.config.contextmenu.use)this.onMousedownRight(n,t,i,r)}},ON_MOUSEMOVE:function(n,t,i,r){var u;if(this.config.mode!=this.reportConstValue.mode.view&&this.config.active&&!this.config.cancelEvent&&!(this.config.status&this.reportConstValue.canvasStatus.drawable)){var f=t.target,a=$(f),o=ecount.common.getEventPoint(t),s=a.closest("[data-controltype]"),h=s.attr("data-controltype"),e=function(){var o=t.target,s=$(o),h=s.closest("th, td"),c=h.closest("table"),l=c.attr("id"),e=this.getEntityById(l),u,f;if(e){u=this.reportConstValue.shapeStatus.none;switch(this.config.status){case this.reportConstValue.canvasStatus.selectable|this.reportConstValue.canvasStatus.resizableCellWidth|this.reportConstValue.canvasStatus.resizableCellHeight:u=this.reportConstValue.shapeStatus.selectable|this.reportConstValue.shapeStatus.resizableCellWidth|this.reportConstValue.shapeStatus.resizableCellHeight;break;case this.reportConstValue.canvasStatus.selectable|this.reportConstValue.canvasStatus.resizableCellWidth:u=this.reportConstValue.shapeStatus.selectable|this.reportConstValue.shapeStatus.resizableCellWidth;break;case this.reportConstValue.canvasStatus.selectable|this.reportConstValue.canvasStatus.resizableCellHeight:u=this.reportConstValue.shapeStatus.selectable|this.reportConstValue.shapeStatus.resizableCellHeight;break;case this.reportConstValue.canvasStatus.editable|this.reportConstValue.canvasStatus.resizableCellWidth|this.reportConstValue.canvasStatus.resizableCellHeight:u=this.reportConstValue.shapeStatus.editable|this.reportConstValue.shapeStatus.resizableCellWidth|this.reportConstValue.shapeStatus.resizableCellHeight;break;case this.reportConstValue.canvasStatus.editable|this.reportConstValue.canvasStatus.resizableCellWidth:u=this.reportConstValue.shapeStatus.editable|this.reportConstValue.shapeStatus.resizableCellWidth;break;case this.reportConstValue.canvasStatus.editable|this.reportConstValue.canvasStatus.resizableCellHeight:u=this.reportConstValue.shapeStatus.editable|this.reportConstValue.shapeStatus.resizableCellHeight;break;case this.reportConstValue.canvasStatus.editing|this.reportConstValue.canvasStatus.resizableCellWidth|this.reportConstValue.canvasStatus.resizableCellHeight:u=this.reportConstValue.shapeStatus.editing|this.reportConstValue.shapeStatus.resizableCellWidth|this.reportConstValue.shapeStatus.resizableCellHeight;break;case this.reportConstValue.canvasStatus.editing|this.reportConstValue.canvasStatus.resizableCellWidth:u=this.reportConstValue.shapeStatus.editing|this.reportConstValue.shapeStatus.resizableCellWidth;break;case this.reportConstValue.canvasStatus.editing|this.reportConstValue.canvasStatus.resizableCellHeight:u=this.reportConstValue.shapeStatus.editing|this.reportConstValue.shapeStatus.resizableCellHeight}(f=this.getItemById(e.id,{isNotUseLineHandler:!0}),f)&&(f.setAction(u),f.setConfig({isNotUseLineHandler:!1}),f.ON_MOUSEMOVE(n,t,i,r))}}.bind(this),c=ecount.common.canResizeTableCellWidth(o,f,this.scrollContainer),l=ecount.common.canResizeTableCellHeight(o,f,this.scrollContainer);if(c&&l?this.setStatus(this.config.status|this.reportConstValue.canvasStatus.resizableCellWidth|this.reportConstValue.canvasStatus.resizableCellHeight):c?this.setStatus(this.config.status|this.reportConstValue.canvasStatus.resizableCellWidth):l&&this.setStatus(this.config.status|this.reportConstValue.canvasStatus.resizableCellHeight),!(this.config.status&this.reportConstValue.canvasStatus.selectable)||!(this.config.status&this.reportConstValue.canvasStatus.editable))if(this.config.status&this.reportConstValue.canvasStatus.selectable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight))e(),ecount.common.canReiszableCell(o,f,this.scrollContainer)||this.setStatus(this.reportConstValue.canvasStatus.selectable);else if(this.config.status&this.reportConstValue.canvasStatus.editable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight))e(),ecount.common.canReiszableCell(o,f,this.scrollContainer)||this.setStatus(this.reportConstValue.canvasStatus.editable);else if(this.config.status&this.reportConstValue.canvasStatus.editing&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight))e(),ecount.common.canReiszableCell(o,f,this.scrollContainer)||this.setStatus(this.reportConstValue.canvasStatus.editing);else if(this.config.status&this.reportConstValue.canvasStatus.selectable)e();else if(this.config.status&this.reportConstValue.canvasStatus.selectableRange){if(u=this.getActionInstance(this.config.drawShapeType),!u)return;u.ON_MOUSEMOVE(n,t,i,r)}else if(!(this.config.status&this.reportConstValue.canvasStatus.drawable))if(this.config.status&this.reportConstValue.canvasStatus.mouseDrawing){if(u=this.getActionInstance(this.config.drawShapeType),!u)return;u.ON_MOUSEMOVE(n,t,i,r)}else if(!(this.config.status&this.reportConstValue.canvasStatus.resizable))if(this.config.status&this.reportConstValue.canvasStatus.editable){if(u=this.getActionInstance(h),!u)return;u.equal$El(s)&&e()}else if(this.config.status&this.reportConstValue.canvasStatus.editing){if(u=this.getActionInstance(h),!u)return;u.equal$El(s)&&e()}else this.config.status&this.reportConstValue.canvasStatus.resizingCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizingCellHeight}},ON_MOUSEUP:function(n,t,i,r){if(this.config.mode!=this.reportConstValue.mode.view&&this.config.active&&!this.config.cancelEvent)if(n.which==1)this.onMouseUpLeft(n,t,i,r);else if(n.which==3&&this.config.contextmenu.use)this.onMouseUpRight(n,t,i,r)},ON_MOUSEOVER:function(n,t){if(this.config.mode!=this.reportConstValue.mode.view&&this.config.active&&!this.config.cancelEvent){var r=t.target,u=$(r),i=u.closest(this.reportConstValue.dragPrefix+this.reportConstValue.dragSelector),f=i.length==0?null:i[0];this.config.status&this.reportConstValue.canvasStatus.selectable&&this.config.status&this.reportConstValue.canvasStatus.editable||this.config.status&this.reportConstValue.canvasStatus.selectable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)||this.config.status&this.reportConstValue.canvasStatus.editable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)||this.config.status&this.reportConstValue.canvasStatus.editing&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)||this.config.status&this.reportConstValue.canvasStatus.selectable||this.config.status&this.reportConstValue.canvasStatus.selectableRange||this.config.status&this.reportConstValue.canvasStatus.drawable||this.config.status&this.reportConstValue.canvasStatus.mouseDrawing||this.config.status&this.reportConstValue.canvasStatus.resizable||this.config.status&this.reportConstValue.canvasStatus.editable||this.config.status&this.reportConstValue.canvasStatus.editing||this.config.status&this.reportConstValue.canvasStatus.resizingCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizingCellHeight}},ON_MOUSEOUT:function(n,t){if(this.config.mode!=this.reportConstValue.mode.view&&this.config.active&&!this.config.cancelEvent){var r=t.target,u=$(r),i=u.closest(this.reportConstValue.dragPrefix+this.reportConstValue.dragSelector),f=i.length==0?null:i[0];this.config.status&this.reportConstValue.canvasStatus.selectable&&this.config.status&this.reportConstValue.canvasStatus.editable||this.config.status&this.reportConstValue.canvasStatus.selectable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)||this.config.status&this.reportConstValue.canvasStatus.editable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)||this.config.status&this.reportConstValue.canvasStatus.editing&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)||this.config.status&this.reportConstValue.canvasStatus.selectable||this.config.status&this.reportConstValue.canvasStatus.selectableRange||this.config.status&this.reportConstValue.canvasStatus.drawable||this.config.status&this.reportConstValue.canvasStatus.mouseDrawing||this.config.status&this.reportConstValue.canvasStatus.resizable||this.config.status&this.reportConstValue.canvasStatus.editable||this.config.status&this.reportConstValue.canvasStatus.editing||this.config.status&this.reportConstValue.canvasStatus.resizingCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizingCellHeight}},ON_CLICK:function(n,t){var i,f,r,e,u;this.config.mode!=this.reportConstValue.mode.view&&this.config.active&&(this.config.cancelEvent||(this.config.status&this.reportConstValue.canvasStatus.editable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)||this.config.status&this.reportConstValue.canvasStatus.selectable&&this.config.status&this.reportConstValue.canvasStatus.editable||this.config.status&this.reportConstValue.canvasStatus.selectable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)||this.config.status&this.reportConstValue.canvasStatus.editable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)||this.config.status&this.reportConstValue.canvasStatus.moveable&&this.config.status&this.reportConstValue.canvasStatus.editable||(this.config.status&this.reportConstValue.canvasStatus.selectable?(i=$(t.target),f=i.closest(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),i=f.find("[data-controltype]"),r=i.attr("id"),e=this.getEntityById(r),e&&(u=this.getItemById(r,{action:this.reportConstValue.shapeStatus.selectable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,style:{},areaDivisionCalculation:"each"}),u&&u.ON_CLICK(n,t))):this.config.status&this.reportConstValue.canvasStatus.selectableRange||this.config.status&this.reportConstValue.canvasStatus.mouseDrawing||this.config.status&this.reportConstValue.canvasStatus.moveable||this.config.status&this.reportConstValue.canvasStatus.moving||this.config.status&this.reportConstValue.canvasStatus.resizing||(this.config.status&this.reportConstValue.canvasStatus.editable?(i=$(t.target),f=i.closest(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),i=f.find("[data-controltype]"),r=i.attr("id"),e=this.getEntityById(r),e&&(u=this.getItemById(r,{action:this.reportConstValue.shapeStatus.editable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,style:{},areaDivisionCalculation:"each"}),u&&u.ON_CLICK(n,t))):this.config.status&this.reportConstValue.canvasStatus.editing?(i=$(t.target),f=i.closest(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),i=f.find("[data-controltype]"),r=i.attr("id"),e=this.getEntityById(r),e&&(u=this.getItemById(r,{action:this.reportConstValue.shapeStatus.editing,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,style:{},areaDivisionCalculation:"each"}),u&&u.ON_CLICK(n,t))):this.config.status&this.reportConstValue.canvasStatus.resizingCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizingCellHeight)),this.previousCollection=null))},_ON_DBLCLICK:function(n,t,i,r){this.config.mode!=this.reportConstValue.mode.view&&this.config.active&&(this.ON_DBLCLICK(n,t,i,r),document.execCommand("enableObjectResizing",null,!1))},ON_DBLCLICK:function(n,t){if(this.config.mode!=this.reportConstValue.mode.view&&this.config.active&&!this.config.cancelEvent){var i=this.reportConstValue.shapeStatus.none,r=function(){var f=$(t.target),s=f.closest(".ec-canvas"),r;if(!f.hasClass("ec-canvas")){var e=f.closest(this.reportConstValue.editablePrefix+this.reportConstValue.editableSelector),o=e.attr("id"),u=e.attr("data-controltype");this.isDocumentEvidence&&u!==this.reportConstValue.shapeType.sign||(r=this.getActionInstance(u),r)&&(r.setConfig(_.extend(this.getDefaultConfig(),{action:i,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,style:{},areaDivisionCalculation:"each"})),this.isResetCanvasBoundingClientRect(u)&&(r.resetCanvasBoundingClientRect(),this.setResetCanvasBoundingClientRect(!1,u)),r.setCanvas(this.$wrapperEl),u=="ecount.report.shape.table"&&(r.setTableStructure(this.instanceManager.tableStructure),r.setTableSelector(this.instanceManager.tableSelector)),r.isAvailableState()&&(r.ON_DBLCLICK(n,t),r.setFocusInTextContainer&&r.setFocusInTextContainer(!1,!0)),r.isEditable()&&(this.setEditableId(o),this.collection.list.filter(function(n){return n.id!=o}).forEach(function(n){this.deselectInstance(n);this.collection.remove(n)}.bind(this))))}}.bind(this);this.config.status&this.reportConstValue.canvasStatus.editable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)||this.config.status&this.reportConstValue.canvasStatus.selectable&&this.config.status&this.reportConstValue.canvasStatus.editable||this.config.status&this.reportConstValue.canvasStatus.selectable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)||this.config.status&this.reportConstValue.canvasStatus.editable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)||this.config.status&this.reportConstValue.canvasStatus.moveable&&this.config.status&this.reportConstValue.canvasStatus.editable||(this.config.status&this.reportConstValue.canvasStatus.selectable?(i=this.reportConstValue.shapeStatus.editable,t.ctrlKey||t.shiftKey||r()):this.config.status&this.reportConstValue.canvasStatus.selectableRange||this.config.status&this.reportConstValue.canvasStatus.mouseDrawing||this.config.status&this.reportConstValue.canvasStatus.moveable||this.config.status&this.reportConstValue.canvasStatus.moving||this.config.status&this.reportConstValue.canvasStatus.resizing||(this.config.status&this.reportConstValue.canvasStatus.editable?(i=this.reportConstValue.shapeStatus.editable,r()):this.config.status&this.reportConstValue.canvasStatus.editing?(i=this.reportConstValue.shapeStatus.editing,r()):this.config.status&this.reportConstValue.canvasStatus.resizingCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizingCellHeight))}},ON_FOCUSIN:function(n,t,i,r){var e,f;if((console.log("ecount.layout.eventHandler.drawingPaperView ON_FOCUSIN %s",this.config.status),console.log(t.target),this.config.mode!=this.reportConstValue.mode.view)&&this.config.active&&!this.config.cancelEvent&&!(this.config.status&this.reportConstValue.canvasStatus.selectable)&&!(this.config.status&this.reportConstValue.canvasStatus.drawable)&&!(this.config.status&this.reportConstValue.canvasStatus.moveable)&&!(this.config.status&this.reportConstValue.canvasStatus.resizable))if(this.config.status&this.reportConstValue.canvasStatus.editable){var o=t.target,s=$(o),u=s.closest("[data-controltype]");u&&u.length&&(e=u.attr("id"),f=this.getItemById(e),f&&f.ON_FOCUSIN(n,t,i,r))}else if(this.config.status&this.reportConstValue.canvasStatus.editing){var o=t.target,s=$(o),u=s.closest("[data-controltype]");u&&u.length&&(e=u.attr("id"),f=this.getItemById(e),f&&f.ON_FOCUSIN(n,t,i,r))}},ON_FOCUSOUT:function(n,t){var e,i,u,f,r;if((console.log("ecount.layout.eventHandler.drawingPaperView ON_FOCUSOUT %s",this.config.status),console.log(t.target),this.config.mode!=this.reportConstValue.mode.view)&&this.config.active&&!this.config.cancelEvent){this.saveCursor(t.relatedTarget&&t.relatedTarget.getAttribute("data-cid")||"");var s=t.relativeTarget,h=$(s),o=h.closest("wrapper-report-toolbar"),c=o&&o.length==1;if(!(this.config.status&this.reportConstValue.canvasStatus.selectable))if(this.config.status&this.reportConstValue.canvasStatus.moveable&&this.config.status&this.reportConstValue.canvasStatus.editable){if(i=$(t.target),i=i.closest("[data-controltype]"),!i||i.length==0)return;if(u=i.attr("id"),f=this.getEntityById(u),!f)return;if(r=this.getItemById(u,{action:this.reportConstValue.canvasStatus.moveable&this.reportConstValue.canvasStatus.editable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each"}),!r)return;r.ON_FOCUSOUT(t);this.customTriggerEvent("drawingPaper.endEdit",{id:i.attr("id"),controlType:f.getDataProperty("controlType")})}else if(!(this.config.status&this.reportConstValue.canvasStatus.drawable))if(this.config.status&this.reportConstValue.canvasStatus.mouseDrawing){if(i=$(t.target),i=i.closest("[data-controltype]"),!i||i.length==0)return;if(u=i.attr("id"),f=this.getEntityById(u),!f)return;if(e=this.instanceManager.clipboardInstance,r=this.getItemById(u,{action:this.reportConstValue.shapeStatus.mouseDrawing,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each",remainEditable:e&&(e.isCopying()||e.isPasting())}),!r)return;r.ON_FOCUSOUT(t);this.customTriggerEvent("drawingPaper.endEdit",{id:i.attr("id"),controlType:f.getDataProperty("controlType")})}else if(!(this.config.status&this.reportConstValue.canvasStatus.moveable))if(this.config.status&this.reportConstValue.canvasStatus.resizable){if(i=$(t.target),i=i.closest("[data-controltype]"),!i||i.length==0)return;if(u=i.attr("id"),f=this.getEntityById(u),!f)return;if(r=this.getItemById(u,{action:this.reportConstValue.shapeStatus.resizable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each"}),!r)return;r.ON_FOCUSOUT(t);this.customTriggerEvent("drawingPaper.endEdit",{id:i.attr("id"),controlType:f.getDataProperty("controlType")})}else if(this.config.status&this.reportConstValue.canvasStatus.editable){if(this.addDataInHistory(),i=$(t.target),i=i.closest("[data-controltype]"),!i||i.length==0)return;var u=i.attr("id"),e=this.instanceManager.clipboardInstance,r=this.getItemById(u,{action:this.reportConstValue.shapeStatus.editable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each",remainEditable:e&&(e.isCopying()||e.isPasting())});if(!r)return;r.ON_FOCUSOUT(t)}else if(this.config.status&this.reportConstValue.canvasStatus.editing){if(this.addDataInHistory(),i=$(t.target),i=i.closest("[data-controltype]"),!i||i.length==0)return;if(u=i.attr("id"),f=this.getEntityById(u),!f)return;if(e=this.instanceManager.clipboardInstance,r=this.getItemById(u,{action:this.reportConstValue.shapeStatus.editing,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each",remainEditable:e&&(e.isCopying()||e.isPasting())}),!r)return;r.ON_FOCUSOUT(t);this.config.dropdownmenu.serviceKey&&this.config.dropdownmenu.serviceKeyType=="mappingData"&&ecount.global.setTimeout(this.ecPageID,function(){ecount.layer.removeLayer(this.config.dropdownmenu.serviceKey);this.config.dropdownmenu.serviceKey=null}.bind(this),200);this.config.dropdownmenu.serviceKeyType=null;this.customTriggerEvent("drawingPaper.endEdit",{id:i.attr("id"),controlType:f.getDataProperty("controlType")})}else if(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth){if(i=$(t.target),i=i.closest("[data-controltype]"),!i||i.length==0)return;if(u=i.attr("id"),f=this.getEntityById(u),!f)return;if(r=this.getItemById(u,{action:this.reportConstValue.shapeStatus.resizableCellWidth,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each"}),!r)return;r.ON_FOCUSOUT(t);this.config.dropdownmenu.serviceKey&&this.config.dropdownmenu.serviceKeyType=="mappingData"&&ecount.global.setTimeout(this.ecPageID,function(){ecount.layer.removeLayer(this.config.dropdownmenu.serviceKey);this.config.dropdownmenu.serviceKey=null}.bind(this),200);this.config.dropdownmenu.serviceKeyType=null;this.customTriggerEvent("drawingPaper.endEdit",{id:i.attr("id"),controlType:f.getDataProperty("controlType")})}else if(this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight){if(i=$(t.target),i=i.closest("[data-controltype]"),!i||i.length==0)return;if(u=i.attr("id"),f=this.getEntityById(u),!f)return;if(r=this.getItemById(u,{action:this.reportConstValue.shapeStatus.resizableCellHeight,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each"}),!r)return;r.ON_FOCUSOUT(t);this.customTriggerEvent("drawingPaper.endEdit",{id:i.attr("id"),controlType:f.getDataProperty("controlType")})}this.constValue.isIE||this.removeAllRanges()}},ON_KEYDOWN:function(n,t,i,r){var u,o,s,f,e;if(this.config.mode!=this.reportConstValue.mode.view&&!this.config.cancelEvent&&!this.config.cancelEvent){if(u=t.which||t.keyCode,!this.config.active){t.ctrlKey&&u==this.constValue.keyCode.Z?this.undo():t.ctrlKey&&u==this.constValue.keyCode.Y&&this.redo();return}if(o=this.instanceManager.clipboardInstance,this.$wrapperEl.is(":visible")){if(s=$(t.target),this.config.status&this.reportConstValue.canvasStatus.selectable){if(t.ctrlKey&&u==this.constValue.keyCode.Z){this.undo();return}if(t.ctrlKey&&u==this.constValue.keyCode.Y){this.redo();return}}else if(this.config.status&this.reportConstValue.canvasStatus.editable){if(t.ctrlKey&&u==this.constValue.keyCode.Z){this.addDataInHistory();this.undo();return}if(t.ctrlKey&&u==this.constValue.keyCode.Y){this.redo();return}}else if(this.config.status&this.reportConstValue.canvasStatus.editing){if(t.ctrlKey&&u==this.constValue.keyCode.Z){t.preventDefault();this.addDataInHistory();this.undo();return}if(t.ctrlKey&&u==this.constValue.keyCode.Y){t.preventDefault();this.redo();return}}if(this.config.active&&!this.config.keyEventPreventDefault){if(f=function(){var s,f,o,h,c,e;if(u==this.constValue.keyCode.SPACE||u==this.constValue.keyCode.BACKSPACE||u==this.constValue.keyCode.DELETE)for(f=0,o=this.collection.list.length;f<o;f++)(e=this.getItemById(this.collection.list[f].id,{action:this.reportConstValue.shapeStatus.editable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"}),e)&&e.ON_KEYDOWN(n,t,i,r);else{if(this.constValue.isIE&&t.ctrlKey&&u==this.constValue.keyCode.C)return ecount.global.setTimeout(this.ecPageID,function(){var u=this.instanceManager.clipboardInstance;u&&!u.isCopying()&&this.copyClipboard(n,t,i,r)}.bind(this)),!1;if(this.constValue.isIE&&t.ctrlKey&&u==this.constValue.keyCode.X)return ecount.global.setTimeout(this.ecPageID,function(){var u=this.instanceManager.clipboardInstance;u&&!u.isCopying()&&this.cutClipboard(n,t,i,r)}.bind(this)),!1;if(this.constValue.isIE&&t.ctrlKey&&u==this.constValue.keyCode.V)return ecount.global.setTimeout(this.ecPageID,function(){var u=this.instanceManager.clipboardInstance;u&&!u.isPasting()&&this.pasteClipboard(n,t,i,r)}.bind(this)),!1;if(s=this.getElementByRange(),s){var l=s.attr("id"),a=s.attr("data-controltype"),e=this.getItemById(l,{action:this.reportConstValue.shapeStatus.editable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"});if(!e)return;["ecount.report.shape.table","ecount.report.shape.rectangle","ecount.report.shape.textbox"].contains(a)&&e.ON_KEYDOWN(n,t,i,r)}else for(f=0,o=this.collection.list.length;f<o;f++)if((h=this.getEntityById(this.collection.list[f].id),h)&&(c=h.getDataProperty("controlType"),e=this.getItemById(this.collection.list[f].id,{action:this.reportConstValue.shapeStatus.editable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"}),e)&&["ecount.report.shape.table","ecount.report.shape.rectangle","ecount.report.shape.textbox"].contains(c)){e.ON_KEYDOWN(n,t,i,r);break}this.instanceManager.dragableInstance.unbindMousemoveEvent();this.instanceManager.dragableInstance.unbindMouseupEvent()}[this.constValue.keyCode.DELETE,this.constValue.keyCode.BACKSPACE].contains(u)&&(this.checkPaperMinHeight(),this.removeTooltip());this.addDataInHistory({delay:2e3})}.bind(this),e=function(){var a=!0,h,o,s,l,e,c,f;if([this.constValue.keyCode.UP_ARROW,this.constValue.keyCode.DOWN_ARROW,this.constValue.keyCode.LEFT_ARROW,this.constValue.keyCode.RIGHT_ARROW,this.constValue.keyCode.DELETE].contains(u)){if(!this.notExistPositionCollectionItem()){this.confirmMovePositionCollectionItem();return}for(h=_.clone(this.collection.list),e=0,c=h.length;e<c;e++)(f=this.getItemById(h[e].id,{action:this.reportConstValue.shapeStatus.resizable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each",documentEvidence:this.isDocumentEvidence}),f)&&(f.ON_KEYDOWN(n,t,i,r),h[e]&&this.updateElementPoint({targetId:h[e].id}),[this.constValue.keyCode.B,this.constValue.keyCode.U,this.constValue.keyCode.I,this.constValue.keyCode.DELETE].contains(u)&&a&&t.preventDefault(),a=!1)}else if(u==this.constValue.keyCode.BACKSPACE)if(this.collection.list.length==1){for(e=0,c=this.collection.list.length;e<c;e++)(o=this.getEntityById(this.collection.list[e].id),o)&&(s=o.getDataProperty("controlType"),l=o.getDataProperty("container"),f=this.getActionInstance(s),f)&&(f.setConfig(_.extend(this.getDefaultConfig(),{action:this.reportConstValue.shapeStatus.resizable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"})),f.$parent!==l&&(this.isResetCanvasBoundingClientRect(s)&&(f.resetCanvasBoundingClientRect(),this.setResetCanvasBoundingClientRect(!1,s)),f.setCanvas(this.$wrapperEl),f.setParent(l),f.setEntity(o),f.setParentId(o.parentId),f.setChildren(o.children),f.setTableStructure&&f.setTableStructure(this.instanceManager.tableStructure),f.setTableResize&&f.setTableResize(this.instanceManager.tableResize),f.setTableSelector&&f.setTableSelector(this.instanceManager.tableSelector),f.bindTextContainerMousedown&&f.bindTextContainerMousedown(),f.bindTextContainerDBLClick&&f.bindTextContainerDBLClick(),f.bindTextContainerFocusout&&f.bindTextContainerFocusout(),f.bindTextContainerDragStart&&f.bindTextContainerDragStart()),f.ON_KEYDOWN(n,t,i,r));o&&["ecount.report.shape.table","ecount.report.shape.rectangle","ecount.report.shape.textbox"].contains(s)&&(f.isEditable()?(this.customTriggerEvent("drawingPaper.beginEdit",{id:o.id,controlType:s}),this.setStatus(this.reportConstValue.canvasStatus.editing),this.setEditableId(o.id)):(t.preventDefault(),n.cancelBubbled=!0))}else{for(h=_.clone(this.collection.list),e=0,c=h.length;e<c;e++)(f=this.getItemById(h[e].id,{action:this.reportConstValue.shapeStatus.resizable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"}),f)&&(f.ON_KEYDOWN(n,t,i,r),h[e]&&this.updateElementPoint({targetId:h[e].id}));t.preventDefault();n.cancelBubbled=!0}else{if(this.constValue.isIE&&t.ctrlKey&&u==this.constValue.keyCode.C)return ecount.global.setTimeout(this.ecPageID,function(){var u=this.instanceManager.clipboardInstance;u&&!u.isCopying()&&this.copyClipboard(n,t,i,r)}.bind(this)),!1;if(this.constValue.isIE&&t.ctrlKey&&u==this.constValue.keyCode.X)return ecount.global.setTimeout(this.ecPageID,function(){var u=this.instanceManager.clipboardInstance;u&&!u.isCopying()&&this.cutClipboard(n,t,i,r)}.bind(this)),!1;if(this.constValue.isIE&&t.ctrlKey&&u==this.constValue.keyCode.V)return ecount.global.setTimeout(this.ecPageID,function(){var u=this.instanceManager.clipboardInstance;u&&!u.isPasting()&&this.pasteClipboard(n,t,i,r)}.bind(this)),!1;if(t.ctrlKey&&u==this.constValue.keyCode.Z)this.undo();else if(t.ctrlKey&&u==this.constValue.keyCode.Y)this.redo();else if(this.collection.list.length==1){for(e=0,c=this.collection.list.length;e<c;e++)(o=this.getEntityById(this.collection.list[e].id),o)&&(s=o.getDataProperty("controlType"),l=o.getDataProperty("container"),f=this.getActionInstance(s),f)&&(f.setConfig(_.extend(this.getDefaultConfig(),{action:this.reportConstValue.shapeStatus.resizable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"})),f.$parent!==l&&(this.isResetCanvasBoundingClientRect(s)&&(f.resetCanvasBoundingClientRect(),this.setResetCanvasBoundingClientRect(!1,s)),f.setCanvas(this.$wrapperEl),f.setParent(l),f.setEntity(o),f.setParentId(o.parentId),f.setChildren(o.children),f.setTableStructure&&f.setTableStructure(this.instanceManager.tableStructure),f.setTableResize&&f.setTableResize(this.instanceManager.tableResize),f.setTableSelector&&f.setTableSelector(this.instanceManager.tableSelector),f.bindTextContainerMousedown&&f.bindTextContainerMousedown(),f.bindTextContainerDBLClick&&f.bindTextContainerDBLClick(),f.bindTextContainerFocusout&&f.bindTextContainerFocusout(),f.bindTextContainerDragStart&&f.bindTextContainerDragStart()),f.ON_KEYDOWN(n,t,i,r));o&&["ecount.report.shape.table","ecount.report.shape.rectangle","ecount.report.shape.textbox"].contains(s)&&f.isEditable()&&(this.customTriggerEvent("drawingPaper.beginEdit",{id:o.id,controlType:s}),this.setStatus(this.reportConstValue.canvasStatus.editing),this.setEditableId(o.id))}}[this.constValue.keyCode.DELETE,this.constValue.keyCode.BACKSPACE].contains(u)&&(this.addDataInHistory(),this.cloneCollectionData(),this.clearCollection("shape"),this.checkPaperMinHeight())}.bind(this),this.config.status&this.reportConstValue.canvasStatus.moveable&&this.config.status&this.reportConstValue.canvasStatus.editable)t.shiftKey||t.altKey||t.ctrlKey||(f(),this.setStatus(this.reportConstValue.canvasStatus.editable));else{if(this.config.status&this.reportConstValue.canvasStatus.selectable)return e();this.config.status&this.reportConstValue.canvasStatus.drawable||this.config.status&this.reportConstValue.canvasStatus.moveable||this.config.status&this.reportConstValue.canvasStatus.resizable||(this.config.status&this.reportConstValue.canvasStatus.editable?f():this.config.status&this.reportConstValue.canvasStatus.editing&&f())}if(n.cancelBubbled)return!1}}}},ON_KEYPRESS:function(n,t){var u,r,i,f;if(this.config.mode!=this.reportConstValue.mode.view&&this.config.active&&!this.config.cancelEvent)if(u=t.which||t.keyCode,r=this.instanceManager.clipboardInstance,this.config.status&this.reportConstValue.canvasStatus.selectable){if(t.ctrlKey&&u==this.constValue.keyCode.V){if(!r)return;if(i=r.get(),!i)return;i.type=="shape"&&(f=$(i.value),f.each(function(n,t){var r=$(t),i=r.find("[data-controltype]"),u,f;i.length==1&&(u=i.attr("data-controltype")||"",f=ecount.common.uuid(this.reportConstValue.defaultCanvasConfig.prefixId[u]),i.attr("id",f),this.$wrapperEl.append(r))}.bind(this)))}}else this.config.status&this.reportConstValue.canvasStatus.drawable||this.config.status&this.reportConstValue.canvasStatus.moveable||this.config.status&this.reportConstValue.canvasStatus.resizable||this.config.status&this.reportConstValue.canvasStatus.editable},ON_KEYUP:function(n,t,i,r){var o,u,e,f;if(this.config.mode!=this.reportConstValue.mode.view&&this.config.active&&!this.config.cancelEvent&&!this.config.keyEventPreventDefault){if(o=t.which||t.keyCode,!(this.config.status&this.reportConstValue.canvasStatus.selectable)&&!(this.config.status&this.reportConstValue.canvasStatus.drawable)&&!(this.config.status&this.reportConstValue.canvasStatus.moveable)&&!(this.config.status&this.reportConstValue.canvasStatus.resizable))if(this.config.status&this.reportConstValue.canvasStatus.editable){if(this.config.editableId){if(u=this.getEntityById(this.config.editableId),!u)return;if(e=u.getDataProperty("controlType"),f=this.getItemById(this.config.editableId,{action:this.reportConstValue.shapeStatus.editable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each"}),!f)return;f.ON_KEYUP(t);this.config.isSyncFont&&(this.triggerEvent("drawingPaper.font",n,t,i,r),this.triggerEvent("drawingPaper.shape",n,t,i,r));e=="ecount.report.shape.table"&&this.triggerEvent("drawingPaper.layout",n,t,i,r)}}else if(this.config.status&this.reportConstValue.canvasStatus.editing&&this.config.editableId){if(u=this.getEntityById(this.config.editableId),!u)return;if(e=u.getDataProperty("controlType"),f=this.getItemById(this.config.editableId,{action:this.reportConstValue.shapeStatus.editable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each"}),!f)return;f.ON_KEYUP(t);this.config.isSyncFont&&(this.triggerEvent("drawingPaper.font",n,t,i,r),[ecount.constValue.keyCode.LEFT_ARROW,ecount.constValue.keyCode.RIGHT_ARROW,ecount.constValue.keyCode.UP_ARROW,ecount.constValue.keyCode.DOWN_ARROW].contains(o)&&ecount.global.setTimeout(this.ecPageID,function(){this.triggerEvent("drawingPaper.shape",n,t,i,r)}.bind(this)));u&&e=="ecount.report.shape.table"&&this.triggerEvent("drawingPaper.layout",n,t,i,r)}this.resizeHandler();[this.constValue.keyCode.UP_ARROW,this.constValue.keyCode.DOWN_ARROW,this.constValue.keyCode.LEFT_ARROW,this.constValue.keyCode.RIGHT_ARROW].contains(o)&&this.addDataInHistory()}},_ON_SCROLL:function(n,t,i,r){this.config.mode!=this.reportConstValue.mode.view&&(this.config.cancelEvent||this.ON_SCROLL(n,t,i,r))},ON_SCROLL:function(){this.config.mode!=this.reportConstValue.mode.view&&(this.config.cancelEvent||(this.config.dropdownmenu.serviceKey&&(ecount.layer.removeLayer(this.config.dropdownmenu.serviceKey),this.config.dropdownmenu.serviceKey=null),this.config.dropdownmenu.serviceKeyType=null,this.config.eventContainerBoundingClientRect=null,this.setResetCanvasBoundingClientRect(!0)))},ON_COPY:function(){},ON_DOCUMENT_COPY:function(n,t,i,r){var u,e,f;if(!ecount.isMobile)return this.config.mode==this.reportConstValue.mode.view?void 0:this.config.active?this.config.cancelEvent?void 0:this._focusCopyClipboard?void 0:this.config.keyEventPreventDefault?void 0:(u=this._range.getRange(),e=u&&!this.$el.find(u.commonAncestorContainer).length,e)?void 0:(f=this.instanceManager.clipboardInstance,f&&f.isCopying())?void 0:(this.copyClipboard(n,t,i,r),this.stopPropagation(n),this.preventDefault(n),!1):void 0},ON_PASTE:function(n){ecount.isMobile||(this.stopPropagation(n),this.preventDefault(n))},ON_DOCUMENT_PASTE:function(n,t,i,r){if(!ecount.isMobile&&this.config.mode!=this.reportConstValue.mode.view&&this.config.active&&!this.config.cancelEvent&&!this.config.keyEventPreventDefault){var u=this.instanceManager.clipboardInstance;u&&u.isPasting()||(this.pasteClipboard(n,t,i,r),this.stopPropagation(n),this.preventDefault(n))}},ON_CUT:function(){},ON_DOCUMENT_CUT:function(n,t,i,r){if(!ecount.isMobile)return this.config.mode==this.reportConstValue.mode.view?void 0:this.config.active?this.config.cancelEvent?void 0:this.config.keyEventPreventDefault?void 0:(this.cutClipboard(n,t,i,r),this.stopPropagation(n),this.preventDefault(n),!1):void 0},ON_DRAG_START:function(n,t,i,r){r||(r={});ecount.isMobile?(r.touchstartHandler||(r.touchstartHandler=this.ON_TOUCHSTART.bind(this)),r.touchmoveHandler||(r.touchmoveHandler=this.ON_DRAG_TOUCHMOVE.bind(this)),r.touchendHandler||(r.touchendHandler=this.ON_DRAG_TOUCHEND.bind(this))):(r.mousedownHandler||(r.mousedownHandler=this.ON_DRAG_MOUSEDOWN.bind(this)),r.mousemoveHandler||(r.mousemoveHandler=this.ON_DRAG_MOUSEMOVE.bind(this)),r.mouseupHandler||(r.mouseupHandler=this.ON_DRAG_MOUSEUP.bind(this)));r.isAttachMousemoveEvent&&!r.attachMousemoveElement&&(r.attachMousemoveElement=this.config.dragMouseMoveSelector?$(this.config.dragMouseMoveSelector):this.$wrapperEl);r.isAttachMouseupEvent&&!r.attachMouseupElement&&(r.attachMouseupElement=this.config.dragMouseUpSelector?$(this.config.dragMouseUpSelector):this.$wrapperEl);this.instanceManager.dragableInstance.init().setConfig(_.extend(this.getDefaultConfig(),r)).setElement(r.container);ecount.isMobile?this.instanceManager.dragableInstance.ON_TOUCHSTART(t):this.instanceManager.dragableInstance.ON_MOUSEDOWN(t)},ON_DRAG_MOUSEDOWN:function(n,t){var i,f,s,e;this.mousedownPoint=ecount.common.getEventPoint(t);n=n||{};n.mousePoint=this.mousedownPoint;var r=$(t.target),h=r.hasClass(this.reportConstValue.resizerSelector),c=r.hasClass(this.reportConstValue.moveableTopSelector)||r.hasClass(this.reportConstValue.moveableBottomSelector)||r.hasClass(this.reportConstValue.moveableLeftSelector)||r.hasClass(this.reportConstValue.moveableRightSelector),u,o;if(h||c){if(u=this.getEntityById(r.closest(this.reportConstValue.lineHandlerPrefix+this.reportConstValue.lineHandlerSelector).attr("data-refid")),!u)return;o=u.getDataProperty("el")}else o=r.hasClass(this.reportConstValue.containerSelector)?r.find("[data-controltype]:first"):r.hasClass(this.reportConstValue.contentDefaultClass)?r.find("[data-controltype]"):r.closest("[data-controltype]"),u=this.getEntityById(o.attr("id"));if(!(this.config.status&this.reportConstValue.canvasStatus.selectable))if(this.config.status&this.reportConstValue.canvasStatus.drawable)this.addNoselectionInBody();else if(this.config.status&this.reportConstValue.canvasStatus.moveable)this.addNoselectionInBody(),u.isManagedShapeByEntity()&&!ecount.isMobile&&(i=this.getActionInstance("smartGuideManager"),i&&(i.setCanvas(this.$wrapperEl),i.setCanvasPosition(),i.setConfig({action:this.reportConstValue.shapeStatus.drawable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,elementSelector:"[data-controltype]",containerSelector:this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector,selectedElementSelector:this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector+this.reportConstValue.resizerSelectPrefix+this.reportConstValue.resizerSelectSelector,scrollContainer:this.scrollContainer}),i.setEntity(this.entityTree.getEntities()),this.isResetCanvasBoundingClientRect("smartGuideManager")&&(i.resetCanvasBoundingClientRect(),this.setResetCanvasBoundingClientRect(!1,"smartGuideManager")),i.ON_MOUSEDOWN(n,t))),this.config.isCloneShape=!0;else if(this.config.status&this.reportConstValue.canvasStatus.resizable)for(this.addNoselectionInBody(),u.isManagedShapeByEntity()&&(i=this.getActionInstance("smartGuideManager"),i&&(i.setCanvas(this.$wrapperEl),i.setCanvasPosition(),i.setConfig({action:this.reportConstValue.shapeStatus.resizable,resizeType:this.config.resizeType,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,elementSelector:"[data-controltype]",containerSelector:this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector,selectedElementSelector:this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector+this.reportConstValue.resizerSelectPrefix+this.reportConstValue.resizerSelectSelector,scrollContainer:this.scrollContainer}),i.setEntity(this.entityTree.getEntities()),this.isResetCanvasBoundingClientRect("smartGuideManager")&&(i.resetCanvasBoundingClientRect(),this.setResetCanvasBoundingClientRect(!1,"smartGuideManager")),i.ON_MOUSEDOWN(n,t))),this.config.resizingRatios={},f=0,s=this.collection.list.length;f<s;f++)(e=this.getItemById(this.collection.list[f].id,{action:this.reportConstValue.shapeStatus.resizable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"}),e)&&(n.targetSelector="#"+this.collection.list[f].id,e.ON_MOUSEDOWN(n,t),this.config.resizingRatios[this.collection.list[f].id]=e.getHeight()/e.getWidth());else this.config.status&this.reportConstValue.canvasStatus.editable||(this.config.status&this.reportConstValue.canvasStatus.resizingCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizingCellHeight)&&(this.addNoselectionInBody(),this.actionInstanceManager.resizeTableActionInstance&&this.actionInstanceManager.resizeTableActionInstance.ON_MOUSEDOWN(t))},ON_DRAG_MOUSEMOVE:function(n){var a,y,e,c,b,v,i,f,r,s,o,u,t;if(!(this.config.status&this.reportConstValue.canvasStatus.selectable)&&!(this.config.status&this.reportConstValue.canvasStatus.drawable))if(this.config.status&this.reportConstValue.canvasStatus.mouseDrawing){if(t=this.getActionInstance(this.config.drawShapeType),!t)return;t.ON_MOUSEMOVE({},n,{},{})}else if(this.config.status&this.reportConstValue.canvasStatus.moveable){if(a=ecount.common.getDistancePoint(this.mousedownPoint,{x:n.clientX,y:n.clientY}),y=Math.abs(a.x)>10||Math.abs(a.y)>10,y){for(i=0,f=this.collection.list.length;i<f;i++)if(e=this.getEntityById(this.collection.list[i].id),e){var u=e.getDataProperty("controlType"),h=e.getDataProperty("container"),t=this.getActionInstance(u);t&&(t.setAction(this.reportConstValue.shapeStatus.moving),h.css({"z-index":parseInt(h.css("z-index"),10)+this.reportConstValue.defaultMovingZIndex}))}this.setStatus(this.reportConstValue.canvasStatus.moving)}}else if(this.config.status&this.reportConstValue.canvasStatus.moving)if(this.notExistPositionCollectionItem()===!0){if(this.config.isCloneShape){for(i=0,f=this.collection.list.length;i<f;i++)if(e=this.getEntityById(this.collection.list[i].id),e){var u=e.getDataProperty("controlType"),h=e.getDataProperty("container"),t=this.getItemById(this.collection.list[i].id);n.ctrlKey&&t&&(u=="ecount.report.shape.table"?(this.isResetCanvasBoundingClientRect(u)&&(t.resetCanvasBoundingClientRect(),this.setResetCanvasBoundingClientRect(!1,u)),t.setCanvas(this.$wrapperEl),t.setParent(h),t.setTableStructure(this.instanceManager.tableStructure),t.clone()):(this.isResetCanvasBoundingClientRect(u)&&(t.resetCanvasBoundingClientRect(),this.setResetCanvasBoundingClientRect(!1,u)),t.setCanvas(this.$wrapperEl),t.setParent(h),t.clone()))}this.config.isCloneShape=!1}for(i=0,f=this.collection.list.length;i<f;i++)(c=this.$wrapperEl.find("#"+this.collection.list[i].id),c.length!=0)&&(t=this.getItemById(this.collection.list[i].id),t)&&(b=this.reportConstValue.areaselectWidth*-1,r={x:n.clientX,y:n.clientY},ecount.isMobile&&(v=n.originalEvent.touches[0],r.x=v.clientX,r.y=v.clientY),n.shiftKey&&(Math.abs(this.mousedownPoint.x-r.x)>Math.abs(this.mousedownPoint.y-r.y)?r.y=this.mousedownPoint.y:r.x=this.mousedownPoint.x),t.ON_MOUSEMOVE({},n,{},{initPoint:this.collection.list[i].mousedownElementPoint,fromPoint:this.mousedownPoint,toPoint:r}));ecount.isMobile||(o=this.getActionInstance("smartGuideManager"),o&&(o.setCanvas(this.$wrapperEl),o.ON_MOUSEMOVE({},n,{},{})))}else this.instanceManager.dragableInstance.unbindEvent(),this.confirmMovePositionCollectionItem();else if(this.config.status&this.reportConstValue.canvasStatus.resizable||this.config.status&this.reportConstValue.canvasStatus.resizing)if(this.config.status&this.reportConstValue.canvasStatus.resizable&&this.setStatus(this.reportConstValue.canvasStatus.resizing),this.notExistPositionCollectionItem()===!0){for(i=0,f=this.collection.list.length;i<f;i++)if(t=this.getItemById(this.collection.list[i].id),t){if(r={x:n.clientX,y:n.clientY},n.shiftKey&&this.config.resizingRatios[this.collection.list[i].id]){s=this.config.resizingRatios[this.collection.list[i].id];switch(this.config.resizeType){case"nw":r.y=this.mousedownPoint.y+(r.x-this.mousedownPoint.x)*s;break;case"ne":r.y=this.mousedownPoint.y-(r.x-this.mousedownPoint.x)*s;break;case"sw":r.y=this.mousedownPoint.y-(r.x-this.mousedownPoint.x)*s;break;case"se":r.y=this.mousedownPoint.y+(r.x-this.mousedownPoint.x)*s}}t.setConfig(_.extend(this.getDefaultConfig(),{action:this.reportConstValue.shapeStatus.none,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"}));t.resizing(this.collection.list[i].mousedownElementPoint,this.collection.list[i].mousedownElementSize,this.mousedownPoint,r);t.ON_MOUSEMOVE({},n,{},{})}o=this.getActionInstance("smartGuideManager");o&&(o.setCanvas(this.$wrapperEl),o.ON_MOUSEMOVE({},n,{},{}))}else this.instanceManager.dragableInstance.unbindEvent(),this.confirmMovePositionCollectionItem();else if(this.config.status&this.reportConstValue.canvasStatus.editable){var p=n.target,c=$(p),l=c.closest("[data-controltype]"),w=l.attr("id");if(this.config.editableId&&this.config.editableId==w){if(u=l.attr("data-controltype"),t=this.getActionInstance(u),!t)return;t.setAction(this.reportConstValue.shapeStatus.dragingCell);t.ON_MOUSEMOVE({},n,{},{})}}else if(this.config.status&this.reportConstValue.canvasStatus.editing){var p=n.target,c=$(p),l=c.closest("[data-controltype]"),w=l.attr("id");if(this.config.editableId&&this.config.editableId==w){if(u=l.attr("data-controltype"),t=this.getActionInstance(u),!t)return;t.setAction(this.reportConstValue.shapeStatus.dragingCell);t.ON_MOUSEMOVE({},n,{},{})}}else(this.config.status&this.reportConstValue.canvasStatus.resizingCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizingCellHeight)&&this.actionInstanceManager.resizeTableActionInstance&&this.actionInstanceManager.resizeTableActionInstance.ON_MOUSEMOVE({},n,{},{})},ON_DRAG_MOUSEUP:function(n){var c,l,a,o,h,u,s,r,f,t,e,i;if(!(this.config.status&this.reportConstValue.canvasStatus.selectable))if(this.config.status&this.reportConstValue.canvasStatus.drawable)for(t=0,e=this.collection.list.length;t<e;t++){var i=this.$wrapperEl.find("#"+this.collection.list[t].id),s=i.attr("data-controltype"),r=this.getActionInstance(s);r&&r.ON_MOUSEUP({},n,{},{})}else if(this.config.status&this.reportConstValue.canvasStatus.mouseDrawing){if(r=this.getActionInstance(this.config.drawShapeType),!r)return;r.ON_MOUSEUP({},n,{},{})}else if(!(this.config.status&this.reportConstValue.canvasStatus.moveable))if(this.config.status&this.reportConstValue.canvasStatus.moving){for(h=this.isChildOfLayoutContainer(n.target),t=0,e=this.collection.list.length;t<e;t++)(i=this.$wrapperEl.find("#"+this.collection.list[t].id),i.length!=0)&&(u=i.closest(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),u.length!=0)&&(s=i.attr("data-controltype"),r=this.getActionInstance(s),r)&&(c=parseInt(u.css("z-index"),10),c>this.reportConstValue.defaultMovingZIndex&&u.css({"z-index":c-this.reportConstValue.defaultMovingZIndex}),l=_.parseInt(u.css("left"),10),a=_.parseInt(u.css("top"),10),h||(o=this.collection.list[t].mousedownElementPoint,o&&(a=o.y,l=o.x,u.css({top:o.y+"px"}),u.css({left:o.x+"px"}))),this.collection.list[t].mousedownElementPoint.x=l,this.collection.list[t].mousedownElementPoint.y=a,r.syncLineHandlerPosition(),this.resizeHandler({targetId:i.attr("id")}));ecount.isMobile||(f=this.getActionInstance("smartGuideManager"),f&&(f.setCanvas(this.$wrapperEl),f.ON_MOUSEUP({},n,{},{}),f.setConfig({action:this.reportConstValue.shapeStatus.none})))}else if(this.config.status&this.reportConstValue.canvasStatus.resizable||this.config.status&this.reportConstValue.canvasStatus.resizing){for(h=this.isChildOfLayoutContainer(n.target),t=0,e=this.collection.list.length;t<e;t++)(i=this.$wrapperEl.find("#"+this.collection.list[t].id),i&&i.length!=0)&&(u=i.closest(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),u&&u.length!=0)&&(s=i.attr("data-controltype"),r=this.getActionInstance(s),r)&&(r.setParent(u),r.resized&&r.resized({isValid:h,initPoint:this.collection.list[t].mousedownElementPoint,initSize:this.collection.list[t].mousedownElementSize}),r.ON_MOUSEUP({},n,{},{}),this.collection.list[t].mousedownElementSize=this.getElementSize(i[0]),this.collection.list[t].mousedownElementPoint=this.getElementPoint(i[0],!0,!0,{isIgnoreBorder:!0},u[0]),this.resizeHandler({targetId:i.attr("id")}));f=this.getActionInstance("smartGuideManager");f&&(f.setCanvas(this.$wrapperEl),f.ON_MOUSEUP({},n,{},{}),f.setConfig({action:this.reportConstValue.shapeStatus.none}));this.triggerEvent("drawingPaper.layout",null,n,null,{})}else if(!(this.config.status&this.reportConstValue.canvasStatus.editable)&&(this.config.status&this.reportConstValue.canvasStatus.resizingCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizingCellHeight)){for(this.actionInstanceManager.resizeTableActionInstance&&this.actionInstanceManager.resizeTableActionInstance.ON_MOUSEUP({},n,{},{}),t=0,e=this.collection.list.length;t<e;t++)(i=this.$wrapperEl.find("#"+this.collection.list[t].id),i&&i.length!=0)&&(this.updateElementSize({targetId:i.attr("id")}),this.updateElementPoint({targetId:i.attr("id")}));this.actionInstanceManager.resizeTableActionInstance=null}this.mousedownPoint=null;this.mousemovePoint=null;this.config.resizingRatios=null;this.removeNoselectionInBody()},isChildOfLayoutContainer:function(n){var i=this.getLayoutContainer(),t=i.find(n);return!!(t&&t.length>0)},ON_TOUCHSTART:function(n,t){var r=$(t.target),i,u;r&&(i=this.getEntityById(r.attr("id")),i)&&(u=i.getDataProperty("controlType"),u===this.reportConstValue.shapeType.sign&&($(this.scrollContainer).css("overflow","hidden"),this.ON_DRAG_MOUSEDOWN(n,t)))},ON_DRAG_TOUCHMOVE:function(n){var u=$(n.target),t,i,r;u&&(t=this.getEntityById(u.attr("id")),t)&&(i=t.getDataProperty("controlType"),i===this.reportConstValue.shapeType.sign&&(r=this.getActionInstance(i),r&&(this.mousedownPoint||(this.mousedownPoint=ecount.common.getEventPoint(n.originalEvent.touches[0])),this.setStatus(this.reportConstValue.canvasStatus.moving),r.setConfig(_.extend(this.getDefaultConfig(),{action:this.reportConstValue.shapeStatus.moving})),$(this.scrollContainer).css("overflow","hidden"),this.ON_DRAG_MOUSEMOVE(n))))},ON_DRAG_TOUCHEND:function(n){var i=$(n.target),t,r;return i?(t=this.getEntityById(i.attr("id")),$(this.scrollContainer).css("overflow","auto"),!t)?(this.setStatus(this.reportConstValue.canvasStatus.selectable),!0):(r=t.getDataProperty("controlType"),r===this.reportConstValue.shapeType.sign?(this.ON_DRAG_MOUSEUP(n),!1):void 0):!0},_ON_MOUSEMOVE_SERVICE:function(){},_ON_MOUSEUP_SERVICE:function(n,t,i,r){n.ecService=="outline"&&this.ON_MOUSEUP(n,t,i,r)},onMouseDownLeft:function(n,t,i,r){var o={isAttachMousemoveEvent:!0,attachMousemoveElement:this.config.dragMouseMoveSelector?$(this.config.dragMouseMoveSelector):this.$wrapperEl,isAttachMouseupEvent:!0,attachMouseupElement:this.config.dragMouseUpSelector?$(this.config.dragMouseUpSelector):this.$wrapperEl,dragableSelector:this.reportConstValue.dragPrefix+this.reportConstValue.dragSelector,containerSelector:this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector,mousedownHandler:this.ON_DRAG_MOUSEDOWN.bind(this),mousemoveHandler:this.ON_DRAG_MOUSEMOVE.bind(this),mouseupHandler:this.ON_DRAG_MOUSEUP.bind(this)},s,g,nt,ot,st,d,ht,b,a,w,tt,it,f;n.mousePoint=ecount.common.getEventPoint(t);var rt=t.target,c=$(rt),v=c.hasClass(this.reportConstValue.resizerSelector),y=c.hasClass(this.reportConstValue.moveableTopSelector)||c.hasClass(this.reportConstValue.moveableBottomSelector)||c.hasClass(this.reportConstValue.moveableLeftSelector)||c.hasClass(this.reportConstValue.moveableRightSelector),p=v&&rt.className.match(this.reportConstValue.regExpResize),s,ct,l=null,h=null,k=null,e,u,f,ut,ft=!0,et="";if(console.log("MOUSEDOWN LEFT status: %s",this.config.status),this.config.status&this.reportConstValue.canvasStatus.drawable||(v||y?(f=this.getEntityById(c.closest(this.reportConstValue.lineHandlerPrefix+this.reportConstValue.lineHandlerSelector).attr("data-refid")),l=f.getDataProperty("el")):(c.hasClass(this.reportConstValue.containerSelector)?l=c.find("[data-controltype]:first"):c.hasClass(this.reportConstValue.contentDefaultClass)?l=c.find("[data-controltype]"):(l=c.closest("[data-controltype]"),l.length||(s=c.closest(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),l=s.find("[data-controltype]:first"))),f=this.getEntityById(l.attr("id"))),!f||f.isManagedShapeByEntity()?(s=l.closest(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),ct,h=s.find(this.reportConstValue.dragPrefix+this.reportConstValue.dragSelector),k=l,e=h&&h.attr("id")||k.attr("id")):(s=l.parent(),h=v||!v&&!y?l:null,k=l,e=h&&h.attr("id")||k.attr("id")),ut=h&&h.attr("data-controltype")||k.attr("data-controltype"),y||(y=ut==this.reportConstValue.shapeType.rectangle&&c.hasClass(this.reportConstValue.dragSelector)),y&&(this.setStatus(this.reportConstValue.canvasStatus.selectable),f&&(f.isManagedShapeByEntity()||(y=!1)))),this.isDocumentEvidence&&(this.config.status==(this.reportConstValue.canvasStatus.selectable|this.reportConstValue.canvasStatus.resizableCellWidth)||this.config.status==(this.reportConstValue.canvasStatus.selectable|this.reportConstValue.canvasStatus.resizableCellHeight)||this.config.status==(this.reportConstValue.canvasStatus.selectable|this.reportConstValue.canvasStatus.resizableCellWidth|this.reportConstValue.canvasStatus.resizableCellHeight))&&this.setStatus(this.reportConstValue.canvasStatus.selectable),this.config.status&this.reportConstValue.canvasStatus.selectable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)){if(f.getDataProperty("controlType")!=this.reportConstValue.shapeType.table)return;if((this.collection.list.length>1||!this.collection.keys[f.id])&&(this.cloneCollectionData(),this.clearCollection()),u=this.getItemById(e,{action:this.reportConstValue.shapeStatus.resizableCellWidth,areaDivisionCalculation:"each"}),!u)return;n.targetSelector="#"+e;this.addCollectionByElement(f.getDataProperty("el")[0]);u.ON_MOUSEDOWN(n,t);this.setStatus(this.reportConstValue.canvasStatus.resizingCellWidth);this.actionInstanceManager.resizeTableActionInstance=u;o.container=s[0];this.ON_DRAG_START({},t,null,o)}else if(this.config.status&this.reportConstValue.canvasStatus.editable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)){if(f.getDataProperty("controlType")!=this.reportConstValue.shapeType.table)return;if((this.collection.list.length>1||!this.collection.keys[f.id])&&(this.cloneCollectionData(),this.clearCollection()),u=this.getItemById(e,{action:this.reportConstValue.shapeStatus.resizableCellWidth,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each"}),!u)return;this.addCollectionByElement(f.getDataProperty("el")[0]);n.targetSelector="#"+e;u.ON_MOUSEDOWN(n,t);u.setFocusInTextContainer&&u.setFocusInTextContainer(!1,!0);this.setStatus(this.reportConstValue.canvasStatus.resizingCellWidth);this.actionInstanceManager.resizeTableActionInstance=u;o.container=s[0];this.ON_DRAG_START({},t,null,o)}else if(this.config.status&this.reportConstValue.canvasStatus.editing&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)){if(f.getDataProperty("controlType")!=this.reportConstValue.shapeType.table)return;if((this.collection.list.length>1||!this.collection.keys[f.id])&&(this.cloneCollectionData(),this.clearCollection()),u=this.getItemById(e,{action:this.reportConstValue.shapeStatus.resizableCellWidth,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each"}),!u)return;this.addCollectionByElement(f.getDataProperty("el")[0]);n.targetSelector="#"+e;u.ON_MOUSEDOWN(n,t);u.setFocusInTextContainer&&u.setFocusInTextContainer(!1,!0);this.setStatus(this.reportConstValue.canvasStatus.resizingCellWidth);this.actionInstanceManager.resizeTableActionInstance=u;o.container=s[0];this.ON_DRAG_START({},t,null,o)}else if(this.config.status&this.reportConstValue.canvasStatus.selectable){if(this.config.deselectElementId=null,v)this.setStatus(this.reportConstValue.canvasStatus.resizable),this.setResizeType(p&&p[1]);else{if(this.config.isMultiSelect=!1,t.shiftKey||n.shiftKey)this.config.isMultiSelect=!0,this.collection.getById(e)?this.config.deselectElementId=e:(this.collection.list.length&&(g=this.getEntityById(this.collection.list[0].id),nt=this.getEntityById(e),e&&g.isManagedShapeByEntity()==nt.isManagedShapeByEntity()||(this.cloneCollectionData(),this.clearCollection())),this.addCollectionByEvent(s,e),this.instanceManager.tableSelector&&this.instanceManager.tableSelector.invisible(),this.instanceManager.tableSelector&&this.instanceManager.tableSelector.reset());else if(t.ctrlKey||n.ctrlKey)this.config.isMultiSelect=!0,this.collection.getById(e)?this.config.deselectElementId=e:(this.collection.list.length&&(g=this.getEntityById(this.collection.list[0].id),nt=this.getEntityById(e),e&&g.isManagedShapeByEntity()==nt.isManagedShapeByEntity()||(this.cloneCollectionData(),this.clearCollection())),this.addCollectionByEvent(s,e),this.instanceManager.tableSelector&&this.instanceManager.tableSelector.invisible(),this.instanceManager.tableSelector&&this.instanceManager.tableSelector.reset());else{if(this.shapeUtils.isShapeServiceLayer(t.target))return;n.isClearSelectAll?(this.cloneCollectionData(),this.clearCollection()):this.collection.getById(e)||(this.cloneCollectionData(),this.clearCollection(),s.length==0&&(ft=!1));this.addCollectionByEvent(s,e)}this.config.isMultiSelect&&(y=!0);this.instanceManager.dragableInstance.setOtherElementInfos(null);f=this.getEntityById(e);ot=f&&f.getDataProperty("isNotEditable");u=this.getItemById(e,{action:this.reportConstValue.shapeStatus.selectable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,style:{},areaDivisionCalculation:"each"});u&&(n.targetSelector="#"+e,n.selectedShapeCount=this.collection.list.length,n.isMultiSelect=this.config.isMultiSelect,this.isContract&&this.removeActionInstancePopover(),u.isAvailableState()?(u.ON_MOUSEDOWN(n,t),u.setFocusInTextContainer&&u.setFocusInTextContainer(_.isBoolean(n.isMoveLastCursor),!0),ot||(y?this.setStatus(this.reportConstValue.canvasStatus.moveable):(f.getDataProperty("controlType")=="ecount.report.shape.table"?(st=u.getTableSelector(),b=st.getSelectedBoundary(),b.isValidate()?(this.setStatus(this.reportConstValue.canvasStatus.editable),this.collection.list.some(function(n){if(n.id==e)return!1;this.deselectInstance(n);this.collection.remove(n)},this)):this.collection.list.length==1?this.setStatus(this.reportConstValue.canvasStatus.editable):this.setStatus(this.reportConstValue.canvasStatus.moveable)):["ecount.report.shape.rectangle","ecount.report.shape.textbox"].contains(f.getDataProperty("controlType"))?this.setStatus(this.reportConstValue.canvasStatus.editing):h&&h.length&&this.setStatus(this.reportConstValue.canvasStatus.moveable),(this.config.status==this.reportConstValue.canvasStatus.editable||this.config.status==this.reportConstValue.canvasStatus.editing)&&this.setEditableId(e)))):this.collection.removeById(e))}if(this.config.status==this.reportConstValue.canvasStatus.selectable){if(u=this.getActionInstance("selectableRange"),!u)return;this.draw("selectableRange",{});u.ON_MOUSEDOWN(n,t);this.setStatus(this.reportConstValue.canvasStatus.mouseDrawing);h&&h.length&&(o.containerSelector=".wrapper-report-stage",o.container=s[0],this.ON_DRAG_START({},t,null,o))}else h&&h.length&&(!u||u.isManagedShape())&&(o.containerSelector=".wrapper-report-stage",o.container=s[0],this.collection.list.length==1&&(et=h.get(0).getAttribute("id")),this.ON_DRAG_START({},t,null,o)),f.getDataProperty("controlType")=="ecount.report.shape.table"&&this.ON_DRAG_START({},t,null,o),this.triggerEvent("drawingPaper.history",n,t,i,r),this.triggerEvent("drawingPaper.shape",n,t,i,r)}else if(this.config.status&this.reportConstValue.canvasStatus.drawable){if(d=this.getWrapperBoundingClientRect(),d.top<=t.clientY&&d.bottom>=t.clientY&&d.left<=t.clientX&&d.right>=t.clientX){if(this.cloneCollectionData(),this.clearCollection(),this.setStatus(this.reportConstValue.canvasStatus.mouseDrawing),u=this.getActionInstance(this.config.drawShapeType),!u||u.config.paste)return;u.setAction(this.reportConstValue.shapeStatus.drawable);this.isResetCanvasBoundingClientRect(this.config.drawShapeType)&&(u.resetCanvasBoundingClientRect(),this.setResetCanvasBoundingClientRect(!1,this.config.drawShapeType));u.setCanvas(this.$wrapperEl);u.ON_MOUSEDOWN(n,t);this.entityTree.addEntity({id:u.config.attr.id,children:[],parentId:null,data:{controlType:u.controlType,container:u.$parent,el:u.$el}})}}else if(this.config.status&this.reportConstValue.canvasStatus.moveable)this.setStatus(this.reportConstValue.canvasStatus.moving);else if(this.config.status&this.reportConstValue.canvasStatus.resizable)this.setStatus(this.reportConstValue.canvasStatus.resizing);else if(this.config.status&this.reportConstValue.canvasStatus.editable)if(v)this.setStatus(this.reportConstValue.canvasStatus.resizable),this.setResizeType(p&&p[1]),h&&h.length&&(o.containerSelector=".wrapper-report-stage",o.container=s[0],this.ON_DRAG_START({},t,null,o));else if(a=function(){u.ON_MOUSEDOWN(n,t);u.setFocusInTextContainer&&u.setFocusInTextContainer(!1,!0);this.setStatus(this.reportConstValue.canvasStatus.editable);this.clearCursor();o.containerSelector=".wrapper-report-stage";o.container=s[0];this.ON_DRAG_START({},t,null,o)}.bind(this),this.collection.list.length==1&&this.config.editableId&&this.config.editableId==e){if(f=this.getEntityById(e),u=this.getItemById(e,{action:this.reportConstValue.shapeStatus.editable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each"}),!u)return;n.targetSelector="#"+e;f.getDataProperty("controlType")=="ecount.report.shape.table"?(ht=u.getTableSelector().getFromSectionType(),b=u.getTableSelector().getSelectedBoundary(),u.isEditable()?b.isValidate()?(w=c.closest("th, td"),tt=w&&w.length>0?w[0]:null,u.isSelectedBoundaryInElementByElement(tt)||a()):a():a()):a();this.config.isSyncFont&&ecount.global.setTimeout(this.ecPageID,function(){this.triggerEvent("drawingPaper.font",n,t,i,r);this.triggerEvent("drawingPaper.shape",n,t,i,r)}.bind(this))}else{n.isClearSelectAll=!0;ecount.isMobile?this.config.editableId&&(f=this.getEntityById(this.config.editableId),f&&this.customTriggerEvent("drawingPaper.endEdit",{id:f.id,controlType:f.getDataProperty("controlType")})):this.collection.list.length==1&&this.config.editableId&&this.customTriggerEvent("drawingPaper.endEdit",{id:this.collection.list[0].id,controlType:this.collection.list[0].controlType});this.setStatus(this.reportConstValue.canvasStatus.selectable);f&&f.getDataProperty("controlType")=="ecount.report.shape.table"&&u&&(u.setTableStructure(null),u.setTableSelector(null));this.ON_LAYOUT_MOUSEDOWN(n,t,i,r);return}else if(this.config.status&this.reportConstValue.canvasStatus.editing)if(v)this.setStatus(this.reportConstValue.canvasStatus.resizable),this.setResizeType(p&&p[1]),h&&h.length&&(o.containerSelector=".wrapper-report-stage",o.container=s[0],this.ON_DRAG_START({},t,null,o));else if(a=function(){f.getDataProperty("controlType")=="ecount.report.shape.table"?(u.setAction(this.reportConstValue.shapeStatus.editable),u.ON_MOUSEDOWN(n,t),u.setFocusInTextContainer&&u.setFocusInTextContainer(!1,!0),o.containerSelector=".wrapper-report-stage",o.container=s[0],this.ON_DRAG_START({},t,null,o)):u.ON_MOUSEDOWN(n,t)}.bind(this),this.collection.list.length==1&&this.config.editableId&&this.config.editableId==e){if(u=this.getItemById(e,{action:this.reportConstValue.shapeStatus.editing,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each"}),!u)return;if(n.targetSelector="#"+e,v)this.setStatus(this.reportConstValue.canvasStatus.resizable),this.setResizeType(p&&p[1]),o.containerSelector=".wrapper-report-stage",o.container=s[0],this.ON_DRAG_START({},t,null,o);else{if(f.getDataProperty("controlType")=="ecount.report.shape.table"){var ht=u.getTableSelector().getFromSectionType(),lt=u.getTableSelector().getFromSectionIndex(),b=u.getTableSelector().getSelectedBoundary();this.setStatus(this.reportConstValue.canvasStatus.editing);u.isEditable()?b.isValidate()?(w=c.closest("th, td"),tt=w&&w.length>0?w[0]:null,u.isSelectedBoundaryInElementByElement(tt)?a():(it=this.instanceManager.tableStructure.getTd(ht,lt,b.config.left,b.config.top),it&&u.textContainerDisabledEditable(it,!0),a())):a():a()}else a();this.config.isSyncFont&&ecount.global.setTimeout(this.ecPageID,function(){this.triggerEvent("drawingPaper.font",n,t,i,r);this.triggerEvent("drawingPaper.shape",n,t,i,r)}.bind(this))}}else{n.isClearSelectAll=!0;ecount.isMobile?this.config.editableId&&(f=this.getEntityById(this.config.editableId),f&&this.customTriggerEvent("drawingPaper.endEdit",{id:f.id,controlType:f.getDataProperty("controlType")})):this.collection.list.length==1&&this.config.editableId&&this.customTriggerEvent("drawingPaper.endEdit",{id:this.collection.list[0].id,controlType:this.collection.list[0].controlType});this.setStatus(this.reportConstValue.canvasStatus.selectable);f&&f.getDataProperty("controlType")=="ecount.report.shape.table"&&u&&(u.setTableStructure(null),u.setTableSelector(null));this.ON_LAYOUT_MOUSEDOWN(n,t,i,r);this.addDataInHistory();return}else if(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight){if((this.collection.list.length>1||!this.collection.keys[f.id])&&(this.cloneCollectionData(),this.clearCollection()),u=this.getItemById(e,{action:this.reportConstValue.shapeStatus.resizableCellWidth,areaDivisionCalculation:"each"}),!u)return;this.addCollectionByElement(f.getDataProperty("el")[0]);n.targetSelector="#"+e;u.ON_MOUSEDOWN(n,t);this.setStatus(this.reportConstValue.canvasStatus.resizingCellWidth);this.actionInstanceManager.resizeTableActionInstance=u;o.container=s[0];this.ON_DRAG_START({},t,null,o)}this.customTriggerEvent("drawingPaper.deSelectPositionCollection",{active:ft,targetID:et})},onMousedownRight:function(n,t,i,r){var rt=t.target,e=$(rt),k,ut,c=null,l=null,w=null,f,b=e.hasClass(this.reportConstValue.resizerSelector),y=e.hasClass(this.reportConstValue.moveableTopSelector)||e.hasClass(this.reportConstValue.moveableBottomSelector)||e.hasClass(this.reportConstValue.moveableLeftSelector)||e.hasClass(this.reportConstValue.moveableRightSelector),u,g,o,h,nt,a,s,v,d,p;if(this.config.status&this.reportConstValue.canvasStatus.drawable||(b||y?(o=this.getEntityById(e.closest(this.reportConstValue.lineHandlerPrefix+this.reportConstValue.lineHandlerSelector).attr("data-refid")),c=o.getDataProperty("el")):(c=e.hasClass(this.reportConstValue.containerSelector)?e.find("[data-controltype]:first"):e.hasClass(this.reportConstValue.contentDefaultClass)?e.find("[data-controltype]"):e.closest("[data-controltype]"),o=this.getEntityById(c.attr("id"))),!o||o.isManagedShapeByEntity()?(k=c.closest(this.reportConstValue.containerPrefix+this.reportConstValue.containerSelector),ut,l=ecount.isMobile?c:k.find(this.reportConstValue.dragPrefix+this.reportConstValue.dragSelector),w=c,f=l&&l.attr("id")||w.attr("id")):(k=c.parent(),l=b||!b&&!y?c:null,w=c,f=l&&l.attr("id")||w.attr("id")),h=l&&l.attr("data-controltype")||w.attr("data-controltype"),y||(y=h==this.reportConstValue.shapeType.rectangle&&e.hasClass(this.reportConstValue.dragSelector)),y&&(this.setStatus(this.reportConstValue.canvasStatus.selectable),o&&(o.isManagedShapeByEntity()||(y=!1)))),(!(this.config.status&this.reportConstValue.canvasStatus.selectable)||!(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight))&&(!(this.config.status&this.reportConstValue.canvasStatus.editable)||!(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)))if(this.config.status==this.reportConstValue.canvasStatus.selectable)this.config.deselectElementId=null,g=!1,t.shiftKey||n.shiftKey||t.ctrlKey||n.ctrlKey||(n.isClearSelectAll?(this.cloneCollectionData(),this.clearCollection()):this.collection.getById(f)||(this.cloneCollectionData(),this.clearCollection()),this.addCollectionByEvent(k,f)),this.instanceManager.dragableInstance.setOtherElementInfos(null),o=this.getEntityById(f),o&&(h=o.getDataProperty("controlType"),u=this.getItemById(f,{action:ecount.isMobile?this.reportConstValue.shapeStatus.editable:this.reportConstValue.shapeStatus.selectable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,style:{},areaDivisionCalculation:"each"}),u&&(ecount.isMobile||(n.targetSelector="#"+f,n.selectedShapeCount=this.collection.list.length,n.isMultiSelect=g,u.isAvailableState()?(u.ON_MOUSEDOWN(n,t),u.setFocusInTextContainer&&u.setFocusInTextContainer(!1,!0),y?this.setStatus(this.reportConstValue.canvasStatus.moveable):(h=="ecount.report.shape.table"?(nt=u.getTableSelector(),a=nt.getSelectedBoundary(),a.isValidate()?(this.setStatus(this.reportConstValue.canvasStatus.editable),this.collection.list.some(function(n){if(n.id==f)return!1;this.deselectInstance(n);this.collection.remove(n)},this)):this.setStatus(this.reportConstValue.canvasStatus.editable)):["ecount.report.shape.rectangle","ecount.report.shape.textbox"].contains(h)?this.setStatus(this.reportConstValue.canvasStatus.editing):this.setStatus(this.reportConstValue.canvasStatus.moveable),this.setEditableId(f))):this.collection.removeById(f))));else if(!(this.config.status&this.reportConstValue.canvasStatus.drawable)&&!(this.config.status&this.reportConstValue.canvasStatus.moveable)&&!(this.config.status&this.reportConstValue.canvasStatus.resizable))if(this.config.status&this.reportConstValue.canvasStatus.editable)if(s=function(){h=="ecount.report.shape.table"&&u.setAction(this.reportConstValue.shapeStatus.editable);u.ON_MOUSEDOWN(n,t);u.setFocusInTextContainer&&u.setFocusInTextContainer(!1,!0)}.bind(this),this.collection.list.length==1&&this.config.editableId&&this.config.editableId==f){if(u=this.getItemById(f,{action:this.reportConstValue.shapeStatus.editing,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each"}),!u)return;if(n.targetSelector="#"+f,!b){if(h=="ecount.report.shape.table"){var tt=u.getTableSelector().getFromSectionType(),it=u.getTableSelector().getFromSectionIndex(),a=u.getTableSelector().getSelectedBoundary();this.setStatus(this.reportConstValue.canvasStatus.editing);u.isEditable()?a.isValidate()?(v=e.closest("th, td"),d=v&&v.length>0?v[0]:null,u.isSelectedBoundaryInElementByElement(d)?s():(p=this.instanceManager.tableStructure.getTd(tt,it,a.config.left,a.config.top),p&&u.textContainerDisabledEditable(p,!0),s())):(this.removeAllRanges(),s()):(this.removeAllRanges(),s())}else s();this.config.isSyncFont&&ecount.global.setTimeout(this.ecPageID,function(){this.triggerEvent("drawingPaper.font",n,t,i,r);this.triggerEvent("drawingPaper.shape",n,t,i,r)}.bind(this))}}else n.isClearSelectAll=!0,this.setStatus(this.reportConstValue.canvasStatus.selectable),o&&h=="ecount.report.shape.table"&&u&&(u.setTableStructure(null),u.setTableSelector(null)),this.ON_LAYOUT_MOUSEDOWN(n,t,i,r),this.addDataInHistory();else if(this.config.status&this.reportConstValue.canvasStatus.editing)if(s=function(){h=="ecount.report.shape.table"&&u.setAction(this.reportConstValue.shapeStatus.editable);u.ON_MOUSEDOWN(n,t);u.setFocusInTextContainer&&u.setFocusInTextContainer(!1,!0)}.bind(this),this.collection.list.length==1&&this.config.editableId&&this.config.editableId==f){if(u=this.getItemById(f,{action:this.reportConstValue.shapeStatus.editing,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,areaDivisionCalculation:"each"}),!u)return;if(n.targetSelector="#"+f,!b){if(h=="ecount.report.shape.table"){var tt=u.getTableSelector().getFromSectionType(),it=u.getTableSelector().getFromSectionIndex(),a=u.getTableSelector().getSelectedBoundary();this.setStatus(this.reportConstValue.canvasStatus.editing);u.isEditable()?a.isValidate()?(v=e.closest("th, td"),d=v&&v.length>0?v[0]:null,u.isSelectedBoundaryInElementByElement(d)?s():(p=this.instanceManager.tableStructure.getTd(tt,it,a.config.left,a.config.top),p&&u.textContainerDisabledEditable(p,!0),s())):(this.removeAllRanges(),s()):(this.removeAllRanges(),s())}else s();this.config.isSyncFont&&ecount.global.setTimeout(this.ecPageID,function(){this.triggerEvent("drawingPaper.font",n,t,i,r);this.triggerEvent("drawingPaper.shape",n,t,i,r)}.bind(this))}}else n.isClearSelectAll=!0,this.setStatus(this.reportConstValue.canvasStatus.selectable),o&&h=="ecount.report.shape.table"&&u&&(u.setTableStructure(null),u.setTableSelector(null)),this.ON_LAYOUT_MOUSEDOWN(n,t,i,r),this.addDataInHistory();else this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight},onMouseUpLeft:function(n,t,i,r){var f,o=function(){this.setStatus(this.reportConstValue.canvasStatus.selectable);this.setEditableId(null);this.config.drawShapeType="none";this.config.resizeType="none";this.config.drawColumnCount=0;this.config.drawRowCount=0;this.constValue.isIE&&this.removeAllRanges()}.bind(this),e,a,s,h,c,u;if(this.triggerEvent("drawingPaper.shapeStyle",n,t,i,r),ecount.global.setTimeout(this.ecPageID,function(){this.config.isSyncFont&&(this.triggerEvent("drawingPaper.font",n,t,i,r),this.triggerEvent("drawingPaper.shape",n,t,i,r));this.triggerEvent("drawingPaper.layout",n,t,i,r)}.bind(this)),!(this.config.status&this.reportConstValue.canvasStatus.selectable)||!(this.config.status&this.reportConstValue.canvasStatus.editable))if(this.config.status&this.reportConstValue.canvasStatus.selectable&&(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)){if(h=this._node.closest(t.target,"[data-controltype]"),h){if(c=h.getAttribute("id"),f=this.getEntityById(c),!f)return;u=this.getActionInstance(f.getDataProperty("controlType"));u&&u.ON_MOUSEUP(n,t,i,r)}o()}else if(this.config.status&this.reportConstValue.canvasStatus.editable&&this.config.status&this.reportConstValue.canvasStatus.moveable)this.config.deselectElementId&&(t.shiftKey||n.shiftKey?this.collection.getById(this.config.deselectElementId)&&(this.deselectInstance(this.collection.getById(this.config.deselectElementId)),this.collection.removeById(this.config.deselectElementId)):(t.ctrlKey||n.ctrlKey)&&this.collection.getById(this.config.deselectElementId)&&(this.deselectInstance(this.collection.getById(this.config.deselectElementId)),this.collection.removeById(this.config.deselectElementId))),o();else if(this.config.status&this.reportConstValue.canvasStatus.selectable)this.config.deselectElementId&&(t.shiftKey||n.shiftKey?this.collection.getById(this.config.deselectElementId)&&(this.deselectInstance(this.collection.getById(this.config.deselectElementId)),this.collection.removeById(this.config.deselectElementId)):(t.ctrlKey||n.ctrlKey)&&this.collection.getById(this.config.deselectElementId)&&(this.deselectInstance(this.collection.getById(this.config.deselectElementId)),this.collection.removeById(this.config.deselectElementId)),this.config.deselectElementId=null),o();else if(this.config.status&this.reportConstValue.canvasStatus.selectableRange)o();else if(this.config.status&this.reportConstValue.canvasStatus.mouseDrawing){if(this.config.deselectElementId&&(t.shiftKey||n.shiftKey?this.collection.getById(this.config.deselectElementId)&&(this.deselectInstance(this.collection.getById(this.config.deselectElementId)),this.collection.removeById(this.config.deselectElementId)):(t.ctrlKey||n.ctrlKey)&&this.collection.getById(this.config.deselectElementId)&&(this.deselectInstance(this.collection.getById(this.config.deselectElementId)),this.collection.removeById(this.config.deselectElementId)),this.config.deselectElementId=null),u=this.getActionInstance(this.config.drawShapeType),!u)return;u.setConfig(_.extend(this.getDefaultConfig(),{action:this.reportConstValue.shapeStatus.mouseDrawing,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,style:{},areaDivisionCalculation:"each"}));this.isResetCanvasBoundingClientRect(this.config.drawShapeType)&&(u.resetCanvasBoundingClientRect(),this.setResetCanvasBoundingClientRect(!1,this.config.drawShapeType));u.setCanvas(this.$wrapperEl);u.ON_MOUSEUP(n,t,i,r);u.resetConfig();this.removeNoselectionInBody();this.resizeHandler();o();u.controlType!="ecount.report.shape.selectableRange"&&this.addDataInHistory()}else if(this.config.status&this.reportConstValue.canvasStatus.moveable){this.config.deselectElementId&&(t.shiftKey||n.shiftKey?this.collection.getById(this.config.deselectElementId)&&(this.deselectInstance(this.collection.getById(this.config.deselectElementId)),this.collection.removeById(this.config.deselectElementId)):(t.ctrlKey||n.ctrlKey)&&this.collection.getById(this.config.deselectElementId)&&(this.deselectInstance(this.collection.getById(this.config.deselectElementId)),this.collection.removeById(this.config.deselectElementId)),this.config.deselectElementId=null);var u,y=t.target,l=$(y),l=l.closest("[data-controltype]");if(l&&l.length){if(c=l.attr("id"),f=this.getEntityById(c),!f)return;u=this.getActionInstance(f.getDataProperty("controlType"));u&&(n.isMultiSelect=this.config.isMultiSelect,u.ON_MOUSEUP(n,t,i,r))}u&&u.isEditable()?(this.setStatus(this.reportConstValue.canvasStatus.editing),this.setEditableId(f.id)):o()}else if(this.config.status&this.reportConstValue.canvasStatus.moving){for(e=0,a=this.collection.list.length;e<a;e++)(f=this.getEntityById(this.collection.list[e].id),f)&&(u=this.getActionInstance(f.getDataProperty("controlType")),u)&&u.ON_MOUSEUP(n,t,i,r);o();this.addDataInHistory()}else if(this.config.status&this.reportConstValue.canvasStatus.resizable){for(e=0,a=this.collection.list.length;e<a;e++)(f=this.getEntityById(this.collection.list[e].id),f)&&(u=this.getActionInstance(f.getDataProperty("controlType")),u)&&u.ON_MOUSEUP(n,t,i,r);o();this.addDataInHistory()}else if(this.config.status&this.reportConstValue.canvasStatus.resizing){for(e=0,a=this.collection.list.length;e<a;e++)(f=this.getEntityById(this.collection.list[e].id),f)&&(u=this.getActionInstance(f.getDataProperty("controlType")),u)&&u.ON_MOUSEUP(n,t,i,r);o();this.addDataInHistory()}else if(this.config.status&this.reportConstValue.canvasStatus.editable){var y=t.target,l=$(y),v=l.closest("[data-controltype]"),p=l.closest(this.reportConstValue.editablePrefix+this.reportConstValue.editableSelector);if(p.length&&v.length){if(s=v.attr("id"),f=this.getEntityById(s),!f)return;if(this.collection.list.some(function(n){if(n.id==s)return!1;this.deselectInstance(n);this.collection.remove(n)},this),u=this.getItemById(s,{action:this.reportConstValue.shapeStatus.editable,areaDivisionCalculation:"each"}),!u)return;this.config.editableId==s?(u.ON_MOUSEUP(n,t,i,r),u.ON_DBLCLICK(n,t),u.setFocusInTextContainer&&u.setFocusInTextContainer(!1,!0)):f.getDataProperty("controlType")=="ecount.report.shape.table"&&(u.setTableStructure(null),u.setTableSelector(null))}}else if(this.config.status&this.reportConstValue.canvasStatus.editing){var y=t.target,l=$(y),v=l.closest("[data-controltype]"),p=l.closest(this.reportConstValue.editablePrefix+this.reportConstValue.editableSelector);if(p.length&&v.length){if(s=v.attr("id"),f=this.getEntityById(s),!f)return;if(this.collection.list.some(function(n){if(n.id==s)return!1;this.deselectInstance(n);this.collection.remove(n)},this),u=this.getItemById(s,{action:this.reportConstValue.shapeStatus.editing,areaDivisionCalculation:"each"}),!u)return;this.config.editableId==s?(u.ON_MOUSEUP(n,t,i,r),u.ON_DBLCLICK(n,t),u.setFocusInTextContainer&&u.setFocusInTextContainer(!1,!0)):f.getDataProperty("controlType")=="ecount.report.shape.table"&&(u.setTableStructure(null),u.setTableSelector(null))}}else if(this.config.status&this.reportConstValue.canvasStatus.resizingCellWidth){if(h=this._node.closest(t.target,"[data-controltype]"),h){if(c=h.getAttribute("id"),f=this.getEntityById(c),!f)return;u=this.getActionInstance(f.getDataProperty("controlType"));u&&u.ON_MOUSEUP(n,t,i,r)}o();this.addDataInHistory()}else if(this.config.status&this.reportConstValue.canvasStatus.resizingCellHeight){if(h=this._node.closest(t.target,"[data-controltype]"),h){if(c=h.getAttribute("id"),f=this.getEntityById(c),!f)return;u=this.getActionInstance(f.getDataProperty("controlType"));u&&u.ON_MOUSEUP(n,t,i,r)}o();this.addDataInHistory()}this.config.deselectElementId=null;this.config.isMultiSelect=!1;this.removeActionInstancePopover()},onMouseUpRight:function(n,t,i,r){var u,e,f;if((!(this.config.status&this.reportConstValue.canvasStatus.selectable)||!(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight))&&(!(this.config.status&this.reportConstValue.canvasStatus.editable)||!(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth||this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight))&&!(this.config.status&this.reportConstValue.canvasStatus.resizableCellWidth)&&!(this.config.status&this.reportConstValue.canvasStatus.resizableCellHeight)){if(this.config.status!=this.reportConstValue.canvasStatus.selectable&&!(this.config.status&this.reportConstValue.canvasStatus.drawable)&&!(this.config.status&this.reportConstValue.canvasStatus.moveable)&&!(this.config.status&this.reportConstValue.canvasStatus.resizable))if(this.config.status&this.reportConstValue.canvasStatus.editable){if(this.collection.list.length==1)for(u=0,e=this.collection.list.length;u<e;u++){if(f=this.getItemById(this.collection.list[0].id,{action:this.reportConstValue.shapeStatus.editing,areaDivisionCalculation:"each"}),!f)break;f.ON_MOUSEUP(n,t,i,r)}}else if(this.config.status&this.reportConstValue.canvasStatus.editing&&this.collection.list.length==1)for(u=0,e=this.collection.list.length;u<e;u++){if(f=this.getItemById(this.collection.list[0].id,{action:this.reportConstValue.shapeStatus.editing,areaDivisionCalculation:"each"}),!f)break;f.ON_MOUSEUP(n,t,i,r)}this.ON_CONTEXTMENU(n,t,i,r)}},ON_CONTEXTMENU:function(n,t,i,r){function tt(){var o,s,c;[this.reportConstValue.shapeType.rectangle,this.reportConstValue.shapeType.textbox,this.reportConstValue.shapeType.table].contains(e&&e.controlType)&&(o=this.getCommandConvenienceFunctionHyperlink({isVirtualUI:!0}));r=_.extend(r,{isEditable:a,sectionType:y,sectionIndex:it,mappingDataID:f&&f.attr("id"),selectedBoundary:h,selectedShapeConfig:this.getSelectedShapes(),isClickBlockSelected:ut,isElements:this._node.isElement(u),isCanvasSelected:ft,isMappingDataSelected:et,isWrapperInTarget:st,isCollapsed:ot,hyperlinkInfo:o&&o.value,callback:nt.bind(this,u)});this.triggerEvent("drawingPaper.contextmenuData",n,t,i,r);this.getSaveCursor()?this.saveCursor(d):(this.getClearCursor()&&this.removeAllRanges(),this.clearCursor());s=this.getContextmenu();c={top:t.pageY,bottom:t.pageY,left:t.pageX,right:t.pageX};this.instanceManager.contextmenuInstance.setPosition(c);this.instanceManager.contextmenuInstance.setContextmenuData(s);this.instanceManager.contextmenuInstance.openContextmenu({ownerKey:this.ecIKey,serviceKey:this.config.serviceKey},ecount.layer)}var v,ct,nt;if(!ecount.isMobile){var b=[],s=this.instanceManager.tableSelector,k=this.instanceManager.tableStructure,h=s&&s.getSelectedBoundary(),y=s&&s.getFromSectionType(),it=s&&s.getFromSectionIndex(),u=t.target,f=$(u),c=f.closest("[data-controltype]");c&&c.length!=0||(u.classList.contains(this.reportConstValue.lineHandlerSelector)?v=this.getEntityById(f.attr("data-refid")):[this.reportConstValue.moveableTopSelector,this.reportConstValue.moveableBottomSelector,this.reportConstValue.moveableLeftSelector,this.reportConstValue.moveableRightSelector].some(function(n){if(u.classList.contains(n))return v=this.getEntityById(f.closest(this.reportConstValue.lineHandlerPrefix+this.reportConstValue.lineHandlerSelector).attr("data-refid")),!0}.bind(this)),v&&(c=v.getDataProperty("el")));var p=c.attr("data-controltype"),d=c.attr("id"),e=this.getItemById(d),l=window.getSelection(),o=this._range.getRange(!0),rt=u==o.commonAncestorContainer||$.contains(u,o.commonAncestorContainer),ut=rt&&!l.isCollapsed,ft=u.classList.contains(this.constValue.drawingPaper.canvasSelector),et=u.classList.contains(this.constValue.drawingPaper.mappingDataSelector),ot=l.isCollapsed,lt=this._node.isElement(u)&&(u.tagName=="A"||f.closest("a").length)||this._node.isText(u)&&f.closest("a").length,st=this.isDrawingPaperWrapper(u);if(this.setSaveCursor(!1),this.setClearCursor(!1),h&&h.isValidate()&&(b=s.getSelectedTxs()),this.$wrapperEl[0]==u||$.contains(this.$wrapperEl[0],u)){var w=function(n,t,i,r){var u=t.closest("th, td");r&&r.isValidate()?b.contains(u[0])||(u.trigger("mousedown",{which:1,notPreventTriggerEvent:!0}),u.trigger("mouseup",{which:1,notPreventTriggerEvent:!0})):(u.trigger("mousedown",{which:1,notPreventTriggerEvent:!0}),u.trigger("mouseup",{which:1,notPreventTriggerEvent:!0}))}.bind(this),ht=function(n,t){var i=t.closest("table");i.trigger("mousedown",{which:1,notPreventTriggerEvent:!0,ctrlKey:n.ctrlKey});i.trigger("mouseup",{which:1,notPreventTriggerEvent:!0,ctrlKey:n.ctrlKey})}.bind(this),g=function(n,t){var i=t.closest("[data-controltype]");i.trigger("mousedown",{which:1,notPreventTriggerEvent:!0,ctrlKey:n.ctrlKey});i.trigger("mouseup",{which:1,notPreventTriggerEvent:!0,ctrlKey:n.ctrlKey})}.bind(this),a=e&&e.isEditable();a?p!="ecount.report.shape.table"||e.isSelectedBoundaryInElementByElement(f.closest("th, td")[0])?this._node.isElement(u)&&u.classList.contains(this.reportConstValue.mappingDataSelector)&&(this.removeAllRanges(),this._node.isElement(u)&&u.classList.contains(this.reportConstValue.mappingDataSelector)?o.selectNodeContents(u):o.selectNode(u),l.addRange(o)):(this.removeAllRanges(),a=!1,e.setCellEditable(a),w(t,f)):(this.collection.list.length>0?p=="ecount.report.shape.table"?t.ctrlKey?ht(t,f):(e.setFocusInTextContainer(f),w(t,f,y,h,k),this._node.isElement(u)&&u.classList.contains(this.reportConstValue.mappingDataSelector)&&(this.removeAllRanges(),o.selectNode(u),l.addRange(o))):g(t,f):p=="ecount.report.shape.table"?(e.setFocusInTextContainer(f),w(t,f,y,h,k),this._node.isElement(u)&&u.classList.contains(this.reportConstValue.mappingDataSelector)&&(this.removeAllRanges(),o.selectNode(u),l.addRange(o))):g(t,f),a=!0);this.clearInsertMappingDataControlId();this.config.serviceKey=ecount.common.makeServiceKey(this.ecPath,"drawingPaper");this.config.serviceKeyType="contextmenu";_.isUndefined(r)&&(r={});ct=e&&e.isManagedShape();nt=function(n,t){var i=this.getItemById(t,{action:this.reportConstValue.shapeStatus.selectable,currentUserSignInfo:this._options.shape.sign.currentUserSignInfo,resizeType:this.config.resizeType,areaDivisionCalculation:"each"});this.setSaveCursor(i.isCursorInTextContainer(this.constValue.drawingPaper.searchCursorType.element,n));this.setClearCursor(!0)};this.constValue.isIE?ecount.global.setTimeout(this.ecPageID,tt.bind(this)):tt.call(this)}}},_ON_CLICK_SERVICE:function(n,t,i,r){var u,f;this.config.mode!=this.reportConstValue.mode.view&&this.config.active&&(this.config.cancelEvent||t.target&&t.target.parentNode&&t.target.parentNode.classList.contains("disabled")||(this.instanceManager.contextmenuInstance&&this.instanceManager.contextmenuInstance.fireEventHandler("click.contextmenu",n,t,i,r),u=t.target.getAttribute("data-refid"),u)&&(f=this.getItemById(u),f&&f.ON_CLICK_SERVICE(n,t,i,r)))},_ON_CLICK_CONTEXTMENU:function(n){var t=n.value;if(!_.isEmpty(t)){switch(t){case"insertLeftColumn":case"insertRightColumn":case"insertUpRow":case"insertDownRow":t=t.replace("insert","add");break;case"addMappingData":case"insertMappingData":case"viewSamples":case"setting":case"allSettings":(t==="addMappingData"||t==="setting")&&this.setStatus(this.reportConstValue.canvasStatus.selectable);this.triggerEvent("drawingPaper."+t,{},{},{},n);n.command=null;return;case"insertHyperlink":case"editHyperlink":case"deleteHyperlink":this.config.beforeCursorPosition&&this.config.beforeCursorPosition.editableId&&(this.setEditable(this.config.beforeCursorPosition.editableId),this.restoreCursor(),this.saveCursor());this.triggerEvent("drawingPaper."+t,{},{},{},n);n.command=null;return;default:(t==="cut"||t==="copy"||t==="paste"||t==="pastePlainText"||t==="delete")&&(t="_"+t)}this[t]()}}});ecount.class("ecount.layout.drawingPaperEdit","ecount.layout.drawingPaper",{});ecount.layout.report||(ecount.layout.report={});ecount.layout.report._export=function(){return{prop:{_loadedItemCount:0,_clientX:0,_clientY:0,dragTarget:null,dragPosition:null,dragDistance:0,mmUnit:.26458333333333,bottomSpare:13,marginMinSpace:10,isCustomReport:!1,template:'<div class="wrapper-report-stage {{showPaper}} {{wrapperStageClass}}"><div data-category="stage" class="stage {{stageClass}}" {{paperStyle}}/>{{resizeHandle}}<\/div>',resizeHandleTemplate:'<div class="stage-resize-handle"><\/div>',marginGuideLineTemplate:'<div class="report-area-print-margin-guide {{showAll}}"><div class="print-margin-guide-top" data-size="{{topMargin}}" style="top: {{topMargin}}mm"><div class="print-margin-guide-handle"/><\/div><div class="print-margin-guide-bottom" data-size="{{bottomMargin}}" style="bottom: {{bottomMargin}}mm"><div class="print-margin-guide-handle"/><\/div><div class="print-margin-guide-left" data-size="{{leftMargin}}" style="left: {{leftMargin}}mm"><div class="print-margin-guide-handle"/><\/div><div class="print-margin-guide-right" data-size="{{rightMargin}}" style="right: {{rightMargin}}mm"><div class="print-margin-guide-handle"/><\/div><\/div>',gridGuideTemplate:'<div data-category ="gridGuide" class="grid-row-titles {{hide}}" style="right: {{rightPosition}}px"><div class="row-titles">{{guideList}}<\/div><\/div>',init:function(n){this.marginData=n.marginData||{};this.marginData.isHide=!!this.marginData.isHide;this.useMarginGuideLine=n.useMarginGuideLine;this.canDragMarginGuideLine=n.canDragMarginGuideLine;this.validateMarginGuideLine=n.validateMarginGuideLine;this.bottomSpare=n.bottomSpare||this.bottomSpare;this.isCustomReport=n.isCustomReport||this.isCustomReport;this.isHideHeader=n.isHideHeader;this.isHideFooter=n.isHideFooter;this.isTempViewAreaGuideLine={header:!1,top:!1,body:!1,bottom:!1,footer:!1};this.scrollContainerSelector=n.scrollContainerSelector;this.paperStyle=this.isCustomReport?n.paperStyle:{width:(n.width||0)+"mm","padding-top":(this.marginData.top||0)+"mm","padding-bottom":this.bottomSpare+"mm"};n.addStyle&&_.extend(this.paperStyle,n.addStyle);this.gridGuideData=n.gridGuideData||{};this.gridGuideData.rightPosition==null&&(this.gridGuideData.rightPosition=5);this.setTemplate(n);ecount.layout.prototype.init.apply(this,arguments);this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.history=new ecount.report.history({isEqual:function(n,t){return n.id==t.id&&n.status==t.status&&n.innerHTML==t.innerHTML&&n.scrollTop==t.scrollTop&&n.scrollLeft==t.scrollLeft&&n.cursor==t.cursor?n.tableSelector&&!t.tableSelector||!n.tableSelector&&t.tableSelector?!1:n.tableSelector&&t.tableSelector&&(n.tableSelector.selectedBoundary.config.top!=t.tableSelector.selectedBoundary.config.top||n.tableSelector.selectedBoundary.config.bottom!=t.tableSelector.selectedBoundary.config.bottom||n.tableSelector.selectedBoundary.config.left!=t.tableSelector.selectedBoundary.config.left||n.tableSelector.selectedBoundary.config.right!=t.tableSelector.selectedBoundary.config.right)?!1:!0:!1}});this.mappingDataCollection=n.mappingDataCollection||new ecountlib.data.collection;this.smartGuideEvents=new ecount.events(this);this.smartGuideEvents.on({"shape.change.smartGuide":this.onShapeChangeSmartGuide.bind(this)});this.smartGuideManager=new ecount.report.shape.smartGuideManager.action({controlSelector:"[data-controltype]",scrollContainerSelector:".wrapper-report-stage"},this.smartGuideEvents);this.topList=[];this.headerList=[];this.bodyList=[];this.footerList=[];this.bottomList=[];this.itemList=[];this.events=new ecount.events(this);this.events.on({"grid.append":this.transferEvent,"drawingPaper.all":this.transferEvent,"drawingPaper.history":this.transferEvent,"drawingPaper.shape":this.transferEvent,"drawingPaper.font":this.transferEvent,"drawingPaper.shapeStyle":this.transferEvent,"drawingPaper.layout":this.transferEvent,"drawingPaper.addMappingData":this.transferEvent,"drawingPaper.insertMappingData":this.transferEvent,"drawingPaper.insertHyperlink":this.transferEvent,"drawingPaper.editHyperlink":this.transferEvent,"drawingPaper.deleteHyperlink":this.transferEvent,"drawingPaper.viewSamples":this.transferEvent,"drawingPaper.setting":this.transferEvent,"drawingPaper.allSettings":this.transferEvent,"drawingPaper.initControl":this.transferEvent,"drawingPaper.makeCompleteControl":this.transferEvent,"drawingPaper.initPasteControl":this.transferEvent,"drawingPaper.shape.initTableCell":this.transferEvent,"drawingPaper.shape.dblClick":this.transferEvent,"drawingPaper.shape.select":this.transferEvent,"drawingPaper.shape.deselect":this.transferEvent,"drawingPaper.shape.click":this.transferEvent,"drawingPaper.shape.createInstance":this.transferEvent,"drawingPaper.shape.beforedestroyInstance":this.transferEvent,"drawingPaper.shape.destroyInstance":this.transferEvent,"drawingPaper.shape.cloneInstance":this.transferEvent,"drawingPaper.shape.clickBtnOldHtml":this.transferEvent,"drawingPaper.shape.clickBtnConvertBackgroundImage":this.transferEvent,"drawingPaper.beginEdit":this.transferEvent,"drawingPaper.endEdit":this.transferEvent,"drawingPaper.renderComplete":this.transferEvent,"drawingPaper.contextmenuData":this.transferEvent,"drawingPaper.changeActive":this.transferEvent,"drawingPaper.deSelectPositionCollection":this.transferEvent,"report.activeArea":this.transferEvent,"report.areaClick":this.transferEvent,"report.resizeMargin":this.transferEvent,"report.resizeMarginEnd":this.transferEvent,"report.changeAreaHeight":this.transferEvent,scope:this});this.events.register(ecount.gridV2.event.ready,this,this.transferEvent);this.events.register(ecount.grid.event.list.preInit,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderingError,this,this.transferEvent);this.events.register(ecount.grid.event.list.afterFormLoad,this,this.transferEvent);this.events.register(ecount.grid.event.list.initAddRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderAllRowComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.afterRowDataLoad,this,this.transferEvent);this.events.register(ecount.grid.event.list.preInitDrag,this,this.transferEvent);this.events.register(ecount.grid.event.list.dragEndPreInit,this,this.transferEvent);this.events.register(ecount.grid.event.list.dragEndCompleted,this,this.transferEvent);this.events.register(ecount.grid.event.list.resizing,this,this.transferEvent);this.events.register(ecount.grid.event.list.resizeEndCompleted,this,this.transferEvent);this.events.register(ecount.grid.event.list.activate,this,this.transferEvent);this.events.register(ecount.grid.event.list.gridResized,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeDisplaySetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formDisplaySetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeShowText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formShowText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeHideText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formHideText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeAddedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeRemovedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formRemovedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeAddedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeRemovedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formRemovedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeMerged,this,this.transferEvent);this.events.register(ecount.grid.event.list.formMerged,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeDivided,this,this.transferEvent);this.events.register(ecount.grid.event.list.formDivided,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAdd,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddItem,this,this.transferEvent);this.events.register(ecount.grid.event.list.formConnectItem,this,this.transferEvent);this.events.register(ecount.grid.event.list.formDeleteItem,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeBatchSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBatchSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeTotalSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formTotalSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetBeforeFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetBeforeCancelFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetCancelFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.selectorBeforeSelect,this,this.transferEvent);this.events.register(ecount.grid.event.list.selectorSelect,this,this.transferEvent);this.events.register(ecount.grid.event.list.initMoveContainer,this,this.transferEvent);this.events.register(ecount.grid.event.list.containerMoving,this,this.transferEvent);this.events.register(ecount.grid.event.list.movedContainer,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetDragPrepareComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetDragComplete,this,this.transferEvent);this.events.register(ecount.gridV2.cellEvent.renderCompleted,this,this.transferEvent);this.events.register("grid.onRendering",this,this.transferEvent);this.events.register(ecount.grid.event.list.beforeOpeningContextmenu,this,this.transferEvent);this.events.register(ecount.grid.event.list.afterOpeningContextmenu,this,this.transferEvent);this.events.register(ecount.grid.event.list.completedOpenContextmenu,this,this.transferEvent);this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer)},ecRequire:function(){var n=$.makeArray(arguments);n.push(this);ecount.runtime.require.apply(this,n)},loadDependencies:function(n,t){n.length>0?this.ecRequire(n,t):t()},render:function(){function t(n){ecount.layout.prototype.render.apply(this,n);this.clipboard=this._options.clipboard||new ecount.report.clipboard;this.isCustomReport?this.addItem(this.items):(this.createHeader(this._header),this.createTop(this._top),this.createBody(this._body),this.createBottom(this._bottom),this.createFooter(this._footer));this.useMarginGuideLine!==!1&&this.createMarginGuideLine();this.gridGuideData.data&&this.gridGuideData.data.length>0&&this.createGridGuide();this.hidden&&this.$el.hide();this.isHideHeader&&this.$el.find("div.report-area-header").addClass("hide");this.isHideFooter&&this.$el.find("div.report-area-footer").addClass("hide");this.setViewAreaGuideEvent();this.bindKeydownEvent();this.bindKeyupEvent();this.$el.bind("scroll."+[this.ecPageID,this.tabId,this.id].join(ecount.delimiter),function(n){ecount.runtime.notify("scroll.page.eventContainer","clearLayer",n);ecount.runtime.notify("scroll.page.eventContainer",this.ecPageID,n);ecount.runtime.notify("scroll.page.eventContainer",[this.ecPageID,"grid"].join("_"),n)}.bind(this));this.smartGuideManager.render(this.$el);this.ecTransaction.start()}var n=arguments;this.loadDependencies(this.dependencyList,t.bind(this,n))},setcontainerOption:function(n,t){t.tabId=this.tabId;t.ecPageID=this.ecPageID;t.containerName=this.containerName;t.delegator=this.events;t.containerDelegator=this.containerDelegator;t.historyInstance=this.history;t.mappingDataCollection=this.mappingDataCollection;t.eventContainer=this.eventContainer;var i;return["header","top","bottom","footer"].contains(n)?(t.clipboardInstance=this.clipboard,t.smartGuideManagerInstance=this.smartGuideManager,t.stageSelector=".stage",t.scrollContainerSelector=".wrapper-report-stage",t.containerArea=n,i=new ecount.layout[t.__controlType](t)):i=new ecount.layout.grid(t),i},createHeader:function(n){var i,r,u,t;if(n&&n.items.length>0){for(i=$('<div class="report-area-header" data-role="header" data-area-name='+ecount.resource.LBL19971+"/>"),r=0,u=n.items.length;r<u;r++)(t=this.setcontainerOption("header",n.items[r]),t)&&(t.render(i),this.headerList.push(t),this.itemList.push(t));i.append($('<div class="report-area-handle" />'));this.$el.find('div[data-category="stage"]').append(i)}},createTop:function(n){var i,r,u,t;if(n&&n.items.length>0){for(i=$('<div class="report-area-top" data-role="top" />'),r=0,u=n.items.length;r<u;r++)(t=this.setcontainerOption("top",n.items[r]),t)&&(t.render(i),this.topList.push(t),this.itemList.push(t));i.append($('<div class="report-area-handle" />'));this.$el.find('div[data-category="stage"]').append(i)}},createBody:function(n){var r,t,u,i;if(n&&n.items.length>0){for(r=$('<div class="report-area-body" data-role="body" />'),t=0,u=n.items.length;t<u;t++)i=this.setcontainerOption("body",n.items[t]),i.render(r),this.bodyList.push(i),this.itemList.push(i);this.$el.find('div[data-category="stage"]').append(r)}},createBottom:function(n){var i,r,u,t;if(n&&n.items.length>0){for(i=$('<div class="report-area-bottom" data-role="bottom" />'),r=0,u=n.items.length;r<u;r++)(t=this.setcontainerOption("bottom",n.items[r]),t)&&(t.render(i),this.bottomList.push(t),this.itemList.push(t));i.append($('<div class="report-area-handle" />'));this.$el.find('div[data-category="stage"]').append(i)}},createFooter:function(n){var i,r,u,t;if(n&&n.items.length>0){for(i=$('<div class="report-area-footer" data-role="footer" data-area-name='+ecount.resource.LBL19972+"/>"),r=0,u=n.items.length;r<u;r++)(t=this.setcontainerOption("footer",n.items[r]),t)&&(t.render(i),this.footerList.push(t),this.itemList.push(t));i.append($('<div class="report-area-handle" />'));this.$el.find('div[data-category="stage"]').append(i)}},createMarginGuideLine:function(){var n=this.marginGuideLineTemplate.replace("{{showAll}}",this.marginData.isHide!==!1?"show-all hide":"show-all").replaceAll("{{topMargin}}",(this.marginData.top||0).toString()).replaceAll("{{bottomMargin}}",(this.marginData.bottom||0).toString()).replaceAll("{{leftMargin}}",(this.marginData.left||0).toString()).replaceAll("{{rightMargin}}",(this.marginData.right||0).toString());this.$el.find('div[data-category="stage"]').append(n)},createGridGuide:function(){for(var n,i="",r="",t=0;t<this.gridGuideData.data.length;t++)n=this.gridGuideData.data[t],r+='<div data-cid="{{id}}" class="row-title" style="height: {{height}}px;">{{label}}<\/div>'.replace("{{height}}",n.height).replace("{{label}}",n.label).replace("{{id}}",n.id);i=this.gridGuideTemplate.replace("{{hide}}",this.gridGuideData.isHide?"hide":"").replace("{{rightPosition}}",parseInt(this.gridGuideData.rightPosition)*-1).replace("{{guideList}}",r);this.$el.find("div.report-area-body").append(i)},setGridGuid:function(){for(var n,i="",t=0;t<this.gridGuideData.data.length;t++)n=this.gridGuideData.data[t],i+='<div data-cid="{{id}}" class="row-title" style="height: {{height}}px;">{{label}}<\/div>'.replace("{{height}}",n.height).replace("{{label}}",n.label).replace("{{id}}",n.id);this.$el.find('div[data-category="gridGuide"]').find(".row-titles").html(i)},setGridGuideData:function(n){this.gridGuideData.data=n},getGridGuideData:function(){return this.gridGuideData.data},setViewAreaGuideEvent:function(){var t=this,n;this.$el.find("div.report-area-handle").hover(function(){n=$(this).parent().attr("data-role");n&&t.showViewAreaGuideLine(n)},function(){n&&!t.isTempViewAreaGuideLine[n]&&t.hideViewAreaGuideLine(n)})},setTemplate:function(n){var t=n.css||"",r=n.wrapperCss||"",i;n.viewAreaGuide===!1&&(t+=" report-area-invisible");i=_.isNil(n.isHidePaper)?!0:n.isHidePaper;this.template=ecount.widget.replaceAttr(this.template,{paperStyle:ecount.convertor.convertToStyle(this.paperStyle),stageClass:t,showPaper:i===!0?"":"show-paper",wrapperStageClass:r,resizeHandle:n.useResizeHandle?this.resizeHandleTemplate:""})},addItem:function(n){var u,r,f;if(n&&n.length>0)for(u=this.$el.find('div[data-category="stage"]'),r=0,f=n.length;r<f;r++){var t=n[r],i=null,e=null;t.__pnode=this.__type;t.ecPageID=this.ecPageID;t.delegator=this.delegator;t.containerDelegator=this.events;t.containerName=this.containerName;t.ecTransaction=this.ecTransaction;t.stageSelector=".stage";t.scrollContainerSelector=".wrapper-report-stage";t.__type===widget.generator.CONTROL?(e=ecount.common.createNamespace(t.controlType),t.id||(t.id=ecount.common.uuid(t.controlType)),i=new e(t)):(t.popupID=this.popupID,t.popupLevel=this.popupLevel,t.eventContainer=this.eventContainer,i=new ecount.layout[t.__controlType](t));this.itemList.push(i);i.render(u);u.append(i);i=null}},getTop:function(){return this.topList.length==0?null:this.topList[0]},getHeader:function(){return this.headerList.length==0?null:this.headerList[0]},getBody:function(){return this.bodyList.length==0?null:this.bodyList},getFooter:function(){return this.footerList.length==0?null:this.footerList[0]},getBottom:function(){return this.bottomList.length==0?null:this.bottomList[0]},getItemById:function(n){var t=_.find(this.topList,function(t){return t.id===n});return t?t:(t=_.find(this.headerList,function(t){return t.id===n}),t)?t:(t=_.find(this.bodyList,function(t){return t.id===n}),t)?t:(t=_.find(this.footerList,function(t){return t.id===n}),t)?t:(t=_.find(this.bottomList,function(t){return t.id===n}),t)?t:null},getItems:function(n){return n?this.itemList.find(function(t){return t.id===n}):null},activeTop:function(){this.deactive();this.$el.find("div.report-area-top").addClass("active")},activeHeader:function(){this.deactive();this.$el.find("div.report-area-header").addClass("active")},activeBody:function(){this.deactive();this.$el.find("div.report-area-body").addClass("active")},activeFooter:function(){this.deactive();this.$el.find("div.report-area-footer").addClass("active")},activeBottom:function(){this.deactive();this.$el.find("div.report-area-bottom").addClass("active")},deactive:function(){this.$el.find("div.report-area-header").removeClass("active");this.$el.find("div.report-area-top").removeClass("active");this.$el.find("div.report-area-body").removeClass("active");this.$el.find("div.report-area-bottom").removeClass("active");this.$el.find("div.report-area-footer").removeClass("active")},getActiveArea:function(){return this.$el.find("div.report-area-header").hasClass("active")?"header":this.$el.find("div.report-area-top").hasClass("active")?"top":this.$el.find("div.report-area-body").hasClass("active")?"body":this.$el.find("div.report-area-bottom").hasClass("active")?"bottom":this.$el.find("div.report-area-footer").hasClass("active")?"footer":null},setGridGuidePosition:function(n){var t=parseInt(n);t==null&&(t=5);this.$el.find('div[data-category="gridGuide"]').css("right",t*-1)},setGridGuide:function(n){for(var r,i=_.isString(n)?[n]:n,u=this.$el.find('div[data-category="gridGuide"]'),t=0;t<i.length;t++)r=u.find('[data-cid="'+i[t].id+'"]'),i[t].height>0?(r.removeClass("hide"),r.height(i[t].height-1),i[t].label&&i[t].label&&r.text(i[t].label)):r.addClass("hide")},showGridGuide:function(){this.$el.find('div[data-category="gridGuide"]').removeClass("hide")},hideGridGuide:function(){this.$el.find('div[data-category="gridGuide"]').addClass("hide")},toggleMarginGuideLine:function(n,t){n?this.showMarginGuideLine(t):this.hideMarginGuideLine(t);this.marginData.isHide=!n},showMarginGuideLine:function(n){n=n||"all";var t=this.$el.find("div.report-area-print-margin-guide"),i="show-"+n;t.hasClass(i)||t.addClass(i)},hideMarginGuideLine:function(n){n=n||"all";var t="show-"+n;this.$el.find("div.report-area-print-margin-guide").removeClass(t).removeClass("show-unit")},showAllMarginGuideLine:function(){var n=this.$el.find("div.report-area-print-margin-guide");n&&(n.removeClass("hide"),this.marginData.isHide=!1)},hideAllMarginGuideLine:function(){var n=this.$el.find("div.report-area-print-margin-guide");n&&(n.addClass("hide"),this.marginData.isHide=!0)},showMarginGuideUnit:function(){var n=this.$el.find("div.report-area-print-margin-guide"),t="show-unit";n.hasClass(t)||n.addClass(t)},hideMarginGuideUnit:function(){this.$el.find("div.report-area-print-margin-guide").removeClass("show-unit")},showViewAreaGuide:function(){this.$el.find('div[data-category="stage"]').removeClass("report-area-invisible")},hideViewAreaGuide:function(){var n=this.$el.find('div[data-category="stage"]');n.hasClass("report-area-invisible")||n.addClass("report-area-invisible")},showViewAreaGuideLine:function(n){switch(n){case"header":this.$el.find('div[data-category="stage"]').addClass("show-guide-header");break;case"top":this.$el.find('div[data-category="stage"]').addClass("show-guide-top");break;case"bottom":this.$el.find('div[data-category="stage"]').addClass("show-guide-bottom");break;case"footer":this.$el.find('div[data-category="stage"]').addClass("show-guide-footer");break;default:this.$el.find('div[data-category="stage"]').addClass("show-guide-top").addClass("show-guide-bottom")}},hideViewAreaGuideLine:function(n){switch(n){case"header":this.$el.find('div[data-category="stage"]').removeClass("show-guide-header");break;case"top":this.$el.find('div[data-category="stage"]').removeClass("show-guide-top");break;case"bottom":this.$el.find('div[data-category="stage"]').removeClass("show-guide-bottom");break;case"footer":this.$el.find('div[data-category="stage"]').removeClass("show-guide-footer");break;default:this.$el.find('div[data-category="stage"]').removeClass("show-guide-top").removeClass("show-guide-bottom")}},showViewPaperGuide:function(){this.$el.addClass("show-paper")},hideViewPaperGuide:function(){this.$el.removeClass("show-paper")},toggleViewAreaGuideLine:function(n,t){n?this.showViewAreaGuideLine(t):this.hideViewAreaGuideLine(t);this.isTempViewAreaGuideLine[t]=n},setPaperWidth:function(n){this.$el.find('div[data-category="stage"]').css("width",n+"mm")},setPaperSize:function(n){var t=this.$el.find('div[data-category="stage"]'),i=n?n.width:t.width(),r=n?n.height:t.height();t&&(t.css("width",i+"px"),t.css("height",r+"px"))},setMarginGuide:function(n){this.marginData.top=n.top||this.marginData.top;this.marginData.bottom=n.bottom||this.marginData.bottom;this.marginData.left=n.left||this.marginData.left;this.marginData.right=n.right||this.marginData.right;this.$el.find("div.print-margin-guide-top").css("top",this.marginData.top+"mm").attr("data-size",this.marginData.top);this.$el.find("div.print-margin-guide-bottom").css("bottom",this.marginData.bottom+"mm").attr("data-size",this.marginData.bottom);this.$el.find("div.print-margin-guide-left").css("left",this.marginData.left+"mm").attr("data-size",this.marginData.left);this.$el.find("div.print-margin-guide-right").css("right",this.marginData.right+"mm").attr("data-size",this.marginData.right)},getMarginGuide:function(){return this.marginData},showArea:function(n){switch(n){case"header":this.$el.find("div.report-area-header").removeClass("hide");break;case"top":this.$el.find("div.report-area-top").removeClass("hide");break;case"body":this.$el.find("div.report-area-body").removeClass("hide");break;case"bottom":this.$el.find("div.report-area-bottom").removeClass("hide");break;case"footer":this.$el.find("div.report-area-footer").removeClass("hide")}},hideArea:function(n){var t;switch(n){case"header":t=this.$el.find("div.report-area-header");t.hasClass("hide")||t.addClass("hide");break;case"top":t=this.$el.find("div.report-area-top");t.hasClass("hide")||t.addClass("hide");break;case"body":t=this.$el.find("div.report-area-body");t.hasClass("hide")||t.addClass("hide");break;case"bottom":t=this.$el.find("div.report-area-bottom");t.hasClass("hide")||t.addClass("hide");break;case"footer":t=this.$el.find("div.report-area-footer");t.hasClass("hide")||t.addClass("hide")}},isShowArea:function(n){switch(n){case"header":return!this.$el.find("div.report-area-header").hasClass("hide");case"top":return!this.$el.find("div.report-area-top").hasClass("hide");case"body":return!this.$el.find("div.report-area-body").hasClass("hide");case"bottom":return!this.$el.find("div.report-area-bottom").hasClass("hide");case"footer":return!this.$el.find("div.report-area-footer").hasClass("hide")}return!1},renewDimension:function(){var n=this.$el.find('div[data-category="stage"]').width(),t=this.$el.parent().width(),i=80,r=100;t-n<r?this.$el.css("padding-left",i+"px"):t<n+r+i?this.$el.css("padding-left",n-t+r+i+"px"):this.$el.css("padding-left",0)},renewMarginPosition:function(){this._moveMarginGuide(this.marginData.top,"top",this.$el.find("div.print-margin-guide-top"));this._moveMarginGuide(this.marginData.bottom,"bottom",this.$el.find("div.print-margin-guide-bottom"));this._moveMarginGuide(this.marginData.left,"left",this.$el.find("div.print-margin-guide-left"));this._moveMarginGuide(this.marginData.right,"right",this.$el.find("div.print-margin-guide-right"))},_setDragEvent:function(){this.horizontalDrag=new ecount.draggable;this.verticalDrag=new ecount.draggable;this.horizontalDrag.setDragData({id:this.id+"_horizontal",target:this.$el.find("div.print-margin-guide-left .print-margin-guide-handle, div.print-margin-guide-right .print-margin-guide-handle"),helper:"none",droppable:this.$el,axis:"horizontal",drag_start:this._dragStartEvent.bind(this),drag_move:this._dragMoveEvent.bind(this),drag_stop:this._dragStopEvent.bind(this)});this.verticalDrag.setDragData({id:this.id+"_vertical",target:this.$el.find("div.print-margin-guide-top .print-margin-guide-handle, div.print-margin-guide-bottom .print-margin-guide-handle"),helper:"none",droppable:this.$el,axis:"vertical",drag_start:this._dragStartEvent.bind(this),drag_move:this._dragMoveEvent.bind(this),drag_stop:this._dragStopEvent.bind(this)});this.areaDrag=new ecount.draggable;this.areaDrag.setDragData({id:this.id+"_topArea",target:this.$el.find("div.report-area-handle"),helper:"none",droppable:this.$el,axis:"vertical",drag_start:this._dragAreaStartEvent.bind(this),drag_move:this._dragAreaMoveEvent.bind(this),drag_stop:this._dragAreaStopEvent.bind(this)});this.resizeHandleDrag=new ecount.draggable;this.resizeHandleDrag.setDragData({id:this.id+"_resizeHandle",target:this.$el.find("div.stage-resize-handle"),helper:"none",droppable:this.$el,axis:"vertical",drag_start:this._dragResizeHandleStartEvent.bind(this),drag_move:this._dragResizeHandleMoveEvent.bind(this),drag_stop:this._dragResizeHandleStopEvent.bind(this)})},_dragResizeHandleStartEvent:function(n){this._clientY=n.originalEvent.clientY;this._areaHeight=$(n.originalEvent.target).parent().height();this.dragTarget=n.originalEvent.target;this.isFirstMove=!0},_dragResizeHandleMoveEvent:function(n){var i=$(this.dragTarget).parent().attr("data-role"),r=n.originalEvent.clientY-this._clientY,u={area:i,value:r,isFirstMove:this.isFirstMove,command:"onReportChangeAreaHeight"},t;this.delegator.triggerEvent("report.changeAreaHeight",u);t=this.getScrollContainer();t&&t.length&&t.scrollTop(t.prop("scrollHeight"));this.isFirstMove=!1},_dragResizeHandleStopEvent:function(){this._clientY=0;this._areaHeight=0;this.dragTarget=null},_dragAreaStartEvent:function(n){this._clientY=n.originalEvent.clientY;this._areaHeight=$(n.originalEvent.target).parent().height();this.dragTarget=n.originalEvent.target;this.dragArea=$(this.dragTarget).parent().attr("data-role");this.dragArea&&this.toggleViewAreaGuideLine(!0,this.dragArea)},_dragAreaMoveEvent:function(n){var t,i;if(!this.dragArea)return!1;t=this._areaHeight+n.originalEvent.clientY-this._clientY;t<0&&(t=0);i={area:this.dragArea,value:t,command:"onReportChangeAreaHeight"};this.delegator.triggerEvent("report.changeAreaHeight",i)},_dragAreaStopEvent:function(){this.dragArea&&this.toggleViewAreaGuideLine(!1,this.dragArea);this._clientY=0;this._areaHeight=0;this.dragTarget=null;this.dragArea=null},_dragStartEvent:function(n){var t,i;if(this.canDragMarginGuideLine&&!this.canDragMarginGuideLine())return!1;if(t=_.get(n,"originalEvent.target.parentElement.className"),t)i=t.split("-"),this._clientX=n.originalEvent.clientX,this._clientY=n.originalEvent.clientY,this.dragTarget=n.originalEvent.target.parentElement,this.dragPosition=i[3],this.showMarginGuideLine(),this.showMarginGuideUnit();else return!1},_dragMoveEvent:function(n){var i=0,t=0,r;if(!this.dragPosition)return!1;switch(this.dragPosition){case"top":i=this._convertUnitData(n.originalEvent.clientY-this._clientY);t=+this.marginData.top+i;break;case"bottom":i=this._convertUnitData(n.originalEvent.clientY-this._clientY);t=+this.marginData.bottom+-i;break;case"left":i=this._convertUnitData(n.originalEvent.clientX-this._clientX);t=+this.marginData.left+i;r=+this.paperStyle.width.split("mm")[0];t=Math.min(t,r-+this.marginData.right);break;case"right":i=this._convertUnitData(n.originalEvent.clientX-this._clientX);t=+this.marginData.right+-i;r=+this.paperStyle.width.split("mm")[0];t=Math.min(t,r-+this.marginData.left)}t<0&&(t=0);this.validateMarginGuideLine&&(t=this.validateMarginGuideLine({dragPosition:this.dragPosition,value:t,marginMinSpace:this.marginMinSpace}));t=parseInt(t);this._moveMarginGuide(t,this.dragPosition,this.dragTarget);this.dragDistance=t},_dragStopEvent:function(){switch(this.dragPosition){case"top":this.marginData.top=this.dragDistance;break;case"bottom":this.marginData.bottom=this.dragDistance;break;case"left":this.marginData.left=this.dragDistance;break;case"right":this.marginData.right=this.dragDistance}this._moveMarginGuideEnd(this.dragDistance);this.hideMarginGuideUnit();this.marginData.isHide&&this.hideMarginGuideLine();this.dragTarget=null;this.dragPosition=null;this.dragDistance=0;this._clientX=0;this._clientY=0},_convertUnitData:function(n){return n*this.mmUnit},_moveMarginGuide:function(n,t,i){var r,e;if(n=+n,t=="bottom"){var u=this.$el.find('div[data-category="stage"]'),o=this._convertUnitData(u.height()),f=n-(this.bottomSpare+o-this.marginMinSpace),s=f>0?this.bottomSpare+f:this.bottomSpare;u.css({"padding-bottom":s+"mm"})}r=$(i);r.attr("data-size",+(+n).toFixed(2));r.css(t,n+"mm");t=="top"&&this.$el.find('div[data-category="stage"]').css("padding-top",n+"mm");e={position:t,value:n,command:"onReportResizeMargin"};this.delegator.triggerEvent("report.resizeMargin",e)},_moveMarginGuideEnd:function(n){var t={position:this.dragPosition,value:n,command:"onReportResizeMarginEnd"};this.delegator.triggerEvent("report.resizeMarginEnd",t)},getScrollContainer:function(){return this.scrollContainerSelector?this.$el.closest(this.scrollContainerSelector):null},getAreaOf:function(n){return n?_.some(this.topList,function(t){return t.id===n})?"top":_.some(this.headerList,function(t){return t.id===n})?"header":_.some(this.bodyList,function(t){return t.id===n})?"body":_.some(this.footerList,function(t){return t.id===n})?"footer":_.some(this.bottomList,function(t){return t.id===n})?"bottom":null:null},transferEvent:function(n){if(n.type=="report.activeArea"&&(n.command="onReportActiveArea"),n.__eventType){var t=Array.prototype.slice.call(arguments);return this.delegator._triggerEvent.apply(this.delegator,[n.__eventType].concat(t))}this.delegator.triggerEvent(n.type,n)},bindKeydownEvent:function(){$(document).on("keydown.report-"+this.id,function(n){var t=this.ON_DOCUMENT_KEYDOWN(ec$.getEcEvent(n),n);if(t&&t.length)return t.filter(function(n){return!!n.cancelBubble}).length>0}.bind(this))},unbindKeydownEvent:function(){$(document).off("keydown.report-"+this.id)},bindKeyupEvent:function(){$(document).on("keyup.report-"+this.id,function(n){this.ON_DOCUMENT_KEYUP(ec$.getEcEvent(n),n)}.bind(this))},unbindKeyupEvent:function(){$(document).off("keyup.report-"+this.id)},destroy:function(){this.unbindKeydownEvent();this.unbindKeyupEvent();this.horizontalDrag&&this.horizontalDrag.destroy();this.verticalDrag&&this.verticalDrag.destroy();this.areaDrag&&this.areaDrag.destroy();this.resizeHandleDrag&&this.resizeHandleDrag.destroy();this.clipboard&&this.clipboard.destroy();ecount.layout.prototype.destroy.call(this)},onLoadComplete:function(){var n={target:this.containerName,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n);this._setDragEvent()},onLoadItem:function(n,t){this._loadedItemCount++;(t||3==this._loadedItemCount)&&this.delegator.triggerEvent("container.onload",{target:this.__type,self:this})},ON_MOUSEDOWN:function(n,t,i,r){function f(n){r.type="report.activeArea";r.command="onReportActiveArea";r.activeArea=n;this.transferEvent(r)}if(n.which==1||n.which==3)if(n.ecRole)f.call(this,n.ecRole);else{var e=n.gridID||n.id,u=this.getAreaOf(e);n.gridID&&(r._targetArea="GRIDAREA");u&&f.call(this,u)}},isMarginGuide:function(n){return _.some(n,function(n){return n=="print-margin-guide-handle"})},isAreaHandle:function(n){return _.includes(n,"report-area-handle")},getMarginGuideElements:function(){return{left:this.$el.find(".print-margin-guide-left")[0],top:this.$el.find(".print-margin-guide-top")[0],right:this.$el.find(".print-margin-guide-right")[0],bottom:this.$el.find(".print-margin-guide-bottom")[0]}},getMarginGuideHandleWidth:function(){return(this.$el.find(".print-margin-guide-left").width()-1)/2},getMarginGuidePosition:function(n){var i,t;switch(n){case"top":if(i=this.$el.find(".print-margin-guide-top")[0],i)return t=topGuide.getBoundingClientRect(),t.top+t.height/2;break;case"bottom":if(i=this.$el.find(".print-margin-guide-bottom")[0],i)return t=i.getBoundingClientRect(),t.top+t.height/2;break;case"left":if(i=this.$el.find(".print-margin-guide-left")[0],i)return t=i.getBoundingClientRect(),t.left+t.width/2;break;case"right":if(i=this.$el.find(".print-margin-guide-right")[0],i)return t=i.getBoundingClientRect(),t.left+t.width/2}return null},isClosestVisible:function(){var t=!0,n=this.$el[0];do{if(n.nodeType==Node.DOCUMENT_NODE)break;if(n.nodeType==Node.DOCUMENT_FRAGMENT_NODE)break;if(n.style.display=="none"){t=!1;break}}while(n=n.parentNode);return t},ON_DOCUMENT_KEYDOWN:function(){if(this.isClosestVisible())return this._eventPropagate("ON_DOCUMENT_KEYDOWN",arguments)},ON_DOCUMENT_KEYUP:function(){this.isClosestVisible()&&this._eventPropagate("ON_DOCUMENT_KEYUP",arguments)},onShapeChangeSmartGuide:function(){this.isClosestVisible()&&this._eventPropagate("onShapeChangeSmartGuide",arguments)},_eventPropagate:function(n,t){var r=_.reduce(this.topList,function(i,r){return r[n]&&i.push(r[n].apply(r,t)),i},[]),u=_.reduce(this.headerList,function(i,r){return r[n]&&i.push(r[n].apply(r,t)),i},[]),f=_.reduce(this.bodyList,function(i,r){return r[n]&&i.push(r[n].apply(r,t)),i},[]),e=_.reduce(this.footerList,function(i,r){return r[n]&&i.push(r[n].apply(r,t)),i},[]),o=_.reduce(this.bottomList,function(i,r){return r[n]&&i.push(r[n].apply(r,t)),i},[]),i;return this.isCustomReport?(i=_.reduce(this.itemList,function(i,r){return r[n]&&i.push(r[n].apply(r,t)),i},[]),_.compact(i)):_.compact(u.concat(f).concat(e).concat(r).concat(o))}},create:function(){var n=$.extend({},this.prop);ecount.layout.report=$.Class(ecount.layout,n)}}};ecount.layout.reportContainer||(ecount.layout.reportContainer={});ecount.layout.reportContainer._export=function(){return{prop:{template:'<div class="wrapper-ecount-report"><\/div>',init:function(){ecount.layout.prototype.init.apply(this,arguments);this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.headerList=[];this.bodyList=[];this.footerList=[];this.itemList=[];this.events=new ecount.events(this);this.events.on({"grid.append":this.transferEvent,"drawingPaper.all":this.transferEvent,"drawingPaper.history":this.transferEvent,"drawingPaper.shape":this.transferEvent,"drawingPaper.font":this.transferEvent,"drawingPaper.shapeStyle":this.transferEvent,"drawingPaper.layout":this.transferEvent,"drawingPaper.addMappingData":this.transferEvent,"drawingPaper.insertMappingData":this.transferEvent,"drawingPaper.insertHyperlink":this.transferEvent,"drawingPaper.editHyperlink":this.transferEvent,"drawingPaper.deleteHyperlink":this.transferEvent,"drawingPaper.viewSamples":this.transferEvent,"drawingPaper.setting":this.transferEvent,"drawingPaper.allSettings":this.transferEvent,"drawingPaper.initControl":this.transferEvent,"drawingPaper.makeCompleteControl":this.transferEvent,"drawingPaper.initPasteControl":this.transferEvent,"drawingPaper.shape.initTableCell":this.transferEvent,"drawingPaper.shape.dblClick":this.transferEvent,"drawingPaper.shape.select":this.transferEvent,"drawingPaper.shape.deselect":this.transferEvent,"drawingPaper.shape.click":this.transferEvent,"drawingPaper.shape.createInstance":this.transferEvent,"drawingPaper.shape.beforedestroyInstance":this.transferEvent,"drawingPaper.shape.destroyInstance":this.transferEvent,"drawingPaper.shape.cloneInstance":this.transferEvent,"drawingPaper.shape.clickBtnOldHtml":this.transferEvent,"drawingPaper.shape.clickBtnConvertBackgroundImage":this.transferEvent,"drawingPaper.beginEdit":this.transferEvent,"drawingPaper.endEdit":this.transferEvent,"drawingPaper.renderComplete":this.transferEvent,"drawingPaper.contextmenuData":this.transferEvent,"drawingPaper.changeActive":this.transferEvent,"drawingPaper.deSelectPositionCollection":this.transferEvent,"report.activeArea":this.transferEvent,"report.areaClick":this.transferEvent,"report.resizeMargin":this.transferEvent,"report.resizeMarginEnd":this.transferEvent,"report.changeAreaHeight":this.transferEvent,scope:this});this.events.register(ecount.gridV2.event.ready,this,this.transferEvent);this.events.register(ecount.grid.event.list.preInit,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderingError,this,this.transferEvent);this.events.register(ecount.grid.event.list.afterFormLoad,this,this.transferEvent);this.events.register(ecount.grid.event.list.initAddRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderAllRowComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.afterRowDataLoad,this,this.transferEvent);this.events.register(ecount.grid.event.list.preInitDrag,this,this.transferEvent);this.events.register(ecount.grid.event.list.dragEndPreInit,this,this.transferEvent);this.events.register(ecount.grid.event.list.dragEndCompleted,this,this.transferEvent);this.events.register(ecount.grid.event.list.resizing,this,this.transferEvent);this.events.register(ecount.grid.event.list.resizeEndCompleted,this,this.transferEvent);this.events.register(ecount.grid.event.list.activate,this,this.transferEvent);this.events.register(ecount.grid.event.list.gridResized,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeDisplaySetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formDisplaySetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeShowText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formShowText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeHideText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formHideText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeAddedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeRemovedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formRemovedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeAddedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeRemovedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formRemovedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeMerged,this,this.transferEvent);this.events.register(ecount.grid.event.list.formMerged,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeDivided,this,this.transferEvent);this.events.register(ecount.grid.event.list.formDivided,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAdd,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddItem,this,this.transferEvent);this.events.register(ecount.grid.event.list.formConnectItem,this,this.transferEvent);this.events.register(ecount.grid.event.list.formDeleteItem,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeBatchSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBatchSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeTotalSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formTotalSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetBeforeFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetBeforeCancelFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetCancelFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.selectorBeforeSelect,this,this.transferEvent);this.events.register(ecount.grid.event.list.selectorSelect,this,this.transferEvent);this.events.register(ecount.grid.event.list.initMoveContainer,this,this.transferEvent);this.events.register(ecount.grid.event.list.containerMoving,this,this.transferEvent);this.events.register(ecount.grid.event.list.movedContainer,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetDragPrepareComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetDragComplete,this,this.transferEvent);this.events.register(ecount.gridV2.cellEvent.renderCompleted,this,this.transferEvent);this.events.register("grid.onRendering",this,this.transferEvent);this.events.register(ecount.grid.event.list.beforeOpeningContextmenu,this,this.transferEvent);this.events.register(ecount.grid.event.list.afterOpeningContextmenu,this,this.transferEvent);this.events.register(ecount.grid.event.list.completedOpenContextmenu,this,this.transferEvent);this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer)},render:function(){ecount.layout.prototype.render.apply(this,arguments);this.createSettingPanel(this._settingPanel);this.createPanel(this._panel);this.hidden&&this.$el.hide();this.ecTransaction.start()},createSettingPanel:function(n){if(n&&n.items.length>0){var t=$('<div class="ecount-report-setting-panel" data-role="settingPanel"/>');this.createItems(n.items,t);t.append('<div class="setting-panel-toggler" data-role="panelToggle"/>');this.$el.append(t)}},createPanel:function(n){if(n&&n.items.length>0){var t=$('<div class="ecount-report-panel"/>');this.createItems(n.items,t);this.$el.append(t)}},createItems:function(n,t){var i,r,u,f;if(n&&n.length!==0)for(u=0,f=n.length;u<f;u++)i=n[u],i.itemIndex=u,i.delegator=this.delegator,i.containerDelegator=this.events,i.ecPageID=this.ecPageID,i.__type===widget.generator.CONTROL?(r=ecount.common.createNamespace(i.controlType),this.initializer&&ecount.control.initializeByUserSetting(this.initializer,i),r=new r(i)):(i.__type===widget.generator.TABPANE?i.colSize=this.colSize:i.__type===widget.generator.TABCONTENTS&&(this.onSingleMode=i.onSingleMode),i.hasScroll===!0&&(i.scrollContainer=t),i.popupID=this.popupID,i.popupLevel=this.popupLevel,i.eventContainer=this.eventContainer,r=new ecount.layout[i.__type](i)),this.itemList.push(r),r.render(t||this.$el),r=null;else this.onLoadItems()},onLoadComplete:function(){var n={target:this.containerName,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},toggleReportSettingPanel:function(n){var i=!1,t=this.$el.find(".ecount-report-setting-panel");n===!0?t.hasClass("open")||(t.addClass("open"),i=!0):n===!1?t.hasClass("open")&&(t.removeClass("open"),i=!0):(t.hasClass("open")?t.removeClass("open"):t.addClass("open"),i=!0);i&&this.delegator.triggerEvent("report.toggleSettingPanel",{command:"onReportToggleSettingPanel",isOpen:t.hasClass("open")})},getSettingPanel:function(){return this._settingPanel},getPanel:function(){return this._panel},ON_CLICK:function(n,t,i,r){if(n.ecRole=="panelToggle"){this.toggleReportSettingPanel();return}if($(t.target).closest(".ecount-report-setting-panel")[0]){event.command="onReportClickSettingPanel";this.delegator.triggerEvent("report.clickSettingPanel",event);return}r.cid!="panelToggle"&&this.toggleReportSettingPanel(!1)},ON_MOUSEDOWN:function(n){n.which==3&&this.toggleReportSettingPanel(!1)}},create:function(){var n=$.extend({},this.prop);ecount.layout.reportContainer=$.Class(ecount.layout,n)}}};ecount.layout.canvasEditorContainer||(ecount.layout.canvasEditorContainer={});ecount.layout.canvasEditorContainer._export=function(){return{prop:{_loadedItemCount:0,_mousedownGroupName:"canvasEditorContainersMousedown",template:'<div class="wrapper-print position-relative"><\/div>',init:function(n){ecount.layout.prototype.init.apply(this,arguments);_.extend(this,n);this.itemList=[];this.ecTransaction=new ecount.transaction({ecPageID:this.ecPageID});this.ecTransaction.complete(this.onLoadComplete.bind(this));this.events=new ecount.events(this);this.events.on({"grid.append":this.transferEvent,"drawingPaper.all":this.transferEvent,"drawingPaper.history":this.transferEvent,"drawingPaper.shape":this.transferEvent,"drawingPaper.font":this.transferEvent,"drawingPaper.shapeStyle":this.transferEvent,"drawingPaper.layout":this.transferEvent,"drawingPaper.addMappingData":this.transferEvent,"drawingPaper.insertMappingData":this.transferEvent,"drawingPaper.insertHyperlink":this.transferEvent,"drawingPaper.editHyperlink":this.transferEvent,"drawingPaper.deleteHyperlink":this.transferEvent,"drawingPaper.viewSamples":this.transferEvent,"drawingPaper.setting":this.transferEvent,"drawingPaper.allSettings":this.transferEvent,"drawingPaper.initControl":this.transferEvent,"drawingPaper.makeCompleteControl":this.transferEvent,"drawingPaper.initPasteControl":this.transferEvent,"drawingPaper.shape.initTableCell":this.transferEvent,"drawingPaper.shape.dblClick":this.transferEvent,"drawingPaper.shape.select":this.transferEvent,"drawingPaper.shape.click":this.transferEvent,"drawingPaper.shape.createInstance":this.transferEvent,"drawingPaper.shape.destroyInstance":this.transferEvent,"drawingPaper.shape.cloneInstance":this.transferEvent,"drawingPaper.shape.clickBtnOldHtml":this.transferEvent,"drawingPaper.beginEdit":this.transferEvent,"drawingPaper.endEdit":this.transferEvent,"drawingPaper.renderComplete":this.transferEvent,"drawingPaper.deSelectPositionCollection":this.transferEvent,"drawingPaper.changeActive":this.transferEvent,"report.activeArea":this.transferEvent,"report.areaClick":this.transferEvent,"report.resizeMargin":this.transferEvent,"report.resizeMarginEnd":this.transferEvent,"report.changeAreaHeight":this.transferEvent,scope:this});this.events.register(ecount.gridV2.event.ready,this,this.transferEvent);this.events.register(ecount.grid.event.list.preInit,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderingError,this,this.transferEvent);this.events.register(ecount.grid.event.list.afterFormLoad,this,this.transferEvent);this.events.register(ecount.grid.event.list.initAddRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.renderAllRowComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.afterRowDataLoad,this,this.transferEvent);this.events.register(ecount.grid.event.list.preInitDrag,this,this.transferEvent);this.events.register(ecount.grid.event.list.dragEndPreInit,this,this.transferEvent);this.events.register(ecount.grid.event.list.dragEndCompleted,this,this.transferEvent);this.events.register(ecount.grid.event.list.resizing,this,this.transferEvent);this.events.register(ecount.grid.event.list.resizeEndCompleted,this,this.transferEvent);this.events.register(ecount.grid.event.list.activate,this,this.transferEvent);this.events.register(ecount.grid.event.list.gridResized,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeDisplaySetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formDisplaySetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeShowText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formShowText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeHideText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formHideText,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeAddedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeRemovedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formRemovedColumn,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeAddedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeRemovedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formRemovedRow,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeMerged,this,this.transferEvent);this.events.register(ecount.grid.event.list.formMerged,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeDivided,this,this.transferEvent);this.events.register(ecount.grid.event.list.formDivided,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAdd,this,this.transferEvent);this.events.register(ecount.grid.event.list.formAddItem,this,this.transferEvent);this.events.register(ecount.grid.event.list.formConnectItem,this,this.transferEvent);this.events.register(ecount.grid.event.list.formDeleteItem,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeBatchSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBatchSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formBeforeTotalSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formTotalSetting,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetBeforeFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetBeforeCancelFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetCancelFixed,this,this.transferEvent);this.events.register(ecount.grid.event.list.selectorBeforeSelect,this,this.transferEvent);this.events.register(ecount.grid.event.list.selectorSelect,this,this.transferEvent);this.events.register(ecount.grid.event.list.initMoveContainer,this,this.transferEvent);this.events.register(ecount.grid.event.list.containerMoving,this,this.transferEvent);this.events.register(ecount.grid.event.list.movedContainer,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetDragPrepareComplete,this,this.transferEvent);this.events.register(ecount.grid.event.list.formSetDragComplete,this,this.transferEvent);this.events.register(ecount.gridV2.cellEvent.renderCompleted,this,this.transferEvent);this.events.register("grid.onRendering",this,this.transferEvent);this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer)},render:function(){ecount.layout.prototype.render.apply(this,arguments);this.addItem(this.items);this.bindMousedownEvent();this.ecTransaction.start()},addItem:function(n){var r,u;if(n&&n.length>0)for(r=0,u=n.length;r<u;r++){var t=n[r],i=null,f=null;t.tabId=this.tabId;t.__pnode=this.__type;t.ecPageID=this.ecPageID;t.delegator=this.delegator;t.containerDelegator=this.events;t.containerName=this.containerName;t.ecTransaction=this.ecTransaction;t.__type===widget.generator.CONTROL?(f=ecount.common.createNamespace(t.controlType),t.id||(t.id=ecount.common.uuid(t.controlType)),i=new f(t)):(t.popupID=this.popupID,t.popupLevel=this.popupLevel,t.eventContainer=this.eventContainer,i=new ecount.layout[t.__type](t));this.itemList.push(i);i.render(this.$el);this.$el.append(i);i=null}},transferEvent:function(n){if(n.__eventType){var t=Array.prototype.slice.call(arguments);return this.delegator._triggerEvent.apply(this.delegator,[n.__eventType].concat(t))}this.delegator.triggerEvent(n.type,n)},getEcEvent:function(n){var t=document.activeElement||ec$.getEventTarget(n);return $.extend(ec$.parseElement(t),{which:n.which,ctrlKey:n.ctrlKey,altKey:n.altKey,shiftKey:n.shiftKey,mouseButton:n.button,mouseButtons:n.buttons,clientX:n.clientX,clientY:n.clientY,syntheticEvent:n.originalEvent&&n.originalEvent.syntheticEvent,oType:n.type})},bindMousedownEvent:function(){ecount.common.clearMousedownEventListener(this._mousedownGroupName);ecount.common.addMousedownEventListener(ecount.runtime.root.document,this._mousedownGroupName,"canvas-"+this.ecIKey,function(n,t){var i=this.getEcEvent(n,t);this.ON_DOCUMENT_MOUSEDOWN(i,n)}.bind(this),0)},unbindMousedownEvent:function(){ecount.common.clearMousedownEventListener(this._mousedownGroupName)},getInnerDrawingPaper:function(){return this.innerDrawingPaper||(this.innerDrawingPaper=this.find(function(n){return n.id===this.drawingPaperId}.bind(this))[0]),this.innerDrawingPaper},destroy:function(){this.unbindMousedownEvent();ecount.layout.prototype.destroy.call(this)},onLoadComplete:function(){var n={target:this.containerName,type:this.__type,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},onLoadItem:function(n,t){this._loadedItemCount++;(t||3==this._loadedItemCount)&&this.delegator.triggerEvent("container.onload",{target:this.__type,self:this})},ON_DOCUMENT_MOUSEDOWN:function(n,t){function u(n){var t=ecount.constValue.drawingPaper.customAttributeForRelatedReport("selector");return!n.closest("[data-service='service.layer']").length&&!n.closest(t).length}var i=this.getInnerDrawingPaper(),r;i&&(r=$(t.target),this.$el.find(t.target).length?i.isActive()||(document.activeElement&&document.activeElement.blur(),i.active()):u(r)&&i.deactive())}},create:function(){var n=$.extend({},this.prop);ecount.layout.canvasEditorContainer=$.Class(ecount.layout,n)}}};ecount.class("ecount.control.codes.c02","ecount.control.codes.c01",{additionalItem:null,onInitState:function(n,t,i){ecount.control.codes.prototype.onInitState.apply(this,arguments);var r=i.codes||[];!r.length&&this.defaultLabel&&this.defaultValue&&r.push({cid:this.id,label:this.defaultLabel,value:this.defaultValue});t.selectedItems=r.map(function(n){return this._getSelectedItemData(n)}.bind(this));t.selectedItems.forEach(function(n){_.extend(n.rawData,i.addItem)}.bind(this));this.setAdditionalItem(i.addItem||{})},removeCode:function(n,t){var r=this.getState(this._IT_SELF,"selectedItems"),u,i;r&&r.length&&(u=r.filter(function(t,i){return!this.isRemoveableCode(t)||i!=n}.bind(this)),i=r[n],this.setState(this._IT_SELF,"selectedItems",u),!t&&i&&this.isRemoveableCode(i)&&this.executeChangeDelegator({action:"removeCode",args:[i.value,i.label]}))},removeAll:function(n){n=arguments.length===0?!0:n;var t;this.isAddAsteriskCode&&(this.isAddAsteriskCode=!1);t=this.getState(this._IT_SELF,"selectedItems").filter(function(n){return!this.isRemoveableCode(n)}.bind(this));this.setState(this._IT_SELF,"selectedItems",t);this.adjustItemContainer(!0);n&&!this.isInGrid()&&this.executeChangeDelegator({action:"removeCodesAll",removeItems:arguments&&arguments.length>1?arguments[1]:{}})},save:function(){return{key:this.id,value:{code:this.getSelectedCode(),additonalData:this.getAdditionalData}}},serialize:function(n){return{key:n||this.name,value:this.getSelectedCode()}},setAdditionalItem:function(){},removeAdditionalItem:function(){},isRemoveableCode:function(){return!0},isExistItem:function(n){return!this.isRemoveableCode(n)},addCodeByMessage:function(n,t){this._beforeAddCodeByMessageAction(n,t,function(){this._addCodeByMessage(n,t)}.bind(this))},addCodeByMessage:function(n,t){this._beforeAddCodeByMessageAction(n,t,function(){this._addCodeByMessage(n,t)}.bind(this))},reflowContainer:function(){var n;this.ecview&&(n=this.getState(this._IT_SELF,"selectedItems").find(function(n){return this.isRemoveableCode(n)}.bind(this)),n&&this.ecview.displayFunctions(),this.getState("more","opt.isExpanded")&&this.toggleItemList(!0))},_getSelectedItemData:function(n,t){var i=(n.label||n[this.labelColumn]||"").toString(),r=this._useSafeEscape?i.unescapeHTML().escapeHTML():i.escapeHTML(),u=n.value==undefined?n[this.valueColumn]:n.value,f=(n.bgColor||n[this.bgColorColumn]||"").toString().escapeHTML(),e=["label",n.CSS||"primary"].join("-");return $.isNull(t)||$.isNull(t.data)||$.isNull(this.bgColorColumn)||(bgColor=t.data[this.bgColorColumn]||""),_.merge({cid:this.id,label:r,originLabel:i,value:u,ecService:this.isUseTooltip?"tooltip":"",rawData:n,"style.css":e,"style.backgroundcolor":f,"opt.editable":this._editable},this.addItemExtraData(n))},_getInitailSelectedItems:function(n){return n},_decideFocus:function(){this.setFocusOutTrigger()},_addFilteredData:function(n,t){this.pendingViewUpdate(!0);this.isChangeEventPostpone&&this.disableDelegatorExecution();this.responseFilter(n).forEach(function(n,i,r){var u=_.merge(this._getMessageData(n,t),{index:i});i==r.length-1&&this.isChangeEventPostpone&&this.enableDelegatorExecution();this.isRemoveableCode(n)||this.updateNotRemoveableCode(n,i);this.addCode(n,!1,u);this.setAdditionalItem(u.data)}.bind(this));this.pendingViewUpdate(!1);this.batchUpdateView()},updateNotRemoveableCode:function(){},_getPopupOpenParameter:function(n){return _.extend({},this.defaultParam,{width:this.width||450,height:this.height||500,name:(this.popupType===!0?this.id:this.subTitle)||"",url:this.popupURL,popupType:this.popupType===!0,checkMaxCount:this.checkMaxCount,responseID:this.callbackID,keyword:"",selectedCodes:this.getSelectedCode(),isCheckBoxDisplayFlag:this.isCheckBoxDisplayFlag,isContainLevelGroup:this.isContainLevelGroup?this.getCheckLabelStatus():!1,tabID:this.tabID,controlID:this.id,gridID:this.gridID,ispopupCloseUse:!1,isOnePopupClose:!0,eventTarget:null,__ecPageID:this.ecPageID,__gridOpenPopupTriggerInfo:n.__gridOpenPopupTriggerInfo},n)}});ecount.class("ecount.control.view.codes.c02","ecount.control.view.codes.c01",{});ecount.class("ecount.control.date.d01","ecount.control.date",{ecPackage:"ecount.control.date.d01",init:function(){ecount.control.date.prototype.init.apply(this,arguments)},render:function(){ecount.control.date.prototype.render.apply(this,arguments);this.showOnlyFixedDatePicker()},showOnlyFixedDatePicker:function(){if(this.ecview&&this._isOnlyFixedDatePicker){var n=this.getLayerDatepickerOption({cid:this.cid,ecPageID:this.ecPageID,ecService:"layer.datepicker",ecPath:this.ecPath,serviceKey:this.getEcIKey()});this.datepickerLayer=new ecount.layer.datepicker(n);this.datepickerLayer.render(this.ecview.$el.find(".control"));this.datepickerLayer.show(n)}},setFixedDataPickerMonthMode:function(n){this.ecview&&this._isOnlyFixedDatePicker&&this._isMonthCalendar===!!n&&(this._isMonthCalendar=n===!1,this.datepickerLayer&&this.datepickerLayer.destroy(),this.showOnlyFixedDatePicker())},serialize:function(n){var t,i=[],r,u,f;return i=this._extractFormat?Date.format(this._extractFormat,this.getDate()[0]):[this.getSYear(),this.getSMonth().padLeft(2,"0"),this.getSDay().padLeft(2,"0")].join(""),t={key:n||this.name,value:i},this._hideDateControl&&!this._isOnlyFixedDatePicker&&(r=this.getComponentByAttr("ecRole","date.hide"),t[(n||this.name)+"_DATECHK"]=r["attr.checked"]?"1":"0"),this.useFnActivedItem()&&(u=this.getFnActivedId(),f=(n||this.name)+"_FN",t[f]=u),t},getLayerDatepickerOption:function(){return this._isYearCalender?!1:_.merge(ecount.control.date.prototype.getLayerDatepickerOption.apply(this,arguments),{singleDate:!0,_isOnlyFixedDatePicker:this._isOnlyFixedDatePicker})},checkDateValidation:function(n){var i=n[0].format("yyyyMMdd"),t=this.getComponent(this.getPositionIndex("y"));return this._minimumDate&&parseInt(i,10)<parseInt(this._minimumDate,10)?[{message:this._minimumError,method:"checkMinimumYMD"}]:this._checkYearRange(t,t.selectedValue)?void 0:[{message:ecount.resource.message.INVALID_YEAR,method:"checkInvalidYear"}]},isSingleDate:function(){return!0}});ecount.class("ecount.control.date.d02","ecount.control.date",{ecPackage:"ecount.control.date.d02",_hideDateIndividual:!1,_preventAutoSync:!1,_syncDateOnNativeEvent:!0,init:function(){ecount.control.date.prototype.init.apply(this,arguments)},initializeOptions:function(n){ecount.control.date.prototype.initializeOptions.apply(this,arguments);_.merge(this,{_hideDateIndividual:n._hideDateIndividual,_preventAutoSync:n._preventAutoSync,_syncDateOnNativeEvent:this._syncDateOnNativeEvent});this._isLastDay&&n.data&&n.data.length&&(n.data.splice(2,1,{value:"01"}),n.data.splice(5,1,{value:"01"}))},getInitDataComponents:function(n,t,i){var r=i.data,u=this.getDateSetLength();return this.getCompInOrder(n,t,i).map(function(n,i){if(!n.format)return n;this.setFormatIndex(n.format);switch(n.format){case"y":return this._getSelectboxYearComponent(n,i<u?r[0].selectedValue:r[3].selectedValue,i,t);case"m":return this._getSelectboxComponent(n,i<u?r[1].selectedValue:r[4].selectedValue,i,t);case"d":return this._getInputboxComponent(n,i<u?r[2].value:r[5].value,i,t);case"h1":return this._getSelectboxComponent(n,r[6].selectedValue,i,t);case"mi1":return this._getSelectboxComponent(n,r[7].selectedValue,i,t);case"h2":return this._getSelectboxComponent(n,r[8].selectedValue,i,t);case"mi2":return this._getSelectboxComponent(n,r[9].selectedValue,i,t);default:return n}}.bind(this))},getInitComponents:function(n,t,i){var r=this.getDefaultSelectedValue(n,t,i),u=this.getDateSetLength();return this.getCompInOrder(n,t,i).map(function(n,i){if(!n.format)return n;this.setFormatIndex(n.format);switch(n.format){case"y":return this._getSelectboxYearComponent(n,i<u?r.startYear:r.endYear,i,t);case"m":return this._getSelectboxComponent(n,i<u?r.startMonth:r.endMonth,i,t);case"d":return this._getInputboxComponent(n,i<u?r.startDay:r.endDay,i,t);case"h1":return this._getSelectboxComponent(n,r.startHours,i,t);case"mi1":return this._getSelectboxComponent(n,r.startMinutes,i,t);case"h2":return this._getSelectboxComponent(n,r.endHours,i,t);case"mi2":return this._getSelectboxComponent(n,r.endMinutes,i,t);default:return n}}.bind(this))},onInitFunction:function(n,t,i){ecount.control.date.prototype.onInitFunction.apply(this,arguments);var r=t.functions,u=this._hideDateControl&&!i._isDateOptionChecked;r.waveMark={ecFunction:"delimiter",ecRole:"delimiter","style.display":!u}},getCompInOrder:function(n,t,i){var r=this.getDateComponents(n,t,i),u=Object.clone(r,!0),f=this.getTimeComponents(n,t,i),e=this.getOptionalComponents(n,t,i);return r.concat(f).concat(u).concat(e).map(function(n,t){return _.merge(n,{index:t})})},getEYear:function(){var n=this.getComponent(this.getPositionIndex("y")+this.getDateSetLength()),t=(""+n.selectedValue).replace("====","");return n["opt.notVisible"]&&$.isEmpty(t)?(new Date).getFullYear():t},getEMonth:function(){return this._getDate("m",this.getDateSetLength()).replace("==","")},getERMonth:function(){var n=this.getPositionIndex("m")+this.getDateSetLength(),t=Number(this.getEMonth()),i=this._getDateComponentOnly();return t===0?"":i[n].selectedLabel},getEDay:function(){return this._isLastDay?this.getEndDateLastDay():this._getDate("d",this.getDateSetLength())},getDate:function(){var n=new Date,t=sYearComp=this.getComponent(this.getPositionIndex("y")+this.getDateSetLength()),i=!this._checkYearRange(t,t.selectedValue),r=ecount.control.date.prototype.getDate.call(this,arguments),u=this.isEmptyEndDate();return u?n=null:(n.setDate(1),n.setYear(i?n.getFullYear():this.getEYear()),n.setMonth(this.getEMonth()-1),this._isLastDay?n.setDate(this.getEndDateLastDay()):n.setDate(this.getEDay())),r.concat(n)},getLastDayOfSelectedMonth:function(n){return n<this.getDateSetLength()?this.getStartDateLastDay():this.getEndDateLastDay()},getEndDateLastDay:function(){return this.getLastDayOfMonth(this.getEYear(),this.getEMonth())},setEYear:function(n){var t=this.getPositionIndex("y")+this.getDateSetLength();this._checkYearRange(t,n)?(this.hideError(t),this._setDate(t,n)):(this._showInvalidYearError(t),this._setErrorYearValue(t,n))},setEMonth:function(n){this._setDate(this.getPositionIndex("m")+this.getDateSetLength(),n)},setEDay:function(n){this._setDate(this.getPositionIndex("d")+this.getDateSetLength(),this._isLastDay?this.getEndDateLastDay():n)},setDate:function(n,t){var i=$.isArray(n)?n:[n];t&&this.setNotChangeDelegatorFlag(!0);this._setSDate(i[0]);this._setEDate(i[1]);this.validateIf(this.getState(this._IT_SELF,"validate.needvalidate"));t&&this.setNotChangeDelegatorFlag(!1)},setFocusToEDate:function(){this.setFocus(this.getPositionIndex("d")+this.getDateSetLength())},toDateString:function(n){var t=this.getDate();return[t[0]?this.splitDate(t[0],this.dateFormat,n).join(""):"",t[0]?this.splitDate(t[1],this.dateFormat,n).join(""):""]},isSingleDate:function(){return!1},checkYearValidation:function(){for(var i=this.getPositionIndex("y"),r=[this.getComponent(i),this.getComponent(i+this.getDateSetLength())],n=0,u=r.length,t;n<u;n++)if(t=r[n],!this._checkYearRange(t,t.selectedValue))return[{message:ecount.resource.message.INVALID_YEAR,method:"checkInvalidYear"}]},checkDateValidation:function(n){var t=n[0].format("yyyyMMdd"),i=n[1].format("yyyyMMdd");if(parseInt(t,10)>parseInt(i,10))return[{message:ecount.resource.MSG03452,method:"checkSEDate"}]},displayChange:function(){this._hideDateIndividual&&ecount.control.date.prototype.displayChange.apply(this,arguments)},serialize:function(n){var u,f,e=this.getSYear(),o=this.getEYear(),s=this.getSMonth(),h=this.getEMonth(),t,i,r=[],c,l,a;return this._isLastDay?(t="01",i=this.getEndDateLastDay()):(t=this.getSDay(),i=this.getEDay(),t=t!=undefined?t.toString().padLeft(2,"0"):"",i=i!=undefined?i.toString().padLeft(2,"0"):""),this._extractFormat?(u=this._extractFormat.replace("yyyy",e).replace("MM",s.padLeft(2,"0")).replace("dd",t),f=this._extractFormat.replace("yyyy",o).replace("MM",h.padLeft(2,"0")).replace("dd",i)):(u=[e,s.padLeft(2,"0"),t].join(""),f=[o,h.padLeft(2,"0"),i].join("")),r.push({key:(n||this.name)+"_FROM",value:u}),r.push({key:(n||this.name)+"_TO",value:f}),this.label&&(c=comps.find(function(n){n.ecRole=="date.label"}),r.push({key:(n||this.name)+"_CHK",value:c["attr.checked"]?"1":"0"})),this._hideDateControl&&(l=this.getComponentByAttr("ecRole","date.hide"),r.push({key:(n||this.name)+"_DATECHK",value:l["attr.checked"]?"1":"0"})),this.useFnActivedItem()&&(a=this.getFnActivedId(),r.push({key:(n||this.name)+"_FN",value:a})),r},serializeAdditionalData:function(){var n=this.serialize();if(!_.isEmpty(n)){var t="DATE10",i=n[0].value.length==8?ecount.infra.getECDateFormat(t,!1,n[0].value.toDate()):"",r=n[1].value.length==8?ecount.infra.getECDateFormat(t,!1,n[1].value.toDate()):"";_.isEmpty(i)&&_.isEmpty(r)||(result=String.format("{0} ~ {1}",i,r))}return{name:this.subTitle,value:result}},onKeyInputFilter:function(n){var u=+n.ecRoleIndex,t=this.getPositionIndex("y"),i=this.getPositionIndex("d"),r=this.getDateSetLength();switch(u){case t:case t+r:this.setFilteredYearInput(n);break;case i:case i+r:this.setFilteredDayInput(n)}},getLayerDatepickerOption:function(){if(this._isYearCalender)return!1;var i=this._getDateComponentOnly(),u=this.getPositionIndex("y"),f=this.getPositionIndex("m"),r=this.getDateSetLength(),n=i[u+r],t=i[f+r];return _.merge(ecount.control.date.prototype.getLayerDatepickerOption.apply(this,arguments),{singleDate:!1,selectedEYear:{label:n.selectedLabel,value:n.selectedValue},selectedEMonth:{label:t.selectedLabel,value:t.selectedValue},eYearData:n.option.filter(this._getOptionsExceptEmpty.bind(this)),eMonthData:t.option.filter(this._getOptionsExceptEmpty.bind(this))})},setStandardValue:function(){var t=arguments.length>=1?arguments[1]:arguments[0],n=$.isArray(t)?t:[t],i;if(!n.contains("")){this.setDate.apply(this,arguments);return}n[0]!=""||this._hasEmptyComponentInDateSet(0)||(this._deleteSelectedDate(0,!0),this._setEDate(n[1]));n[1]==""&&(i=this.getDateSetLength(),this._hasEmptyComponentInDateSet(i)||(this._deleteSelectedDate(i,!0),this._setSDate(n[0])))},_getYearComponentIndexes:function(){var n=this.getPositionIndex("y");return[n,n+this.getDateSetLength()]},_getDayComponent:function(n){var t=this.getDateSetLength(),i=this.getComponent(n);return!~["h1, mi1, h2, mi2"].indexOf(i.format)&&n>=t?this.getComponent(this.dateFormat.indexOf("d")+t):this.getComponent(this.dateFormat.indexOf("d"))},_getNotDisplayFlagMap:function(){var n=ecount.control.date.prototype._getNotDisplayFlagMap.apply(this,arguments);return _.extend(n,{waveMark:!1})},_getYearValueFromEvent:function(n){var t=n.ecRoleIndex||n.cindex,i=this.getDateSetLength();return t>i?this.getEYear():this.getSYear()},_getDateSyncError:function(){return[]},_setSDate:function(n){var t=this.dateFormat.map(function(n,t){return t}),i=this.splitDate(n,this.dateFormat);this.setDateItem(t,i)},_setEDate:function(n){var t=this.getDateSetLength(),i=this.dateFormat.map(function(n,i){return i+t}),r=this.splitDate(n,this.dateFormat);this.setDateItem(i,r)},_setValidYearData:function(n,t){var i=n.ecRoleIndex||n.cindex,r=this.getComponent(i),u=this._checkYearRange(i,t);if(r.mode=="input"&&!u){this._showInvalidYearError(i);this._setErrorYearValue(i,t);return}u&&(!this.checkYearValidation()&&this.hasError()&&(this.setPreventHideError(!1),this.hideError(i)),this.setState(i,"selectedValue",t),this.setState(i,"selectedLabel",this._getSelectLabel(r,t)),this.setState(i,"mode","button"),this._addManualYearOption(i),this.hasEmptyComponent()||!this._syncDateOnNativeEvent||this._preventAutoSync||n.eventTriggerFromInternalTarget||this._setSyncedDate(n))},_setSyncEmptyData:function(n,t){var r=this.getDateSetLength(),i=n>=r?r:0;this._isDateSpace&&(this._isEmptyValue(t)?this._deleteSelectedDate(i):this.hasEmptyComponent(i)&&this._setDateToEmptyComponents(i))},_setSyncedDate:function(n){this._syncDate(n.ecRoleIndex||n.cindex)},_setSyncedDateByOpposite:function(n){var t=this.getComponent(n.ecRoleIndex||n.cindex),i;t&&t.format&&(i=this.getComponents().find(function(n){return n.format==t.format&&n.index!=t.index}),this._syncDate(i.index))},_setSyncedDateOnFocusIn:function(n){if(!this.getState(this._IT_SELF,"hasInvalidYearError"))if(n.eventTriggerFromInternalTarget){var t=this.getDateSetLength(),i=t>n.previousInternalTargetIndex?0:1,r=t>n.cindex?0:1;i!=r&&this._wrappingDateChangeFunc(this._setSyncedDateByOpposite)(n)}else this._wrappingDateChangeFunc(this._setSyncedDateByOpposite)(n)},_setSyncedDateOnFocusOut:function(n){ecount.global.setTimeout(this.ecPageID,function(){var i=this.getLayerServiceKey(n),t=ecount.layer.getLayer(i);this.hasFocus()||t&&t.hasFocus()||this._wrappingDateChangeFunc(this._setSyncedDate)(n)}.bind(this),0)},_syncDate:function(n){var t=this.getDateSetLength(),i=n<t,r=this.getDateFormat("yyyyMMdd"),f=i?r[0]:r[1],u;this._isFromDateLargerThanToDate()&&(u=this.dateFormat.map(function(n,r){return i?r+t:r}),this.setDateItem(u,this.splitDate(f,this.dateFormat)))},_isFromDateLargerThanToDate:function(){var n=this.getDate(),t=this.getDateFormat("yyyyMMdd");return $.isEmpty(n[0])||$.isEmpty(n[1])?!1:t[0]>t[1]},_checkDateSync:function(){var t=this._getDateSyncError(),i,n,r;if(this._hasInvalidDataToProcess()&&(this.hasError()&&this.hideError(this._IT_SELF),t.length)){for(i=[],n=0,r=t.length;n<r;n++)t[n].control=this,i.push(t[n].message);this.showError(this._IT_SELF,i.join("<br/>"),!0)}},_hasInvalidDataToProcess:function(){var n=this.getDate(),t=this.getDateFormat("yyyyMMdd");return $.isEmpty(n[0])||$.isEmpty(n[1])?!1:t[0]>t[1]?!0:!1},_syncOppositYear:function(){for(var t,u,f=this.getPositionIndex("y"),i=[this.getComponent(f),this.getComponent(f+this.getDateSetLength())],r=0,e=i.length,n;r<e;r++)n=i[r],this._checkYearRange(n,n.selectedValue)||(t=n.index==0?i[1]:i[0],this.setState(n.index,"selectedLabel",t.selectedLabel),this.setState(n.index,"selectedValue",t.selectedValue),this.setState(n.index,"value",t.value),this._syncDate(t.index));this.checkYearValidation()&&(u=(new Date).getFullYear(),this.setSYear(u),this.setEYear(u));this.setPreventHideError(!1);this.hideError()},_keepFocusInsideControl:function(n){this._preventAutoSync||this._hasInvalidDataToProcess()&&(this.setState(this._IT_SELF,"keepFocusInside",!0),ecount.runtime.observingOnce("page.runkeydown.afterSave",this.ecPageID,function(){ecount.global.setTimeout(this.ecPageID,function(){var t=this.getState(this._IT_SELF,"popover.message");this.setState(this._IT_SELF,"keepFocusInside",!1);this._setSyncedDate(n);t&&this.showError(this._IT_SELF,t)}.bind(this),0)}.bind(this)))},ON_FOCUSIN:function(n,t,i,r){var u=this.getComponent(n.ecRoleIndex||n.cindex);u&&(this.getState(this._IT_SELF,"focusChangeFiredByDateSelect")||u.focusChangeFiredByModeChange||u.format&&u.mode!="input"&&this._setSyncedDateOnFocusIn(n,t,r),u.focusChangeFiredByModeChange&&this.setState(u.index,"focusChangeFiredByModeChange",!1));this.setState(this._IT_SELF,"focusChangeFiredByDateSelect",!1)},ON_FOCUSOUT:function(n,t,i,r){var u,f,e;if(n.ecService=="layer.datepicker"||n.ecPath!=this.ecPath)return!1;if(u=this.getComponent(n.ecRoleIndex||n.cindex),u)if(u.format=="d")f=this.getDateSetLength(),e=this.hasEmptyYearMonth(u.index>f?f:0),this._setDayCompValueByFocusOut(n,u,e);else if(u.format)this.onServiceComponentFocusOutHandler(n,t,r);if(this.hasError())return!1;u&&!this.hasEmptyComponent()&&this._checkYearRange(u.index,this._getYearValueFromEvent(n))&&this._syncDateOnNativeEvent&&!this._preventAutoSync&&this._setSyncedDateOnFocusOut(n,t,r);this._wrappingDateChangeFunc(this._setSyncedTime)(n,t,r)}});ecount.class("ecount.control.date.d03","ecount.control.date",{ecPackage:"ecount.control.date.d03",editMode:null,initializeOptions:function(n){ecount.control.date.prototype.initializeOptions.apply(this,arguments);_.extend(this,{editMode:n._editMode})},_initializeState:function(n){n._readOnly=ecount.common.isTrue(n.isMultiBoard)?n._readOnly:!!(n._editMode!=ecenum.editMode.new||n._readOnly);ecount.control.date.prototype._initializeState.apply(this,arguments)},onInitFunction:function(n,t,i){var r=t.functions,u=i._editMode==ecenum.editMode.new;ecount.control.date.prototype.onInitFunction.apply(this,arguments);r.datepicker&&(r.datepicker["style.display"]=ecount.common.isTrue(i.isMultiBoard)?!0:u);r.label={id:this.id,cid:this.id,index:this.getComponents().length,ecFunction:"label",ecFunctionId:"date.label","style.display":ecount.common.isTrue(i.isMultiBoard)?!0:!!(!u&&i.data[0]&&i.data[0].label),label:i.data[0].label,cid:this.id}},getInitDataComponents:function(n,t,i){var r=ecount.control.date.serverDate(this.ecPageID),f=i.data[0].value,u=f.length==8?[f.substring(0,4),f.substring(4,6),f.substring(6,8)]:f.length==10?f.split("-"):[r.getFullYear(),(r.getMonth()+1).toString().padLeft(2,"0"),r.getDate().toString().padLeft(2,"0"),r.getHours(),r.getMinutes(),r.getHours(),r.getMinutes()];return this.getCompInOrder(n,t,i).map(function(n,r){if(!n.format)return n;this.setFormatIndex(n.format);n["attr.disabled"]=i._readOnly;switch(n.format){case"y":return this._getSelectboxYearComponent(n,u[0],r,t);case"m":return this._getSelectboxComponent(n,u[1],r,t);case"d":return this._getInputboxComponent(n,u[2],r,t);case"h1":return this._getSelectboxComponent(n,u[3],r,t);case"h2":return this._getSelectboxComponent(n,u[4],r,t);case"mi1":return this._getSelectboxComponent(n,u[5],r,t);case"mi2":return this._getSelectboxComponent(n,u[6],r,t);default:return n}}.bind(this))},getInitComponents:function(n,t,i){var r=this.getDefaultSelectedValue(n,t,i);return this.getCompInOrder(n,t,i).map(function(n,u){if(!n.format)return n;this.setFormatIndex(n.format);n["attr.disabled"]=i._readOnly;switch(n.format){case"y":return this._getSelectboxYearComponent(n,r.startYear,u,t);case"m":return this._getSelectboxComponent(n,r.startMonth,u,t);case"d":return this._getInputboxComponent(n,r.startDay,u,t);case"h1":return this._getSelectboxComponent(n,r.startHours,u,t);case"h2":return this._getSelectboxComponent(n,r.startMinutes,u,t);case"mi1":return this._getSelectboxComponent(n,r.endHours,u,t);case"mi2":return this._getSelectboxComponent(n,r.endMinutes,u,t);default:return n}}.bind(this))},getLabel:function(){var n=this.getState(this._IT_SELF,"label");return n?n.label:""},setValue:function(){if(arguments.length!=0)if(arguments.length==1){var n=arguments[0],t=this.dateFormat.map(function(n,t){return t});n=$.type(n)?n.format("yyyy-MM-dd"):n.toString();n.length==8&&(n=[n.left(4),n.substring(4,6),n.substring(6)].join("-"));this.setDateItem(t,n.split("-"))}else this._setDate.apply(this,arguments)},setLabel:function(n){this.setState("label","label",n)},checkValidate:function(){var n;return(n=this.checkYearValidation())?n:[]},serialize:function(n){var t=[],i=[],r,u;return i=this._extractFormat?Date.format(this._extractFormat,this.getDate()[0]):[this.getSYear(),this.getSMonth().padLeft(2,"0"),this.getSDay().padLeft(2,"0")].join(""),t.push({key:n||this.name,value:i}),this._hideDateControl&&(r=this.getComponentByAttr("ecRole","date.hide"),t.push({key:(n||this.name)+"_DATECHK",value:r["attr.checked"]?"1":"0"})),this.useFnActivedItem()&&(u=this.getFnActivedId(),t.push({key:(n||this.name)+"_FN",value:u})),t},getResetState:function(){return this.getOriginState(["value","selectedValue","selectedLabel","attr.checked"],["label","fn"])},save:function(){var n=this._isTime?"yyyy-MM-dd hh:mm":"yyyy-MM-dd",t=this.getDate().map(function(t){return t?t.format(n):""}),i=this.useFnActivedItem()?this.getFnActivedId():null;return{key:this.id,value:{date:t,label:this.getLabel(),fn:i}}},restore:function(n){var t=this._getDateFromDateString(n.date);this.setDate(t);this.setLabel(n.label);this.useFnActivedItem()&&!$.isNull(n.fn)&&this.setFnActivedId(n.fn)},_ON_BEFORE_MOUSEOVER:function(n){var t=this.isReadOnly(this._IT_SELF)||this.isReadOnly(n.cindex);return t&&n.ecService!="layer.fn"?!1:!0},ON_CHANGE:function(){return~[this.getSYear(),this.getSMonth(),this.getSDay()].indexOf("")?!1:ecount.control.date.prototype.ON_CHANGE.apply(this,arguments)}});ecount.class("ecount.control.divider","ecount.control",{ecPackage:"ecount.control.divider",init:function(){ecount.control.prototype.init.apply(this,arguments)},render:function(){ecount.control.prototype.render.apply(this,arguments)},onInitState:function(n,t){t.components||(t.components=[{}])},onInitComponent:function(){}});ecount.class("ecount.control.view.divider","ecount.control.view",{template:"((divider))",init:function(){ecount.control.view.prototype.init.apply(this,arguments)},render:function(){ecount.control.view.prototype.render.apply(this,arguments)},onInitTemplate:function(n){return n}});ecount.class("ecount.control.view.date","ecount.control.view",{template:'<div data-cid="{{cid}}" data-pcid="{{pcid}}" data-node="0" data-section="0" data-role="dateWrapper"\nclass="wrapper-datepicker {{style.contextCss}} {{style.display}}">\n{{date}}{{time}}[[datepicker]]\n<\/div>\n[[fn]]\n{{dateHideCheckbox}}\n{{label}}\n[[subLabel]]',fnTemplate:'<div class="btn-group">\n((dateFn))\n<\/div>',waveMarkTemplate:'<span data-role="delimiter" class="{{style.display}}"> ~ <\/span>',addonLabelTemplate:'<span data-for="{{labelFor}}" class="{{style.display}}">{{label}}<\/span>',datepickerTemplate:'<div id="btn-datepicker-toggle" data-cid="{{cid}}" class="btn-datepicker-toggle {{style.display}}"       data-calendar="0" tabindex="-1" data-service="{{ecService}}" data-function="{{ecFunction}}" data-function-id="{{ecFunctionId}}" ><\/div>',init:function(){ecount.control.view.prototype.init.apply(this,arguments)},onInitTemplate:function(n,t){var i=t.dateFormat.map(function(n,i){var u=t.components[i],r;switch(n){case"y":case"m":r="((select))";break;case"d":r="((inputDate))"}return this.getAddonAppendedTemplate(u,r,i)}.bind(this)),r=t.timeFormat.map(function(n,i){var u=t.dateFormat.length+i,f=t.components[u],r;switch(n){case"h1":r="((select))";break;case"mi1":r="\r\n((select))";break;case"h2":r=" [[waveMark]] ((select))";break;case"mi2":r="\r\n((select))"}return this.getAddonAppendedTemplate(f,r,u)}.bind(this));return n.replace(/{{date}}/gi,i.join("\n").replaceRegexpString()).replace(/{{time}}/gi,r.join("\n").replaceRegexpString()).replace("{{dateHideCheckbox}}",t._hideDateControl&&!t._isOnlyFixedDatePicker?"&nbsp;((checkbox))":"").replace("{{label}}",t.label?"((sideLabel))":"")},getAddonAppendedTemplate:function(n,t,i){var r=t,u,f;return n.prefix&&(u=[n.prefixSpace?"&nbsp;":"",n.prefix,"&nbsp;"].join(""),r=[ecount.widget.replaceAttr(this.addonLabelTemplate,{label:u,labelFor:i,"style.display":n["style.display"]?"":"hidden"}),r].join("")),n.postfix&&(f=["&nbsp;",n.postfix,n.postfixSpace?"&nbsp;":""].join(""),r=[r,ecount.widget.replaceAttr(this.addonLabelTemplate,{label:f,labelFor:i,"style.display":n["style.display"]?"":"hidden"})].join("")),r},render:function(){ecount.control.view.prototype.render.apply(this,arguments)},hasFocus:function(n){var t=this.getElements(n);return t.length>1&&(t=t.filter(":visible")),document.activeElement==t.get(0)},onChangeMode:function(n,t){var u=this.getElements(n),f=t=="input",r=u.filter("input[type='text']"),e=u.filter("button"),i=f?r:e,o=f?e:r;r.val("");i.hasClass("hidden")&&o.hasClass("hidden")||(i.removeClass("hidden"),o.addClass("hidden"),ecount.global.setTimeout(this.ecPageID,function(){var n=document.activeElement,t,r;n&&n.tagName==="BODY"&&i.focus();n.getAttribute("data-cid")==i.attr("data-cid")&&(t=n.getAttribute("data-cid"),r=n.getAttribute("data-index"),n.removeAttribute("data-cid"),n.removeAttribute("data-index"),i.attr("data-ignoretype","focusin"),i.focus(),i.attr("data-ignoretype",""),n.setAttribute("data-cid",t),n.setAttribute("data-index",r))}.bind(this),0))},onChangeSelectedLabel:function(n,t){var r=this.getElements(n),i=r.filter("button").find("div.selectbox-label");i=i&&i.length?i:r.filter("button");r.filter("input[type='text']").val(t);i.text(t)},onChangeSelectedValue:function(n,t){var i=this.getElements(n),r=i.parent();i.val(t)},onChangeStyleDisplay:function(n,t){var i=this.getElements(n),r=this.$el.find('[data-for="'+n+'"]');i.length>1&&n!=this._IT_SELF&&(i=i.filter("button"));t?(i.removeClass("hidden"),r.removeClass("hidden")):(i.addClass("hidden"),r.addClass("hidden"))},onChangeAttrDisabled:function(n,t){var i=this.getElements(n);n!=this._IT_SELF&&(i.prop("tagName")==="INPUT"?i.prop("disabled",t):i[t?"addClass":"removeClass"]("disabled"))},onBlur:function(n){if(typeof n=="number"&&n>-1){var t=this.getElements(n);t.blur()}else this.$el.find("input:visible, button:visible").blur()},onChangeStyleCss:function(n,t){this.$el.find("div[data-role-index="+n+"]").addClass(t)},onChangeStyleDisplayDatepicker:function(n){var t=this.$el.find('[data-service="layer.datepicker"]');t[n?"removeClass":"addClass"]("hidden")},onChangeStyleDisplayWaveMark:function(n){var t=this.$el.find('[data-role="delimiter"]');t[n?"removeClass":"addClass"]("hidden")},onChangeAttrChecked:function(n,t){var i=this.getElements(n);i.prop("checked",t)},isVisibleElement:function(n){var t=this.getElements(n);return t.length?t.length==2?ecount.widget.isVisible(t.get(0))||ecount.widget.isVisible(t.get(1)):ecount.widget.isVisible(t.get(0)):!1}});ecount.class("ecount.control.view.date.d01","ecount.control.view.date",{template:'<div class="wrapper-datepicker {{style.contextCss}}"\ndata-cid="{{cid}}" data-pcid="{{pcid}}" data-node="0" data-section="0" data-role="dateWrapper" >\n{{date}}\n[[datepicker]]\n{{time}}\n<\/div>\n[[fn]]\n{{dateHideCheckbox}}\n{{label}}\n[[subLabel]]',fnTemplate:"",init:function(){ecount.control.view.date.prototype.init.apply(this,arguments)},onInitTemplate:function(){return ecount.control.view.date.prototype.onInitTemplate.apply(this,arguments)},render:function(){ecount.control.view.date.prototype.render.apply(this,arguments)}});ecount.class("ecount.control.view.date.d02","ecount.control.view.date",{template:'<div data-cid="{{cid}}" data-pcid="{{pcid}}" data-role="dateWrapper" \nclass="wrapper-datepicker enable-toggle-ecitem datepicker-range {{style.contextCss}}">\n{{fromDate}}\n[[waveMark]]\n{{toDate}}\n[[datepicker]]\n<\/div>\n[[fn]]\n{{dateHideCheckbox}}\n{{label}}\n{{subLabel}}',css:"btn-group-select-inline",fnTemplate:"",init:function(){ecount.control.view.date.prototype.init.apply(this,arguments)},onInitTemplate:function(n,t){var i=t.dateFormat.length,r=t.dateFormat.map(function(n,i){var u=t.components[i],r;switch(n){case"y":case"m":r="((select))";break;case"d":r="((inputDate))"}return this.getAddonAppendedTemplate(u,r,i)}.bind(this)),u=t.dateFormat.map(function(n,r){if(t.components.length>r+i){var f=t.components[r+i],u;switch(n){case"y":case"m":u="((select))";break;case"d":u="((inputDate))"}return this.getAddonAppendedTemplate(f,u,r+i)}}.bind(this));return n.replace("{{fromDate}}",r.join("\n")).replace("{{toDate}}",u.join("\n")).replace("{{dateHideCheckbox}}",t._hideDateControl?"&nbsp;((checkbox))":"").replace("{{label}}",t.label?"((sideLabel))":"").replace("{{subLabel}}",t.subLabel?"((dateSublabel))":"")},render:function(){ecount.control.view.date.prototype.render.apply(this,arguments)}});ecount.class("ecount.control.view.date.d03","ecount.control.view.date",{baseTemplateType:!1,template:['<div class="wrapper-datepicker {{style.contextCss}}"','data-cid="{{cid}}" data-pcid="{{pcid}}" data-node="0" data-section="0" data-role="dateWrapper" >',"{{date}}","{{time}}","[[datepicker]]","[[label]]","[[sublabel]]","[[fn]]","<\/div>",].join("\n"),labelTemplate:'<span data-role="date.label" class="{{style.display}}"> - {{label}} <\/span>',fnTemplate:"",onChangeLabelLabel:function(n){var t=this.$el.find('[data-role="date.label"]');n?t.text(" - "+n).removeClass("hidden"):t.addClass("hidden").text("")}});ecount.class("ecount.control.radio","ecount.control",{ecPackage:"ecount.control.radio",init:function(){ecount.control.prototype.init.apply(this,arguments)},render:function(){ecount.control.prototype.render.apply(this,arguments)},onInitState:function(n,t,i){t.components||(t.components=[{}]);i&&_.isBoolean(i.inlineDividerPos)&&i.inlineDividerPos&&(i.inlineDividerPos=1);t.inlineDividerPos=i.inlineDividerPos||[];t.forceSetValue=i.forceSetValue;for(var f=t.components,e,u,r=f.length-1;r>=0;r--)u=f[r],u.selected===!0&&($.isNull(e)?e=r:u.selected=!1)},initializeViewOptions:function(n){_.merge(this.__viewOptions,{isVertical:n.isVertical,isMultiple:n._multiple,isSquare:n._isSquare,isNoLabel:n._isNoLabel})},onInitComponent:function(n,t,i,r,u){r["attr.name"]=u._isUserNameSet?this.name:this.id+(this.ecPageID?"_"+this.ecPageID:"")+(this.pId?"_"+this.pId:"");r["attr.checked"]=r.selected===!0;r["attr.labelid"]=["control",this.tabID||"",this.gridID||"",this.ecPageID,this.id,t].join("-");r.selected&&(i.value=r.value,i["opt.oldvalue"]=r.value);try{delete r.selected}catch(f){r.selected=null}},onInitExtractComponent:function(n,t,i){var r=i.data,u=i.extractData.__state.components;t.components.forEach(function(n,t,f){if(n["attr.name"]=i._isUserNameSet?this.name:(n.name||this.id)+(this.ecPageID?"_"+this.ecPageID:"")+(this.pId?"_"+this.pId:""),n["attr.labelid"]=["control",this.tabID||"",this.gridID||"",this.ecPageID,this.id,t].join("-"),r&&r[t]&&u[t]&&(r[t].selected||u[t]["attr.checked"])){f.forEach(function(n){n["attr.checked"]=!1});n["attr.checked"]=!0;return}}.bind(this))},getValue:function(){var n=this.getComponents().head(function(n){return n["attr.checked"]==!0});if(n)return""+n.value},setValue:function(n,t,i){var u=this.getComponents(),r;(arguments.length===1&&(t=n),this.getComponents().all(function(n){return n["attr.disbled"]})||this.getState(this._IT_SELF,"attr.disabled"))||(r=u.head(function(n){return typeof t=="boolean"?n.value===t:n.value==t}),r&&!r["attr.disabled"]&&(this.disableStateObserving(),this.setState(this._ALL_COMP,"attr.checked",!1),this.enableStateObserving(),this.setState(r.index,"attr.checked",!0),i&&this.executeChangeDelegator({cindex:r.index,value:this.getValue(r.index)})))},setStandardValue:function(n){_.isArray(n)&&(n=n[0]);this.setValue(n)},setLabel:function(n,t){this.setState(n,"label",t)},getLabel:function(n){this.getState(n,"label")},setUncheck:function(){this.setState(this._ALL_COMP,"attr.checked",!1)},setReadOnly:function(n,t){var i;arguments.length==2&&(i=n,n=t,t=i);ecount.control.prototype.setReadOnly.apply(this,arguments)},serialize:function(n){return ecount.control.prototype.serialize.apply(this,[{key:n||this.name,value:this.getValue()||""},n])},serializeById:function(){return this.serialize(this.id)},serializeAdditionalData:function(){return ecount.control.prototype.serializeAdditionalData.apply(this,[{name:this.subTitle||"",value:this.getCheckedLabel()||""}])},restore:function(n){_.isBoolean(this.getState(this._IT_SELF,"forceSetValue"))&&this.getState(this._IT_SELF,"forceSetValue")&&this.isReadOnly(this._IT_SELF)?(this.setReadOnly(!1),this.setValue(0,n,!0),this.setReadOnly(!0)):this.setValue(0,n,!0)},getResetState:function(){return this.getOriginState(["attr.checked","label","value"])},getSyncData:function(){return{data:this.getExtractState(["attr.checked"]).concat(this.getExtractState(["opt.oldvalue"],!0))}},checkValidate:function(n,t){var i=n||[],r=this.getValue()||"";return ecount.validator.validate(r,i,t)},getCheckedLabel:function(n){var r=n?n:this.getValue(),i,t;return t=this.getComponents().head(function(n){return n.value==r}),t&&(i=t.label),i},getGridSelectedLabel:function(){return this.getCheckedLabel()},showCompByValue:function(n){var r=this.getComponents(),i,t;for($.isArray(n)||(n=[n]),this.pendingViewUpdate(!0),t=0;t<r.length;t++)i=this.getState(t,"value"),n.contains(i)&&this.setState(t,"style.display",!0);this.pendingViewUpdate(!1);this.batchUpdateView()},hideCompByValue:function(n){var r=this.getComponents(),i,t;for($.isArray(n)||(n=[n]),this.pendingViewUpdate(!0),t=0;t<r.length;t++)i=this.getState(t,"value"),n.contains(i)&&this.setState(t,"style.display",!1);this.pendingViewUpdate(!1);this.batchUpdateView()},onChangeHandler:function(n,t){var r=this.getComponents(),i=this.getValue();this.setOldValue(i);this.disableStateObserving();this.pendingViewUpdate(!0);r.forEach(function(t,i){this.setState(i,"attr.checked",n.cindex==i)}.bind(this));this.pendingViewUpdate(!1);this.batchUpdateView();this.enableStateObserving();this.executeChangeDelegator({ecEvent:n,event:t,oldValue:i,value:this.getValue(n.cindex)});this.notifyToStateObserver(n.cindex,"attr.checked",!0)},ON_CLICK:function(n){if(this.getComponents().head(function(n){return n["attr.disabled"]&&n["attr.checked"]}))return n.suspend=!0,!1},ON_CHANGE:function(n,t){var i;switch(n.handler){case ECountEvent.Type.CHANGE_CONTROL:i=this.onChangeHandler(n,t,{})}return this.validateIf(this.getState(this._IT_SELF,"validate.needvalidate")),i},ON_KEYDOWN_ARROW_UP:function(n,t){return t.preventDefault(),!1},ON_KEYDOWN_ARROW_DOWN:function(n,t){return t.preventDefault(),!1}});ecount.class("ecount.control.view.radio","ecount.control.view",{template:"((radio))",colxs:'<div class="col-xs-{{column}}">{{items}}<\/div>',baseTemplateType:!0,init:function(){ecount.control.view.prototype.init.apply(this,arguments)},render:function(){ecount.control.view.prototype.render.apply(this,arguments)},onInitTemplate:function(n,t){var u,f,s,i,h,c,r;if(t.isMultiple){var l=Math.round(12/t.isMultiple),a=Math.ceil(t.components.length/t.isMultiple),e=0,o="";for(i=0;i<t.isMultiple;i++){for(u=[],f=0;e<t.components.length&&f<a;e++,f++)u.push(this.template);s=ecount.widget.replaceAttr(this.colxs,{column:l});o+=s.replace("{{items}}",u.join(""))}n=o}if(t._multiple,t.isSquare&&(n=n.replace(/\(\(radio\)\)/g,"((radio-square))")),t.inline)for(i=0,h=t.components.length;i<h;i++)c=t.components[i],c["style.css"]+="textbox-inline";return t.isVertical?n=n.replace(/(\(\(\w+\)\))/g,'<div class="control">$&<\/div>'):t.inlineDividerPos&&(r=-1,n=n.replace(/(\(\(\w+\)\))/g,function(n,i){return(r++,t.inlineDividerPos===r)?i+'<span class="inline-divider" data-role="checkbox.divider" data-role-index="'+r+'"><\/span>':i})),n},onChangeStyleDisplay:function(n,t){var i=this.getElements(n),r=i.attr("type")=="radio"?i.parent("span"):i;t?r.removeClass("hidden"):r.addClass("hidden")},onChangeValue:function(){},onChangeAttrChecked:function(n,t){var i=this.getElements(n);this.gridID&&(this.getElements().attr("checked",!1),i.attr("checked",t));i.prop("checked",t)},onChangeLabel:function(n,t){var r=this.getElements(n),i;r&&(i=this.$el.find("[for="+r.attr("id")+"]"),i.find("[data-txtlabel]").length?i.find("[data-txtlabel]").text(t):i.text(t))}});ecount.control.keyHelper=$.Class(ecount.control,{ecPackage:"ecount.control.keyHelper",init:function(){ecount.control.prototype.init.apply(this,arguments)},render:function(){ecount.control.prototype.render.apply(this,arguments)},initializeOptions:function(n){var t=ecount.resource,i=[[t.LBL08710,"Enter"],[t.LBL08711,""],[t.LBL04820,"Shift + "],[t.LBL08713,""],[t.LBL08714,"Shift + "],[t.LBL08715,"Space"],[t.LBL08716,""],[String.format(t.LBL08717,5),"Shift + "],[t.LBL08718,""],[String.format(t.LBL08719,5),"Shift + "],[t.LBL08232,"F2"],[t.LBL01653,"F8"],[t.LBL10727,"ESC"]];n.addItems&&i.add(n.addItems);$.extend(this,{items:i})},onInitState:function(n,t,i){t.components||(t.components=[{}]);t["dropdown.display"]=!1;t["dropdown.items"]=[];t["dropdown.disableItem"]=i.disableItem},onInitComponent:function(){},onAfterRender:function(){this.addItems(this.items)},onLazyRender:function(){},filerOptions:function(n){var i=!1,t=this.getState(this._IT_SELF,"dropdown.disableItem");return _.isArray(t)&&_.size(t)>0&&_.each(t,function(t){t==n&&(i=!0)}),i},addItems:function(n){var t=this,i=this.getState(this._IT_SELF,"dropdown.items"),r=_.filter(n,function(n,i){var r=t.filerOptions(i);if(!r)return n});this.setState(this._IT_SELF,"dropdown.items",_.concat(i,r))},showDropdown:function(){this.setState(this._IT_SELF,"dropdown.display",!0)},hideDropdown:function(){this.setState(this._IT_SELF,"dropdown.display",!1)},toggle:function(){var n=this.getState(this._IT_SELF,"dropdown.display");n?this.hideDropdown():this.showDropdown()},serialize:function(){return!1},ON_CLICK:function(){this.toggle()}});ecount.control.view.keyHelper=$.Class(ecount.control.view,{template:['<div class="wrapper-keyboard-help">'+ecount.resource.LBL08647+" ",'<div class="btn-group btn-group-xs dropup">','<div class="dropdown-menu dropdown-menu-right">','<table class="table table-hover table-success" style="width: 260px">','<colgroup><col style="width: 160px"><col><\/colgroup>',"<thead><tr><th>"+ecount.resource.LBL03422+"<\/th><th>"+ecount.resource.LBL03429+"<\/th><\/tr><\/thead>","<tbody><\/tbody>","<\/table>","<\/div>",'<a href="javascript:;" class="dropdown-toggle" data-findex="{{findex}}" data-index={{index}} id="{{id}}" data-cid="{{cid}}" class="{{style.css}} {{style.display}}">'+ecount.resource.BTN00087+' <span class="fa fa-caret-up"><\/span><\/a>',"<\/div>","<\/div>"].join(""),init:function(){ecount.control.view.prototype.init.apply(this,arguments)},render:function(){ecount.control.view.prototype.render.apply(this,arguments)},onInitTemplate:function(n){return n},onChangeDropdownDisplay:function(n,t){t?(this.getElements(n).find(".dropup").addClass("open"),this.getElements(arguments[0]).find(".fa").removeClass("fa-caret-down"),this.getElements(arguments[0]).find(".fa").addClass("fa-caret-down")):(this.getElements(n).find(".dropup").removeClass("open"),this.getElements(arguments[0]).find(".fa").addClass("fa-caret-down"),this.getElements(arguments[0]).find(".fa").removeClass("fa-caret-down"))},onChangeDropdownItems:function(n,t){var i=this.getElements(n).find("tbody");_.each(t,function(n){i.append($("<tr><td>"+n[0]+"<\/td><td>"+n[1]+"<\/td><\/tr>"))})}});ecount.class("ecount.control.label","ecount.control",{ecPackage:"ecount.control.label",isWithoutDropdown:!1,init:function(){ecount.control.prototype.init.apply(this,arguments)},render:function(){ecount.control.prototype.render.apply(this,arguments)},onInitState:function(n,t,i){t.components||(t.components=[{}]);(i.FormSetButton||!$.isEmpty(i.formSet))&&(t["style.formSet"]=!1);$.isEmpty(i.formSet)||(t.formSet=i.formSet)},onInitComponent:function(n,t,i,r,u){var f=r.bgColor;u._cdata&&(r["attr.data-value"]=u._cdata[t]);(!u.data||u.data.length===0||_.isNil(r.label))&&(r.label="");r["style.bgcolor"]=f;r["style.color"]=f?ecview.util.getContrastColor(f):"";r.style=""},initializeViewOptions:function(n){$.extend(this.__viewOptions,{hasFn:n.hasFn,baseType:n.baseType,FormSetButton:n.FormSetButton,isWithoutDropdown:n.isWithoutDropdown||this.isWithoutDropdown,disableAdd:n.disableAdd,disableMod:n.disableMod,disableAllMod:n.disableAllMod,disableDel:n.disableDel,alignRight:n.alignRight})},setStyleString:function(n){var t="";n.bgColor&&(t+="background-color:"+n.bgColor+";");n.style=n.style?n.style+=t:t},setWidth:function(n,t){var t=t?t:0,i=this.getComponents().filter(function(n){return typeof t=="number"?n.index===t:n["attr.data-value"]===t||n.id===t});this.setState(i[0].index,"style.width",n)},getLabel:function(n){var i,t;return _.isUndefined(n)?(t=this.getLabelAll(),t.length>1?t:t.toString()):(i=this.getComponents().filter(function(t){return typeof n=="number"?t.index===n:t["attr.data-value"]===n||t.id===n}),i[0].label)},getLabelAll:function(){return this.getComponents().map(function(n){return n.label})},getGridSelectedLabel:function(){return this.getLabel()},setValue:function(n,t){this.setLabel(n,t)},getValue:function(n){return this.getLabel(n==undefined?0:n)},setLabel:function(n,t){var i,u=n,r;if(_.isUndefined(t))for(i=this.getComponents(),r=0;r<i.length;r++)_.isArray(n)&&(u=n[r]),this.setState(i[r].index,"label",u);else i=this.getComponents().filter(function(n){return typeof t=="number"?n.index===t:n["attr.data-value"]===t||n.id===t}),this.setState(i[0].index,"label",n)},onNextFocus:function(){this.setFocusOutTrigger()},setFocus:function(){this.onNextFocus()},getFocusableIndex:function(){return-1},getReversedFocusableIndex:function(){return-1},serialize:function(n){return ecount.control.prototype.serialize.apply(this,[{key:n||this.name,value:this.getLabel().toString()},n])},save:function(n){var t,r=[],i;if(_.isUndefined(n)){for(t=this.getComponents(),i=0;i<t.length;i++)r.push(t[i].label);return{key:this.id,value:r}}return t=this.getComponents().filter(function(t){return typeof n=="number"?t.index===n:t["attr.data-value"]===n||t.id===n}),{key:t[0].id,value:t[0].label}},restore:function(n,t){this.setLabel(n,t)},serializeById:function(){return this.serialize(this.id)},showError:function(n,t){ecount.control.prototype.showError.call(this,0,n,t)},hideError:function(){ecount.control.prototype.hideError.call(this,0)},_doDisplayError:function(n){var n=n?n:0,t=this.getComponents().filter(function(t){return typeof n=="number"?t.index===n:t["attr.data-value"]===n||t.id===n});return t[0]["style.display"]==="none"?!1:!0},_ON_BEFORE_CLICK:function(){return this.getState(this._IT_SELF,"style.formSet")?!0:ecount.control.prototype._ON_BEFORE_CLICK.apply(this,arguments)},ON_CLICK:function(n,t,i,r){var f=$(t.target),u=f.attr("data-gubun");if(_.merge(r,{cid:this.id,cname:this.name,event:t,targetID:"btn-formset-"+u+"-click",command:["on","formset",u,"click"].join("_").ecCamelize(!0),__self:this}),this.onClick){event.type="button.click";this.onClick(r)}if(!this.getState(this._IT_SELF,"style.formSet"))if(this.pcid)t.preventDefault();else return!1},showFormsetLayer:function(){this.setState(this._IT_SELF,"style.formSet",!0,!0)},hideFormsetLayer:function(){this.setState(this._IT_SELF,"style.formSet",!1,!0)},changeBackgroundColor:function(n,t){var i;ecview.util.isValidColor(n)===!0&&(i=ecview.util.getContrastColor(n),t=$.isNumber(t)?t:0,this.setState(t,"style.bgcolor",n),this.setState(t,"style.color",i))},_hasClass:function(n,t){for(var r=n!=""?n.split(" "):[],i=0;i<r.length;i++)return r[i]===t?!0:!1},_removeClass:function(n,t,i){var f=this.getState(i,"labelCSS"),u=n!=""?n.split(" "):[],r;if(t===f)this.setState(i,"labelCSS","");else for(r=0;r<u.length;r++)u[r]===t&&(u[r]="");return u.join(" ").trim()},_addClass:function(n,t,i){var r=this.getState(i,"labelCSS");return t===r?(this.setState(i,"labelCSS",""),n=n+" "+t):n=n+" "+t+" "+r,n.trim()}});ecount.class("ecount.control.view.label","ecount.control.view",{template:"((labelList))",init:function(){ecount.control.view.prototype.init.apply(this,arguments)},render:function(n,t){this._mergeAttr(n,t);this._formSet(n,t);ecount.control.view.prototype.render.apply(this,arguments)},_mergeAttr:function(n){for(var t="",i=0;i<n.components.length;i++)t+="((label))\r\n";this.template=this.template.replace("((labelList))",t)},_formSet:function(n,t){var i,r;n.hasFn&&(n.baseType=!1);$.isEmpty(n.formSet)||(this.template='<div id= "formSet" class="wrapper-popover-table right"><div class="arrow"><\/div><ul class="dropdown-menu">((formSet))<\/ul><\/div>((label))',i=n.formSet.map(function(n){return'<li><a href="javascript:;" data-gubun='+n.id+" id="+n.id+">"+n.label+"<\/a><\/li>"}).join(""),this.template=this.template.replace("((formSet))",i));n.FormSetButton&&(r=0,this.template=n.isWithoutDropdown==!1?['<div id= "formSet" class="wrapper-popover-table right">','<div class="arrow"><\/div>','<ul class="dropdown-menu">',n.disableAdd==!0?"":'<li><a href="javascript:;" data-gubun="add" id="list-'+n.cid+'-add" >'+ecount.resource.LBL02792+"<\/a><\/li>",n.disableMod==!0?"":'<li><a href="javascript:;" data-gubun="mod" id="list-'+n.cid+'-mod">'+ecount.resource.LBL01593+"<\/a><\/li>",n.disableAllMod==!0?"":'<li><a href="javascript:;" data-gubun="allMod" id="list-'+n.cid+'-AllMod">'+ecount.resource.LBL10736+"<\/a><\/li>",n.disableDel==!0||n.FormSetButton=="mod"?"":'<li><a href="javascript:;" data-gubun="del" id="list-'+n.cid+'-del">'+ecount.resource.LBL10607+"<\/a><\/li>","<\/ul>","<\/div>","((label))"].join(""):'<div id= "formSet" class="wrapper-popover-table right"><\/div>((label))');n.alignRight&&t.addClass("text-right")},onInitTemplate:function(n,t){return _.isNull(t.gridID)||(this._mergeAttr(t),n=this.template),n},onChangeStyleBgcolor:function(n,t){this.getElements(n).css("background-color",t)},onChangeStyleColor:function(n,t){this.getElements(n).css("color",t)},onChangeStyleFontWeight:function(n,t){this.getElements(n).css("font-weight",t)},onChangeStyleTextDecoration:function(n,t){this.getElements(n).css("text-decoration",t)},onChangeStyleFontStyle:function(n,t){this.getElements(n).css("font-style",t)},onChangeStyleFontSize:function(n,t){this.getElements(n).css("font-size",parseInt(t))},onChangeStyleFont:function(n,t){this.getElements(n).css("font-family",t[0]||t[1]||t[2])},onChangeStyleWidth:function(n,t){this.getElements(n).width(t)},onChangeLabel:function(n,t){this.getElements(n).html(t)},onChangeStyleDisplay:function(n,t){t?this.getElements(n).removeClass("hidden"):this.getElements(n).addClass("hidden")},onChangeStyleCss:function(n,t){this.getElements(n)[0].className=t},onChangeStyleFormSet:function(n,t){var i=this.getElements(this._IT_SELF).find("#formSet");t?i.hasClass("visible")||i.addClass("visible"):i.hasClass("visible")&&i.removeClass("visible")}});ecount.class("ecount.control.select","ecount.control",{ecPackage:"ecount.control.select",moreOptionButton:!1,moreOptionData:null,_isSpace:!1,useManualInput:!1,useDynamicAdd:!1,manualInputItemId:null,selectCompIndex:null,cssMap:null,_keyStack:"",keyStackID:"",_defaultCss:"btn btn-default btn-selectbox ",_spaceSymbolLabel:"===",_spaceSymbolValue:"".padLeft(3,ecount.delimiter),initializeOptions:function(n){_.merge(this,{moreOptionButton:n.moreOptionButton,moreOptionData:n.moreOptionData,useManualInput:n.useManualInput,useDynamicAdd:n.useDynamicAdd,dynamicAddData:n.dynamicAddData,selectCompIndex:0,_isSpace:n._isSpace,spaceId:this.id+"_empty",manualInputItemId:this.id+"_manual",cssMap:n.cssMap||{},isFooterCustomRoleId:n.isFooterCustomRoleId})},onInitComponent:function(n,t,i,r,u){var f,e;if(!u.notUseDefaultCss&&(r.css||this._userCss)){var o=(this._defaultCss+r["style.css"]).split(" "),s={},h=[];for(f=0;f<o.length;f++)e=o[f],s[e]||(s[e]=!0,h.push(e));r["style.css"]=h.join(" ")+" "}},onInitExtractComponent:function(n,t,i){var u,r;i.data&&i.data.length>0&&(u=this.__originData.components,t.components.forEach(function(n,t){r=u[t];n.selectedValue=$.isNull(r.selectedValue)?n.selectedValue:r.selectedValue;n.selectedLabel=$.isNull(r.selectedLabel)?n.selectedLabel:r.selectedLabel}.bind(this)))},getInitDataComponents:function(n,t,i){return i.data.map(function(n){var t=this._getInitialSelectboxOption(n,i),r=this._getInitialSelectedValue(n,t),u,f,e;return $.isNull(n.selectedValue)||typeof n.selectedValue!="object"||(selectedLabel=this._getSelectedLabel(r,t)),(u=t.head(ecount.control.select.optionFindingPredicate.bind(t,r)))?(e=this._getSelectedPrefixCss(u.value,t),f=this._getSelectedOptionSet(u,e)):(f=this._getSelectedOptionSet(t[0],t[0].prefixCss),r=t[0].value),_.extend({},n,f,{option:t,lastSelectedValue:r,"attr.disabled":!!i._readOnly,"ecService.input":"layer.autocomplete","opt.oldvalue":"",isEditFormMode:i.isEditFormMode||!1,isNewFormMode:i.isNewFormMode||!1,newFormTitle:i.isNewFormMode?i.newFormTitle||ecount.resource.LBL11298:"",mode:i.mode||"button"})}.bind(this))},getInitComponents:function(n,t,i){return[$.extend({cid:this.cid,name:this.name,selectedCss:"",lastSelectedValue:"",selectedPrefixCss:"",ecService:"layer.selectbox","ecService.input":"layer.autocomplete","attr.disabled":!!i._readOnly,"opt.oldvalue":"",mode:i.mode||"button"},this._getDefaultOptionState(n,t,i))]},onInitState:function(n,t,i){_.merge(t,{recommendValue:i.recommendValue||{},useRecommendOption:i.useRecommendOption||!1,showLayerInputMode:i.showLayerInputMode||!1})},_getInitialSelectboxOption:function(n,t){var i;return n.option?typeof n.option=="string"?i=this._getOptionsFromString(n.option):(this._isSpace&&n.option&&(n.option[0].length===0&&n.option.pop(),n.option.unshift({id:this.spaceId,value:this._spaceSymbolValue,label:this._spaceSymbolLabel})),this.useManualInput&&n.option&&n.option.push({id:this.manualInputItemId,value:ecount.resource.LBL05716,label:ecount.resource.LBL05716,functionalCss:"noneFocus",useManualInput:this.useManualInput}),i=this._getOptionsFromArray(n.option,t.data.length)):i=this._getContinuosDataByRange(n),this.moreOptionButton&&i.push(this._getViewMoreOption()),i},_getInitialSelectedValue:function(n){if(!$.isNull(n.selectedValue))return typeof n.selectedValue!="object"?_.isNumber(n.selectedValue)?n.selectedValue+"":n.selectedValue:$.isArray(n.selectedValue)?n.selectedValue[0]:n.selectedValue.value},_getSelectedOptionSet:function(n,t){return{cid:this.cid,name:this.name,focusChangeFiredByModeChange:!1,ecRole:"select.selectbox",ecService:"layer.selectbox",ecServiceKey:this.ecPath,selectedValue:_.isNumber(n.value)?n.value+"":n.value,selectedLabel:n.label,selectedCss:n.className,prefixCss:t}},getValue:function(){return this.getState(this.selectCompIndex,"selectedValue")},initializeViewOptions:function(n){_.merge(this.__viewOptions,{isSmall:n._isSmall})},getOldValue:function(n){return this.getState(n||0,"opt.oldvalue")},getSelectedItem:function(){return{value:this.getValue(),label:this.getState(this.selectCompIndex,"selectedLabel")}},getGridSelectedLabel:function(){return this.getState(this.selectCompIndex,"selectedLabel")},getCodeData:function(){var n=this.getComponent(this.selectCompIndex),t=n.option.head(ecount.control.select.optionFindingPredicate.bind(n.option,n.selectedValue));if(t)return t.data},setValue:function(){var t=this.selectCompIndex,n,i=!1;switch(arguments.length){case 1:case 2:n=$.isNull(arguments[0])?"":arguments[0];i=$.isNull(arguments[1])?!1:arguments[1];break;default:t=arguments[0]||0;n=$.isNull(arguments[1])?"":arguments[1];i=$.isNull(arguments[2])?!1:arguments[2]}(_.isArray(n)&&(n=n[0]),this.useManualInput||this.getState(t,"option").any(function(t){return t.value==n}))&&(n==undefined&&(n=""),this._changeSelectedValue(t,n),this.setState(t,"attr.disabled",this.getState(t,"attr.disabled"),!0),this.setState(t,"lastSelectedValue",n),i&&this.executeChangeDelegator({cindex:t,value:n}))},setIsNewFormMode:function(n){this.setState(this.selectCompIndex,"isNewFormMode",n)},setStandardValue:function(){this.setValue.apply(this,arguments)},setSelectedIndex:function(n){var t=this.getComponent(this.selectCompIndex),i=t.option[n];i&&this._changeSelectedValue(t.index,i)},setSelectedValue:function(n){var t=this.getComponent(this.selectCompIndex),i=t.option.head(ecount.control.select.optionFindingPredicate.bind(t.option,n));i&&this._changeSelectedValue(t.index,i||{value:$.isNull(n)?"":n})},setVisibleBorder:function(){},setRecommendValue:function(n){this.resetRecommend();this.setState(this._IT_SELF,"recommendValue",n);this.setState(this._IT_SELF,"useRecommendOption",!0)},resetRecommend:function(){var n=this.getComponent(this.selectCompIndex),t;this.setState(this._IT_SELF,"recommendValue","");this.setState(this._IT_SELF,"useRecommendOption",!1);t=n.option.map(function(n){return n.recommend=!1,n});this.setState(n.index,"option",t)},getLayerServiceKey:function(n){var t,i;return n?(i=n.ecPath,t=n.ecService==ecount.layer.constValue.FN?"fn":n.ecRoleIndex||n.ecFunctionId):(i=this.ecPath,t=this.selectCompIndex),ecount.common.makeServiceKey(i,t)},addOption:function(n,t){var i=this.getState(this.selectCompIndex,"option"),r=this._getOptionsFromArray($.isArray(n)?n:[n],i.length),u=i.length==(this.useManualInput||this.useDynamicAdd?1:0),f=this.getLayerServiceKey();_.isArray(r)&&r.forEach(function(n){var t=_.isUndefined(n.index)||_.isNull(n.index)?this.useManualInput||this.useDynamicAdd?i.length-1:i.length:n.index;i.splice(t,0,n)}.bind(this));ecount.layer.hide(f);u&&this._changeSelectedValue(this.selectCompIndex,r[0]);t&&this.executeChangeDelegator({cindex:this.selectCompIndex,value:this.getState(this.selectCompIndex,"lastSelectedValue")})},addMoreSelectOption:function(){var n=this.getComponent(this.selectCompIndex),t=this._getOptionsFromArray(this.moreOptionData,n.option.length),i=_.findIndex(n.option,function(n){return n.value==this._getMoreOptionValue()}.bind(this)),u=this.getLayerServiceKey(),r;layer=ecount.layer.getLayer(u);firstOptionAdded;n.option.splice(i,1);this.useManualInput||this.useDynamicAdd?(r=n.option.pop(),n.option=n.option.concat(t).concat([r])):n.option=n.option.concat(t);firstOptionAdded=n.option[i];this._changeSelectedValue(n.index,firstOptionAdded);layer.update({option:n.option});this.setFocus(0);this.executeChangeDelegator({cindex:this.selectCompIndex,value:this.getState(this.selectCompIndex,"lastSelectedValue")})},setReadOnly:function(n){this._setStateByType("attr.disabled",n)},removeOption:function(n){var u=this.getLayerServiceKey(),t,r,i;ecount.layer.hide(u);n===undefined?(this.setState(this.selectCompIndex,"option",[]),this._changeSelectedValue(this.selectCompIndex,{label:"",value:""})):(t=this.getComponent(this.selectCompIndex,this.selectCompIndex),r=t.option[n],t.option.splice(n,1),t.selectedValue==r.value&&(i=t.option[n==t.option.length?this.selectCompIndex:n],this._changeSelectedValue(this.selectCompIndex,i?i:{value:""})))},setOption:function(n){var i=this.getLayerServiceKey(),t=this._getOptionsFromArray($.isArray(n)?n:[n]);ecount.layer.hide(i);this.moreOptionButton&&t.push(this._getViewMoreOption());this.setState(this.selectCompIndex,"option",t);this._changeSelectedValue(this.selectCompIndex,t[0])},hideOption:function(n){var t=this.getComponent(this.selectCompIndex),i=t.option.map(function(t,i){return i==n?_.merge(t,{"style.display":!1}):t}),r=i.head(function(n){return n.value==t.selectedValue});i[n].value==t.selectedValue&&i[n].label==t.selectedLabel&&n<i.length-1&&(r=i[n+1]);this.setState(t.index,"option",i);this._changeSelectedValue(t.index,r)},showOption:function(n){var t=this.getComponent(this.selectCompIndex).option.map(function(t,i){return i==n?_.omit(t,["style.display"]):t});this.setState(this.selectCompIndex,"option",t)},changeInputMode:function(n){var t=this.getComponent(n||0);this._changeCompModeBySelectedValue(t,{isModeChange:!0})},getOptionCount:function(){return this.getComponent(this.selectCompIndex).option.length},getSelectOptions:function(){return this.getState(this.selectCompIndex,"option").clone(!0)},getLength:function(){return this.getOptionCount()},getValueByIndex:function(n){return this.getComponent(this.selectCompIndex).option[n].value},isContain:function(n){var t=this.getComponent(this.selectCompIndex);return t.option.length>0&&_.findIndex(t.option,function(t){return t.value==n})>-1},hasChild:function(){return this.getComponent(this.selectCompIndex).option.length>0},getResetState:function(){return this.getOriginState(["option","selectedValue","selectedLabel","selectedPrefixCss"])},extract:function(){return{__state:_.extend({},this.__state,{components:this.__state.components.map(function(n){var t=_.cloneDeep(n);return n.mode&&delete t.mode,t})}),__viewOptions:_.cloneDeep(this.__viewOptions)}},getSyncData:function(){return{data:this.getExtractState(["option","selectedValue","selectedLabel","selectedPrefixCss"])}},save:function(){return{key:this.id,value:{options:this.getState(this.selectCompIndex,"option").clone(!0),selected:this.getValue()}}},restore:function(n){if(typeof n!="object")this.setValue(n);else{var t=n.selected,i=n.options;this.pendingViewUpdate(!0);this.setState(this.selectCompIndex,"option",i);this.setValue(t);this.pendingViewUpdate(!1);this.batchUpdateView()}},serialize:function(n){return ecount.control.prototype.serialize.call(this,{key:n||this.name,value:this.getValue()},n)},serializeById:function(){return this.serialize(this.id)},setValueBySerialized:function(n){this.setSelectedValue(n)},checkValidate:function(n,t){var i=this._getValidateValue(),r=n||[];return this._isSpace&&$.isEmpty("")&&r.contains("required")?ecount.validator.validate(i,r,t):ecount.validator.validate(i,n||[],t||"")},getSelectboxOptions:function(n){var t=this.getComponent(n||this.selectCompIndex);return _.cloneDeep(t.option)},executeChangeDelegator:function(n){n=n||{};_.isNil(n.cindex)||this.setState(n.cindex,"lastSelectedValue",n.value);ecount.control.prototype.executeChangeDelegator.call(this,n);this.pcid&&this.executeParentChangeDelegator&&(_.merge(n,{cid:this.cid}),this.executeParentChangeDelegator(n))},onClickSelectHandler:function(n){return this.ecview&&!this.ecview.hasFocus(n.ecRoleIndex)&&this.setFocus(n.ecRoleIndex),!1},onClickLayerSelectHandler:function(n,t,i,r){var u=this.getComponent(this.selectCompIndex),f;if(!u)return!1;if(this.moreOptionButton&&r.selected&&r.selected.value==this._getMoreOptionValue())return this.addMoreSelectOption();u.mode=="input"&&(f=this._getSelectedOption(n,r),this._changeCompModeBySelectedValue(u,{selected:{isModeChange:f.isModeChange,value:r.selected.value,label:r.selected.label}}),this.setFocus(u.index));this.onChangeSelectedValueHandler(n,t,r)},onChangeSelectedValueByKeyboard:function(n,t,i,r){var u=n.ecRoleIndex||this.selectCompIndex,f=this._getNextSelectedOption(n,t,i,r),e=this.getComponent(u);if(!f)return!1;switch(n.handler){case ECountEvent.Type.KEYDOWN_ARROW_UP_SELECT_LAYER:case ECountEvent.Type.KEYDOWN_ARROW_UP_AUTOCOMPLETE_LAYER:if(this.getState(u,"mode")=="input"&&f.id!==this.manualInputItemId)return this._changeToButtonMode(u),!1;break;case ECountEvent.Type.KEYDOWN_ARROW_DOWN_SELECT_LAYER:if(this.getState(u,"mode")=="input")if(f.id!==this.manualInputItemId)this._changeToButtonMode(u);else return!1;else if(this.getState(u,"mode")=="button"&&f.id===this.manualInputItemId)return this._changeCompModeBySelectedValue(e,f),!1}if(this.getState(u,"mode")!="input")this.onChangeSelectedValueHandler(n,t,{index:n.cindex||n.ecRoleIndex,selected:f,changeValue:!0})},onChangeSelectedValueOnServiceByKeyboard:function(n,t,i,r){var u=n.ecRoleIndex||this.selectCompIndex,e=this.getComponent(u),f=this._getNextSelectedOption(n,t,i,r),s=this._getSelectedOption(n,r),o=e.selectedValue;if(!f)return!1;switch(n.handler){case ECountEvent.Type.KEYDOWN_ARROW_UP_SELECT_LAYER:if(this.getState(u,"mode")=="input"&&f.id!==this.manualInputItemId)return this._changeToButtonMode(u),!1;break;case ECountEvent.Type.KEYDOWN_ARROW_DOWN_SELECT_LAYER:this.getState(u,"mode")=="input"?f.id!==this.manualInputItemId&&this._changeToButtonMode(u):this.getState(u,"mode")=="button"&&f.id===this.manualInputItemId&&this._changeCompModeBySelectedValue(e,f)}this.getState(u,"mode")!="input"&&(this._changeSelectedValue(u,f),this.setState(u,"opt.oldvalue",o))},onChangeAutocompleteOnServiceByKeyboard:function(n){var i=n.ecRoleIndex||this.selectCompIndex,t=this.getComponent(this.selectCompIndex),r=this.getLayerServiceKey(_.extend({},n,{ecService:ecount.layer.constValue.SELECTBOX})),u=ecount.layer.getLayer(r);if(!t)return!1;t.mode=="input"&&u.type==="selectbox"&&(this._changeToButtonMode(i),this._changeSelectboxLayerSelection(n,-1))},_changeSelectboxLayerSelection:function(n,t){var i=this.getLayerServiceKey(_.extend({},n,{ecService:ecount.layer.constValue.SELECTBOX})),r=ecount.layer.getLayer(i);r.setCurrentSelection(t)},onChangeSelectedValueHandler:function(n,t,i){var r=n.ecRoleIndex||this.selectCompIndex,e=this.getComponent(r),u=this._getSelectedOption(n,i),s=this.getState(this._IT_SELF,"showLayerInputMode"),o=this._getDefaultDelegatorInfo(n,t),f;(this.disableStateObserving(),this._changeCompModeBySelectedValue(e,u),this.getState(r,"mode")!="input"||i.changeValue)&&(f=e.selectedValue,this._changeToButtonMode(r),this._onBeforeChangeSelectedValue(n,t,i),this._changeSelectedValue(r,u),this._onAfterChangeSelectedValue(u),this.enableStateObserving(),f!=u.value?(this.setState(r,"lastSelectedValue",u.value),this.notifyToStateObserver(n.cindex,"selectedLabel",this.getState(r,"selectedLabel")),this.executeChangeDelegator({event:t,cindex:r,oldValue:f,value:u.value})):this.delegator&&this.delegator.triggerEvent("control.select",_.merge(o,{type:"control.select",event:t,cindex:r,value:u.value,oldValue:f})),this.validateIf(this.getState(this._IT_SELF,"validate.needvalidate")))},_setInputValue:function(n,t,i,r){this._updateInputValue(n,t,i,r)},_updateInputValue:function(n){var f=this.getComponent(n.ecRoleIndex||n.cindex),r=this.selectCompIndex,i=n.cindex,t=n.value,u=this.getState(r,"option");$.isEmpty(t)||(this.setState(i,"selectedValue",t),this.setState(i,"selectedLabel",this._getSelectedLabel(t,u)),this.setState(i,"value",t))},getLayerAutocompleteOption:function(n){var i=ecount.control.prototype.getLayerAutocompleteOption.apply(this,arguments),r=this.selectCompIndex,t=this.getState(r,"option"),u=_.isArray(t)?t.filter(function(n){return n.useManualInput!==!0}):[];return _.extend(i,{setMinWidth:!0,value:n.value,autoHighlightFirstResult:!0,searchSourceList:u,setupHandler:this.setManualInputAutoCompleteSetting.bind(this,this),responseFilter:this.getManualInputAutocompleteList.bind(this),boundary:this.getRoleHolderBoundary(n.ecRole,n.ecRoleIndex)})},setManualInputAutoCompleteSetting:function(n,t,i,r){r(i)},getManualInputAutocompleteList:function(n,t){return n.filter(function(n){return n.value.indexOf(t)>=0})},_onKeypressOthersHandler:function(n,t){var u=String.fromCharCode(t.which),i=this.getComponent(n.cindex||n.ecRoleIndex),f,r;if(i&&i.format!="d"&&i.mode!="input"){if(r=i.option,!!this.useManualInput&&i.mode=="button"){this.setState(i.index,"focusChangeFiredByModeChange",!0);this.setState(i.index,"mode","input");this.setFocusOnComponent(i.index,!0);return}u!=this._keyStack&&(this._keyStack+=u.toLowerCase());this.keyStackID&&ecount.global.clearTimeoutByTimerNo(this.ecPageID,this.keyStackID);f=ecount.control.select.getCurrentOptionIndex(i);ecount.control.select.autoCompleteHandler(this._keyStack,f,r,function(n){this._changeSelectedValue(i.index,r[n])}.bind(this));this.keyStackID=ecount.global.setTimeout(this.ecPageID,function(){this.keyStackID=null;this._keyStack=""}.bind(this),300)}},_getOptionId:function(n,t){return arguments.length==2?this.id+"_"+(isNaN(+n)?t:t+n):this.id+"_"+(isNaN(+n)?"":n)},getOptionObject:function(n,t,i){var u=_.isNumber(t)?t:0,r=n.toString(),f=r.length>=u?r:new Array(u-r.length+1).join(_.isNil(i)?"":i)+r;return{id:this.id+"_"+n,label:f,value:n}},_getOptionsFromArray:function(n,t){return ecount.control.select.getOptionsFromArray(n,this._getOptionId.bind(this,t),this._getOptionObjFromArray.bind(this))},_getContinuosDataByRange:function(n){return ecount.control.select.getContinuosDataByRange(n,this.getOptionObject.bind(this))},_getOptionsFromString:function(n){return ecount.control.select.getOptionsFromString(this.id,n)},_getOptionObjFromArray:function(n){return{value:""+n[0],label:""+n[1],data:this.cssMap[n[3]]?{}:n[3],className:n.className,prefixCss:this.cssMap[n[3]]||"",activeCss:this.reportType?"checked-item":null,liCss:n[4]||"",isFooterOption:n[5]||"",isFooterCustomRoleId:this.isFooterCustomRoleId||!1,isEditMode:n[6]||""}},_getMoreOptionValue:function(){return"MORE_OPTION"},_getDefaultOptionState:function(){return{selectedValue:"",selectedLabel:"",option:[]}},_getViewMoreOption:function(){return{value:this._getMoreOptionValue(),label:ecount.resource.LBL09004,keepSelectBoxLayer:!0}},_getSelectedLabel:function(n,t){var i=t.head(ecount.control.select.optionFindingPredicate.bind(t,n));return i?i.label:n},_getSelectedCss:function(n,t){var i=t.head(ecount.control.select.optionFindingPredicate.bind(t,n));if(i)return i.className},_getSelectedPrefixCss:function(n,t){var i=t.head(ecount.control.select.optionFindingPredicate.bind(t,n));if(i)return i.prefixCss},_getSelectedLayerData:function(n,t){var i=t.selected,r="",u="",e="",o="",s="",f=!1;return i&&""+i.id&&i.id==this.manualInputItemId?{label:r,value:u,manual:f,isModeChange:!0}:(i?(r=i.label,u=i.value,e=i.className,o=i.prefixCss,f=!1,s=i.isFooterOption):this.getComponent(n.ecRoleIndex).mode=="input"&&(r=n.value,u=n.value,f=!0),{label:r,value:u,className:e,prefixCss:o,isFooterOption:s,manual:f,isModeChange:!1})},_getSelectedOption:function(n,t){var i=this.getComponent(n.ecRoleIndex||this.selectCompIndex),r;return r=t&&t.selected?t.selected:i.option.head(ecount.control.select.optionFindingPredicate.bind(i.option,i.selectedValue)),this._getSelectedLayerData(n,{selected:r})},_getNextSelectedOption:function(n,t,i,r){var s=n.ecRoleIndex||this.selectCompIndex,u=this.getComponent(s),f=_.findIndex(u.option,function(n){return n.value==u.selectedValue}),o=this.getState(this._IT_SELF,"useRecommendOption"),e;if(u){switch(n.handler){case ECountEvent.Type.KEYDOWN_ARROW_UP_SELECT_LAYER:if(r.prevLayerSection==="select"){if(o&&r.nextLayerSection&&r.nextLayerSection==="quickEntry")return u.option.filter(function(n){return n.recommend})[0]}else if(r.prevLayerSection==="quickEntry")return;if(f<=0)return;e=f-1;break;case ECountEvent.Type.KEYDOWN_ARROW_DOWN_SELECT_LAYER:if(r.removeClassHidden)return u.option.filter(function(n){return n.recommend})[0];if(r.prevLayerSection==="quickEntry"&&o&&r.nextLayerSection&&r.nextLayerSection==="select")return u.option[0];if(f+1>=u.option.length)return;e=f+1;break;default:e=f}return u.option[e]}},_onBeforeChangeSelectedValue:function(){},_onAfterChangeSelectedValue:function(){},_changeSelectedValue:function(n,t){var i=this.getState(n,"option"),r;this.pendingViewUpdate(!0);this.setState(n,"opt.oldvalue",this.getState(n,"selectedValue"),!1);typeof t=="object"?(this.setState(n,"selectedValue",""+t.value),this.setState(n,"selectedLabel",$.isNull(t.label)?this._getSelectedLabel(t.value,i):t.label),this.setState(n,"selectedPrefixCss",t.prefixCss||this._getSelectedPrefixCss(t.value,i))):(r=this._getSelectedLabel(t,i),this.setState(n,"selectedValue",""+t),this.setState(n,"selectedLabel",this.useManualInput?r||t:r),this.setState(n,"selectedPrefixCss",this._getSelectedPrefixCss(t,i)));this.pendingViewUpdate(!1);this.batchUpdateView()},_changeCompModeBySelectedValue:function(n,t){var i=n.index;$.isEmpty(t.isModeChange)&&(t.isModeChange=t.id===this.manualInputItemId);t.isModeChange?(this.setState(i,"focusChangeFiredByModeChange",!0),this.setState(i,"mode","input"),this.setFocus(i)):this.setState(i,"mode","button");t.manual&&this.setState(i,"manualInput",!0)},_changeToButtonMode:function(n){_.isEmpty(this.getState(n,"mode"))||this.getState(n,"mode")==="button"||(this.setState(n,"focusChangeFiredByModeChange",!0),this.setState(n,"mode","button"),this.setFocus(n))},_getValidateValue:function(n){var t=this.getValue(n);return t=="".padLeft(t.length,ecount.delimiter)&&(t="".padLeft(t.length," ")),t},_checkValidation:function(n){return this.maxLength&&n.value.length>this.maxLength?!1:!0},ON_FOCUSIN:function(n,t){var i=this.getComponent(n.ecRoleIndex),u=i&&i.lastSelectedValue,f=this.getState(this._IT_SELF,"useRecommendOption"),r=this.getState(this._IT_SELF,"recommendValue");f&&!!r&&u!=r&&this._showLayer(_.extend({},n,{handler:".layer.selectbox",ecService:"layer.selectbox"}),t,{showingUpDelay:400,hiddenBody:!0});i&&i.focusChangeFiredByModeChange&&this.setState(n.ecRoleIndex,"focusChangeFiredByModeChange",!1)},ON_FOCUSOUT:function(n,t,i,r){var u=this.getComponent(n.ecRoleIndex||n.cindex),f=u&&u.lastSelectedValue,e=u&&u.selectedValue,s=this.getLayerServiceKey(n),h=$.isEmpty(r.index)?n.ecRoleIndex:r.index,c=ecount.layer.getLayer(s),o;u&&f!=e&&this.executeChangeDelegator({event:t,cindex:u.index,oldValue:f,value:e});switch(n.handler){case ECountEvent.Type.FOCUSOUT_CONTROL:o=u&&u.mode=="input";o&&(this.getState(h,"focusChangeFiredByModeChange")||($.isEmpty(n.value)&&this.setValue(this._spaceSymbolValue),u&&this.setState(u.index,"mode","button")))}},_ON_BEFORE_CLICK:function(n,t,i,r){if(ecount.control.prototype._ON_BEFORE_CLICK.apply(this,arguments)===!1)return!1;var s=n.ecRoleIndex,u=this.getComponent(s),e=this.getState(this._IT_SELF,"showLayerInputMode"),f=this.getLayerServiceKey(n),o=ecount.layer.getLayer(f),h=this.getState(this._IT_SELF,"useRecommendOption");if(h&&f&&o&&o.hiddenBody&&(ecount.layer.clearTimer(f),ecount.layer.removeLayer(f)),u)switch(n.handler){case ECountEvent.Type.CLICK_SELECT:return u.mode=="input"&&!!e?!0:u.mode!="input";case ECountEvent.Type.CLICK_AUTOCOMPLETE:if(u.mode!="input"||e)u.mode!="input"||!e||_.merge(r,{showLayerInputMode:!0});else return!1;return!0}return!0},ON_CLICK:function(n,t,i,r){switch(n.handler){case ECountEvent.Type.CLICK_SELECT:return this.onClickSelectHandler(n,t,i,r)}},ON_CLICK_SERVICE:function(n,t,i,r){if(r.originId!="selectboxAddNewForm"&&r.originId!="selectboxOption"&&r.originId!="selectboxEditForm")switch(n.handler){case ECountEvent.Type.CLICK_LAYER:return this.onClickLayerSelectHandler(_.merge({cid:this.cid,ecRoleIndex:r.index},n),t,i,r)}},ON_MOUSEDOWN_SERVICE:function(n,t,i,r){if(r.hasAutocompleteFocus)switch(n.handler){case ECountEvent.Type.MOUSEDOWN_LAYER:r.selected=r.itemList[r.selectedIndex];return this.onClickLayerSelectHandler(_.merge({cid:this.cid,ecRoleIndex:r.index},n),t,i,r)}},ON_KEYDOWN_ARROW_UP:function(n,t,i,r){this.onChangeSelectedValueByKeyboard(n,t,i,r);n.suspend=!0},ON_KEYDOWN_ARROW_UP_SERVICE:function(n,t,i,r){switch(n.ecService){case"layer.selectbox":return this.onChangeSelectedValueOnServiceByKeyboard(_.merge({cid:this.cid,ecRoleIndex:r.index},n),t,i,r);case"layer.autocomplete":return this.onChangeAutocompleteOnServiceByKeyboard(n,t,r)}},ON_KEYDOWN_ARROW_DOWN:function(n,t,i,r){this.onChangeSelectedValueByKeyboard(n,t,r,!0);n.suspend=!0},ON_KEYDOWN_ARROW_DOWN_SERVICE:function(n,t,i,r){switch(n.ecService){case"layer.selectbox":return this.onChangeSelectedValueOnServiceByKeyboard(_.merge({cid:this.cid,ecRoleIndex:r.index},n),t,i,r);case"layer.autocomplete":return!1}},ON_KEYDOWN_ENTER:function(n,t,i,r){var u=$.isEmpty(r.index)?n.ecRoleIndex:r.index,e=this.getComponent(u),f=this.getState(u,"mode");if(this.moreOptionButton&&r.selected&&r.selected.value==this._getMoreOptionValue())return this.addMoreSelectOption();if(f=="input"&&(r.changeValue=!0,r.selected={label:n.value||this._spaceSymbolLabel,value:n.value||this._spaceSymbolValue}),f=="button"){var o=this.getValue(),s=this.getSelectOptions(),h=s.filter(function(n){return n.value!=this._spaceSymbolValue}.bind(this)).some(function(n){return n.value==o});h||(r.changeValue=!0,r.selected={label:this._spaceSymbolLabel,value:this._spaceSymbolValue})}this.onChangeSelectedValueHandler(n,t,r||{});!this.useManualInput||this.getState(u,"mode")!="input"||this.setState(e.index,"mode","button")},ON_KEYDOWN_ENTER_SERVICE:function(n,t,i,r){var u=$.isEmpty(r.index)?n.ecRoleIndex:r.index,f=this.getComponent(u);if(this.moreOptionButton&&r.selected&&r.selected.value==this._getMoreOptionValue())return this.addMoreSelectOption();if(this.getState(u,"mode")=="input"){r.changeValue=!0;switch(n.ecService){case"layer.selectbox":r.selected={label:n.value||this._spaceSymbolLabel,value:n.value||this.getState(u,"selectedLabel")};break;case"layer.autocomplete":if($.isEmpty(r.itemList)||$.isEmpty(r.selectedIndex))return!1;selectedValue=r.itemList[r.selectedIndex];r.selected={label:selectedValue.value||this.getState(u,"selectedValue"),value:selectedValue.value||this.getState(u,"selectedLabel")}}}this.onChangeSelectedValueHandler(_.merge({cid:this.cid,ecRoleIndex:r.index},n),t,r||{});f.lastSelectedValue!=f.selectedValue&&this.executeChangeDelegator({event:t,cindex:u,oldValue:f.lastSelectedValue,value:f.selectedValue});!this.useManualInput||this.getState(u,"mode")!="input"||this.setState(f.index,"mode","button");this.setFocus(u+1)},ON_KEYDOWN_ESC_SERVICE:function(n,t,i,r){if(this.moreOptionButton&&r.selected&&r.selected.value==this._getMoreOptionValue())return this.addMoreSelectOption();this.onChangeSelectedValueHandler(_.merge({cid:this.cid,ecRoleIndex:r.index},n),t,r||{})},ON_KEYPRESS_OTHERS:function(n,t,i,r){if(r.selected&&r.selected.selectedIndex!==undefined){var u=r.selected.selectedIndex,f=this.getComponent(r.selected.index).option[u];this._changeSelectedValue(r.index,f)}else this._onKeypressOthersHandler(n,t,r)},ON_KEYPRESS_OTHERS_SERVICE:function(n,t,i,r){if(r.selected){var u=r.selected,f=this.getState(u.index,"option");this._changeSelectedValue(u.index,f[u.selectedIndex])}}});ecount.control.select.getContinuosDataByRange=function(n,t){var i=n.step===undefined?1:Math.abs(parseInt(n.step)),r=parseInt(n.from),f=parseInt(n.to),e=[],o=parseInt(Math.abs(r-f)/i),s=n.padLength&&parseInt(n.padLength),h=n.padString&&n.padString.toString(),u;r>f&&(i=-(i||1));do u=t(r,s,h),$.isEmpty(u)||e.push(u),r+=i;while(o--);return e};ecount.control.select.getOptionsFromArray=function(n,t,i){return n.map(function(n,r){if($.isArray(n)){var f=t(r),u=_.merge(i(n),{id:f});return isNaN(+n[2])?u.className=n[2]:u.index=n[2],u}return _.merge({id:t,label:n.label||n.text,data:n.data||n.userData},n)}.bind(this))};ecount.control.select.getOptionsFromString=function(n,t){var i=JSON.parse(t);return i.map(function(t,i){if($.isArray(t)){var r={value:_.isNumber(t[0])?t[0]+"":t[0],label:t[1],data:optArr[3],className:optArra.className,id:n+"_"+i};return isNaN(+t[2])?r.className=t[2]:r.index=t[2],r}return t}.bind(this))};ecount.control.select.optionFindingPredicate=function(n,t){var i=$.isEmpty(t.value)?t.value:""+t.value,r=$.isEmpty(t.value)?n:""+n;return ecount.common.isTrue(i)&&ecount.common.isTrue(r)||ecount.common.isFalse(i)&&ecount.common.isFalse(r)||i==r};ecount.control.select.getCurrentOptionIndex=function(n){var i=0,r=n.option,t,u;if(n.selectedValue)for(t=0,u=r.length;t<u;t++)if(ecount.control.select.optionFindingPredicate(n.selectedValue,r[t])){i=t;break}return i};ecount.control.select.autoCompleteHandler=function(n,t,i,r){var f,u,e;u=i.reduce(function(t,i,r){return i.label&&(""+i.label).toLowerCase().indexOf(n)===0&&t.push(r),t}.bind(this),[]);u.length>0&&(e=u.filter(function(n){return n>t}),f=e.length?e[0]:u[0],f!=undefined&&r(f))};ecount.class("ecount.control.view.select","ecount.control.view",{template:"((select))[[fn]]",initInputTemplate:"((select-input))",baseTemplateType:!0,prefixTemplate:'<span class="{{style.css}}"><\/span>',init:function(){ecount.control.view.prototype.init.apply(this,arguments)},render:function(n){var t=n.components.some(function(n){return n.mode==="input"});t&&(this.template=this.initInputTemplate);ecount.control.view.prototype.render.apply(this,arguments)},onInitTemplate:function(n,t){var i=t.components[0];return i&&(t._inline?i["style.css"]=[i["style.css"],"btn-selectbox-inline"].join(" "):i["style.css"]&&(i["style.css"]=i["style.css"].replace("btn-group-select-inline","btn-selectbox-inline")),i["attr.disabled"],t.isSmall&&(i["style.css"]=[i["style.css"],"btn-sm"].join(" ")),i.selectedPrefixCss&&(i.selectedLabel=this.prefixTemplate.replace("{{style.css}}",i.selectedPrefixCss)+i.selectedLabel)),n},onChangeMode:function(n,t){var u=this.getElements(n),f=t=="input",i=u.filter("input[type='text']"),e=u.filter("button"),r=f?i:e,o=f?e:i;i.val("");r.hasClass("hidden")&&o.hasClass("hidden")||(r.removeClass("hidden"),o.addClass("hidden"),r.focus());this.setBorderRadius()},onChangeSelectedValue:function(n){var t=this.getElements(n),i=t.parent()},onChangeSelectedLabel:function(n,t){var r=this.getElements(n),i=r.filter("button").find("div.selectbox-label");i=i&&i.length?i:r.filter("button");r.filter("input[type='text']").val(t);i.text(t)},onChangeStyleDisplay:function(n,t){var i=this.getElements(n);i.length>1&&(i=i.filter("button"));t?(i.removeClass("hidden"),n==this._IT_SELF&&this.$el.removeClass("hidden")):i.addClass("hidden")},onChangeSelectedPrefixCss:function(n,t){var i=this.getElements(n).filter("button"),r=i.find("div.selectbox-label"),u;i=r&&r.length?r:i;i&&(u=i.text(),t?i.html(this.prefixTemplate.replace("{{style.css}}",t)+u):i.html(u))},onChangeSelectedCss:function(){},onChangeAttrDisabled:function(n,t){var i=this.getElements(n).filter("button");i&&(t?i.addClass("disabled"):i.removeClass("disabled"))},onBlur:function(n){if(typeof n=="number"&&n>-1){var t=this.getElements(n);t.blur()}else this.$el.find("input:visible, button:visible").blur()},isVisibleElement:function(n){var t=this.getElements(n);return t.length?t.length==2?ecount.widget.isVisible(t.get(0))||ecount.widget.isVisible(t.get(1)):ecount.widget.isVisible(t.get(0)):!1}});ecount.class("ecount.control.anchor","ecount.control.button",{ecPackage:"ecount.control.anchor",_defaultCss:"",init:function(){ecount.control.button.prototype.init.apply(this,arguments)},initializeOptions:function(n){_.extend(this,{onClickHandler:n.onClick,hasDropdown:n.hasDropdown,dropdownAdditionalOptions:n.dropdownAdditionalOptions,dropdownOptions:n.ownDropdownOptions||n.dropdownOptions,_isNotAllowDropdownShow:n._isNotAllowDropdownShow,suffixIndex:n.suffixIndex})},initializeViewOptions:function(n){$.extend(this.__viewOptions,{isVertical:n.isVertical||this.isVertical||!1})},onInitComponent:function(n,t,i,r,u){var f,e,o;if(u._cdata&&(r._cdata=u._cdata),f={},u.style&&u.style.split(";").filter(function(n){return n!=""}).forEach(function(n){var t=n.split(":");f[t[0]]=t[1]}),r["attr.href"]=r.url||u.url||"javascript:;",r["attr.target"]=r.target||u.target||"",r["attr.clickOnce"]=r["attr.clickOnce"]||u._clickOnce||!1,r.ecRole=u.ecRole||"",r.ecRoleIndex=$.isEmpty(u.ecRoleIndex)?"":u.ecRoleIndex,r.ecService=u.ecService||"",r.ecServiceAttr=u.ecServiceAttr||"",r.ecServiceTrigger=u.ecServiceTrigger||"",r.label=r.label||"",r["css.disabled"]=r["attr.disabled"]?"text-disabled":"",r["style.bgcolor"]=r.bgColor||f.bgColor||"",r["style.color"]=r.color||f.color||"",r.style="",u._changeCssData)for(e=0;e<u._changeCssData.length;e++)o=u._changeCssData[e],o.index===t&&o.css&&(r["style.css"]=o.css);u.hasDropdown&&(r.ecService="layer.dropdown",r.ecServiceAttr="layer.fixed")},render:function(){ecount.control.button.prototype.render.apply(this,arguments)},onInitState:function(n,t,i){t.components||(t.components=[{}]);t.baseType=i.baseType},withDivider:function(n,t){t=t?t:0;this.setState(t,"attr.divider",n)},_initEvents:function(){},validate:function(){return[]},serialize:function(n){return ecount.control.button.prototype.serialize.apply(this,[undefined,n])},serializeById:function(n){n=n?n:0;var t=this.getComponents().filter(function(t){return typeof n=="number"?t.index===n:t["attr.data-value"]===n||t.id===n});return this.serialize(t[0].id)},save:function(){var n=this.getNationalFlag();if(n)return{key:this.id,nationalCode:n}},restore:function(n){this.getNationalFlag()&&_.get(n,"nationalCode")&&this.setNationalFlag(_.get(n,"nationalCode"))},setReadOnly:function(n,t){t=t?t:0;var r=this.getComponents().filter(function(n){return typeof t=="number"?n.index===t:n["attr.data-value"]===t||n.id===t}),i=r[0].index;this.setState(this._IT_SELF,"attr.disabled",n);this.setState(i,"attr.disabled",n);this.setState(i,"css.disabled",n)},changeCss:function(n,t,i){i=$.isNumber(i)?i:this._ALL_COMP;this.setState(i,"style.css",n)},changeCssByIndex:function(n,t,i){this.changeCss(n,i,t)},_removeClass:function(n,t){var t=t?t:0,i=this.getState(t,"style.css");return _.pull(i.split(" "),n).join(" ")},_addClass:function(n){var t=this._removeClass(n);return t+" "+n},_hasClass:function(n,t){var t=t?t:0,i=this.getState(t,"style.css");return _.isNumber(_.find(i.split(" "),function(t){return t==n}))},addClass:function(){ecount.control.prototype.addClass.apply(this,arguments);this.executeTabSync()},removeClass:function(){ecount.control.prototype.removeClass.apply(this,arguments);this.executeTabSync()},getUserData:function(n){n=n?n:0;var t=this.getComponents().filter(function(t){return typeof n=="number"?t.index===n:t["attr.data-value"]===n||t.id===n});return t[0]._cdata?t[0]._cdata:[]},getLabel:function(n){n===undefined&&(n=0);var t=this.getComponent(n);return t.label},getOriginalElement:function(){var n=this.getContainerElement().find("a");return n&&n[0].tagName==="A"?n[0].outerHTML:""},setLabel:function(n,t){t=t?t:0;this.setState(t,"label",n)},changeLinkLabel:function(n){var t=this.id,i=this.getComponents().filter(function(n){return n.cid===t});this.setState(i[0].index,"label",n)},getValue:function(){},setValue:function(){},getStandardValue:function(){},getSyncData:function(){return{data:this.getExtractState(["style.display","label","style.css","css.disabled"])}},getGridSelectedLabel:function(){return this.getOriginalElement()},onClickHandler:function(){},onMessage:function(n,t){t=t||{};this.getNationalFlag()&&_.get(t,"data.STATE_CODE")&&(this.setNationalFlag(_.get(t,"data.STATE_CODE"),!0),this._sendMessage(n,_.merge({},t,{callback:null,data:t.originalDataset||t.data})),t.callback&&t.callback())},_sendMessage:function(n,t){n||(n={pageID:this.popupURL?this.popupURL.split("/").last():""});n.controlID=this.id;t.control=this;ecount.global.executeCallback(this.ecPageID,this.responseID,n,t)},getLayerDropdownOption:function(n,t){return $.extend(this.getLayerDefaultOption(n,t),{isSetDropdownSize:this.isSetDropdownSize,hasDropdownLayerIcon:this.hasDropdownLayerIcon,css:this.css,items:this.dropdownOptions||[],boundary:this.getContainerBoundary(),baseType:!0,cid:n.cid,cindex:n.cindex},this.dropdownAdditionalOptions)},ON_CLICK:function(n,t,i,r){if($.isNull(n.cindex))return!1;r.cid=this.id;r.name=this.name;r.command=r.command||this._makeCommandString();r.event=t;r.__self=this;var u=this.getComponent(n.cindex);u&&(r.linkID=u.originID==undefined?null:u.originID);this.onClickHandler&&this.onClickHandler(_.merge({},n,r),t,i,r)},ON_KEY_INPUT:function(){},_ON_BEFORE_FOCUSIN:function(){return this._isNotAllowDropdownShow?!1:!0},ON_KEYDOWN_SPACE:function(n,t,i,r){var f=t.keyCode,u;switch(f){case 32:return u=ecount.global.findPageInstance(n.ecPageID),r.command||(r.command=["on",i.containerName,i.id].join("_").ecCamelize(!0)),u&&u._commandHandler(n,t,i,r),!1}}});ecount.class("ecount.control.view.anchor","ecount.control.view",{template:"((link))",init:function(){ecount.control.view.prototype.init.apply(this,arguments)},render:function(){ecount.control.view.prototype.render.apply(this,arguments)},onInitTemplate:function(n,t){return t.hasFn?["<span>",n,"<\/span>"].join(""):(t.isVertical&&(n=n.replace(/(\(\(\w+\)\))/g,'<div class="control">$&<\/div>')),n)},parseAttrsValue:function(n){n["style.bgcolor"]&&(n.style=["background-color:",n["style.bgcolor"],";","color:",ecview.util.getContrastColor(n["style.bgcolor"]),";"].join(""))},onChangeStyleCss:function(n,t){this.getElements(n).removeClass().addClass(t)},onChangeLabel:function(n,t){this.getElements(n).html(t)},onChangeStyleBgcolor:function(n,t){var i=this.getElements(n);i.css({"background-color":t,color:ecview.util.getContrastColor(t)})},onChangeAttrDivider:function(n,t){var i=this.getElements(n),r='<span class="inline-divider"><\/span>';t=="right"?i.after(r):i.before(r)},onChangeAttrReadonly:function(n,t){var i=this.getElements(n);if(t)i.on("click.onChangeAttrReadonly",function(){return!1});else i.unbind("click.onChangeAttrReadonly")},onChangeCssDisabled:function(n,t){var i=this.getElements(n);i[t?"addClass":"removeClass"]("text-disabled")},onChangeStyleInline:function(){},onChangeAttrPlaceholder:function(){}});ecount.class("ecount.control.checkbox","ecount.control",{ecPackage:"ecount.control.checkbox",_defaultCss:"form-checkbox",_serializeByAll:!1,_useCommonSerialize:!1,_initallyHiddenIndex:null,init:function(){ecount.control.prototype.init.apply(this,arguments)},render:function(){ecount.control.prototype.render.apply(this,arguments)},initializeOptions:function(n){ecount.control.prototype.initializeOptions.apply(this,arguments);this._initallyHiddenIndex=n._hideCheckbox?n._hideCheckbox.map(function(n){return+n}):[];this.isVertical=n.isVertical||!1;this._isSquare=n._isSquare||!1;this._readOnlyIndex=n._readOnlyIndex},initializeViewOptions:function(n){_.merge(this.__viewOptions,{isVertical:n.isVertical||this.isVertical||!1,isSquare:n._isSquare||this._isSquare||!1})},onInitState:function(n,t,i){ecount.control.prototype.onInitState.apply(this,arguments);_.merge(this.__state,{hasMagnifier:i.hasMagnifier||!1})},onInitComponent:function(n,t,i,r){r.label=r.label||"";r["attr.name"]=r.name+(this.pid?"_"+this.pid:"");r["attr.checked"]=!!r.selected;r["attr.labelid"]=["control",this.tabID||"",this.gridID||"",this.ecPageID,this.id,t].join("-");this._initallyHiddenIndex&&~this._initallyHiddenIndex.indexOf(t)&&(r["style.display"]=!1);delete r.selected;i.components&&r&&i.components[0].bgColor&&!r.bgColor&&(r.bgColor=i.components[0].bgColor);this._setCompReadOnlyIndex(r,t)},_setCompReadOnlyIndex:function(n,t){this._readOnlyIndex&&_.indexOf(this._readOnlyIndex,t)!=-1&&(n["attr.disabled"]=!0)},onInitExtractComponent:function(n,t,i){var r=i.data,u=i.extractData.__state.components;t.components.forEach(function(n,t){if(n["attr.name"]=n.name+(this.pid?"_"+this.pid:""),n["attr.labelid"]=["control",this.tabID||"",this.gridID||"",this.ecPageID,this.id,t].join("-"),r&&r[t]&&u[t]&&(r[t].selected||u[t]["attr.checked"])){n["attr.checked"]=!0;return}}.bind(this))},onLazyRender:function(){ecount.control.prototype.onAfterRender.apply(this,arguments);var n=this.getComponents();n&&n.length>0&&n.some(function(n){return n.bgColor})&&this._setCheckboxColor(n)},_setCheckboxColor:function(n){var i=[],t="",r=!1,u=["color","#000",!0];n.forEach(function(n){var e=n["attr.labelid"],f;n.bgColor&&(t=$.Color(n.bgColor).toHexString(),r=ecview.util.getRandomContrastColor(t).textColor=="#000000");i.push(["#"+e+" + label:before",["border-color",t,!0]]);f=["#"+e+":checked + label:before",["background-color",t,!0]];r&&f.push(u);i.push(f)}.bind(this));t&&(ec$.destroyStyleSheetRules(["CONTROL_STYLE",this.id].join("_").ecCamelize()),ec$.addStylesheetRules(i,{id:["CONTROL_STYLE",this.id].join("_").ecCamelize(),appendTarget:this.ecview.$el}))},setCheckboxColor:function(n){var i="",r=this.getComponents(),t;for(_.isArray(n)||(n=[n]),t=0;t<r.length;t++){if(n.length!=1&&_.isNil(n[t]))break;i=n[t]||i;i&&this.setState(t,"bgColor",i)}this._setCheckboxColor(r)},getResetState:function(){return this.getOriginState(["attr.checked","style.display","attr.disabled","label","value"])},getSyncData:function(){return{data:this.getExtractState(["attr.checked","style.display","label"]).concat(this.getExtractState(["opt.oldvalue"],!0))}},serialize:function(n){var t,i;return this._serializeByCustomKey&&$.isArray(this._serializeByCustomKey)?this.serializeByCustomKey():(this._useCommonSerialize?(i=this.getCheckedValue(),t=i.length?i.join(ecount.delimiter):""):t=this.getCheckedValue(),ecount.control.prototype.serialize.apply(this,[{key:n||this.name,value:t},n]))},serializeById:function(){return this.serialize(this.id)},serializeByCustomKey:function(){var n,i=this.getCheckedIndex(),t=this.suffixIndex;return n=[],this._serializeByCustomKey.forEach(function(r,u){var f=t?r+t:r;n.push({key:f,value:i.contains(u)?"1":"0"})}),n},serializeAdditionalData:function(){return ecount.control.prototype.serializeAdditionalData.apply(this,[{name:this.subTitle||"",value:this.getCheckedLabel()||[]}])},save:function(){for(var t=[],i=this.getComponents(),n=0,r=i.length;n<r;n++)t.push(this.getValue(n));return{key:this.id,value:t}},restore:function(n){for(var t=0,i=n.length;t<i;t++)this.setValue(t,n[t])},isCheckboxControl:function(){return!0},getStandardValue:function(){return this.getCheckedValue()},getValue:function(n){return this.getState(n||0,"attr.checked")},getCheckedValue:function(){return this._getCheckedComponent().map(function(n){return $.isNull(n.value)?n.value:""+n.value})},getCheckedLabel:function(){return this._getCheckedComponent().map(function(n){return $.isNull(n.label)?n.label:""+n.label})},getGridSelectedLabel:function(){return this.getCheckedLabel()},getCheckedIndex:function(){return this._getCheckedComponent().map(function(n){return n.index})},getCheckedInfo:function(){return this.getComponents().map(function(n){return{index:n.index,checked:n["attr.checked"],value:n.value}})},getIsCheckedAll:function(){var n=this.getComponents(),t=n.filter(function(n){return n["attr.checked"]});return t.length==n.length},getValueInData:function(n){var t=this.getComponents();return t[n]?t[n].value:null},setOldValue:function(){this.setState(this._IT_SELF,"opt.oldvalue",this.getCheckedValue(),!1)},setValue:function(n,t,i){var f=this.getComponents(),r,u;for(arguments.length==1?(t=$.isNull(n)?"":n,n=[0]):$.isArray(n)||(n=[n]),n=n.map(this._getAdjustedIndex.bind(this)),this.setOldValue(),this.pendingViewUpdate(!0),r=0;r<n.length;r++)u=f[n[r]],u["attr.disabled"]||this.setState(n[r],"attr.checked",!!t),i&&this.executeChangeDelegator({cindex:n});this.pendingViewUpdate(!1);this.batchUpdateView()},getCheckedItems:function(){var n=this.getComponents();return n.filter(function(n){return n["attr.checked"]}).map(function(n){return{value:n.value,label:n.label}})},setReadOnly:function(n,t){var i;arguments.length==2&&(i=n,n=t,t=i);ecount.control.prototype.setReadOnly.apply(this,arguments)},setStandardValue:function(n){var t=this.getCheckedValue();this.setCheckedValue(t,!1);this.setCheckedValue(n,!0)},setCheckedValue:function(n,t){for(var n=$.isArray(n)?n:[n],t=$.isNull(t)?!0:t,u=this.getComponents(),r,i=0;i<n.length;i++)n[i]=$.isEmpty(n[i])?n[i]:n[i].toString();for(i=0;i<u.length;i++)r=u[i],!_.isUndefined(r.value)&&n.contains(""+r.value)&&this.setState(i,"attr.checked",t,this.gridID?!0:undefined)},setCheckedAll:function(n){this.setState(this._ALL_COMP,"attr.checked",n)},setCheckedArray:function(n){this.pendingViewUpdate(!0);this.getComponents().forEach(function(t,i){this.setState(i,"attr.checked",!!n[i])}.bind(this));this.pendingViewUpdate(!1);this.batchUpdateView()},checkValidate:function(n,t){var i=n||[],r=this.getCheckedValue(),u=r.length===0?"":"Fiiled";return ecount.validator.validate(u,i,t)},hideCheck:function(n){var i,r,t;for(n=$.isArray(n)?n:[n],n=n.map(this._getAdjustedIndex.bind(this)),i=this.getComponents(),t=0;t<n.length;t++)r=i[n[t]],r&&this.setState(n[t],"style.display",!1);this.executeChangeDelegator({value:this.getValue(n)})},showCheck:function(n){var i,r,t;for(n=$.isArray(n)?n:[n],n=n.map(this._getAdjustedIndex.bind(this)),i=this.getComponents(),t=0;t<n.length;t++)r=i[n[t]],r&&this.setState(n[t],"style.display",!0);this.executeChangeDelegator({value:this.getValue(n)})},changeCheckLabel:function(n,t){n=$.isArray(n)?n:[n];for(var i=0,u=n.length,r;i<u;i++)r=n[i].label,$.isNull(r)||this.setState(i,"label",r);t&&this.executeChangeDelegator()},_getCheckedComponent:function(){return this.getComponents().filter(function(n){return n["attr.checked"]})},_getAdjustedIndex:function(n){return n},_getValueForDelegate:function(n){return this.getValue(n&&n.cindex?n.cindex:0)},onNextFocus:function(n){var i=this.getComponents(),t=i[++n];t?t["attr.disabled"]||!t["style.display"]?this.onNextFocus(n):this.setFocus(n):this.setFocusOutTrigger()},onChangeHandler:function(n,t){var i=n.cindex,r=this.getComponent(i);r["attr.disabled"]||(this.setOldValue(),this.setState(n.cindex,"attr.checked",n.checked),this.executeChangeDelegator({targetValue:this.getState(n.cindex,"value"),cindex:i,event:t,value:this.getValue(i)}))},ON_CLICK:function(n,t,i,r){if(n.handler=="click.magnifier"){var u=this.getState(this._IT_SELF,"hasMagnifier");r.command=["on",this.containerName,_.isString(u)?u:"magnifier"].join("_").ecCamelize(!0);r.cid=this.id;r.control=this}},ON_CHANGE:function(n,t){switch(n.handler){case ECountEvent.Type.CHANGE_CONTROL:return this.onChangeHandler(n,t,{})}},ON_CHANGE_SERVICE:function(){this.ON_CHANGE.apply(this,arguments)}});ecount.class("ecount.control.view.checkbox","ecount.control.view",{template:"((checkbox))",baseTemplateType:!0,init:function(){ecount.control.view.prototype.init.apply(this,arguments)},render:function(){ecount.control.view.prototype.render.apply(this,arguments)},onInitTemplate:function(n,t){if(t.isSquare&&(n=n.replace(/\(\(checkbox\)\)/g,"((checkbox-square))")),t.isVertical)n=n.replace(/(\(\([\w\-]+\)\))/g,'<div class="control">$&<\/div>');else if(t.inlineDividerPos){var i=-1;n=n.replace(/(\(\([\w\-]+\)\))/g,function(n,r){return(i++,~t.inlineDividerPos.indexOf(i))?r+'<span class="inline-divider" data-role="checkbox.divider" data-role-index="'+i+'"><\/span>':r})}return t.hasMagnifier&&(n=n+String.format('<button class="btn btn-default btn-sm btn-transparant btn-code-search" data-cid="{0}" data-function="{1}" ><\/button>',t.id,"magnifier")),n},parseAttrsValue:function(){},onChangeStyleDisplay:function(n,t){var i=this.getElements(n),r=i.siblings("label"),u=i.parent("span[data-cid]").next("span[data-role='checkbox.divider']");t?(i.removeClass("hidden"),r.removeClass("hidden"),u.removeClass("hidden")):(i.addClass("hidden"),r.addClass("hidden"),u.addClass("hidden"))},onChangeValue:function(){},onChangeAttrChecked:function(n,t){var i=this.getElements(n);i.prop("checked",t);i.prop("tagName")=="DIV"&&(t?i.addClass("active"):i.removeClass("active"))},onChangeLabel:function(n,t){var i=this.getElements(n);i&&i.siblings("label[for="+i.attr("id")+"]").text(t)},onChangeAttrDisabled:function(n,t){var i=ecount.control.view.formElements.join(","),r;$.isNumber(n)&&(r=this.getElements(n),r.find(i).andSelf(i).prop("disabled",t),r.find(":not("+i+")").toggleClass("disabled",t))},onChangeAttrLabel:function(n,t){var i=this.getElements(n);i&&this.$el.find("[for="+i.attr("id")+"]").text(t)}});ecount.class("ecount.control.view.textEditor","ecount.control.view",{_EditorInstance:null,_scrollTop:0,template:["<div id='titleContents' style='width:100%' data-cid=\"{{id}}\">",'<textarea rows="{{rows}}" data-index={{index}} class="form-control {{editorModeTextArea}}" data-textarea="editor_textarea" wrap="hard" placeholder="{{attr.placeholder}}" ><\/textarea>',"<div data-texteditor='tx_trex_container' class='tx-editor-container {{editorModeEditor}}' id='tx_trex_container'>","<div id='tx_toolbar_basic{{id}}' class='tx-toolbar tx-toolbar-basic'>","<div class='tx-toolbar-boundary'>",String.format("<ul class='tx-bar tx-bar-left tx-nav-opt'><li class='tx-list'><div unselectable='on' class='tx-switchtoggle' id='tx_switchertoggle{{id}}'> <a href='javascript:;' title='{0}'>{0}<\/a><\/div><\/li><\/ul>",ecount.resource.LBL70688),"<ul class='tx-bar tx-bar-left tx-group-undo'>",String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-lbg tx-undo' id='tx_undo{{id}}'><a href='javascript:;' class='tx-icon' title='{0} (Ctrl+Z)'>{0}<\/a><\/div><\/li>",ecount.resource.LBL70585),String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-rbg tx-redo' id='tx_redo{{id}}'><a href='javascript:;' class='tx-icon' title='{0} (Ctrl+Y)'>{0}<\/a><\/div><\/li>",ecount.resource.LBL70586),"<\/ul>","<ul class='tx-bar tx-bar-left'><li class='tx-list'><div id='tx_fontfamily{{id}}' unselectable='on' class='tx-slt-70bg tx-fontfamily'>",String.format("<a href='javascript:;' title='{0}'>{0}<\/a>",ecount.resource.LBL70558),"<\/div><div id='tx_fontfamily_menu{{id}}' class='tx-fontfamily-menu tx-menu' unselectable='on'><\/div><\/li><\/ul>","<ul class='tx-bar tx-bar-left'><li class='tx-list'><div unselectable='on' class='tx-slt-42bg tx-fontsize' id='tx_fontsize{{id}}'>",String.format("<a href='javascript:;' title='{0}'>9pt<\/a>",ecount.resource.LBL70559),"<\/div><div id='tx_fontsize_menu{{id}}' class='tx-fontsize-menu tx-menu' unselectable='on'><\/div><\/li>","<\/ul>","<ul class='tx-bar tx-bar-left tx-group-font'>",String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-lbg tx-bold' id='tx_bold{{id}}'><a href='javascript:;' class='tx-icon' title='{0} (Ctrl+B)'>{0}<\/a><\/div><\/li>",ecount.resource.LBL09037),String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-bg tx-italic' id='tx_italic{{id}}'><a href='javascript:;' class='tx-icon' title='{0} (Ctrl+I)'>{0}<\/a><\/div><\/li>",ecount.resource.LBL70562),String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-bg tx-underline' id='tx_underline{{id}}'><a href='javascript:;' class='tx-icon' title='{0} (Ctrl+U)'>{0}<\/a><\/div><\/li>",ecount.resource.LBL70561),String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-bg tx-strike' id='tx_strike{{id}}'><a href='javascript:;' class='tx-icon' title='{0} (Ctrl+D)'>{0}<\/a><\/div><\/li>",ecount.resource.LBL70563),String.format("<li class='tx-list'><div unselectable='on' class='tx-slt-tbg tx-forecolor' id='tx_forecolor{{id}}'><a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a><a href='javascript:;' class='tx-arrow' title='{0}'>{0}<\/a><\/div><div id='tx_forecolor_menu{{id}}' class='tx-menu tx-forecolor-menu tx-colorpallete' unselectable='on'><\/div><\/li>",ecount.resource.LBL70564),String.format("<li class='tx-list'><div unselectable='on' class='tx-backcolor tx-slt-brbg' id='tx_backcolor{{id}}' style='background-color: rgb(154, 165, 234);'><a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a><a href='javascript:;' class='tx-arrow' title='{0}'>{0}<\/a><\/div><div id='tx_backcolor_menu{{id}}' class='tx-menu tx-backcolor-menu tx-colorpallete' unselectable='on'><\/div><\/li>",ecount.resource.LBL10379),"<\/ul>","<ul class='tx-bar tx-bar-left tx-group-align'>",String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-lbg tx-alignleft' id='tx_alignleft{{id}}'><a href='javascript:;' class='tx-icon' title='{0} (Ctrl+,)'>{0}<\/a><\/div><\/li>",ecount.resource.LBL05361),String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-bg tx-aligncenter' id='tx_aligncenter{{id}}'><a href='javascript:;' class='tx-icon' title='{0} (Ctrl+.)'>{0}<\/a><\/div><\/li>",ecount.resource.LBL05362),String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-bg tx-alignright' id='tx_alignright{{id}}'><a href='javascript:;' class='tx-icon' title='{0} (Ctrl+/)'>{0}<\/a><\/div><\/li>",ecount.resource.LBL05363),String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-rbg tx-alignfull' id='tx_alignfull{{id}}'><a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a><\/div><\/li><\/ul>",ecount.resource.LBL70571),"{{toolbar}}","<\/div>","<\/div> ","<div class='tx-toolbar tx-toolbar-advanced' style='display: none;'>","<div class='tx-toolbar-boundary'>","<ul class='tx-bar tx-bar-left'>","<li class='tx-list'><div class='tx-tableedit-title'><\/div><\/li>","<\/ul>","<ul class='tx-bar tx-bar-left tx-group-align'>",String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-lbg tx-table' id='tx_table{{id}}'><a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a><\/div><div id='tx_table_menu{{id}}' class='tx-table-menu tx-menu' unselectable='on'><div class='tx-menu-inner'><div class='tx-menu-preview'><\/div><div class='tx-menu-rowcol'><\/div><div class='tx-menu-deco'><\/div><div class='tx-menu-enter'><\/div><\/div><\/div><\/li>",ecount.resource.LBL70578),String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-bg tx-insertcells' id='tx_insertcells{{id}}'><a href='javascript:;' class='tx-icon2' title='{0}'>{0}<\/a><\/div><div id='tx_insertcells_menu{{id}}' class='tx-insertcells-menu tx-menu' unselectable='on'><\/div><\/li>",ecount.resource.LBL70590),String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-bg tx-mergecells' id='tx_mergecells{{id}}'><a href='javascript:;' class='tx-icon2' title='{0}'>{0}<\/a><\/div><div id='tx_mergecells_menu{{id}}' class='tx-mergecells-menu tx-menu' unselectable='on'><\/div><\/li>",ecount.resource.LBL70589),String.format("<li class='tx-list'><div unselectable='on' class='tx-btn-rbg tx-deletecells' id='tx_deletecells{{id}}'><a href='javascript:;' class='tx-icon2' title='{0}'>{0}<\/a><\/div><div id='tx_deletecells_menu{{id}}' class='tx-deletecells-menu tx-menu' unselectable='on'><\/div><\/li>",ecount.resource.LBL80306),"<\/ul>","<ul class='tx-bar tx-bar-left tx-group-align'>",String.format("<li class='tx-list'><div id='tx_cellslinecolor{{id}}' unselectable='on' class='tx-slt-tlbg tx-cellslinecolor'><a href='javascript:;' class='tx-icon2' title='{0}'>{0}<\/a><div class='tx-colorpallete' unselectable='on'><\/div><\/div><div id='tx_cellslinecolor_menu{{id}}' class='tx-cellslinecolor-menu tx-menu tx-colorpallete' unselectable='on'><\/div><\/li>",ecount.resource.LBL70592),String.format("<li class='tx-list'><div id='tx_cellslineheight{{id}}' unselectable='on' class='tx-btn-bg tx-cellslineheight'><a href='javascript:;' class='tx-icon2' title='{0}'>{0}<\/a><\/div><div id='tx_cellslineheight_menu{{id}}' class='tx-cellslineheight-menu tx-menu' unselectable='on'><\/div><\/li>",ecount.resource.LBL70593),String.format("<li class='tx-list'><div id='tx_cellslinestyle{{id}}' unselectable='on' class='tx-btn-bg tx-cellslinestyle'><a href='javascript:;' class='tx-icon2' title='{0}'>{0}<\/a><\/div><div id='tx_cellslinestyle_menu{{id}}' class='tx-cellslinestyle-menu tx-menu' unselectable='on'><\/div><\/li>",ecount.resource.LBL70594),String.format("<li class='tx-list'><div id='tx_cellsoutline{{id}}' unselectable='on' class='tx-btn-rbg tx-cellsoutline'><a href='javascript:;' class='tx-icon2' title='{0}'>{0}<\/a><\/div><div id='tx_cellsoutline_menu{{id}}' class='tx-cellsoutline-menu tx-menu' unselectable='on'><\/div><\/li>",ecount.resource.LBL70595),"<\/ul>","<ul class='tx-bar tx-bar-left'><li class='tx-list'>","<div id='tx_tablebackcolor{{id}}' unselectable='on' class='tx-btn-lrbg tx-tablebackcolor' style='background-color:#9aa5ea;'>",String.format("<a href='javascript:;' class='tx-icon2' title='{0}'>{0}<\/a>",ecount.resource.LBL70596),"<\/div><div id='tx_tablebackcolor_menu{{id}}' class='tx-tablebackcolor-menu tx-menu tx-colorpallete' unselectable='on'><\/div><\/li>","<\/ul>","<\/div>","<\/div>","<div id='tx_canvas{{id}}' class='tx-canvas'><div id='tx_loading{{id}}' class='tx-loading'><div><img src='{{basePath}}images/editor/icon/editor/loading2.png' width='113' height='21' align='absmiddle' /><\/div><\/div>","<div id='tx_canvas_wysiwyg_holder{{id}}' class='tx-holder' style='display:block;'><iframe id='tx_canvas_wysiwyg{{id}}' name='tx_canvas_wysiwyg{{id}}' allowtransparency='true' frameborder='0' data-cid='{{id}}'><\/iframe><\/div>","<div class='tx-source-deco'><div id='tx_canvas_source_holder{{id}}' class='tx-holder'><textarea id='tx_canvas_source{{id}}' rows='{{rows}}' cols='30'><\/textarea><\/div><\/div>","<div id='tx_canvas_text_holder{{id}}' class='tx-holder'><textarea id='tx_canvas_text{{id}}' rows='{{rows}}' cols='30'><\/textarea><\/div><\/div>","<div id='tx_resizer{{id}}' class='tx-resize-bar'><div class='tx-resize-bar-bg'><\/div><img id='tx_resize_holder{{id}}' src='{{basePath}}{{heightDragImg}}' width='58' height='12' unselectable='on' alt='' /><\/div>","<\/div>","<form id='tx_editor_form' style='display:none;'><\/form>","<\/div>"].join("\n"),toolbarTemplate:"",onInitTemplate:function(n,t){var i,r,u,f;return this.setToolbarTemplate(t),n=n.replace(/{{toolbar}}/,this.toolbarTemplate),n=n.replace(/{{basePath}}/g,EditorJSLoader.getBasePath()),n=n.replace(/{{id}}/g,t.id),i=ecount&&ecount.config&&ecount.config.user,r=_.get(window,"webmail.config",null),r&&(i=r),u=ecount.stylist.convertDarkModeValue(i.SCREEN_THEME_TYPCD,!0),f=u==="B"||u==="A"?"images/editor/icon/editor/skin/01/btn_drag01.gif":"images/dark/editor/btn_drag01.png",n=n.replace(/{{heightDragImg}}/g,f),t.components&&t.components.length>0&&(n=n.replace(/{{index}}/g,t.components[0].index),n=n.replace(/{{attr.placeholder}}/g,t.components[0]["attr.placeholder"])),n=n.replace(/{{rows}}/g,t._rows),t.editorMode==1?n.replace(/{{editorModeTextArea}}/,"hidden"):n.replace(/{{editorModeEditor}}/,"hidden")},setToolbarTemplate:function(n){var t={isShowSourceCodeIcon:{template:["<li class='tx-list'>","<div id='tx_ecountsourcecode{{id}}' unselectable='on' class='tx-btn-rbg tx-ecountcode'>",String.format("<a href='javascript:;' class='tx-icon2' title='{0}'>{0}<\/a>",ecount.resource.LBL17332),"<\/div>","<\/li>"].join("\n"),getAttr:function(n){return{endCss:n?"bg":"rbg",sourcecode:n?this.template:""}}},_toolbarBtnOptions:{template:"<ul class='tx-bar tx-bar-right'>\n<li class='tx-list'>\n<div id='tx_ecountbutton{{id}}' unselectable='on'>\n<button class='{{buttonCss}}' title='{{label}}'>{{label}}<\/button>\n<\/div>\n<\/li>\n<\/ul>",getAttr:function(n){return{buttonTemplate:n?ecount.widget.replaceAttr(this.template,{label:n.toolbarBtnLabel||"button",buttonCss:n.toolbarBtnCss||"btn btn-default btn-sm"}):""}}}},i;for(var r in t)i=t[r],this.toolbarTemplate=ecount.widget.replaceAttr(this.toolbarTemplate,i.getAttr(n[r]))},onMount:function(n){this.editorMode=n.editorMode;this.id=n.id;this.ecPageID=n.ecPageID;this.rootPath=n.rootPath;this._heightSize=n._heightSize;this.isSimpleImageUpload=n.isSimpleImageUpload;this.isAllowImagePaste=n.isAllowImagePaste;this.isWebMail=n.isWebMail;this.eventContainer=n.eventContainer;this.width=n.width;this.height=n.height;this.ecIKey=n.ecIKey;this.callback=n.callback;this.canvasConfig=n.canvasConfig;this.loadEditor()},setImageFileUpload:function(){},loadEditor:function(){ecount.global.executeCallback(this.ecPageID,ecount.widget.LAZY_INITIALIZER,function(){EditorJSLoader.ready(function(){var n,t;this._EditorInstance=EditorJSLoader.GetEditorCreate();EditorJSLoader.SetEditorPrototype(this._EditorInstance);n=ecount.editor.getEditorConfig(this);n.canvas&&this.canvasConfig&&_.extend(n.canvas,this.canvasConfig);new this._EditorInstance(this._EditorInstance,n);$(this.$el.find("iframe").get(0).contentDocument).on("mousedown",function(){this.$el.trigger("mousedown",{notPreventTriggerEvent:!0})}.bind(this));t=this.eventContainer||$(document);this._scrollTop=t.find(".contents").scrollTop();t.find(".contents").scroll(function(){this._scrollTop==0&&t.find(".contents").scrollTop(0)});this._initFileManager&&this._initFileManager();this.setImageFileUpload()}.bind(this))}.bind(this))},updateValue:function(n){this.editorMode==1?ecount.editor.setContents(this._EditorInstance,n):this.$el.find("[data-textarea]").val(n)},onChangeValue:function(n,t){this.updateValue(t)},setFocusOnTop:function(){ecount.editor.focusOnTop(this._EditorInstance)},setFocusOnBottom:function(){ecount.editor.focusOnBottom.focusOnBottom(this._EditorInstance)},getValue:function(){return this.editorMode==1?ecount.editor.getContents(this._EditorInstance)||"":this.$el.find("[data-textarea]").val()},getViewValue:function(){return this.editorMode==1?ecount.editor.getContents(this._EditorInstance)||"":this.$el.find("[data-textarea]").val()},onChangeNewline:function(n,t){this.newline=t},onChangeWrapStyle:function(n,t){this.wrapStyle=t},onChangeIsSelect:function(n,t){this.isSelect=t},onChangePasteContent:function(n,t){ecount.editor.restoreRange(this._EditorInstance)||ecount.editor.setFocus(this._EditorInstance);ecount.editor.pasteContent(this._EditorInstance,t,this.newline,this.wrapStyle,this.isSelect)},onChangeCursorPosition:function(n,t){if(this.editorMode==1)ecount.editor.setContentsCursor(this._EditorInstance,t);else{var i,t,r,u,f;i=this.$el.find("[data-textarea]")[0];r=i.selectionStart;t=i.value;u=t.substring(0,r);f=t.substring(r);i.value=u+editValue+f}},onChangeEditorMode:function(n,t){t==1?(ecount.editor.setContents(this._EditorInstance,this.$el.find("[data-textarea]").val()),this.$el.find("[data-textarea]").addClass("hidden"),this.$el.find("[data-texteditor]").removeClass("hidden")):t==2&&(this.$el.find("[data-textarea]").val(this.getValue()),this.$el.find("[data-texteditor]").addClass("hidden"),this.$el.find("[data-textarea]").removeClass("hidden"));this.editorMode=t},onChangeFocusIndex:function(n,t){t&&(this.editorMode==1?ecount.editor.setFocus(this._EditorInstance):this.$el.find("[data-textarea]")[0].select())},onChangeSourceCodeId:function(n,t){this.codeID=t},onChangeSourceCodeData:function(n,t){this.codeData=t},onChangeAddSourceCode:function(){var t=ecount.editor.getDocumentBody(this._EditorInstance),n;if(t&&(n=$(t).find("#"+this.codeID)),n&&n.length)n[0].outerHTML=this.codeData;else this.onChangePasteContent(null,this.codeData+($.browser.msie?"<p><\/p>":"<p><br><\/p>"));this.highlightSourceCode()},highlightSourceCode:function(){var n=ecount.editor.getDocumentBody(this._EditorInstance);n&&Prism&&Prism.highlightAllUnder(n)},onChangeDestroy:function(n,t){t===!0&&this.$el.find("input").length>0&&this.$el.find("input").first()[0].focus()},_editorRenderComplete:function(){if(!ecount.isIE&&this._EditorInstance&&this._EditorInstance.canvas){var n=this._EditorInstance.canvas,t=$.isFunction(n.getSizeConfig)?n.getSizeConfig():{},i=n.elContainer;!$.isEmptyObject(t)&&i&&(t.contentWidth=i.offsetWidth)}this.callback&&(this._executeCallback("_editorRenderComplete"),ecount.global.setTimeout(this.ecPageID,function(){this._scrollTop=-1}.bind(this),0))},openImagePopup:function(){this._executeCallback("openImagePopup")},openSourceCodePopup:function(){this._executeCallback("openSourceCodePopup")},dblClicksourceCode:function(n){this._executeCallback("dblClicksourceCode",n)},clickToolbarBtn:function(){this._executeCallback("clickToolbarBtn")},adjustContentsDimensions:function(){this._executeCallback("adjustContentsDimensions")},_executeCallback:function(){if(this.callback){var n=Array.prototype.slice.apply(arguments).slice(0),t=n.shift();$.isFunction(this.callback[t])&&this.callback[t].apply(this,n)}},getConvertCanvas:function(){return this._$canvas||(this._$canvas=$("<canvas/>",{"class":"hidden"}),this.$el.append(this._$canvas)),this._$canvas},setClearConvertCanvas:function(){var n=this.getConvertCanvas()[0],t=n.getContext("2d");t.clearRect(0,0,n.width,n.height);t.beginPath()},setImgToCanvas:function(n){return new Promise(function(t){var r=this.getConvertCanvas()[0],u=r.getContext("2d"),i=new Image;u.clearRect(0,0,r.width,r.height);u.beginPath();i.src=n;i.onload=function(){r.width=i.width;r.height=i.height;u.drawImage(i,0,0,i.width,i.height);t(r)};i.onerror=function(){this.hideProgressbar()}.bind(this)}.bind(this))},setBlobToCanvas:function(n){return new Promise(function(t){var r=this.getConvertCanvas()[0],u=r.getContext("2d"),i=new Image;u.clearRect(0,0,r.width,r.height);u.beginPath();i.src=URL.createObjectURL(n);i.onload=function(){r.width=i.width;r.height=i.height;u.drawImage(i,0,0,i.width,i.height);t(r)};i.onerror=function(){this.hideProgressbar()}.bind(this)}.bind(this))}});ecount.class("ecount.control.view.textEditor.e01","ecount.control.view.textEditor",{storageEndpoint:"/ECAPI/Common/Infra/SaveTempFile",versionCheckApi:"/Groupware/File/CheckFileSize",toolbarTemplate:["<ul class='tx-bar tx-bar-left tx-group-list'>","<li class='tx-list'>","<div unselectable='on' class='tx-slt-31lbg tx-styledlist' id='tx_styledlist{{id}}' style='width: 31px;'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70575),String.format("<a href='javascript:;' class='tx-arrow' title='{0}'>{0}<\/a>",ecount.resource.LBL70575),"<\/div>","<div id='tx_styledlist_menu{{id}}' class='tx-styledlist-menu tx-menu' unselectable='on' style='width: 30px;'><\/div>","<\/li>","<li class='tx-list'>","<div unselectable='on' class='tx-btn-bg tx-table' id='tx_advanced{{id}}'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70578),"<\/div>","<\/li>","<li class='tx-list'>","<div id='tx_ecountimageupload{{id}}' unselectable='on' class='tx-btn-{{endCss}} tx-ecountimageupload'>",String.format("<a href='javascript:;' class='tx-icon2' title='{0}'>{0}<\/a>",ecount.resource.LBL01056),"<\/div>","<div id='tx_ecountimageupload_menu{{id}}' class='tx-ecountimageupload-menu tx-menu tx-ecountimageupload' unselectable='on'><\/div>","<\/li>","{{sourcecode}}","<\/ul>","{{buttonTemplate}}"].join("\n"),onMount:function(n){var t=n.vmHandler;_.merge(this,{initData:n.initData,options:n.options,_callback:t._callback,hasStorageHost:n.hasStorageHost,storageEndpoint:n.storageEndpoint,setPasteContent:t.setPasteContent,showProgressbar:t.showProgressbar,hideProgressbar:t.hideProgressbar});ecount.control.view.textEditor.prototype.onMount.apply(this,arguments)},_initFileManager:function(){this.ecountfileManager||(this.ecountfileManager=new ecount.fileManager({ecPageID:this.ecPageID,initData:$.extend(!0,{},this.initData),handler:{onBeforeUpload:function(){ecmodule.common.fileSecurity.checkFileAllowed.apply(this,arguments)}.bind(this),onComplete:this.onComplete.bind(this),onError:this._onError.bind(this),pageID:this.ecPageID}}))},setImageFileUpload:function(){var n=this,r="",i=null,t=this.initData.uploaderConfig;r=this.isSimpleImageUpload==!0?String.format("#tx_ecountimageupload{0} > a",this.id):"a.tx-ecountimageupload-share, a.tx-ecountimageupload-personal";i=this.$el.find(r);this._isNotEditorImage?i.bind("click",function(){ecount.popup.openWindow({url:"/ECERP/Infra/Forbidden",popupType:!1,additional:!1,popupLevel:Number(n.popupLevel)+1,parentPageID:n.popupID,alreadyIncludedLayout:!0,popupID:"forbidden",param:{ProgramId:"E070313",__ecPageID:n.ecPageID}})}):i.each(function(){var i=$(this).plupload({url:ecount.common.buildSessionUrl(n.storageEndpoint),filters:{max_file_size:"100mb",prevent_duplicates:!1,mime_types:[{title:t.extensions,extensions:t.extensions}]},chunk_size:"0",extensions:t.extensions,dragdrop:!1,prevent_duplicates:!1,multi_selection:!0,max_file_count:10,autostart:!1,noHead:!1,autoHeightBody:!0,tot_size_lmt:{size:"102400000",flag:!1},extensionErrorMsg:!0,isEcountUpload:!0,checkFileAllowed:function(){ecmodule.common.fileSecurity.checkFileAllowed.apply(this,arguments)},byPassCheckFileAllowed:t.byPassCheckFileAllowed});n["uploader_"+this.className]=i.plupload;i.bind("addFiles",function(t,i,r){n.onAddFile(t,i,r)});i.bind("beforeUpload",function(t,i,r){n.onBeforeUpload(i,r)});i.bind("complete",function(t){n.onComplete(t)});i.bind("error",function(t,i,r){n.onError(t,i,r)});i.bind("autostart",function(t,i){n.uploadStart(t,i)})})},onAddFile:function(n,t,i){var r=!1;this.options.uploadSize?(r=this.validate(n,t,i),r&&ecount.global.setTimeout(this.ecPageID,function(){this.uploadStart(n,t)}.bind(this),10)):ecount.common.api({ecPageID:this.ecPageID,url:"/Groupware/File/CheckFileSize",success:function(u){var f={provider_seq:ecount.cloudStorage.INNER,result:u};this.ecountfileManager.setConfigsize(f);this.options.uploadSize=!0;r=this.validate(n,t,i);r&&ecount.global.setTimeout(this.ecPageID,function(){this.uploadStart(n,t)}.bind(this),10)}.bind(this)})},onBeforeUpload:function(){this.$el.find("#file-progres").removeClass("hidden");this.$el.find("#browse_file").attr("disabled",!0)},onComplete:function(){var t=this,n=this["uploader_"+this.imageStorageValue];this._callback?this._callback():(this.MULTI_UPLOAD_FILES=[],n.files.forEach(function(n){this.MULTI_UPLOAD_FILES.add(n)}.bind(this)),this.MultiImageUpload())},onError:function(n,t,i){var r="";switch(i.code){case plupload.COM_STORAGE_SIZE_ERROR:r=i.message;break;case plupload.TOT_SIZE_LMT_ERROR:r=i.message;break;case plupload.FILE_SIZE_ERROR:r=ecount.resource.MSG05582;break;case plupload.FILE_EXTENSION_ERROR:r=String.format(ecount.resource.MSG05733,t.settings.extensions.toUpperCase().replaceAll(",",", "));break;case plupload.TOT_SIZE_LMT_ERROR:r=String.format(ecount.resource.MSG03611,t.settings.filters.max_file_size);break;default:r=i.message||"error"}i.file&&t.removeFile(i.file);ecount.alert(r)},_onError:function(n){var i=n.file,r=n.code,u=n.message,t=this["uploader_"+this.imageStorageValue];t&&t.removeFile(i);t.trigger("Error",{code:r,message:u})},validate:function(n,t,i){var f=!0,r,e,u,o;for(this.imageStorageValue=n.currentTarget.className,r=0,e=i.length;r<e;r++)if(u=i[r],u.provider_seq||(u.provider_seq=ecount.cloudStorage.INNER),o={file:u,isFromTextEditor:!0},f=this.ecountfileManager.validate(o),!f)break;return f},uploadStart:function(){var r,n=[],t,i,u;for(r=this["uploader_"+this.imageStorageValue],t=0,u=r.files.length;t<u;t++)i=r.files[t],i.status!=plupload.DONE&&(i.provider_seq=ecount.cloudStorage.INNER,n.push(i));n&&n.length>0&&this.ecountfileManager.checkStorageQuota(n,function(){this.ecountfileManager.startUpload(n)}.bind(this))},MultiImageUpload:function(){var n={Flag:"I",DtCreateKey:this.options.DtCreateKey,Title:this.MULTI_UPLOAD_FILES[0].name,Type:["share","tx-ecountimageupload-share"].contains(this.imageStorageValue)?"2":"1",FileName:this.MULTI_UPLOAD_FILES[0].name,TargetName:this.MULTI_UPLOAD_FILES[0].target_name,Size:this.MULTI_UPLOAD_FILES[0].size,ownerKey:this.MULTI_UPLOAD_FILES[0].owner_key,usingNewFileStorage:!0,comCode:this.initData.newFileStorageConfig.comcode,temp_file_lifetime:this.initData.newFileStorageConfig.temp_file_lifetime,hasStorageHost:this.hasStorageHost};this.MULTI_UPLOAD_FILES.splice(0,1);ecount.document.setImageUploadInfoSave({ecPageID:this.ecPageID,param:n,callback:function(n,t){var e=String.format('<img src="{0}" />',t.Data),i;if(this.setPasteContent(e),this.MULTI_UPLOAD_FILES&&this.MULTI_UPLOAD_FILES.length>0)this.MultiImageUpload();else{if(this.MULTI_UPLOAD_FILES=null,i=this["uploader_"+this.imageStorageValue],i&&i.files.length)for(var f=i.files,o=f.length,r=null,u=o-1;u>=0;u--)r=f[u],r&&i.removeFile(r);this.imageStorageValue=="paste"&&this.hideProgressbar()}}.bind(this)})},pasteImageContents:function(n,t){n&&(this.showProgressbar(),this.setImgToCanvas(n).then(function(n){n.toBlob(this.pasteImageSave.bind(this),"image/jpeg")}.bind(this)).catch(function(n){this.hideProgressbar();console.log(n);ecount.alert(ecount.resource.MSG09954)}.bind(this)));t&&(this.showProgressbar(),this.setBlobToCanvas(t).then(function(n){n.toBlob(this.pasteImageSave.bind(this),"image/jpeg")}.bind(this)).catch(function(n){this.hideProgressbar();console.log(n);ecount.alert(ecount.resource.MSG09954)}.bind(this)))},pasteImageSave:function(n){var t={},u=Math.random().toString(36).substring(2,11)+".jpeg",r,i;ecount.constValue.isIE?(r=new Date,t=_.merge({},n,{lastModified:r.getTime(),lastModifiedDate:r,name:u,size:n.size,type:"image/jpeg",webkitRelativePath:""})):t=new File([n],u);t.provider_seq||(t.provider_seq=ecount.cloudStorage.INNER);t.getNative=function(){return n};i=[t];this.imageStorageValue="paste";this.uploader_paste={files:i,removeFile:function(){this.files=[]}};this.ecountfileManager.checkStorageQuota(i,function(){ecmodule.common.fileSecurity.checkFileAllowed("upload",i[0].name,0,function(n){n?this.ecountfileManager.startUpload(i):this.hideProgressbar()}.bind(this),this.ecPageID)}.bind(this))}});ecount.class("ecount.control.view.textEditor.e02","ecount.control.view.textEditor",{toolbarTemplate:["<ul class='tx-bar tx-bar-left tx-group-tab'>","<li class='tx-list'>","<div unselectable='on' class='tx-btn-lbg tx-indent' id='tx_indent{{id}}'>",String.format("<a href='javascript:;' title='{0}' class='tx-icon'>{0}<\/a>",ecount.resource.LBL70572),"<\/div>","<\/li>","<li class='tx-list'>","<div unselectable='on' class='tx-btn-rbg tx-outdent' id='tx_outdent{{id}}'>",String.format("<a href='javascript:;' title='{0}' class='tx-icon'>{0}<\/a>",ecount.resource.LBL70573),"<\/div>","<\/li>","<\/ul>","<ul class='tx-bar tx-bar-left tx-group-list'>","<li class='tx-list'>","<div unselectable='on' class='tx-slt-31lbg tx-lineheight' id='tx_lineheight{{id}}'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70574),String.format("<a href='javascript:;' class='tx-arrow' title='{0}'>{1}<\/a>",ecount.resource.LBL70574,ecount.resource.LBL70686),"<\/div>","<div id='tx_lineheight_menu{{id}}' class='tx-lineheight-menu tx-menu' unselectable='on'><\/div>","<\/li>","<li class='tx-list'>","<div unselectable='on' class='tx-slt-31rbg tx-styledlist' id='tx_styledlist{{id}}' style='width: 31px;'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70575),String.format("<a href='javascript:;' class='tx-arrow' title='{0}'>{0}<\/a>",ecount.resource.LBL70575),"<\/div>","<div id='tx_styledlist_menu{{id}}' class='tx-styledlist-menu tx-menu' unselectable='on' style='width: 30px;'><\/div>","<\/li>","<\/ul>","<ul class='tx-bar tx-bar-left tx-group-list'>","<li class='tx-list'>","<div unselectable='on' class='tx-btn-lbg tx-table' id='tx_advanced{{id}}'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70578),"<\/div>","<\/li>","<li class='tx-list'>","<div id='tx_ecountimageupload{{id}}' unselectable='on' class='tx-btn-bg tx-ecountimageupload'>",String.format("<a href='javascript:;' class='tx-icon2' title='{0}'>{0}<\/a>",ecount.resource.LBL01056),"<\/div>","<div id='tx_ecountimageupload_menu{{id}}' class='tx-ecountimageupload-menu tx-menu tx-ecountimageupload' unselectable='on'><\/div>","<\/li>","{{sourcecode}}","<li class='tx-list'>","<div unselectable='on' class='tx-btn-bg tx-link' id='tx_link{{id}}'>",String.format("<a href='javascript:;' class='tx-icon' title='{0} (Ctrl+K)'>{0}<\/a>",ecount.resource.LBL70576),"<\/div>","<div id='tx_link_menu{{id}}' class='tx-link-menu tx-menu'><\/div>","<\/li>","<li class='tx-list'>","<div unselectable='on' class='tx-btn-bg tx-specialchar' id='tx_specialchar{{id}}'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70577),"<\/div>","<div id='tx_specialchar_menu{{id}}' class='tx-specialchar-menu tx-menu'><\/div>","<\/li>","<li class='tx-list'>","<div unselectable='on' class='tx-btn-bg tx-richtextbox' id='tx_richtextbox{{id}}'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70580),"<\/div>","<div id='tx_richtextbox_menu{{id}}' class='tx-richtextbox-menu tx-menu'>","<div class='tx-menu-header'>","<div class='tx-menu-preview-area'>","<div class='tx-menu-preview'><\/div>","<\/div>","<div class='tx-menu-switch'>",String.format("<div class='tx-menu-simple tx-selected'><a><span>{0}<\/span><\/a><\/div>",ecount.resource.LBL70581),String.format("<div class='tx-menu-advanced'><a><span>{0}<\/span><\/a><\/div>",ecount.resource.LBL70581),"<\/div>","<\/div>","<div class='tx-menu-inner'>","<\/div>","<div class='tx-menu-footer'>","<img class='tx-menu-confirm' src='{{basePath}}images/editor/icon/editor/btn_confirm.gif' alt=''/>","<img class='tx-menu-cancel' hspace='3' src='{{basePath}}images/editor/icon/editor/btn_cancel.gif' alt=''/>","<\/div>","<\/div>","<\/li>","<li class='tx-list'>","<div unselectable='on' class='tx-btn-rbg tx-horizontalrule' id='tx_horizontalrule{{id}}'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70579),"<\/div>","<div id='tx_horizontalrule_menu{{id}}' class='tx-horizontalrule-menu tx-menu' unselectable='on'><\/div>","<\/li>","<\/ul>"].join("\n"),onMount:function(n){var t=n.vmHandler;ecount.control.view.textEditor.prototype.onMount.apply(this,arguments);_.merge(this,{storageEndpoint:n.storageEndpoint,setPasteContent:t.setPasteContent,showProgressbar:t.showProgressbar,hideProgressbar:t.hideProgressbar})},setImageFileUpload:function(){var t=this,n=this.$el.find(String.format("#tx_ecountimageupload{0} > a",this.id)).plupload({url:String.format("{0}/WebMail/UploadTemp/",this.storageEndpoint||""),filters:{max_file_size:"5mb",mime_types:[{title:"Image files",extensions:"jpg,jpeg,gif,png,bmp"}],prevent_duplicates:!1},max_file_count:20,autostart:!0});n.bind("uploaded",function(n,i,r){t.handleFileUploaded(n,i,r)});n.bind("error",function(n,i,r){t.handleError(n,i,r)});this._uploader=n},handleFileUploaded:function(n,t,i){var r=i.name,u=r.replace(new RegExp(".+(?=.(jpg|jpeg|gif|png|bmp)$)","gi"),"image"),f=String.format("{0}/WebMail/DownloadTemp/{1}/{2}",this.storageEndpoint||"",encodeURIComponent(i.id),encodeURIComponent(u)),e='<p><img src="'+f+'"/><\/p>';this.setPasteContent(e,!0);this.hideProgressbar()},handleError:function(n,t,i){var r=this,u;this.hideProgressbar();switch(i.code){case plupload.FILE_EXTENSION_ERROR:details=String.format(ecount.resource.MSG05733,t.settings.filters.mime_types[0].extensions.toUpperCase().replaceAll(",",", "));break;case plupload.FILE_SIZE_ERROR:details=String.format(ecount.resource.MSG07499,i.file.name,i.file.size,plupload.parseSize(t.settings.filters.max_file_size));break;case plupload.FILE_DUPLICATE_ERROR:details=String.format(ecount.resource.MSG07500,i.file.name);break;case plupload.FILE_COUNT_ERROR:details=String.format(ecount.resource.MSG04180,t.settings.max_file_count);break;case plupload.IMAGE_FORMAT_ERROR:details=ecount.resource.MSG07502;break;case plupload.IMAGE_MEMORY_ERROR:details=ecount.resource.MSG07503;details+="\nFILE: textEditor.new";details+="\nERROR_CODE: "+i.code;details+="\nERROR_MSG: "+i.message;break;case plupload.HTTP_ERROR:i.file.status=plupload.QUEUED;details=ecount.resource.MSG07504+"<br/>"+i.file.name}r.onErrorMsg||(r.onErrorMsg=!0,u="<strong>"+i.message+"<\/strong><br/>"+details,ecount.alert(unescape(u),function(){r.onErrorMsg=!1}))},pasteImageContents:function(n,t){n&&(this.showProgressbar(),this.setImgToCanvas(n).then(function(n){n.toBlob(function(n){var t=new File([n],Math.random().toString(36).substring(2,11)+".jpeg");this._uploader.plupload.addFile(t,t.name)}.bind(this),"image/jpeg")}.bind(this)).catch(function(n){this.hideProgressbar();console.log(n);ecount.alert(ecount.resource.MSG09954)}.bind(this)));t&&(this.showProgressbar(),this.setBlobToCanvas(t).then(function(n){n.toBlob(function(n){var t=new File([n],Math.random().toString(36).substring(2,11)+".jpeg");this._uploader.plupload.addFile(t,t.name)}.bind(this),"image/jpeg")}.bind(this)).catch(function(n){this.hideProgressbar();console.log(n);ecount.alert(ecount.resource.MSG09954)}.bind(this)))}});ecount.class("ecount.control.view.textEditor.e03","ecount.control.view.textEditor",{toolbarTemplate:["<ul class='tx-bar tx-bar-left tx-group-tab'>","<li class='tx-list'>","<div unselectable='on' class='tx-btn-lbg tx-indent' id='tx_indent{{id}}'>",String.format("<a href='javascript:;' title='{0}' class='tx-icon'>{0}<\/a>",ecount.resource.LBL70572),"<\/div>","<\/li>","<li class='tx-list'>","<div unselectable='on' class='tx-btn-rbg tx-outdent' id='tx_outdent{{id}}'>",String.format("<a href='javascript:;' title='{0}' class='tx-icon'>{0}<\/a>",ecount.resource.LBL70573),"<\/div>","<\/li>","<\/ul>","<ul class='tx-bar tx-bar-left tx-group-list'>","<li class='tx-list'>","<div unselectable='on' class='tx-slt-31lbg tx-lineheight' id='tx_lineheight{{id}}'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70574),String.format("<a href='javascript:;' class='tx-arrow' title='{0}'>{1}<\/a>",ecount.resource.LBL70574,ecount.resource.LBL70686),"<\/div>","<div id='tx_lineheight_menu{{id}}' class='tx-lineheight-menu tx-menu' unselectable='on'><\/div>","<\/li>","<li class='tx-list'>","<div unselectable='on' class='tx-slt-31rbg tx-styledlist' id='tx_styledlist{{id}}' style='width: 31px;'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70575),String.format("<a href='javascript:;' class='tx-arrow' title='{0}'>{0}<\/a>",ecount.resource.LBL70575),"<\/div>","<div id='tx_styledlist_menu{{id}}' class='tx-styledlist-menu tx-menu' unselectable='on' style='width: 30px;'><\/div>","<\/li>","<\/ul>","<ul class='tx-bar tx-bar-left tx-group-list'>","<li class='tx-list'>","<div unselectable='on' class='tx-btn-lbg tx-table' id='tx_advanced{{id}}'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70578),"<\/div>","<\/li>","<li class='tx-list'>","<div id='tx_ecountimageupload{{id}}' unselectable='on' class='tx-btn-bg tx-ecountimageupload'>",String.format("<a href='javascript:;' class='tx-icon2' title='{0}'>{0}<\/a>",ecount.resource.LBL01056),"<\/div>","<div id='tx_ecountimageupload_menu{{id}}' class='tx-ecountimageupload-menu tx-menu tx-ecountimageupload' unselectable='on'><\/div>","<\/li>","{{sourcecode}}","<li class='tx-list'>","<div unselectable='on' class='tx-btn-bg tx-link' id='tx_link{{id}}'>",String.format("<a href='javascript:;' class='tx-icon' title='{0} (Ctrl+K)'>{0}<\/a>",ecount.resource.LBL70576),"<\/div>","<div id='tx_link_menu{{id}}' class='tx-link-menu tx-menu'><\/div>","<\/li>","<li class='tx-list'>","<div unselectable='on' class='tx-btn-bg tx-specialchar' id='tx_specialchar{{id}}'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70577),"<\/div>","<div id='tx_specialchar_menu{{id}}' class='tx-specialchar-menu tx-menu'><\/div>","<\/li>","<li class='tx-list'>","<div unselectable='on' class='tx-btn-bg tx-richtextbox' id='tx_richtextbox{{id}}'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70580),"<\/div>","<div id='tx_richtextbox_menu{{id}}' class='tx-richtextbox-menu tx-menu'>","<div class='tx-menu-header'>","<div class='tx-menu-preview-area'>","<div class='tx-menu-preview'><\/div>","<\/div>","<div class='tx-menu-switch'>",String.format("<div class='tx-menu-simple tx-selected'><a><span>{0}<\/span><\/a><\/div>",ecount.resource.LBL70581),String.format("<div class='tx-menu-advanced'><a><span>{0}<\/span><\/a><\/div>",ecount.resource.LBL70581),"<\/div>","<\/div>","<div class='tx-menu-inner'>","<\/div>","<div class='tx-menu-footer'>","<img class='tx-menu-confirm' src='{{basePath}}images/editor/icon/editor/btn_confirm.gif' alt=''/>","<img class='tx-menu-cancel' hspace='3' src='{{basePath}}images/editor/icon/editor/btn_cancel.gif' alt=''/>","<\/div>","<\/div>","<\/li>","<li class='tx-list'>","<div unselectable='on' class='tx-btn-rbg tx-horizontalrule' id='tx_horizontalrule{{id}}'>",String.format("<a href='javascript:;' class='tx-icon' title='{0}'>{0}<\/a>",ecount.resource.LBL70579),"<\/div>","<div id='tx_horizontalrule_menu{{id}}' class='tx-horizontalrule-menu tx-menu' unselectable='on'><\/div>","<\/li>","<\/ul>"].join("\n"),onMount:function(n){var t=n.vmHandler;ecount.control.view.textEditor.prototype.onMount.apply(this,arguments);_.merge(this,{initData:n.initData,options:n.options,storageEndpoint:n.storageEndpoint,setPasteContent:t.setPasteContent,showProgressbar:t.showProgressbar,hideProgressbar:t.hideProgressbar})},setImageFileUpload:function(){var t=this,n=this.$el.find(String.format("#tx_ecountimageupload{0} > a",this.id)).plupload({filters:{max_file_size:"5mb",mime_types:[{title:"Image files",extensions:"jpg,jpeg,gif,png,bmp"}],prevent_duplicates:!1},max_file_count:20,autostart:!1});t.uploader=n.plupload;n.bind("error",function(n,i,r){t.handleError(n,i,r)});n.bind("addFiles",function(n,i,r){t.onAddFile(n,i,r)});n.bind("beforeUpload",function(n,i,r){t.onBeforeUpload(i,r)});n.bind("complete",function(n){t.onComplete(n)});n.bind("autostart",function(n,i){t.uploadStart(n,i)});this._uploader=n},handleFileUploaded:function(n,t,i){for(var r=0;r<i.length;r++)if(!i[r].IsAttached){var u=i[r].name,o=u.replace(new RegExp(".+(?=.(jpg|jpeg|gif|png|bmp)$)","gi"),"image"),f=i[r].webmailEmbededSrc,e='<p><img src="'+f+'"/><\/p>';this.setPasteContent(e,!0);i[r].IsAttached=!0;this.hideProgressbar()}},handleError:function(n,t,i){var r=this,u;this.hideProgressbar();switch(i.code){case plupload.FILE_EXTENSION_ERROR:details=String.format(ecount.resource.MSG05733,t.settings.filters.mime_types[0].extensions.toUpperCase().replaceAll(",",", "));break;case plupload.FILE_SIZE_ERROR:details=String.format(ecount.resource.MSG07499,i.file.name,i.file.size,plupload.parseSize(t.settings.filters.max_file_size));break;case plupload.FILE_DUPLICATE_ERROR:details=String.format(ecount.resource.MSG07500,i.file.name);break;case plupload.FILE_COUNT_ERROR:details=String.format(ecount.resource.MSG04180,t.settings.max_file_count);break;case plupload.IMAGE_FORMAT_ERROR:details=ecount.resource.MSG07502;break;case plupload.IMAGE_MEMORY_ERROR:details=ecount.resource.MSG07503;details+="\nFILE: textEditor.new";details+="\nERROR_CODE: "+i.code;details+="\nERROR_MSG: "+i.message;break;case plupload.HTTP_ERROR:i.file.status=plupload.QUEUED;details=ecount.resource.MSG07504+"<br/>"+i.file.name}r.onErrorMsg||(r.onErrorMsg=!0,u="<strong>"+i.message+"<\/strong><br/>"+details,ecount.alert(unescape(u),function(){r.onErrorMsg=!1}))},pasteImageContents:function(n,t){n&&(this.showProgressbar(),this.setImgToCanvas(n).then(function(n){n.toBlob(function(n){var t=new File([n],Math.random().toString(36).substring(2,11)+".jpeg");this._uploader.plupload.addFile(t,t.name)}.bind(this),"image/jpeg")}.bind(this)).catch(function(n){this.hideProgressbar();console.log(n);ecount.alert(ecount.resource.MSG09954)}.bind(this)));t&&(this.showProgressbar(),this.setBlobToCanvas(t).then(function(n){n.toBlob(function(n){var t=new File([n],Math.random().toString(36).substring(2,11)+".jpeg");this._uploader.plupload.addFile(t,t.name)}.bind(this),"image/jpeg")}.bind(this)).catch(function(n){this.hideProgressbar();console.log(n);ecount.alert(ecount.resource.MSG09954)}.bind(this)))},uploadStart:function(n){var u,t=[],i,r,f;for(this.imageStorageValue=n.currentTarget.className,u=this.uploader,i=0,f=u.files.length;i<f;i++)r=u.files[i],r.status!=plupload.DONE&&(r.provider_seq=ecount.cloudStorage.INNER,t.push(r));t&&t.length>0&&this.ecountfileManager.startUpload(t)},onAddFile:function(n,t,i){var r=!1;this.options&&this.options.uploadSize?(r=this.validate(n,t,i),r&&ecount.global.setTimeout(this.ecPageID,function(){this.uploadStart(n,t)}.bind(this),10)):this.uploadStart(n,t)},_initFileManager:function(){this.ecountfileManager||(this.ecountfileManager=new ecount.fileManager({ecPageID:this.ecPageID,initData:$.extend(!0,{},this.initData),handler:{onComplete:this.onComplete.bind(this),onError:this._onError.bind(this),pageID:this.ecPageID},isWebMailEditor:!0}))},_onError:function(n){var i=n.file,r=n.code,u=n.message,t=this.uploader;t&&t.removeFile(i);t.trigger("Error",{code:r,message:u})},onComplete:function(n){var t=this,i=this.uploader;this._callback?this._callback():t.handleFileUploaded(n,null,i.files)}});ecount.class("ecount.control.textEditor","ecount.control",{ecPackage:"ecount.control.textEditor",templateFn:"",baseType:!0,errorContainer:"left",useHTML:!0,callbackID:null,_isRight:!1,rootPath:"/ecerp",parentStyle:"style='z-index:2'",isWholeRow:!0,hasStorageHost:!1,init:function(){ecount.control.prototype.init.apply(this,arguments);this.callbackID=ecount.global.registerCallback(this.ecPageID,this.onMessage,this)},initializeOptions:function(n,t){var i=t&&t.result&&t.result.Data?t.result:null;$.extend(this,{editorMode:n.editorMode==undefined?1:n.editorMode,_isUseHtmlFormate:n._isUseHtmlFormate,maxRows:n.maxRows,minRowSize:n.minRowSize,maxBytes:n.maxBytes,bytesTemplate:n.bytesTemplate,hasStorageHost:n.hasStorageHost,_toolbarBtnOptions:n._toolbarBtnOptions,rootPath:n.rootPath||this.rootPath,canvasConfig:n.canvasConfig,_isChanged:!1,__defaultValue:""});i&&this.setUploadConfig(i)},setUploadConfig:function(){},initializeViewOptions:function(n){$.extend(this.__viewOptions,{ecPageID:this.ecPageID,rootPath:this.rootPath,_heightSize:this._heightSize,isSimpleImageUpload:this.isSimpleImageUpload,isAllowImagePaste:_.isBoolean(n.isAllowImagePaste)?n.isAllowImagePaste:this.isAllowImagePaste,isWebMail:!!n.isWebMail,isShowSourceCodeIcon:ecount&&ecount.config&&ecount.config.company&&ecount.config.company.COM_CODE=="80000"&&$.browser.chrome?!0:!1,width:this.width,height:this.height,_rows:n._rows||30,isWholeRow:this.isWholeRow,hasStorageHost:this.hasStorageHost,_toolbarBtnOptions:this._toolbarBtnOptions,callback:{_editorRenderComplete:this._editorRenderComplete.bind(this),openImagePopup:this.openImagePopup.bind(this),adjustContentsDimensions:this.adjustContentsDimensions.bind(this),ON_INPUT:this._changeValueFromInputEvent.bind(this),openSourceCodePopup:this.openSourceCodePopup.bind(this),dblClicksourceCode:this.dblClicksourceCode.bind(this),clickToolbarBtn:this._onclickToolbarBtn.bind(this),isChanged:this.isChanged.bind(this)}})},onInitState:function(n,t){$.extend(t,{editorMode:this.editorMode,newline:"",wrapStyle:"",isSelect:"",pasteContent:"",cursorPosition:"",addSourceCode:!1,sourceCodeId:"",sourceCodeData:"",destroy:!1,canvasConfig:this.canvasConfig})},onInitComponent:function(n,t,i,r){if(ecount.control.prototype.onInitComponent.apply(this,arguments),r.textvalue=this._isUseHtmlFormate?(r.value||"").toString().replace(/<br>/g,"\r\n").replace(/<br>/g,"\n"):r.value||"",r.value=r.value||"",this.flexible){var u=r.textvalue.split("\r\n").length;r.rows=u==1?this.minRowSize:Math.min(u,this.maxRows)}else r.rows=this.rowSize?this.rowSize:this.maxRows;r.maxBytes=r.maxBytes||this.maxBytes;r.bytesTemplate=r.bytesTemplate||this.bytesTemplate||""},render:function(){ecount.control.prototype.render.apply(this,arguments)},isChanged:function(n){return _.isBoolean(n)?this._isChanged=n:this._isChanged===!1&&(this._isChanged=this.__defaultValue!=this.getValue(!0)),this._isChanged},_ON_BEFORE_INPUT:function(){return!this.___editorRenderComplete,!1},ON_INPUT:function(){},_changeValueFromInputEvent:function(){},addAttributeToImageTag:function(n){var t=document.createElement("div"),i;return t.innerHTML=n,i=t.querySelectorAll("img"),i.length>0&&i.forEach(function(n){n.setAttribute("data-isoriginalimage","true")}),t.innerHTML},_editorRenderComplete:function(){var n,i,u;if(this.___editorRenderComplate=!0,n=this.getState(0,"value"),i=this.getState(this._IT_SELF,"editorMode"),i==1){if(n==""||n==undefined){this.setValue(0,"<p><\/p>",!0);this.__defaultValue=this.getValue(!0);this.isChanged(!1);return}if(n.length>0){var r="(div|p|span|table|h1|h2|h3|h4|h5|h6)",f=new RegExp("^(\\s*)<"+r+"+?","i"),t=f.test(n);t&&(u=new RegExp("((<\/"+r+">)(\\s)*)$","i"),t=!!u.test(n));t||(n="<p>"+n+"<\/p>")}}n=this.addAttributeToImageTag(n);this.setValue(0,n,!0);this.__defaultValue=this.getValue(!0);this.isChanged(!1)},setValue:function(n,t,i){arguments.length==1&&(t=n,n=0);t!=this.getValue(this)&&this.isChanged(!0);$.isEmpty(i)&&(i=!0);t=ecount.common.getNoScriptByHtml(t);t=ecount.common.getRemoveTagAndContent(t,["noframes","noscript","noembed"]);var r=this.getState(this._IT_SELF,"editorMode");r==1&&(t=t.replace(/(<br>)*$/g,function(n,i){var r=n;return t.substr(i-3||0,11)!="<p><br><\/p>"&&(r=""),r}),t+=$tx.msie?t==""?"<p><\/p>":"<p><br><\/p>":"<p><br><\/p>");this.setState(0,"value",t,i)},getOriginValue:function(){return this.getState(0,"value")},getValue:function(){var n;try{n=this.ecview.getViewValue()}catch(t){n=this.getOriginValue()}return n=this.editorMode==1?n.replace(/\s+$/,"").replace(/(<p><br><\/p>)$/,""):n,n=ecount.common.getNoScriptByHtml(n),n=ecount.common.getRemoveTagAndContent(n,["noframes","noscript","noembed","meta","iframe","script"]),n=n.replace(/((https?)?:?)?(\/\/)?[a-z]?efs[a-z]?\.ecount.+(?=\/ViewImage)/gmi,this.hasStorageHost?window.location.origin+"/ECFile":"/ECFile")},getGridSelectedLabel:function(){var n=this.getValue();return n.replace(/(<([^>]+)>)/ig,"")},setValueCursorPosition:function(n){this.setState(this._IT_SELF,"cursorPosition",n);this.setState(0,"value",this.getOriginValue())},setPasteContent:function(n,t,i,r){this.setState(this._IT_SELF,"newline",t);this.setState(this._IT_SELF,"wrapStyle",i);this.setState(this._IT_SELF,"isSelect",r);this.setState(this._IT_SELF,"pasteContent",n,!0);this.ecview?this.setState(0,"value",this.ecview.getViewValue(),!1):this.setState(0,"value",this.getOriginValue())},changeMode:function(n){this.setState(this._IT_SELF,"editorMode",n)},ON_FOCUSIN:function(){return!1},onNextFocus:function(){this.setFocusOutTrigger()},setFocus:function(n){this.setFocusOnComponent(n||0,!0)},openImagePopup:function(){this.openPopup({url:this._imagePopupPath,hasStorageHost:this.hasStorageHost,width:775,height:600})},openSourceCodePopup:function(n){this.openPopup($.extend({},{url:"/ECERP/ESK/ESK004P_99",width:830,height:600,additional:!1,contents:""},n||{}))},openPopup:function(n){var t=$.extend({},this.defaultParam,{width:this.width,height:this.height,name:(this.popupType===!0?this.id:this.subTitle)||"",url:this._imagePopupPath,popupType:!1,responseID:this.callbackID},n||{});this.delegator&&this.delegator.triggerEvent("control.openPopup",{targetID:this.id,control:this,parameter:$.extend({},t),handler:function(n,t,i,r){var e,u,f;this.responseID=t;n.popupLevel=r;n.parentPageID=i||this.parentPageID;n.__ecPageID=this.ecPageID;n.AFlag="4";n.PageType="Apply";n.MaxCheckCount=100;n.CheckedCount=0;n.isViewApplyButton=!0;n.EditorMode="Y";n.isViewSizeSelectButton=!0;e=n.modal||this._modal;u=n.additional;delete n.modal;delete n.additional;f={url:n.url,name:n.name||"",param:n,popupType:n.popupType,popupID:this.id,modal:n.modal||this._modal,control:{ctype:this.controlType,name:this.subTitle,id:this.id},popupLevel:r,parentPageID:n.parentPageID,alreadyIncludedLayout:!n.popupType,additional:u};ecount.popup.openWindow(f)}.bind(this)})},show:function(){this.setValue(this.getValue());ecount.control.prototype.show.apply(this,arguments)},hide:function(){ecount.control.prototype.hide.apply(this,arguments)},onMessage:function(n,t){switch(n.pageID){case"ENT007M":t&&t.imagePath&&this.setPasteContent(t.imagePath);break;case"ESK004P_99":this.addSourceCodeInEditor(t.id,t.data)}t.callback&&t.callback()},addSourceCodeInEditor:function(n,t){this.setState(this._IT_SELF,"sourceCodeId",n);this.setState(this._IT_SELF,"sourceCodeData",t);this.setState(this._IT_SELF,"addSourceCode",!this.getState(this._IT_SELF,"addSourceCode"))},dblClicksourceCode:function(n){var t,i;if(n&&n.target&&(t=$(n.target),i=function(n){return["body","BODY","document","DOCUMENT","html","HTML"].contains(n[0].nodeName)},i(t)!==!0)){for(;;){if(t&&t.length&&t[0].nodeName=="PRE")break;else t=t.parent();if(i(t)===!0){t=null;break}}if(t&&t.length){var r=t.attr("id"),u=t.text(),f=t.attr("language");this.openSourceCodePopup({Id:r,Language:f,contents:u})}}},serialize:function(n){return ecount.control.prototype.serialize.apply(this,[{key:n||this.name,value:this.getValue()},n])},serializeById:function(){return this.serialize(this.id)},save:function(){return{key:this.id,value:this.getValue()}},restore:function(n){this.setValue(n.value)},validate:function(){return[]},showError:function(){ecount.control.prototype.showError.apply(this,arguments)},hideError:function(){ecount.control.prototype.hideError.apply(this,arguments)},reset:function(){this.setValue("")},destroy:function(){this.setState(this._IT_SELF,"destroy",!0);ecount.control.prototype.destroy.apply(this,arguments)},adjustContentsDimensions:function(){this.delegator&&this.delegator.triggerEvent("page.adjustContentsDimensions")},_onclickToolbarBtn:function(){this._toolbarBtnOptions&&$.isFunction(this._toolbarBtnOptions.toolbarBtnClickCallBack)&&this._toolbarBtnOptions.toolbarBtnClickCallBack()}});ecount.class("ecount.control.scorebox","ecount.control",{ecPackage:"ecount.control.scorebox",_defaultCss:"score-box",_classAdditionTarget:[],init:function(){ecount.control.prototype.init.apply(this,arguments)},render:function(){ecount.control.prototype.render.apply(this,arguments)},onInitState:function(n,t,i){t.useActiveMode=i._useActiveMode===!0?!0:!1;this.setClassAdditionTarget()},setClassAdditionTarget:function(){var n,i,t,r;for(n=this.getGroupComponents().map(function(n){return n.groupId}),n=n.distinct(),r=0;r<n.length;r++)i=this.getComponentsByAttr("groupId",n[r]),t=i.filter(function(n){return $.isEmpty(n.hide)}),t.length&&!t.contains(i[i.length-1])&&this._classAdditionTarget.push(t[t.length-1])},onInitComponent:function(n,t,i,r){r["style.display"]=!r.hide;var u=this._defaultCss+($.isEmpty(r.css)||r.active===!0&&i.useActiveMode?"":" "+r.css);r["style.css"]=u+(r.active===!0&&i.useActiveMode?" active":"");r.active=r.active===!0?!0:!1;r.groupActive=r.groupActive===!0?!0:!1;this._classAdditionTarget.length&&$.each(this._classAdditionTarget,function(n,t){t.id.indexOf(r.id)>-1&&(r["style.css"]=ecount.convertor.uniqSumClass(r["style.css"],"last-child"))})},setValue:function(n,t){var i=this.getComponents().head(function(t){return t.id==n});i&&this.setState(i.index,"value",t)},hide:function(n){this._setHideAndShow(n,!1)},show:function(n){this._setHideAndShow(n,!0)},_setHideAndShow:function(n,t){for(var s=this.getComponents(),r=null,h=s.length,i,o,f,e,u=0;u<h;u++)r=s[u],i=n?n:u,$.isEmpty(i)||$.isArray(i)||(i=[i]),(i.contains(r.id)||i.contains(r.index))&&(this.setState(r.index,"style.display",t),o=this.getState(r.index,"groupId"));o&&(f=this.getShowCompsByGroup(o),e=f[f.length-1],t?(this.removeLastChildClassInGroup(f),h-1!==e.index&&this.toggleLastChildClass(e,!0)):this._isComponentWithoutLastChildClass(f)&&this.toggleLastChildClass(e,!0))},toggleLastChildClass:function(n,t){n=!$.isEmpty(n)&&!$.isEmpty(n)&&!$.isArray(n)?[n]:n;$.each(n,function(n,i){var r=t?ecount.convertor.uniqSumClass(i["style.css"],"last-child"):ecount.convertor.removeClass(i["style.css"],"last-child");this.setState(i.index,"style.css",r)}.bind(this))},_isComponentWithoutLastChildClass:function(n){return n.length?n[n.length-1]["style.css"].indexOf("last-child")==-1:!1},getShowCompsByGroup:function(n){var t=this.getComponentsByAttr("groupId",n);return t.filter(function(n){return n["style.display"]===!0})},_removeLastChildClassInComponents:function(n){n.length&&$.each(n,function(n,t){var i=ecount.convertor.removeClass(t["style.css"],"last-child");this.setState(t.index,"style.css",i)}.bind(this))},_getHasLastChildClassInGroup:function(n){return n.filter(function(n){return n["style.css"].indexOf("last-child")>-1})},removeLastChildClassInGroup:function(n){var t=this._getHasLastChildClassInGroup(n);this._removeLastChildClassInComponents(t)},getGroupComponents:function(n){var t=n?this.getComponentsByAttr("groupId",n):this.getComponents();return t.filter(function(n){return n.groupId})},ON_CLICK:function(n){var r=this.getState(this._IT_SELF,"useActiveMode"),i,t,u;r&&(i=n.cindex,t=$.isNumber(i)?this.getComponent(i).id:n.id.split("-")[1],$.isString(t)&&(u={id:t,__self:this},this.removeActive(),this.setActive(t)))},_getUserHandlerParam:function(n,t){var i=n.cindex,r=$.isNumber(i)?this.getComponent(i).id:n.id,u={id:r,__self:this};return _.merge(t,u),t},toggleActive:function(n){var e=this.getComponents(),t=null,u=!0,r,f,i;for($.isEmpty(n)||$.isArray(n)||(n=[n]),r=0;r<e.length;r++)t=e[r],n?n.contains(t.id)||n.contains(t.index)?this.isActive(t.index)?(this.setState(t.index,"active",!1),f=this.getState(t.index,"css"),this.setState(t.index,"style.css",this._defaultCss+(f?" "+f:""))):(this.setState(t.index,"active",!0),this.setState(t.index,"style.css",this._defaultCss+" active")):u&&n.contains(t.groupId)&&(this.isActive(t.groupId)?(this.setState(t.index,"groupActive",!1),i=this.ecview.getGroupEl.call(this,t.index),i&&i.removeClass("active"),u=!1):(this.setState(t.index,"groupActive",!0),i=this.ecview.getGroupEl.call(this,t.index),i&&i.addClass("active"),u=!1)):this.isActive(t.index)?(this.setState(t.index,"active",!1),this.setState(t.index,"style.css",this._defaultCss)):(this.setState(t.index,"active",!0),this.setState(t.index,"style.css",this._defaultCss+" active"))},setActive:function(n){var u=this.getComponents(),t=null,i,r;for($.isEmpty(n)||$.isArray(n)||(n=[n]),i=0;i<u.length;i++)t=u[i],n?n.contains(t.id)||n.contains(t.index)?(this.setState(t.index,"active",!0),this.setState(t.index,"style.css",this._defaultCss+" active")):n.contains(t.groupId)&&(this.setState(t.index,"groupActive",!0),r=this.ecview.getGroupEl.call(this,t.index),r&&r.addClass("active")):(this.setState(t.index,"active",!0),this.setState(t.index,"style.css",this._defaultCss+" active"))},removeActive:function(n){var f=this.getComponents(),t=null,u,i,r;for($.isEmpty(n)||$.isArray(n)||(n=[n]),u=0;u<f.length;u++)t=f[u],n?n.contains(t.id)||n.contains(t.index)?(this.setState(t.index,"active",!1),i=this.getState(t.index,"css"),this.setState(t.index,"style.css",this._defaultCss+(i?" "+i:""))):n.contains(t.groupId)&&(this.setState(t.index,"groupActive",!1),r=this.ecview.getGroupEl.call(this,t.index),r&&r.removeClass("active")):(this.setState(t.index,"active",!1),i=this.getState(t.index,"css"),this.setState(t.index,"style.css",this._defaultCss+(i?" "+i:"")),this.setState(t.index,"groupActive",!1),r=this.ecview.getGroupEl.call(this,t.index),r&&r.removeClass("active"))},isActive:function(n){var u=this.getComponents(),t=null,i=!1,r;return $.isEmpty(n)||(t=u.filter(function(t){return t.id===n||t.index===n}),t.length>0?i=this.getState(t[0].index,"active"):(t=u.filter(function(t){return t.groupId===n}),t.length>0&&(r=this.ecview.getGroupEl.call(this,t[0].index),r&&(i=r.hasClass("active"))))),i},getActiveComponent:function(){return this.getComponents().filter(function(n){return n.active===!0||n.groupActive===!0})}});ecount.class("ecount.control.view.scorebox","ecount.control.view",{baseTemplateType:!0,template:"((scorebox))",templateGroup:'<div class="score-box-group {{style.display}} {{groupActive}}"><div class="score-box-group-title" id={{id}} data-role={{role}}>{{groupTitle}}<\/div>{{template}}<\/div>',wrapperTemplate:'<div class="wrapper-score-box {{style.display}}" data-ecpath="{{ecPath}}" data-cid="{{cid}}">((this.template))<\/div>',wrapperToolbar:"<div class='wrapper-toolbar'>{0}<\/div>",init:function(){ecount.control.view.prototype.init.apply(this,arguments)},render:function(){ecount.control.view.prototype.render.apply(this,arguments)},onInitWrapperTemplate:function(n){return String.format(this.wrapperToolbar,n)},cloneTemplateAsManyState:function(n,t){for(var r,u=n,e=t.components,o=[],i,f=[],s="",h=!1,c=!1,a=e.filter(function(n){return n.hasOwnProperty("groupId")}),l=0,v=e.length;l<v;l++)i=e[l],i.template&&(u=i.template),i.hasOwnProperty("groupId")?(r=a.filter(function(n){return n.groupId==i.groupId}),r.length>0&&i.id===r[r.length-1].id?(f.push(u),c=r.filter(function(n){return n.hide==!0}).length===r.length,o.push(ecount.widget.replaceAttr(this.templateGroup,{template:f.join(""),groupTitle:r.length===1?i.groupLabel:s,groupActive:h===!0?"active":"","style.display":c?"hidden":"",id:"scorebox-"+i.groupId,role:"scoreboxGroup"})),f=[],s="",h=!1,c=!1):(f.push(u),i.hasOwnProperty("groupLabel")&&(s=i.groupLabel),i.groupActive===!0&&(h=!0))):o.push(u);return o.join("")},onInitTemplate:function(n){return n},onChangeValue:function(n,t){var i=this.getElements(n)[1];i.innerText=t},getGroupEl:function(n){var t=null;return this.ecview&&(t=this.ecview.getElements(n).parent(),t=t.eq(0)),t},onChangeStyleDisplay:function(n,t){var i=this.getElements(n),r=i.eq(0),u,f;isGroupComponent=i.parent().hasClass("score-box-group");i.length>0&&t?r.removeClass("hidden"):i.length>0&&r.addClass("hidden");isGroupComponent&&(u=i.parent().find("div.score-box"),f=u.not(".hidden").length,f==0?i.parent().eq(0).addClass("hidden"):i.parent().eq(0).removeClass("hidden"))}});ecount.class("ecount.control.menu","ecount.control",{delimiter:"",delegator:null,id:null,title:null,level:null,parentID:null,menuData:null,menuItems:null,isActivated:!1,isClosed:!1,hasShowNewWindowIcon:!1,hasGroupArrow:!1,hasItemParent:!1,menuAPIUrl:null,isMenuControl:!0,mouseoverTimeout:ecount.common.mouseHoverInTime,mouseoutTimeout:ecount.common.mouseHoverOutTime,mouseoverTimer:null,mouseoutTimer:null,initializeOptions:function(n,t){_.extend(this,{delegator:n.delegator||new ecount.events(this),responseID:n.responseID});this.initializeTimeout(n,t);this.menuItems=this._getMenuItems(n,t)},initializeTimeout:function(n,t){this.mouseoverTimeout=this._getMouseoverTimeout(n,t);this.mouseoutTimeout=n.mouseoutTimeout!==undefined?n.mouseoutTimeout:this.mouseoutTimeout},initializeViewOptions:function(n){_.extend(this.__viewOptions,{depth:n.depth})},onInitState:function(){_.extend(this.__state,{ecPath:"",title:this.title,isActivated:!1,isAnchorActivated:!1,isClosed:!1,isShowNewWindowIcon:!1})},render:function(n){this.attachView(n)},onAfterRender:function(){if(this.menuItems){var n=this.ecview.getChildrenContainerDummy();this.menuItems.forEach(function(t){t.render(n)});this.ecview.setChildrenContainerItems(n)}},getWrapperMenuArea:function(){return this.$menuArea||(this.$menuArea=$("#menuArea")),this.$menuArea},getWrapperMenuAreaAddon:function(){return this.$menuAreaAddon||(this.$menuAreaAddon=$("#menuAreaAddon")),this.$menuAreaAddon},getInitComponents:function(n,t,i){return this._getOwnState(n,t,i)},getInitDataComponents:function(n,t,i){return this._getOwnState(n,t,i)},getAPIData:function(){},setHidden:function(){this.ecview.setHidden()},setShow:function(){this.ecview.setShow()},setBodyUrl:function(){this.getComponent(0)},setOwnChildren:function(){},findMenuByEcPath:function(){return this},_getOwnState:function(){return[{ecPageID:this.ecPageID}]},_getComponentIndex:function(){return 0},_getMouseoverTimeout:function(n){return n.mouseoverTimeout!==undefined?n.mouseoverTimeout:this.mouseoverTimeout},_getChildrenByAPI:function(){},_getMenuItems:function(n,t){return{target:n.target||this.target,domId:this._getDomId(t,state,n),label:n.label||this.label,containerId:this._getContainerId(t,state,n)}},_getDomId:function(){return this.id},_getContainerId:function(){return["control","","","",this.id].join(ecount.delimiter)}});ecount.class("ecount.control.menu.item","ecount.control.menu",{ecPackage:"ecount.control.menu.item",onInitState:function(n,t,i){ecount.control.menu.prototype.onInitState.apply(this,arguments);$.extend(this.__state,{section:i.section,"attr.href":"javascript:;","attr.target":"","style.anchorClass":""})},setEcPath:function(){this.ecPath=[this.ecPageID,"menu","section","","",this.id,this.pcid].join(ecount.separator.ecPath)},_getOwnState:function(n,t,i){return[{target:i.target||this.target,domId:this._getDomId(n,t,i),label:i.label||this.label,containerId:this._getContainerId(n,t,i)}]},_getMenuHash:function(){return["#menuType=",this.menuData.MENU_TYPE,"&menuSeq=",this.menuData.MENU_SEQ,"&groupSeq=",this.menuData.GROUP_SEQ,"&prgId=",this.menuData.PRG_ID].join("")},_getMenuItems:function(){return[]},_getDomId:function(){return"ma"+this.id},_getMenuItemData:function(){return{ecPageID:this.ecPageID,delegator:this.delegator}},_hasMouseoutTimer:function(){return!1},ON_CLICK:function(){},ON_MOUSEOVER:function(){},ON_MOUSEOUT:function(){}});ecount.class("ecount.control.menu.section","ecount.control.menu",{ecPackage:"ecount.control.menu.section",onInitState:function(){ecount.control.menu.prototype.onInitState.apply(this,arguments);$.extend(this.__state,{containerId:["control","","",this.ecPageID,this.id].join(ecount.separator.ecPath),"opt.hoverActiveItem":""})},setEcPath:function(){this.ecPath=[this.ecPageID,"menu","section","","",this.id,this.pcid].join(ecount.separator.ecPath)},setActivatedState:function(){},setHoverActiveItem:function(n){this.setState(this._IT_SELF,"opt.hoverActiveItem",n)},getHoverActiveItem:function(){return this.getState(this._IT_SELF,"opt.hoverActiveItem")},getSectionItem:function(){},activateMenuById:function(){},activateMenuByParentId:function(){},_getMenuItems:function(n,t){var i=widget.generator.control();return n._dataItems.map(function(r){return i.define("widget.menuItem").setDataItems([]).setOptions($.extend(this._getSectionData(n,t),{menuData:r})).getInstance()}.bind(this))},_getSectionData:function(){return{ecPageID:this.ecPageID,delegator:this.delegator}},ON_MOUSEOVER:function(){}});ecount.class("ecount.control.menu.container","ecount.control.menu",{ecPackage:"ecount.control.menu.container",initializeOptions:function(){if(ecount.control.menu.prototype.initializeOptions.apply(this,arguments),this.delegator)this.delegator.on({"container.openNewSite":this.openNewSite.bind(this)})},openNewSite:function(){},onInitState:function(n,t){t["style.showingDepth"]=1},onInitComponent:function(){ecount.control.menu.prototype.onInitComponent.apply(this,arguments)},setEcPath:function(){this.ecPath=[this.ecPageID,"menu","","","",this.id,this.pcid].join(ecount.separator.ecPath)},runMenuChangeProcess:function(n,t){ecount.menu.getMenuApiData().then(function(){t&&t()})},_getComponentIndex:function(){return 0},_getMenuItems:function(n,t){var i=widget.generator.control();return n._dataItems.map(function(r){return i.define("widget.menuSection").setDataItems(r).setOptions(this._getContainerData(n,t)).getInstance()}.bind(this))},_getContainerData:function(){return{ecPageID:this.ecPageID,delegator:this.delegator}}});ecount.class("ecount.control.view.menu","ecount.control.view",{template:"<li><\/li>",listClassName:"",activeClassName:"",anchorActiveClassName:"",visibleClassName:"",openClassName:"on",closeClassName:"off",showClassName:"show",render:function(n,t){if(this.$el){this.$el.removeClass(this.activeClassName);t.append(this.$el);return}ecount.control.view.prototype.render.apply(this,arguments)},getWrapperMenuArea:function(){return this.$menuArea||(this.$menuArea=$("#menuArea")),this.$menuArea},getWrapperMenuAreaAddon:function(){return this.$menuAreaAddon||(this.$menuAreaAddon=$("#menuAreaAddon")),this.$menuAreaAddon},getChildrenContainerDummy:function(){return $(document.createDocumentFragment())},getChildrenContainer:function(){return this.getOwnElement('[data-role="menu.itemContainer"]')},getChildrenListedItem:function(){return this.getOwnElement('[data-role="menu.listedItem"]')},setChildrenContainerItems:function(n){this.getChildrenContainer().append(n)},setChildrenContainerEmtpy:function(){this.getChildrenContainer().empty()},setChildrenStorage:function(){var t=this.getChildrenContainer(),n=this.getOwnElement('[data-role="menu.itemStorage"]');n.length||(n=t.after($('<div class="hidden" data-role="menu.itemStorage" />')));n.append(t.children())},onInitWrapperTemplate:function(){return"((this.template))"},onChangeIsActivated:function(n,t){var i=this.getChildrenContainer();t?i.addClass(this.activeClassName):i.removeClass(this.activeClassName)},onChangeIsClosed:function(){var n=this.getChildrenContainer();value?n.addClass(this.closeClassName):n.removeClass(this.closeClassName)},onChangeIsShowNewWindowIcon:function(){var n=this.getChildrenContainer();value?n.addClass(this.visibleClassName):n.removeClass(this.visibleClassName)}});ecount.class("ecount.control.view.menu.item","ecount.control.view.menu",{template:'<li id={{id}} data-ecpath={{ecPath}} data-role="menu.listedItem" class="{{listClassName}}">\n<a href="{{attr.href}}" target="{{attr.target}}" data-role={{menuAnchor}} data-level={{level}} data-findex="{{findex}}" data-index={{index}} id="{{domId}}" data-cid="{{anchorId}}" class="{{anchorClassName}}" data-container-id="{{containerId}}">\n{{label}}[[arrow]][[newWinIconTemplate]]\n<\/a>\n<\/li>',childrenTemplate:'<ul data-ecPath={{ecPath}} class="{{style.display}}" data-role="menu.itemContainer">{{itemTemplate}}<\/ul>',arrowTemplate:'<span class="icon-nav-arrow" data-cid="{{cid}}" data-function="{{ecFunction}}"><\/span>',newWinIconTemplate:'<span class="new-window" data-cid="{{cid}}" data-function="{{ecFunction}}"><\/span>',listClassName:"",onInitTemplate:function(n,t){return ecount.widget.replaceAttr(n,$.extend(t,{listClassName:this.listClassName}))},onChangeIsAnchorActivated:function(){var n=this.getOwnElement("[data-role=menuAnchor]");value?n.addClass(this.anchorActiveClassName):n.removeClass(this.anchorActiveClassName)}});ecount.class("ecount.control.view.menu.section","ecount.control.view.menu",{wrapperTemplate:['<div class="{{containerClassName}} {{style.display}}" data-container-id="{{containerId}}" data-cid="{{cid}}" data-ecpath="{{ecPath}}">',"((this.template))","<\/div>",].join("\n"),template:'<ul id="{{id}}" class="{{ulClassName}}" data-cid="{{cid}}" data-role="menuListedItem"><\/ul>',containerClassName:"",getUlClassName:function(){return""},onInitTemplate:function(n,t){return ecount.widget.replaceAttr(n,$.extend(t,{ulClassName:this.getUlClassName(t)}))},onInitWrapperTemplate:function(){return"((this.template))"}});ecount.class("ecount.control.view.menu.container","ecount.control.view.menu",{template:'<div  class="global-nav" data-role="childContainer"><\/div>',openClassName:"on",onMount:function(){var n=this.getWrapperMenuAreaAddon();this.$el&&(n.attr("data-ecpath",this.$el.attr("data-ecpath")),n.attr("data-role",this.$el.attr("data-role")),n[0].ecIKey=this.$el[0].ecIKey)}});ecount.class("ecount.control.board","ecount.control",{ecPackage:"ecount.control.board",initializeViewOptions:function(n,t){$.extend(this.__viewOptions,{title:this._getBoardHeader(n,t),columns:this._getBoardColumns(n,t),useWrapperSet:!1})},getInitDataComponents:function(n,t,i){return this._getComponents(n,t,i)},getInitComponents:function(n,t,i){return this._getComponents(n,t,i)},onInitComponent:function(n,t,i,r){var u=i.components[t];r.id=u.subid||u.id;r.ecRole="board.item";r["attr.href"]=u.url;r["style.css"]=u["style.css"];r.label=u.title||"";r.navindex=u.navIndex;r.tabflag=u.tabFlag;r.boardid=u.boardId},onMousedownListedItem:function(){},onMousedownMoreButton:function(){},onClickListedItem:function(n,t,i,r){var u=this.getComponent(n.cindex);if(!u)return!1;r.command=String.format("on-{0}-{1}",this.containerName,this.id).ecCamelize(!0);r.navIndex=u.navindex;r.dataItem=$.extend({},u,{id:u.subid});n.navIndex=u.navindex;n.dataItem=$.extend({},u,{id:u.subid})},onClickMoreButton:function(){},_getComponents:function(n,t,i){return i._dataItems&&i._dataItems.length?i._dataItems.slice(0):this._dataItems&&this._dataItems.length?this._dataItems.slice(0):[{}]},_getBoardHeader:function(n){return n._title||this._title||""},_getBoardColumns:function(){return[]},ON_CLICK:function(n,t,i,r){switch(n.ecRole){case"board.item":this.onClickListedItem(n,t,i,r);break;case"board.more":this.onClickMoreButton(n,t,i,r);break;case"movie":this.onClickListedItem(n,t,i,r);r.target="movie";break;case"article":this.onClickListedItem(n,t,i,r);r.target="article"}},ON_MOUSEDOWN:function(n,t,i,r){switch(n.ecRole){case"board.item":this.onMousedownListedItem(n,t,i,r);break;case"board.more":this.onMousedownMoreButton(n,t,i,r)}}});ecount.class("ecount.control.view.board","ecount.control.view",{wrapperTemplate:['<div data-ecPath={{ecPath}} class="panel panel-default panel-lg {{style.display}}">',"((this.template))","<\/div>",].join("\n"),headerTemplate:'<div class="panel-heading">\n{{title}}\n<div class="pull-right"><\/div>\n<div class="pull-left"><\/div>\n<\/div>',containerTemplate:['<div class="panel-body">','<ul class="customer-support-main-nav">{{itemTemplate}}<\/ul>',"<\/div>",].join("\n"),template:'<li data-cid="{{cid}}" data-index={{index}} id="{{id}}" data-cid="{{cid}}" data-role="{{ecRole}}">\n<span data-cid="{{cid}}" data-index={{index}} id="{{id}}" data-cid="{{cid}}" data-role="{{ecRole}}" class="{{style.css}} {{style.display}}" ><\/span>\n<span data-cid="{{cid}}" data-index={{index}} id="{{id}}" data-cid="{{cid}}" data-role="{{ecRole}}">{{label}}<\/span>\n<\/li>',itemContainerTemplate:"",onInitTemplate:function(n,t){var i=ecount.widget.replaceAttr(this.headerTemplate,t),r=t.components.map(function(t){return ecount.widget.replaceAttr(n,t)}).join(""),u=this.containerTemplate.replace("{{itemTemplate}}",r);return[i,u].join("")}});ecount.class("ecount.handler.contextmenu","ecount.handler",{template:'<ul class="dropdown-menu context-menu"/>',submenuCSS:"dropdown-menu-item-group",init:function(){ecount.handler.prototype.init.apply(this,arguments)},on:function(){ecount.handler.prototype.on.apply(this,arguments);var n=this,t=n.scope.$el;t.on("contextmenu",function(t){var r=t.target,o;if(r.getAttribute("data-trigger")=="click"||r.getAttribute("data-allowContextmenu")=="no")return!1;var u=n.eventContainer||$(document),f=r.getAttribute("data-fid"),e=$(this).offset(),i=t.clientX-e.left+u.scrollLeft();return i>1e3&&(i=i-100),o=t.clientY-e.top+u.scrollTop(),n.currentTargetID=f,n.create(n.invoke("create",[f]),i,o),!1});this.$layer=$('<ul class="dropdown-menu context-menu"  style="z-index:6002;"/>');this.$layer.on("click",this.onclickHandler.bind(this)).appendTo(this.scope.$el);this.bodyClickHandler=function(n){var t=n.target;t&&t.getAttribute&&t.getAttribute("data-trigger")=="click"||this.hide.call(this,n)}.bind(this)},un:function(){ecount.handler.prototype.un.apply(this,arguments);this.$layer.off().remove()},create:function(n,t,i,r){function o(n,t){var i,f;for(u+=138,i=0,f=n.length;i<f;i++){var e=u>=1e3?!0:!1,r=n[i].disabled?"disabled":"",s=e?" dropdown-menu-item-group-left":"";n[i].subitem?t.push('<li class="dropdown-menu-item-group '+r+s+'"><a href="javascript:;" id="'+n[i].id+'" data-disabled="'+r+'" data-hasitem="true" data-trigger="click" onmouseover=\'console.log(11);\'>'+n[i].title+"<\/a>"):t.push('<li class="'+r+'"><a href="javascript:;" id="'+n[i].id+'" data-disabled="'+r+'" data-trigger="click">'+n[i].title+"<\/a>");n[i].subitem&&(t.push('<ul class="dropdown-menu">'),n[i].id=="align"&&(u-=138),o(n[i].subitem,t),t.push("<\/ul>"));t.push("<\/li>")}}var f,e,u;r&&(this.currentTargetID=r,f=$(this.scope.targetContainer).offset(),t=t-f.left,i=i-f.top);e=[];u=t;o(n,e);this.$layer.append(e.join("")).css({left:t,top:i});this.show()},onclickHandler:function(n){var t=n.target;return t.getAttribute("data-disabled")!="disabled"&&t.getAttribute("data-hasitem")!="true"&&(this.invoke("select",[this.scope,this.currentTargetID,t.id,$(t).text()]),this.hide()),!1},show:function(){if(!this.isShow){this.isShow=!0;this.$layer.show();$(this.eventContainer||document).on("mousedown",this.bodyClickHandler)}},hide:function(){this.isShow&&(this.isShow=!1,this.$layer.hide().empty(),this.currentTargetID=null,$(this.eventContainer||document).unbind("mousedown",this.bodyClickHandler))}});ecount.class("ecount.control.calendar.schedule","ecount.control.calendar",{dayCnt:0,ecPackage:"ecount.control.calendar.schedule",init:function(){ecount.control.calendar.prototype.init.apply(this,arguments)},render:function(){ecount.control.calendar.prototype.render.apply(this,arguments)},getTodayInfoText:function(){var n=ecount.resource;return n.LBL00785+" : "+String.format(n.LBL00044,this.todayMonth,this.todayDay)},requestData:function(){ecount.common.api({ecPageID:this.ecPageID,url:this.calendarApiUrl,data:Object.toJSON($.extend({DATEF:this.year+(this.month+1).toString().padLeft(2,"0")+"01"},this.calendarApiUserParam||{})),error:function(){alert("error")},complete:function(){return!1},success:function(n){var i=Object.clone(n.Data),t;this.datas=i;t=this.setMonthItems();this.monthItems=t;this.__viewOptions.monthItems=t;this.reDraw()}.bind(this)})}});ecount.class("ecount.control.view.calendar.schedule","ecount.control.view.calendar",{template:['<div class="wrapper-calendar {{weekend}}">','<table class="table table-bordered">',"<thead>","{{HEADER}}","<\/thead>",'<tbody id="calendar-body">',"{{MONTH}}","<\/tbody>","<\/table>","<div>",].join("\n")});ecount.class("ecount.control.calc","ecount.control",{ecPackage:"ecount.control.calc",init:function(){ecount.control.prototype.init.apply(this,arguments)},render:function(){ecount.control.prototype.render.apply(this,arguments)},initializeOptions:function(n){$.extend(this,{_isCalc:_.isBoolean(n._isCalc)?n._isCalc:!0,_isJoinString:n._isJoinString||!1,_isRequired:n._isRequired||!1,joinMaxLength:n.joinMaxLength||5,_maxBytes:2e3,_fieldGubun:n.fieldGubun||"",requiredItem:n.requiredItem||null,notCheckRequiredItem:n.notCheckRequiredItem||!1,requiredType:n.requiredType||null,onOutCheckError:this.data.length>0&&this.data[0].onOutCheckError?this.data[0].onOutCheckError:null,labelClickCallBack:n.labelClickCallBack?n.labelClickCallBack:null,sumIfCallBack:n.sumIfCallBack?n.sumIfCallBack:null,strCalcCallBack:n.strCalcCallBack?n.strCalcCallBack:null,customizeKeyDownValidate:n.customizeKeyDownValidate?n.customizeKeyDownValidate:null,customizeValue:n.customizeValue?n.customizeValue:null,cutInSetSelectableItem:n.cutInSetSelectableItem||null});this.enableFocus=!0;this.isEnter=!1},initCalcData:function(n,t){var i=this.data,f,e,o,b,s,h,l,a,v,u,w,c;for(i&&i.length!=0||i.push({list:[]}),u=0;u<i.length;u++)i[u].css="textbox-inline form-bordered",i[u].value="";i[0].list||(i[0].list=[]);var r=i[0].list,y=i[0].calcSql,p=i[0].calcGubun,k=i[0].numberCalcIds||"",d=i[0].dataType1||[],g=i[0].dataType2||[],nt=i[0].tabCd||[],tt=i[0].tabType||[],it=i[0].sno||[];if(this.initAutoCompleteList(t),y&&y.length>0&&p&&_.split(y,this._fieldGubun).length==p.split(this._fieldGubun).length)for(u=0;u<p.length;u++){o=p.split(this._fieldGubun)[u];f=e=y.split(this._fieldGubun)[u];b=k.split(this._fieldGubun)[u];s=d[u]||"";h=g[u]||"";l=nt[u]||"";a=tt[u]||"";v=it[u]||"";switch(o){case"1":case"12":case"17":case"15":c=(i[0].codes||[]).find(function(n){return n.value==f}.bind(this));c||(c={value:f,label:e,type:o,dataType1:s,dataType2:h,tabCd:l,tabType:a,sno:v});r.push({value:c.value,label:c.label,type:o,dataType1:s,dataType2:h,tabCd:l,tabType:a,sno:v});break;case"2":w=i[0].inCodes?(i[0].inCodes||[]).find(function(n){return f.indexOf(n.value+" in")>-1}.bind(this)):{value:f,label:e};w&&r.push({value:f,label:e.replace(w.value,w.label),type:o,dataType1:s,dataType2:h,tabCd:l,tabType:a,sno:v});break;case"4":case"5":case"6":case"13":case"8":case"9":case"10":case"14":r.push({value:f,label:e,type:o});break;case"7":c=(i[0].bracketFunction||[]).find(function(n){return n.value==f}.bind(this));r.push({value:c.value,label:c.label,type:o,dataType1:s,dataType2:h,tabCd:l,tabType:a,sno:v});break;case"3":r.length>0&&r[r.length-1].type==o?(r[r.length-1].label=r[r.length-1].label+e,r[r.length-1].value=r[r.length-1].value+f):r.push({value:f,label:e,type:o,dataType1:s,dataType2:h,tabCd:l,tabType:a,sno:v});break;case"11":this.sumIfCallBack&&typeof this.sumIfCallBack=="function"&&(e=this.sumIfCallBack(f));r.push({value:f,label:e,type:o,dataType1:s,dataType2:h,tabCd:l,tabType:a,sno:v});break;case"18":case"19":this.strCalcCallBack&&typeof this.strCalcCallBack=="function"&&(e=this.strCalcCallBack(f,b));r.push({value:f,label:e,numberCalcId:b,type:o,dataType1:s,dataType2:h})}}},onInitState:function(n,t,i){t.components||(t.components=[{}]);this.initCalcData(i,n);t.list=this.data[0].list;t._autocompleteList=this._autocompleteList;t.labelEdit={editable:!1,change:!1,index:-1};t.inputEdit={editable:!1,index:-1};t.listLength=this.data[0].list.length;t.reflowContainer=!1;t.toggleMoreBtn=!0},onInitComponent:function(n,t,i,r){r["style.focus"]=!1;r.ecService="layer.autocomplete";r.value="";r.label="";r.labelText="";r.type="";r.typeFromLayer="";r.dataType1="";r.dataType2="";r.tabCd="";r.tabType="";r.sno="";r["style.css"]="form-control-bordered"},getInitDataComponents:function(){var n=ecount.control.prototype.getInitDataComponents.apply(this,arguments);return n.ecService="layer.autocomplete",n},getLayerAutocompleteOption:function(n){var t=ecount.control.prototype.getLayerAutocompleteOption.apply(this,arguments);return _.extend(t,{value:n.value,searchSourceList:this.getAutoCompleteListChangeLabel()||[],setupHandler:this.setManualInputAutoCompleteSetting.bind(this),responseFilter:this.getManualInputAutocompleteList.bind(this),showingUpDelay:0,autoHighlightFirstResult:!0})},getAutoCompleteListChangeLabel:function(){for(var n,r,i=[],t=0;t<this._autocompleteList.length;t++)n=this._autocompleteList[t],r=(ecount.resource[n.label]?ecount.resource[n.label]:n.label).toLowerCase(),i.push({label:r,realLabel:n.label,value:n.value,type:n.type,dataType1:n.dataType1,dataType2:n.dataType2,tabCd:n.tabCd||"",tabType:n.tabType,sno:n.sno});return i},setAutoCompleteList:function(n){this._resetAutocompleteList();this.initAutoCompleteList(n)},_resetAutocompleteList:function(){this._autocompleteList=[]},setManualInputAutoCompleteSetting:function(n,t,i){i(t)},getManualInputAutocompleteList:function(n,t){var f=[],e=[],i,u,r;if(t.length==1&&[160,32].contains(t.charCodeAt(0))&&(t=" "),this._isJoinString||!$.isNumber(t)&&t!==""){for(r=0;r<n.length;r++)i=n[r],u=(ecount.resource[i.label]?ecount.resource[i.label]:i.label).toLowerCase(),this._isCalc&&(!this._isCalc||["4","5"].contains(i.type))||(u==t.toLowerCase()||i.type=="9"&&i.value.toLowerCase()==t.toLowerCase()?f.push(i):u.indexOf(t.toLowerCase())>-1&&e.push(i));return this.isShowAutoComplete=!0,f.concat(e)}return this.isShowAutoComplete=!1,[]},onInitFunction:function(n,t){var i=t.functions;i.removeall={ecFunction:"button",ecFunctionId:"code.removeall","style.display":t.list.length>0,cid:this.id};i.remove={ecFunction:"button",ecFunctionId:"input.remove","style.display":!1,labelEdit:!1,cid:this.id+"_input"};i.more={ecFunction:"button",ecFunctionId:"button.more","style.display":!1,cid:this.id+"_more"}},_openPopup:function(n){var t={targetID:this.id,control:this};this.openPopup(t,n)},onMessage:function(n,t){t=t||{};var i=t.data||null,r=t.callback,u;i&&(_.isArray(i)||(i=[i]),u=i[0].CALC_VALUE?i[0].CALC_VALUE[0]:i,this.insertItem(u),this.setFocus(0));_.isFunction(r)&&r()},getSyncData:function(){var n=this.getExtractState(["list","listLength"],!0).concat(this.getExtractFunctionState(["removeall"]));return{data:n}},_addItem:function(n,t){n=n?n:this._IT_SELF;var r=this.getState(n,"list"),i=_.concat(r,t);this.setState(0,"labelText","");this.setState(n,"list",i);this.setState(n,"listLength",_.size(i));this.reflowContainer();this.setState("removeall","style.display",!0);this.executeChangeDelegator()},_insertItem:function(n,t,i){n=n?n:this._IT_SELF;var r=this.getState(n,"list");_.isArray(t)?_.each(t,function(n,t){r.splice(i+t,0,n)}):r.splice(i,0,t);this.setState(0,"labelText","");this.setState(n,"list",r,!0);this.setState(n,"listLength",_.size(r));this.reflowContainer();this.setState("removeall","style.display",!0);this.executeChangeDelegator()},_removeItem:function(n,t){var i,r;n=n?n:this._IT_SELF;i=this.getState(n,"list");_.pullAt(i,[_.parseInt(t)]);this.setState(n,"list",i,!0);this.setState(n,"listLength",_.size(i));this.reflowContainer();r=this.getValue();r&&r.length!=0||this.setState("removeall","style.display",!1);this.executeChangeDelegator()},_removeItemAll:function(n){n=n?n:this._IT_SELF;this.setState(n,"list",[],!0);this.setState(n,"listLength",0);this.reflowContainer();this.setState("removeall","style.display",!1);this.executeChangeDelegator()},_updateItem:function(n,t,i){n=n?n:this._IT_SELF;var r=this.getState(n,"list"),u=r[t];_.isArray(i)&&(i=i[0]);_.isPlainObject(i)&&!_.isEmpty(i)&&(r[t]=i);this.setState(0,"labelText","");this.setState(n,"list",r,!0);this.reflowContainer();this.executeChangeDelegator()},_parseItem:function(n){for(var t,i=_.cloneDeep(n),r=0;r<i.length;r++)t=i[r],_.isPlainObject(t)&&t.type&&(t.type=t.type.toString());return i},insertItem:function(n){var i,t=this.getState(this._IT_SELF,"labelEdit"),u=t.editable,r=t.index;_.isArray(n)&&_.size(n)>0&&(n=this._parseItem(n),r>=0?u?this._updateItem(this._IT_SELF,r,n):this._insertItem(this._IT_SELF,n,r):this._addItem(this._IT_SELF,n),i=this.getState(this._IT_SELF,"listLength"),_.isFunction(this.sumIfCallBack)?_.defer(function(){i>t.index+1&&t.index+1!==0?this._setTargetChangeText(!1,!0,++t.index,!1):this._setTargetChangeText(!1,!0,-1);this.setFocus(!0)}.bind(this)):i>t.index+1&&t.index+1!==0?this._setTargetChangeText(!1,!0,++t.index,!1):this._setTargetChangeText(!1,!0,-1))},changeItem:function(n,t){var i=this.getState(this._IT_SELF,"listLength");this._updateItem(this._IT_SELF,t,n);++t===i&&(t=-1);this._setTargetChangeText(!1,!0,t)},deleteItem:function(n){this._removeItem(this._IT_SELF,n)},getValue:function(){var n=this.getState(this._IT_SELF,"list");return $.isEmpty(n)?{}:n.reduce(function(n,t){return{value:[n.value,t.value].join(this._fieldGubun),label:[n.label,t.label].join(this._fieldGubun),type:[n.type,t.type].join(this._fieldGubun),dataType1:[n.dataType1,t.dataType1].join(this._fieldGubun),dataType2:[n.dataType2,t.dataType2].join(this._fieldGubun),tabCd:[n.tabCd,t.tabCd].join(this._fieldGubun),tabType:[n.tabType,t.tabType].join(this._fieldGubun),sno:[n.sno,t.sno].join(this._fieldGubun),numberCalcId:[n.numberCalcId||"",t.numberCalcId||""].join(this._fieldGubun)}}.bind(this))},_setInputValue:function(){},setValue:function(n){var i,r,f,u,t=[];if(n){for(u in n)i=n[u],i.split(this._fieldGubun).forEach(function(n,i){t[i]||(t[i]={});t[i][u]=n});for(r=0,f=t.length;r<f;r++)i=[t[r]],this.insertItem(i)}else this.removeItemAll()},getDataType1:function(n){var t=_.groupBy(this.getState(this._IT_SELF,"list"),"dataType1");return _.isString(n)&&!_.isEmpty(n)?t[n]:t},getDataType2:function(n){var t=_.groupBy(this.getState(this._IT_SELF,"list"),"dataType2");return _.isString(n)&&!_.isEmpty(n)?t[n]:t},getTabCd:function(n){var t=_.groupBy(this.getState(this._IT_SELF,"list"),"tabCd");return _.isString(n)&&!_.isEmpty(n)?tabCdData[n]:tabCdData},getTabType:function(n){var t=_.groupBy(this.getState(this._IT_SELF,"list"),"tabType");return _.isString(n)&&!_.isEmpty(n)?tabTypeData[n]:tabTypeData},getSno:function(n){var t=_.groupBy(this.getState(this._IT_SELF,"list"),"sno");return _.isString(n)&&!_.isEmpty(n)?snoData[n]:snoData},getRequiredItem:function(){return this.requiredItem||null},getRequiredType:function(){return this.requiredType||null},setRequiredItem:function(n){this.requiredItem=n},setRequiredType:function(n){this.requiredType=n},validate:function(n,t){var a=[],ut,kt,pt,y,p,ot,st,nt,tt,w,it,lt,at,vt,ui,rt,wt,bt,e;if(n){for(a=this.checkValidate(n,t||this.dataRuleMsg),ut=0,kt=a.length;ut<kt;ut++)a[ut].control=this;ecount.control.prototype.setDataRuleMessage.call(this,target,a)}var f=this.getState(this._IT_SELF,"list"),h=ecount.resource.MSG01377,o=0,dt=0,gt=0,r,v,i=!1,ni=!1,b=[],c=[],ft=-1,u,s,yt=this.getRequiredItem(),ti=this.getRequiredType();for(e=0;e<f.length;e++){if(u=this.getTypeChoice(f[e]),ft=b.length-1,s=ft==-1||b[ft]!=o,!this._isJoinString&&r&&r==u&&!["7","8"].contains(u)&&["1","2","3","11","12"].contains(r)&&s){i=!0;break}switch(u){case"1":case"2":case"3":case"11":case"12":if(this._isJoinString)u=="1"&&this._isJoinString&&dt++;else{if(["1","2","3","8","11","12"].contains(r)&&s||this._isCalc&&["2"].contains(u)||["6"].contains(r)&&["12"].contains(u)||ni==!0&&f[e].value=="0"){i=!0;break}else["1","2","3","8","11","12"].contains(r)&&!s&&c.push(e);this._isCalc||u!="2"||(v=!0,gt++);u=="12"&&r!="5"&&(dateTypeComplete=!1)}break;case"4":case"5":case"6":if(["4","5","6","7","9"].contains(r)||["5","6"].contains(u)&&["2"].contains(r)||["6"].contains(u)&&["12"].contains(r)||this._isCalc&&["4","5"].contains(u)||!v&&["4"].contains(u)||v&&["5"].contains(u)){i=!0;break}if(r=="12"&&u=="5"&&(dateTypeComplete=!0),["5"].contains(u)&&(v=!0,gt++),["4"].contains(u)&&(v=!1),["10"].contains(r)&&!s){i=!0;break}break;case"7":if(o++,["1","2","3","8","11","12"].contains(r)&&s){i=!0;break}else["1","2","3","8","11","12"].contains(r)&&!s&&c.push(e);break;case"8":if(b[ft]==o&&b.pop(),["6","7","10"].contains(r)){i=!0;break}o--;break;case"9":this._isJoinString||(o++,b.push(o),["1","2","3","8","11","12"].contains(r)&&(i=!0));break;case"10":if(!this._isJoinString&&(["4","5","6","7","10"].contains(r)||s)){i=!0;break}}if(o<0&&(i=!0),this._isJoinString||e!=0||["1","2","3","7","9","11","12"].contains(u)||u=="6"&&f[e].value=="-"||(i=!0),ni=f[e].type=="6"&&f[e].value=="/"?!0:!1,!i&&this._isJoinString&&this.joinMaxLength<dt&&(h=String.format(ecount.resource.MSG05529,this.joinMaxLength),i=!0),i||(pt=this._checkValidateType(f,e)||{},i=!!pt.isError,h=pt.ErrMessage||h),i)break;r=this.getTypeChoice(f[e])}var k=0,ii=0,et=[],d=[],g=!1;for(y=0;y<f.length;y++)if(p=f[y],g===!1&&(p.value==="ROUND("||p.value==="CEILING("||p.value==="FLOOR(")){g=!0;k++;et.push(y);continue}else g===!0&&p.value.indexOf("(")>=0?k++:g===!0&&p.value==")"&&k==++ii&&(et.push(y),d.push(et),et=[],g=!1);if(d.length!=0){for(ot=[],st=0;st<d.length;st++)nt=d[st],ot.push(f.slice().slice(nt[0],nt[1]+1));for(tt=0;tt<ot.length;tt++){var nt=d[tt],l=ot[tt],k=0,ii=0,ht=[];for(w=0;w<l.length;w++)if(l[w].value.indexOf("(")>=0)k++;else if(l[w].value==")"&&(ht.push(w),k==++ii))break;var fi=ht.pop()+1,ei=ht.length===0?0:ht.pop(),ct=l.slice(ei,fi),ri=ct.filter(function(n){return n.type==="10"});for(ri.length>1&&(i=!0),it=ct.splice(ct.length-3,ct.length),ri.length>0&&it.length>=3&&(it[0].type!=="10"&&(i=!0),it[1].type!=="3"&&(i=!0),it[2].type!=="8"&&(i=!0)),lt=[],at=0;at<c.length;at++)vt=c[at],nt[0]<=vt&&nt[1]>=vt&&lt.push(vt);for(lt.length>1&&(i=!0),c.length>0&&(ui=f.slice(),lt.forEach(function(n){var t=ui.slice(n,n+1)[0];_.isNil(t)||t.type==="3"||(i=!0)})),rt=0;rt<l.length-1;rt++)l[rt].type==="7"&&l[rt+1].type==="10"&&(i=!0)}}if(this._isRequired&&this._isJoinString&&f.length==0?(i=!0,h=""):["4","5","6","7"].contains(r)?i=!0:o!=0?i=!0:v===!1&&(i=!0),f.length==0||$.isNull(yt)||this.notCheckRequiredItem==!0||(wt=this.getValue()&&this.getValue().value,_.isString(wt)&&wt.split(this._fieldGubun).contains(yt.value)||(i=!0,h=String.format(ecount.resource.MSG09778,yt.label))),f.length==0||$.isNull(ti)||(bt=this.getValue()&&this.getValue().type,_.isString(bt)&&bt.split(this._fieldGubun).contains(ti)||(i=!0)),this.getRequiredCheckPass()&&(i=!1),i==!0)a.push({method:(this._isRequired&&this._isJoinString||!this._isCalc)&&f.length==0?"required":"permission",message:h,control:this}),this.showError(this._IT_SELF,h,!0,!1,!0);else{for(e=c.length-1;e>=0;e--)f.splice(c[e],0,{label:",",value:",",type:"10"});this.setState(this._IT_SELF,"list",f,!0)}return a},_checkValidateType:function(){return{}},getRequiredCheckPass:function(){var n=this.getValue(),t=!1;return n&&_.isString(n.dataType2)&&!!~n.dataType2.indexOf("REQUIREDCHECKPASS")&&(t=!0),t},getTypeChoice:function(n){var t=n.type;return n.type=="8"&&n.value=="("?t="7":n.type=="7"&&(n.value=="ROUND("||n.value=="CEILING("||n.value=="FLOOR(")&&(t="9"),t.toString()},getType:function(n){return n&&n.type?n.type.toString():null},getInsertItemErrorCheck:function(n,t){var r=this.getState(this._IT_SELF,"list"),i={isError:!1,message:null},f=this.getState(this._IT_SELF,"inputEdit"),e,u;if(this.getIsMaxByteError(n,t)&&(i={message:ecount.resource.MSG01396,isError:!0}),this._isJoinString&&(r.length>0&&this.joinMaxLength<=r.where(function(n){return n.type=="1"}).length&&(i={message:String.format(ecount.resource.MSG05529,this.joinMaxLength),isError:!0}),r.find(function(t,i){if(t.value==n.value&&t.type=="1")return e=i,!0}))){if(f.editable&&f.index===e)return{isError:!1,message:null};i={message:ecount.resource.MSG02335,isError:!0}}return this.onOutCheckError&&(u=this.onOutCheckError({list:r,select:n,isJoinString:this._isJoinString}),u.isError&&(i=u)),i},getCalcList:function(){return this.getState(this._IT_SELF,"list")},getIsMaxByteError:function(n,t){for(var u=this.getState(this._IT_SELF,"list"),r=0,i=0;i<u.length;i++)i!==t&&(r+=(u[i].label||"").byte());return(r+=(n.label||"").byte(),r>this._maxBytes)?!0:!1},setFocus:function(){this._setInputFocus(!0)},serialize:function(n){var t=[],i;return t.push({key:n||this.name,value:this.getValue()}),this.useFnActivedItem()&&(i=this.getFnActivedId(),t.push({key:(n||this.name)+"_FN",value:i})),ecount.control.prototype.serialize.call(this,t,n)},serializeById:function(){return this.serialize(null,this.id)},save:function(){var n=this.useFnActivedItem()?this.getFnActivedId():null;return{key:this.id,value:this.getValue(),fn:n}},restore:function(n){this.removeItemAll();this.setValue(n);this.useFnActivedItem()&&!$.isNull(n.fn)&&this.setFnActivedId(n.fn)},dualModeShowButtonDisplay:function(){return!0},getInitFocusIndex:function(){return 0},setCalcMode:function(n,t){this._isCalc=n;this._isRequired=t;this._removeItemAll()},getCalcMode:function(){return this._isCalc},toggleContainerHeight:function(){},toggleRemoveBtn:function(){var n=this.getState("removeall","style.display");this.setState("removeall","style.display",!n)},initAutoCompleteList:function(n){function i(n,t){var r=[],i;if(!n)return[];if(_.isString(n))r.push({value:n,label:n,type:t});else for(i=0;i<n.length;i++)n[i]&&n[i].value&&n[i].label?r.push({value:n[i].value,label:n[i].label,type:n[i].type||t,dataType1:n[i].dataType1,dataType2:n[i].dataType2,tabCd:n[i].tabCd,tabType:n[i].tabType,sno:n[i].sno}):r.push({value:n[i],label:n[i],type:n[i].type||t,dataType1:n[i].dataType1,dataType2:n[i].dataType2,tabCd:n[i].tabCd,tabType:n[i].tabType,sno:n[i].sno});return r}var t=this.data[0];n&&(t.codes=n.codes||t.codes,t.joinString=n.joinString||t.joinString,t.logics=n.logics||t.logics,t.comparisons=n.comparisons||t.comparisons,t.calcs=n.calcs||t.calcs,t.bracketFunction=n.bracketFunction||t.bracketFunction,t.bracket=n.bracket||t.bracket,t.commaBracketFunction=n.commaBracketFunction||t.commaBracketFunction,t.comma=n.comma||t.comma,t.sumIf=n.sumIf||t.sumIf);this._autocompleteList=[];this._autocompleteList=this._autocompleteList.concat(i(t.codes,"1"));this._isJoinString?this._autocompleteList=this._autocompleteList.concat(i(t.joinString,"9")):(this._autocompleteList=this._autocompleteList.concat(i(t.logics,"4")),this._autocompleteList=this._autocompleteList.concat(i(t.comparisons,"5")),this._autocompleteList=this._autocompleteList.concat(i(t.calcs,this.controlType=="widget.calc.dateType"?"13":"6")),this._autocompleteList=this._autocompleteList.concat(i(t.bracketFunction,"7")),this._autocompleteList=this._autocompleteList.concat(i(t.bracket,"8")),this._autocompleteList=this._autocompleteList.concat(i(t.commaBracketFunction,"9")),this._autocompleteList=this._autocompleteList.concat(i(t.comma,"10")),this._autocompleteList=this._autocompleteList.concat(i(t.sumIf,"11")))},setLayerValue:function(n){this.setState(0,"typeFromLayer",n.type)},ON_KEYDOWN_ENTER:function(n,t,i,r){r.pass=!1;var u=this.onKeyDownEnterHandler(n,t,r);if(u==!0)return!1},ON_KEYDOWN_BACKSPACE:function(n,t,i,r){var u=this.getState(this._IT_SELF,"inputEdit"),f=this.getState(this._IT_SELF,"labelEdit");r.isNext=!1;n.value===""&&u.index>=0&&this._removeItem(this._IT_SELF,u.index);this.onKeyDownArrowHandler(n,t,i,r);ecount.layer.clear()},ON_KEYDOWN_BACKSPACE_SERVICE:function(n,t,i,r){this.ON_KEYDOWN_BACKSPACE(n,t,i,r)},ON_KEYDOWN_ENTER_SERVICE:function(n,t,i,r){this.isEnter=!0;var u;if(r.selectedItem=!1,r.itemList&&r.itemList.length>0&&!_.isNil(r.selectedIndex)){if(r.pass=!0,r.selectedItem=!0,isItem=!0,u=r.itemList[r.selectedIndex],_.isFunction(this.cutInSetSelectableItem)&&this.cutInSetSelectableItem(u))return!1;this.setState(0,"value",u.value);this.setState(0,"label",u.realLabel);this.setState(0,"labelText",u.label);this.setState(0,"type",u.type);this.setState(0,"dataType1",u.dataType1);this.setState(0,"dataType2",u.dataType2);this.setState(0,"tabCd",u.tabCd);this.setState(0,"tabType",u.tabType);this.setState(0,"sno",u.sno)}if(_.isFunction(this.sumIfCallBack)&&!_.isNil(r.selectedIndex))this.sumIfCallBack(u.value,!0);else this.onKeyDownEnterHandler(n,t,r)},ON_KEYDOWN_F8:function(){this.ON_FOCUSOUT.apply(this,arguments);ecount.layer.clear()},ON_KEYDOWN_ARROW_RIGHT:function(n,t,i,r){r.isNext=!0;this.onKeyDownArrowHandler(n,t,i,r)},ON_KEYDOWN_ARROW_LEFT:function(n,t,i,r){r.isNext=!1;this.onKeyDownArrowHandler(n,t,i,r)},ON_KEYDOWN_ARROW_DOWN:function(){return!1},ON_KEYDOWN_ARROW_UP:function(){return!1},ON_KEYDOWN_ARROW_RIGHT_SERVICE:function(n,t,i,r){r.isNext=!0;this.onKeyDownArrowHandler(n,t,i,r)},ON_KEYDOWN_ARROW_LEFT_SERVICE:function(n,t,i,r){r.isNext=!1;this.onKeyDownArrowHandler(n,t,i,r)},ON_CLICK:function(n,t,i,r){switch(n.handler){case ECountEvent.Type.CLICK_CONTROL:this.onClickHandler(n,t,r);break;case ECountEvent.Type.CLICK_BUTTON:this.buttonClickHandler(n,t,r)}this.enableFocus=!0},ON_CLICK_SERVICE:function(n,t,i,r){if(n.ecFunction=="autocomplete"){r.pass=!0;var u=r.itemList[r.selectedIndex];if(_.isFunction(this.cutInSetSelectableItem)&&this.cutInSetSelectableItem(u))return!1;if(this.setState(0,"value",u.value),this.setState(0,"label",u.realLabel),this.setState(0,"labelText",u.label),this.setState(0,"type",u.type),this.setState(0,"dataType1",u.dataType1),this.setState(0,"dataType2",u.dataType2),this.setState(0,"tabCd",u.tabCd),this.setState(0,"tabType",u.tabType),this.setState(0,"sno",u.sno),_.isFunction(this.sumIfCallBack)&&!_.isNil(r.selectedIndex))this.sumIfCallBack(r.itemList[r.selectedIndex].value,!0);else this.onKeyDownEnterHandler(n,t,r);this.enableFocus=!0}},ON_FOCUSIN:function(n,t,i,r){var u=this.getLayerServiceKey(n,t);n.ecService=="layer.autocomplete"&&n.value!==""&&(ecount.layer.clear(u),ecount.layer.update(ec$.safeCall(this,"getLayerAutocompleteOption",n,t,i,r)));this.enableFocus=!1},ON_INPUT:function(n,t,i,r){var u=this.getLayerServiceKey(n,t);n.ecService=="layer.autocomplete"&&n.value!==""&&(ecount.layer.clear(u),ecount.layer.update(ec$.safeCall(this,"getLayerAutocompleteOption",n,t,i,r)))},ON_MOUSEDOWN_SERVICE:function(n,t,i,r){this.isClickService=!0;this.ON_CLICK_SERVICE(n,t,i,r)},ON_FOCUSOUT:function(n,t,i,r){var u=this.getState(this._IT_SELF,"labelEdit"),f=this.getState(this._IT_SELF,"inputEdit");if(r.isFocusOut=!0,r.selectedItem=!1,!this.isClickService){if(this.enableFocus&&!this.isEnter&&u.editable)this.onKeyDownEnterHandler(n,t,r);if(!this.isEnter&&!u.editable&&n.value!=="")this.onKeyDownEnterHandler(n,t,r)}this.isEnter=!1;this.enableFocus=!0;this.isClickService=!1},ON_MOUSEDOWN:function(n){switch(n.ecRole){case"code.itemlabel":this.enableFocus=!1}switch(n.ecFunctionId){case"input.remove":this.enableFocus=!1}},onClickHandler:function(n){switch(n.ecRole){case"code.itemlabel":var t=this._triggerLabelClick(_.parseInt(n.ecRoleIndex));t||(this._setTargetChangeText(!0,!0,_.parseInt(n.ecRoleIndex),!0),this._setInputFocus(!0));break;case"code.container":case"input.container":this._setTargetChangeText(!1,!1,-1);this._setInputFocus(!0)}},_triggerLabelClick:function(n){var t=this.getState(this._IT_SELF,"list"),i;if(n!==-1&&this.labelClickCallBack)return i={value:t[n].value,type:t[n].type,dataType1:t[n].dataType1,dataType2:t[n].dataType2,tabCd:t[n].tabCd,tabType:t[n].tabType,sno:t[n].sno,index:n},!$.isNull(i)&&["11","2","10","18","19"].contains(i.type)&&i.value!=","?((i.type==="18"||i.type==="19")&&_.merge(i,{numberCalcId:t[n].numberCalcId}),this.labelClickCallBack(i,this),!0):!1},toggleMoreBtn:function(){var n=this.getState(this._IT_SELF,"toggleMoreBtn");this.setState(this._IT_SELF,"toggleMoreBtn",!n)},onKeyDownEnterHandler:function(n,t,i){var s;this.isEnter=!0;var r=this.getState(this._IT_SELF,"labelEdit"),f=this.getState(this._IT_SELF,"listLength"),e=!1,u=this.getState(0,"value"),h=this.getState(this._IT_SELF,"list"),c,o;return n.shiftKey&&n.which!=119?(this.resetState(),!0):this.customizeKeyDownValidate&&!this.customizeKeyDownValidate(n.oType,n.value)?!1:(this.customizeValue&&(u=this.customizeValue(u)),(this.keyDownEnterBeforeValidate(u,r.index)||i.pass)&&(this._isJoinString&&!r.editable&&(o=h.find(function(n){return n.value===u&&n.type=="1"})),o||(r&&r.editable&&i.selectedItem!=!0&&!i.hasAutocompleteFocus&&(s=this.getAutoCompleteCode(u),s?(this.resetState(),this.setStateList(s)):this.isSomeAutoCompleteCodeByType(this.getState(0,"type"))&&this.resetState(null,"value")),this._setData(!1,i),r=this.getState(this._IT_SELF,"labelEdit"),f=this.getState(this._IT_SELF,"listLength"),f>r.index+1&&r.index+1!==0?this._setTargetChangeText(!1,!0,++r.index,!1):this._setTargetChangeText(!1,!0,-1),e=!0)),_.isString(u)&&_.isEmpty(u)&&(c=r.index+1===f?-1:r.index+1,this._setTargetChangeText(!1,!1,f,!1),e=!1),this.keyDownEnterAfterValidate()?(this.hasError()&&this.hideError(),i.isFocusOut?this.resetState():o&&!r.editable?this.showError(this._IT_SELF,ecount.resource.MSG01736,!0,!1,!0):this.showError(this._IT_SELF,ecount.resource.MSG00409,!0,!1,!0)):this.hasError()&&this.hideError(),this.isEnter=!1,this.enableFocus=!0,this._setInputFocus(e),e)},keyDownEnterBeforeValidate:function(n,t){var r=this.getState(this._IT_SELF,"list"),i=t>=0?r[t]?r[t].label:"":"",u;return(i=ecount.resource[i]?ecount.resource[i]:i,u=this._autocompleteList.find(function(t){return t.value===n}),u)?!0:i===n||!this._isJoinString&&$.isNumber(n)},getAutoCompleteCode:function(n){return this._autocompleteList&&this._autocompleteList.length>0?this._autocompleteList.find(function(t){return t.value===n}):null},isSomeAutoCompleteCodeByType:function(n){return this._autocompleteList&&this._autocompleteList.length>0?this._autocompleteList.some(function(t){return t.type===n}):!1},setStateList:function(n){_.isObjectLike(n)&&(this.setState(0,"value",n.value),this.setState(0,"label",n.realLabel||n.label||""),this.setState(0,"labelText",n.label||""),this.setState(0,"type",n.type),n.dataType1&&this.setState(0,"dataType1",n.dataType1),n.dataType2&&this.setState(0,"dataType2",n.dataType2),n.tabCd&&this.setState(0,"tabCd",n.tabCd),n.tabType&&this.setState(0,"tabType",n.tabType),n.sno&&this.setState(0,"sno",n.sno))},keyDownEnterAfterValidate:function(){return this.getState(0,"value").length>0},onKeyDownArrowHandler:function(n,t,i,r){var s=r.isNext,u=this.getState(this._IT_SELF,"labelEdit"),e=this.getState(this._IT_SELF,"listLength"),o=this.getLayerServiceKey(n,t),f;o&&ecount.layer.hide(o);this.enableFocus=!1;u.index<0&&(u.index=e);f=s?u.editable?u.index+1:u.index:u.index-1<0?0:u.index-1;this.ecview._hasCursorMove(r.isNext)&&(e>f&&f>=0?this._setTargetChangeText(!0,!0,f,!0):this._setTargetChangeText(!1,!1,-1),_.defer(function(){this._setInputFocus(!0);this.enableFocus=!0}.bind(this)))},reflowContainer:function(n){this.setState(this._IT_SELF,"reflowContainer",n?n:!0,!0)},buttonClickHandler:function(n){switch(n.ecFunctionId){case"input.remove":this.removeItem();break;case"code.removeall":this.removeItemAll();break;case"button.more":this.toggleMoreBtn()}},removeItem:function(n){!_.isUndefined(n)&&_.isNumber(n)&&this.setState("UPDATE_IT_SELF","inputEdit",{editable:!0,index:n});var t=this.getState(this._IT_SELF,"inputEdit");this._setTargetChangeText(!1,!1,-1);this._removeItem(this._IT_SELF,t.index);this.resetState()},removeItemAll:function(){this._setTargetChangeText(!1,!1,-1);this._removeItemAll();this.resetState()},resetState:function(n,t){var i=["value","label","labelText","type","dataType1","dataType2","tabCd","tabType","sno"],r;for(i=_.isString(n)?[n]:_.isArray(n)&&n.length>0?n:i,t=_.isString(t)?[t]:_.isArray(t)&&t.length>0?t:[],r=0;r<i.length;r++)t.length>0&&~_.indexOf(t,i[r])||this.setState(0,i[r],"")},_setTargetChangeText:function(n,t,i,r){var u,f,e,o,s,h,c,l,a,v;this.getRequiredCheckPass()&&i<2&&(n=!1,t=!1,i=-1,r=null);u=this.getState(this._IT_SELF,"list");f=_.parseInt(i)>=0?u[i]?u[i].label:"":"";e=ecount.resource[f]?ecount.resource[f]:f;o=_.parseInt(i)>=0?u[i]?u[i].value:"":"";s=_.parseInt(i)>=0?u[i]?u[i].type:"":"";h=_.parseInt(i)>=0?u[i]?u[i].dataType1:"":"";c=_.parseInt(i)>=0?u[i]?u[i].dataType2:"":"";l=_.parseInt(i)>=0?u[i]?u[i].tabCd:"":"";a=_.parseInt(i)>=0?u[i]?u[i].tabType:"":"";v=_.parseInt(i)>=0?u[i]?u[i].sno:"":"";r&&this._setData(r);this.setState(this._IT_SELF,"inputEdit",{editable:t,index:i});this.setState(this._IT_SELF,"labelEdit",{editable:n,change:r,index:i});n?r?(this.setState(0,"value",o),this.setState(0,"label",f),this.setState(0,"labelText",e),this.setState(0,"type",s),this.setState(0,"dataType1",h),this.setState(0,"dataType2",c),this.setState(0,"tabCd",l),this.setState(0,"tabType",a),this.setState(0,"sno",v)):this.resetState():this.resetState();this.setState("remove","style.display",n)},_setData:function(n,t){var i=this.getState(0,"value"),r=this.getState(0,"label");r=r===""?i:r;var e=this.getState(0,"labelText"),u=this.getState(0,"type"),o=this.getState(0,"dataType1",""),s=this.getState(0,"dataType2",""),h=this.getState(0,"tabCd",""),c=this.getState(0,"tabType",""),l=this.getState(0,"sno",""),f=this.getState(this._IT_SELF,"labelEdit"),a=this.getState(this._IT_SELF,"listLength");!u&&t&&_.isBoolean(t.selectedItem)&&!t.selectedItem&&(r=i,u=Number(i)?3:this.getState(0,"typeFromLayer")?this.getState(0,"typeFromLayer"):3,e="",this.setState(0,"typeFromLayer",""));_.isString(i)&&!_.isEmpty(i)&&(n?f.editable:f.editable?(u==3&&i!=r&&(r=i,e=i),this._updateItem(this._IT_SELF,f.index,{value:i,label:r,type:u?u.toString():"3",labelText:e,dataType1:o,dataType2:s,tabCd:h,tabType:c,sno:l})):(f.index<0&&(f.index=a),this._insertItem(this._IT_SELF,{value:i,label:r,type:u?u.toString():"3",labelText:e,dataType1:o,dataType2:s,tabCd:h,tabType:c,sno:l},f.index)))},_setInputFocus:function(n){this.setState(0,"style.focus",n,!0);this.reflowContainer()}});ecount.class("ecount.control.view.calc","ecount.control.view",{template:['<div class="tags-input">','<div class="input-height-fixed">','<div data-role="code.container">',"{{itemList}}",'<div class="tags-input-typeahead" data-role="input.container">',"((input))","<\/div>","[[remove]]","<\/div>","<\/div>","<\/div>","[[more]]","[[removeall]]",].join(""),htmlTemplate:'<span data-role="code.itemlabel" data-cid="{{cid}}" data-role-index={{index}}  data-label="{{label}}" class="tag label label-primary label-light">{{label}}<\/span>\r\n',removeallTemplate:'<button class="btn btn-default btn-remove {{style.display}}" data-cid="{{cid}}" data-function="{{ecFunction}}" data-function-id="{{ecFunctionId}}"><\/button>',removeTemplate:'<button class="btn btn-default btn-remove hidden" data-cid="{{cid}}" data-function="{{ecFunction}}" data-function-id="{{ecFunctionId}}"><\/button>',moreTemplate:'<button class="btn btn-default btn-ellipsis hidden" data-cid="{{cid}}" data-function="{{ecFunction}}" data-function-id="{{ecFunctionId}}"><\/button>',init:function(){ecount.control.view.prototype.init.apply(this,arguments)},render:function(){ecount.control.view.prototype.render.apply(this,arguments)},onInitTemplate:function(n,t){var i=this.getListTemplate(t.list);return n.replace(/{{itemList}}/,i)},onMount:function(){_.defer(this.onChangeReflowContainer.bind(this))},getListTemplate:function(n){var u="",r,i="",t;if(n)for(t=0;t<n.length;t++)r=ecount.resource[n[t].label||""]?ecount.resource[n[t].label||""]:n[t].label,n[t].type=="9"&&[160,32].contains(n[t].value.charCodeAt(0))&&(r=" "),i=this.htmlTemplate.replaceAll(/{{label}}/,r),i=i.replace("{{index}}",t),i=i.replace("{{cid}}","label_"+t),u+=i;return u},updateListTemplate:function(n){var t=this.$el.find('[data-role="code.container"]');t.find("[data-label]").remove();t.prepend(this.getListTemplate(n))},showAllLabel:function(){var n=this.$el.find('[data-role="code.container"]'),t=n.find("[data-label]");t.show()},_hasCursorMove:function(n){var t=this.getElements(0);return t.val()==""||t[0].selectionStart==t[0].selectionEnd&&(n?t[0].selectionEnd==t.val().length:t[0].selectionStart==0)},onChangeList:function(n,t){this.updateListTemplate(t)},onChangeLabelEdit:function(n,t){var r=this.$el.find('[data-role="code.container"]'),i=r.find("[data-role-index="+t.index+"]");t.change?i.hide():i.show()},onChangeInputEdit:function(n,t){var u=this.$el.find('[data-role="code.container"]'),i=this.$el.find('[data-role="input.container"]'),e=this.$el.find('[data-function-id="input.remove"]'),f,r=t.index;this.showAllLabel();r>=0&&(f=u.find("[data-role-index="+r+"]"),f.before(i),i.after(e));r<0&&u.append(i)},onChangeStyleDisplayRemove:function(n){var t=this.$el.find('[data-function-id="input.remove"]');n?t.removeClass("hidden"):t.addClass("hidden")},onChangeStyleDisplayRemoveall:function(n){var t=this.$el.find('[data-function-id="code.removeall"]');n?t.removeClass("hidden"):t.addClass("hidden")},onChangeLabelText:function(n,t){_.isEqual(t,"&nbsp;")&&(t=_.replace(t,"&nbsp;"," "));_.includes(t,"<\/br>")&&(t=_.replace(t,"<\/br>",""));this.getElements(0).val(t)},onChangeStyleFocus:function(n,t){var i=this.getElements(0);t&&i.focus().select()},onChangeReflowContainer:function(n,t){var r=this.getElements().find('[data-role="code.container"]'),i=this.$el.find('[data-function-id="button.more"]');t=_.isNumber(t)||r.height();t>35?i.hasClass("hidden")&&(i.removeClass("hidden"),r.parent().removeClass("input-height-fixed")):i.hasClass("hidden")||(i.addClass("hidden"),r.parent().addClass("input-height-fixed"))},onChangeToggleMoreBtn:function(n,t){var i=this.getElements().find('[data-role="code.container"]');t?i.parent().removeClass("input-height-fixed"):i.parent().addClass("input-height-fixed")}});ecount.class("ecount.control.flowSlide","ecount.control",{ecPackage:"ecount.control.flowSlide",init:function(){ecount.control.prototype.init.apply(this,arguments)},render:function(){ecount.control.prototype.render.apply(this,arguments)},initializeOptions:function(n){_.extend(this,{hasDropdown:n.hasDropdown,dropdownAdditionalOptions:n.dropdownAdditionalOptions,dropdownOptions:n.ownDropdownOptions||n.dropdownOptions})},onInitState:function(n,t){t.components?t.useWrapperTemplate=t.components.length>1:t.components=[{}]},onInitComponent:function(n,t,i,r,u){var o="",s="",f="",e=u&&u.customColor?u.customColor:"";i.components.length>1?(f+="event-target ",ecount.common.isTrue(u.isDynamic)||(o+=" label-group-collapse")):i.components.length===1&&(o+="label-group-block",ecount.common.isFalse(u.noEllipsisCss)&&(s="label-group-no-ellipsis"));this.dropdownOptions&&this.dropdownOptions[r.id]&&(r.ecService="layer.dropdown",r.ecServiceAttr="layer.fixed");r["style.css"]=o;r["style.noEllipsis"]=s;switch(r.buttonType){case"gray":f+="label-default";break;case"lightGray":f+="label-muted";break;case"warning":f+="label-warning";break;case"light":f+="label-primary label-light";break;case"inverse":f+="label-primary label-inverse";break;case"noBackground":e||(e="initial");break;default:f+="label-primary"}r.color=e?"style='color: "+e+";'":"";r["style.buttonType"]=f},getLayerDropdownOption:function(n,t){var i=this.dropdownOptions[n.id],r=+n.cindex||0;return $.extend(this.getLayerDefaultOption(n,t),{items:i||[],boundary:this.getComponentBoundary(r),baseType:!0,cid:n.cid,cindex:n.cindex},this.dropdownAdditionalOptions)},ON_CLICK:function(n,t,i,r){r&&(r.childId=n.id)}});ecount.class("ecount.control.view.flowSlide","ecount.control.view",{template:"((flowSlide))",labelWrapperTemplate:"<div class='wrapper-label-group-proceed-step'>((this.template))<\/div>",baseTemplateType:!0,init:function(){ecount.control.view.prototype.init.apply(this,arguments)},render:function(){ecount.control.view.prototype.render.apply(this,arguments)},onInitWrapperTemplate:function(n,t){return t.useWrapperTemplate?n.replace("((this.template))",this.labelWrapperTemplate):n}});ecount.class("ecount.control.flowSignalLamp","ecount.control",{ecPackage:"ecount.control.flowSignalLamp",init:function(){ecount.control.prototype.init.apply(this,arguments)},render:function(){ecount.control.prototype.render.apply(this,arguments)},onInitState:function(n,t,i){var u,f,r;for(t.components||(t.components=[{}]),u=[],r=0;r<i.lampCount;r++)f={index:r},r==i.activeIndex&&(f[i.isActive?"isActive":"isActiveDanger"]=!0,t.activeIndex=r),u.push(f);t["style.cursor"]=i.isCursor?"cursor-pointer":"";t.label=i.label;t.itemList=u},onInitComponent:function(){},initializeViewOptions:function(){$.extend(this.__viewOptions,{})},getActiveIndex:function(){return this.getState(this._IT_SELF,"activeIndex")},turnOnLamp:function(n,t){var i=Object.clone(this.getState(this._IT_SELF,"itemList"),!0);i[n]&&(this._turnOffActiveLamp(n,i),i[n].isActive=t!==!0,i[n].isActiveDanger=t===!0);this.setState(this._IT_SELF,"itemList",i)},_turnOffActiveLamp:function(n,t){var i=this.getState(this._IT_SELF,"activeIndex");t[i]&&(t[i].isActive=!1,t[i].isActiveDanger=!1);this.setState(this._IT_SELF,"activeIndex",n)}});ecount.class("ecount.control.view.flowSignalLamp","ecount.control.view",{template:'<ul data-cid="{{cid}}" class="wrapper-circle-progress {{style.cursor}}">{{itemList}}<\/ul><span>{{label}}<\/span>',itemTemplate:'<li data-role="{{ecRole}}" data-role-index="{{index}}" data-cid="{{cid}}" class="{{class}}"><\/li>',init:function(){ecount.control.view.prototype.init.apply(this,arguments)},render:function(){ecount.control.view.prototype.render.apply(this,arguments)},onInitTemplate:function(n,t){var i=this.getListTemplate(t);return n.replace(/{{itemList}}/,i)},getListTemplate:function(n){return n.itemList.reduce(function(t,i){var r=this.itemTemplate;return r=r.replace("{{ecRole}}",n.ecRole||""),r=r.replace("{{index}}",i.index),r=i.isActive||i.isActiveDanger?r.replace("{{class}}",i.isActive?"active":"active danger"):r.replace("{{class}}",""),t+r}.bind(this),"")},onChangeItemList:function(n,t){var i=t.find(function(n){return n.isActive||n.isActiveDanger})||{},r=this.$el.find(".active, .active.danger"),u=this.$el.find("li[data-role-index="+i.index+"]");r.removeClass("active danger");u.addClass(i.isActive?"active":"active danger")}});ecount.class("ecount.control.flowOrder","ecount.control",{ecPackage:"ecount.control.flowOrder",init:function(){ecount.control.prototype.init.apply(this,arguments)},render:function(){ecount.control.prototype.render.apply(this,arguments)},initializeOptions:function(n){_.extend(this,{hasDropdown:n.hasDropdown,dropdownAdditionalOptions:n.dropdownAdditionalOptions,executeToggle:n.executeToggle||!0,continuePropagation:n.continuePropagation||!0,useToggleMode:n.useToggleMode||!0,useDropdownLayerFlag:n.useDropdownLayer})},initializeViewOptions:function(n){$.extend(this.__viewOptions,{labelLight:n.labelLight===!1?!1:!0})},onInitState:function(n,t,i){t.components||(t.components=[{}]);_.extend(t,{dropdownOptions:i.ownDropdownOptions||i.dropdownOptions,useArrowButton:i.useArrowButton,dropDownVersion:i.dropDownVersion,directShow:i.directShow,popoverType:i.popoverType})},onInitComponent:function(n,t,i,r){var f=parseInt(r.numberStatement),e=this.getState(this._IT_SELF,"dropdownOptions"),u=!0;_.isBoolean(this.useDropdownLayerFlag)?u=this.useDropdownLayerFlag:_.isEmpty(this.useDropdownLayerFlag)||_.isEmpty(this.useDropdownLayerFlag[r.id])||(u=this.useDropdownLayerFlag[r.id]);e&&e[r.id]&&(r.ecService="layer.dropdown",r.ecServiceAttr="layer.fixed",r.useBookMark=_.isBoolean(r.useBookMark)?r.useBookMark:!1,r.isShow=_.isBoolean(r.isShow)?r.isShow:!0,r.isWrite=_.isBoolean(r.isWrite)?r.isWrite:!0,r.isShade=_.isBoolean(r.isShade)?r.isShade:!1,r.useNumberStatement=_.isBoolean(r.useNumberStatement)?r.useNumberStatement:!0,r.numberStatement=_.isNaN(f)?0:f,r.useDropdownLayer=u)},useDropdownLayer:function(){var t=[].slice.call(arguments),n=t.shift(),i,r,u;_.isBoolean(n)?(i=this.getComponents(),i.forEach(function(t,i){this.setState(i,"useDropdownLayer",n)}.bind(this))):_.isString(n)&&(r=t.shift(),u=this.getComponentById(n),this.setState(u.index,"useDropdownLayer",r))},getDropdownOptions:function(){return this.getState(this._IT_SELF,"dropdownOptions")},setDropdownOptions:function(n,t){if(_.isEmpty(n)||_.isNil(t))return!1;var i=this.getState(this._IT_SELF,"dropdownOptions");i[n]=t;this.setState(this._IT_SELF,"dropdownOptions",i)},getExtraData:function(n){var t=_.isArray(this.getComponents())&&this.getComponents().filter(function(t){return t.id===n})[0];return t&&t.extraData},setExtraData:function(n,t){if(_.isEmpty(n)||_.isEmpty(t))return!1;var i=_.isArray(this.getComponents())&&this.getComponents().map(function(n,t){return n.index=t,n}).filter(function(t){return t.id===n})[0].index;this.setState(i,"extraData",t)},setButtonType:function(n,t){if(_.isEmpty(n)||!_.isString(t))return!1;var i=this.getComponentById(n);this.setState(i.index,"buttonType",t)},useNumberStatement:function(n,t){if(_.isEmpty(n)||!_.isBoolean(t))return!1;var i=this.getComponentById(n);this.setState(i.index,"useNumberStatement",t)},setNumStatement:function(n,t){if(_.isEmpty(n)||!_.isNumber(parseInt(t)))return!1;var i=this.getComponentById(n);this.setState(i.index,"numberStatement",t)},setPencilIcon:function(n,t){if(_.isEmpty(n)||!_.isBoolean(t))return!1;var i=this.getComponentById(n);this.setState(i.index,"isWrite",t)},getBookMarkedId:function(){return this.getComponents().filter(function(n){return n.useBookMark}.bind(this))[0].id},setBookMark:function(n,t){if(_.isEmpty(n))return!1;var i=this.getComponentById(n);i&&this.setState(i.index,"useBookMark",t)},getComponentById:function(n){var i=this.getComponents(),r,t=[];return i.length>=0&&(t=i.filter(function(t){return t.id===n})),t.length>=1&&(r=t[0]),r},getLayerDropdownOption:function(n,t){if(n.ecFunctionId==="button_pencil")return{continuePropagation:!1};var r=this.getState(this._IT_SELF,"dropdownOptions"),i=r[n.id],u=+n.cindex||0;return $.extend(this.getLayerDefaultOption(n,t),{ownerTargetId:n.id,hasOption:i&&i.length===0?!1:!0,useToggleMode:this.useToggleMode,executeToggle:this.executeToggle,continuePropagation:this.continuePropagation,items:i||[],boundary:this.getComponentBoundary(u),baseType:!0,cid:n.cid,cindex:n.cindex},this.dropdownAdditionalOptions)},onLazyRender:function(){var n;this.ecview&&(n=this.getComponents()||[],n.forEach(function(n,t){this.ecview.setAllPopover(n,t)}.bind(this)))},ON_CLICK:function(n,t,i,r){(n.ecFunctionId==="arrowButtonLeft"||n.ecFunctionId==="arrowButtonRight")&&this.ecview.moveOrderBox(n.ecFunctionId==="arrowButtonLeft"?"left":"right");r.id=n.id;r.targetID=n.ecFunctionId==="button_pencil"?"button-pencilIcon":n.id;r.ecFunctionId=n.ecFunctionId;r.extraData=this.getExtraData(n.id);r.command="on"+_.upperFirst(this.containerName)+_.upperFirst(this.id)},resizeControl:function(n){this.ecview&&this.ecview.resizeControl(n)}});ecount.class("ecount.control.view.flowOrder","ecount.control.view",{template:'<div class="{{templateCss}} {{isShow}} {{isFirst}}" data-seq="{{menuSeq}}" data-is-hidden="false"><span class="{{style.labelType}}" id="{{id}}" data-index="{{index}}" data-cid="{{cid}}" data-service="{{ecService}}" data-service-attr="{{ecServiceAttr}}">{{label}}<span class="label-group-option"><span id="{{id}}" data-index="{{index}}" data-cid="{{cid}}" class="numberStatement {{isHideNumberStatement}}">({{numberStatement}})<\/span><a href=\'javascript:;\' class="{{style.isWrite}}" id="{{id}}" data-index="{{index}}" data-cid="{{cid}}" data-function="{{pencilFunction}}" data-function-id="{{pencilFunctionId}}"><\/a><\/span><\/span><span class="label-group-state {{isShowBookMark}}" id="{{id}}_bookMark" data-cid="{{cid}}" data-function="{{bookMarkFunction}}" data-function-id="{{bookMarkFunctionId}}"><\/span>{{itemList}}<\/div>',optionTemplate:'<a href=\'javascript:;\' id="{{id}}" data-cid="{{cid}}" data-index="{{index}}" class="{{style.visible}}"><span class="{{style.optionType}}"><\/span><\/a>',labelWrapperTemplate:'<div class="wrapper-label-group-proceed-step wrapper-label-group-order-mgmt">((this.buttonLeft))((this.template))((this.buttonRight))<\/div>',orderBoxWrapper:'<div class="{{orderBoxWrapperCss}}">((orderBoxList))<\/div>',buttonLeft:['<button class="btn btn-default btn-sm btn-ouline-none btn-arrow-left invisible" data-function="arrowButton" data-function-id="arrowButtonLeft"><\/button>'],buttonRight:['<button class="btn btn-default btn-sm btn-ouline-none btn-arrow-right invisible" data-function="arrowButton" data-function-id="arrowButtonRight"><\/button>'],templateCss:"label-group label-group-proceed-step label-group-order-mgmt",orderBoxWrapperCss:"display-flex overflow-hidden nowrap",pencilIconCss:"label-group-edit",buttonType:[ecount.constValue.buttonType.lightGray,ecount.constValue.buttonType.gray,ecount.constValue.buttonType.primary],compsInfo:null,compsBoxEl:null,arrowButtonsInfo:null,_moveFlag:!0,init:function(){ecount.control.view.prototype.init.apply(this,arguments)},render:function(n){this.popoverType=n.popoverType||"tooltip";this.popoverDirectShow=n.directShow||!1;this.popoverTrigger="hover";this.popoverPlacement="bottom";ecount.control.view.prototype.render.apply(this,arguments)},onInitTemplate:function(n,t){var u=t.components||[],i=[],r;return this.labelLight=t.labelLight,u.forEach(function(r,u){var h=r.isShade?"lightGray":"primary",o="label "+this.changeButtonTypeCss(r.buttonType?r.buttonType:h),f,s,e;o+=" ellipsis";s=this.getItemListHtml(r);e=r.useNumberStatement===undefined?!0:r.useNumberStatement;f=r.isWrite&&e?this.templateCss+" use-label-group-option-dual":this.templateCss;f=r.useDropdownLayer?f+" label-group-hover":f;i.push(ecount.widget.replaceAttr(n,{id:r.id,templateCss:f,isShow:r.isShow?"":"hidden",isFirst:u===0?"first-child":"",menuSeq:u,isHideNumberStatement:e?"":"hide",numberStatement:r.numberStatement,label:r.label,pencilFunction:"button",pencilFunctionId:"button_pencil","id-pencil":r.id+"_pencil",bookMarkFunction:"label",bookMarkFunctionId:"bookMark",isShowBookMark:r.useBookMark?"":"hide",itemList:!t.dropDownVersion?s:"",ecService:r.useDropdownLayer?r.ecService:"",ecServiceAttr:r.ecServiceAttr,"style.labelType":o,"style.isWrite":r.isWrite?this.pencilIconCss:""}))}.bind(this)),r=i.map(function(n,t){return n.replace(/{{index}}/g,t)}).join(""),t.useArrowButton?(this.labelWrapperTemplate=this.labelWrapperTemplate.replace("((this.buttonLeft))",this.buttonLeft).replace("((this.buttonRight))",this.buttonRight),this.orderBoxWrapper=ecount.widget.replaceAttr(this.orderBoxWrapper,{orderBoxWrapperCss:this.orderBoxWrapperCss})):this.labelWrapperTemplate=this.labelWrapperTemplate.replace("((this.buttonLeft))","").replace("((this.buttonRight))",""),this.orderBoxWrapper.replace("((orderBoxList))",r)},onInitWrapperTemplate:function(n){return n.replace("((this.template))",this.labelWrapperTemplate)},getItemListHtml:function(n){var t=["<ul>"],r=this.optionTemplate,i=n.itmeList;return(!i&&$.isArray(n.optionList)&&n.optionList.length>0&&(i=[{optionList:n.optionList}]),!i||i.length<1)?"":(i.forEach(function(i,u){t.push("<li>");i.optionList.forEach(function(i,f){var s=[n.id,u,"option"].join("_")+f,e,o;switch(i.type){case"search":e="fa fa-search";break;case"connect":e="fa fa-chain";break;case"complete":e=i.isComplete?"fa fa-check":"fa fa-times"}o=i.visible===!1?"invisible":"visible";e&&t.push(ecount.widget.replaceAttr(r,{id:s,"style.visible":o,"style.optionType":e}))});t.push("<\/li>")}),t.push("<\/ul>"),t.join(""))},setAllPopover:function(n,t){var u=this.$el,r=u.find("div[data-seq="+t+"]"),f=r.find("a[id="+(n.id+"_label")+"]"),i=n.itemList||[];i.length===0&&$.isArray(n.optionList)&&n.optionList.length>0&&(i=[{optionList:n.optionList}]);this._setItemPopover(n.message,f);i.forEach(function(t,i){t.optionList.forEach(function(t,u){var f=[n.id,i,"option"].join("_")+u,e=r.find("a[id="+f+"]");this._setItemPopover(t.message,e)}.bind(this))}.bind(this))},_setItemPopover:function(n,t){!$.isEmpty(n)&&t.length>0&&this.setPopover({popoverType:this.popoverType,popoverMessage:n},t)},onChangeUseDropdownLayer:function(n,t){var i=this.getElements(n);i[0].dataset.service=t?"layer.dropdown":""},onChangeUseNumberStatement:function(n,t){var i=this.getElements(n),r=$(i).find(".numberStatement"),u=i.hasClass(this.pencilIconCss);t?(r.show(),r.removeClass("hide"),u&&i.eq(0).parent().addClass("use-label-group-option-dual")):(r.hide(),r.addClass("hide"),u&&i.eq(0).parent().removeClass("use-label-group-option-dual"))},onChangeNumberStatement:function(n,t){var i=this.getElements(n),r="("+t+")";$(i).find(".numberStatement").html(r)},onChangeButtonType:function(n,t){var i=this.getElements(n).eq(0);this.buttonType.forEach(function(n){i.removeClass(this.changeButtonTypeCss(n))}.bind(this));i.addClass(this.changeButtonTypeCss(t))},onChangeIsWrite:function(n,t){var i=this.getElements(n),r=i.find("a#"+i.attr("id")),u=!$(i).find(".numberStatement").hasClass("hide");t?(r.addClass(this.pencilIconCss),u&&i.eq(0).parent().addClass("use-label-group-option-dual")):(r.removeClass(this.pencilIconCss),u&&i.eq(0).parent().removeClass("use-label-group-option-dual"))},onChangeUseBookMark:function(n,t){var r=this.getElements(n),i=this.$el.find("span[data-function-id='bookMark']");t?i[n].classList.remove("hide"):i[n].classList.add("hide")},changeButtonTypeCss:function(n){var t="";switch(n){case ecount.constValue.buttonType.lightGray:t="label-muted ";break;case ecount.constValue.buttonType.gray:t="label-default ";break;case ecount.constValue.buttonType.primary:t="label-primary "+(this.labelLight?"label-light ":"");break;default:t="label-primary "+(this.labelLight?"label-light ":"")}return t},getCompsInfo:function(){var t;if(!this.compsInfo){var f=this.getElements(),r=f.find("."+this.templateCss.split(" ").join(".")),u=[],n=null,i=null;for(t=0;t<r.length;t++)n=r.eq(t),i=n.outerWidth(!0),u.push({el:n,width:i,hyphen:i-n.width()});this.compsInfo=u}return this.compsInfo},resetCompsInfo:function(){this.compsInfo=null},getCompsBoxEl:function(){return this.compsBoxEl||(this.compsBoxEl=this.getElements().find(".display-flex.overflow-hidden.nowrap")),this.compsBoxEl},getArrowButtonsInfo:function(){if(!this.arrowButtonsInfo){var n=this.getElements().find(".btn-arrow-left"),t=this.getElements().find(".btn-arrow-right");this.arrowButtonsInfo={leftEl:n,rightEl:t,leftOuterWidth:20,rightOuterWidth:20}}return this.arrowButtonsInfo},setArrowButtonDisplay:function(n,t){var i=this.getArrowButtonsInfo();n===!0?i.leftEl.removeClass("invisible"):i.leftEl.addClass("invisible");t===!0?i.rightEl.removeClass("invisible"):i.rightEl.addClass("invisible")},resizeControl:function(n){var t,u,s;if(this.maxWidthSize=n?n:this.maxWidthSize,!this.maxWidthSize)return!1;var r=this.getCompsInfo(),l=this.getCompsBoxEl(),h=this.getArrowButtonsInfo(),c=h.leftOuterWidth+h.rightOuterWidth,i=this.getVisibleFirstCompIndex(),f=0,o=0,e=r.map(function(){return!1},this);for(f=r[i].width-(i===0?0:r[i].hyphen),e[i]=!0,t=i+1;t<r.length;t++)u=r[t],this.maxWidthSize>c+f+u.width&&(f+=u.width,e[t]=!0);if(i!==0)for(o=r[i].hyphen,t=i-1;t>=0;t--)u=r[t],s=u.width-(t===0?0:u.hyphen),this.maxWidthSize>c+f+o+s&&(f+=s+o,o=u.hyphen,e[t]=!0);l.width(f);this.setArrowButtonDisplay(e[0]===!1,e[e.length-1]===!1)},getVisibleFirstCompIndex:function(n){for(var r,i=this.getCompsInfo(),o=this.getCompsBoxEl(),u=o.scrollLeft(),f=0,e=0,t=0;t<i.length;t++){if(r=f+i[t].hyphen,u<r+5&&u>r-5){e=n==="left"?t===0?0:t-1:n==="right"?t+1>i.length-1?i.length-1:t+1:t;break}f+=i[t].width}return e},moveOrderBox:function(n){var u,o;if(n!=="left"&&n!=="right"||this._moveFlag===!1)return!1;var r=this.getCompsInfo(),f=this.getCompsBoxEl(),e=f.width(),t=this.getVisibleFirstCompIndex(n),i=0;t!==0&&(i=r.slice(0,t).reduce(function(n,t){return n+t.width},0)+r[t].hyphen);u=r.reduce(function(n,t){return n+t.width},0);o=u>i+e-5&&u<i+e+5;this.setArrowButtonDisplay(t!==0,!o);this._moveFlag=!1;f.stop().animate({scrollLeft:i},400,function(){this._moveFlag=!0}.bind(this))}});ecount.class("ecount.control.textEditor.e01","ecount.control.textEditor",{ecPackage:"ecount.control.textEditor.e01",_imagePopupPath:"/ECERP/SVC/ENT/ENT007M",sExtentionType:"jpg,jpeg,gif,tif",storageEndpoint:"/ECAPI/Common/Infra/SaveTempFile",versionCheckApi:"/Groupware/File/CheckFileSize",_maxFileCount:1,init:function(){this._defaultUploaderConfig={url:"/ECAPI/Common/Infra/SaveTempFile",autostart:!0,chunk_size:ecount.common.parseSize("20mb"),extensions:"jpg, jpeg, gif, tif",dragdrop:!1,attach_file_size:0,max_file_size:ecount.common.parseSize("2gb"),max_file_count:10,multi_selection:!1,prevent_duplicates:!0,multipart_param:{},tot_size_lmt:{size:"1",flag:!1},menu_code:ecenum.filemenuCode.gw03,is_free_groupware:!1};this._defaultNewFileStorageConfig={collection:null,partition:null,comcode:"",owner_key:"",storage_host_number:1,upload_path:"/SaveTempFile/",temp_file_lifetime:ecenum.tempfileLifetime.infinity,severalOwner_key:!0,isOwnerKeyNew:!0};this.defaultParam={AFlag:4};this.options={DtCreateKey:"",UserFlag:"",MaxFileSize:0,UsedFileSize:0,RestFileSize:0,AttachSize:0};ecount.control.textEditor.prototype.init.apply(this,arguments)},initializeOptions:function(n){ecount.control.textEditor.prototype.initializeOptions.apply(this,arguments);var t=n._uploaderConfigs&&n._uploaderConfigs.length>0?n._uploaderConfigs[0][1]:{},i=n._newFileStorageConfigs&&n._newFileStorageConfigs.length>0?n._newFileStorageConfigs[0][1]:{};_.merge(this,{initData:{uploaderConfig:_.merge(!0,this._defaultUploaderConfig,t),newFileStorageConfig:_.merge(!0,this._defaultNewFileStorageConfig,i),usingUploader:!0,usingNewFileStorage:!0,usingAlwaysCreateOwnerkey:!0},isSimpleImageUpload:_.isBoolean(n.isSimpleImageUpload)?n.isSimpleImageUpload:!1})},setUploadConfig:function(n){$.extend(this.options,{DtCreateKey:n.Data.DtCreateKey,UserFlag:n.UserFlag});this.storageEndpoint=n.Data.ImageUploadServiceURL},initializeViewOptions:function(n){ecount.control.textEditor.prototype.initializeViewOptions.apply(this,arguments);_.merge(this.__viewOptions,{initData:this.initData,storageEndpoint:this.storageEndpoint,options:this.options,popupID:n.popupID,popupLevel:n.popupLevel,vmHandler:{_callback:n._callback,setPasteContent:this.setPasteContent.bind(this),showProgressbar:this.showProgressbar.bind(this),hideProgressbar:this.hideProgressbar.bind(this)}})},showProgressbar:function(){this.delegator&&this.delegator.triggerEvent("page.showProgressbar")},hideProgressbar:function(){this.delegator&&this.delegator.triggerEvent("page.hideProgressbar")},ON_KEYDOWN_ENTER:function(n,t){if(this.editorMode===0){if(!t.shiftKey)return n.suspend=!1,n.stopPropagation=!0,!1}else return n.suspend=!1,!1}});ecount.class("ecount.control.textEditor.e02","ecount.control.textEditor",{ecPackage:"ecount.control.textEditor.e02",isSimpleImageUpload:!0,isAllowImagePaste:!0,isMakeSendMessageForm:!0,ptagStyle:"<style unikey='ecountPStyleUnikey'>p{margin-top:0px;margin-bottom:0px;}<\/style>",setUploadConfig:function(n){this.storageEndpoint=n.Data.StorageEndpoint},initializeViewOptions:function(){ecount.control.textEditor.prototype.initializeViewOptions.apply(this,arguments);_.merge(this.__viewOptions,{storageEndpoint:this.storageEndpoint||"",vmHandler:{setPasteContent:this.setPasteContent.bind(this),showProgressbar:this.showProgressbar.bind(this),hideProgressbar:this.hideProgressbar.bind(this)}})},showProgressbar:function(){this.delegator&&this.delegator.triggerEvent("page.showProgressbar")},hideProgressbar:function(){this.delegator&&this.delegator.triggerEvent("page.hideProgressbar")},getValue:function(){var t,n;arguments.length==0?t=!1:arguments.length==1&&(t=arguments[0]);try{n=this.ecview.getViewValue()}catch(i){n=this.getOriginValue()}return n=this.editorMode==1?n.replace(/\s+$/,"").replace(/(<p><br><\/p>)$/,""):n,n=ecount.common.getNoScriptByHtml(n),n=ecount.common.getRemoveTagAndContent(n,["noframes","noscript","noembed","meta","iframe","script"]),this.isMakeSendMessageForm!==!0||t||n.indexOf("ecountPStyleUnikey")<0&&(n=this.ptagStyle+n),n}});ecount.class("ecount.control.textEditor.e03","ecount.control.textEditor",{ecPackage:"ecount.control.textEditor.e03",isSimpleImageUpload:!0,isAllowImagePaste:!0,isMakeSendMessageForm:!0,ptagStyle:"<style unikey='ecountPStyleUnikey'>p{margin-top:0px;margin-bottom:0px;}<\/style>",setUploadConfig:function(n){this.storageEndpoint=n.Data.StorageEndpoint},init:function(){this._defaultUploaderConfig={url:"/ECAPI/Common/Infra/SaveTempFile",autostart:!0,chunk_size:ecount.common.parseSize("20mb"),extensions:"jpg, jpeg, gif, tif",dragdrop:!1,attach_file_size:0,max_file_size:ecount.common.parseSize("2gb"),max_file_count:10,multi_selection:!1,prevent_duplicates:!0,multipart_param:{},tot_size_lmt:{size:"1",flag:!1},menu_code:ecenum.filemenuCode.gw03,is_free_groupware:!1};this._defaultNewFileStorageConfig={collection:null,partition:null,comcode:"",owner_key:"",storage_host_number:1,upload_path:"/SaveTempFile/",temp_file_lifetime:ecenum.tempfileLifetime.infinity,severalOwner_key:!0,isOwnerKeyNew:!0};this.defaultParam={AFlag:4};this.options={DtCreateKey:"",UserFlag:"",MaxFileSize:0,UsedFileSize:0,RestFileSize:0,AttachSize:0};ecount.control.textEditor.prototype.init.apply(this,arguments)},initializeOptions:function(n){ecount.control.textEditor.prototype.initializeOptions.apply(this,arguments);var t=n._uploaderConfigs&&n._uploaderConfigs.length>0?n._uploaderConfigs[0][1]:{},i=n._newFileStorageConfigs&&n._newFileStorageConfigs.length>0?n._newFileStorageConfigs[0][1]:{};_.merge(this,{initData:{uploaderConfig:_.merge(!0,this._defaultUploaderConfig,t),newFileStorageConfig:_.merge(!0,this._defaultNewFileStorageConfig,i),usingUploader:!0,usingNewFileStorage:!0,usingAlwaysCreateOwnerkey:!0},isSimpleImageUpload:_.isBoolean(n.isSimpleImageUpload)?n.isSimpleImageUpload:!1})},initializeViewOptions:function(n){ecount.control.textEditor.prototype.initializeViewOptions.apply(this,arguments);_.merge(this.__viewOptions,{initData:this.initData,storageEndpoint:this.storageEndpoint||"",vmHandler:{_callback:n._callback,getValue:this.getValue.bind(this),setValue:this.setValue.bind(this),setPasteContent:this.setPasteContent.bind(this),showProgressbar:this.showProgressbar.bind(this),hideProgressbar:this.hideProgressbar.bind(this)}})},showProgressbar:function(){this.delegator&&this.delegator.triggerEvent("page.showProgressbar")},hideProgressbar:function(){this.delegator&&this.delegator.triggerEvent("page.hideProgressbar")},getValue:function(){var t,n;arguments.length==0?t=!1:arguments.length==1&&(t=arguments[0]);try{n=this.ecview.getViewValue()}catch(i){n=this.getOriginValue()}return n=this.editorMode==1?n.replace(/\s+$/,"").replace(/(<p><br><\/p>)$/,""):n,n=ecount.common.getNoScriptByHtml(n),n=ecount.common.getRemoveTagAndContent(n,["noframes","noscript","noembed","meta","iframe","script"]),this.isMakeSendMessageForm!==!0||t||n.indexOf("ecountPStyleUnikey")<0&&(n=this.ptagStyle+n),n}});ecount.class("ecount.layout.layerDropdown.list","ecount.layout.layerDropdown",{template:'<ul class="dropdown-menu"><\/ul>',render:function(){ecount.layout.layerDropdown.prototype.render.apply(this,arguments)},addItems:function(){for(var t="",n,e=ecount.resource,r=this.items.toArray(),u=this.$el,i=0,f=r.length;i<f;i++)n=r[i],n.IS_MENU_LINK?(n.css="text-default",t+='<li><div class="dropdown-menu-footer">'+this.makeLinkButton(n)+"<\/div><\/li>"):t+="<li>"+this.makeLinkButton(n)+"<\/li>";u.append($(t))}});ecount.class("ecount.layout.layerDropdown.table","ecount.layout.layerDropdown",{template:'<div class="dropdown-menu generate-other-slips">\n<\/div>',templateTable:'<table class="table table-hover table-th-left table-layout-auto table-border-no-a table-nowrap">\n<tbody>\n{{CONTENTS}}\n<\/tbody>\n<\/table>\n{{MENULINK}}',templateBody:"<tr><th>{{TITLE}}<\/th><td>{{LINK}}<\/td><\/tr>",render:function(){ecount.layout.layerDropdown.prototype.render.apply(this,arguments)},addItems:function(){for(var u,f,i,s,h,t="",e="",n,c=ecount.resource,o=this.items.toArray(),l=this.$el,r=0,a=o.length;r<a;r++)if(n=o[r],n.IS_MENU_LINK)n.css="text-default",e='<div class="dropdown-menu-footer">'+this.makeLinkButton(n)+"<\/div>";else{if(t+=this.templateBody.replace(/{{TITLE}}/g,this.notUseTitleResource?n.RESX_CODE:c[n[this.column.res]]),u="",n.SHOW_LINK.length>0)for(i=0,s=n.SHOW_LINK.length;i<s;i++)f=n.SHOW_LINK[i],u+=this.makeLinkButton(n,f.NAME,f.VALUE);t=t.replace(/{{LINK}}/g,u)}h=this.templateTable.replace(/{{CONTENTS}}/g,t).replace(/{{MENULINK}}/g,e);l.append($(h))}});ecount.class("ecount.layout.layerDropdown.anchor","ecount.layout.layerDropdown",{template:'<div class="dropdown-menu"><\/ul>',rowTemplate:'<div class="row">\n<div class="{{col1}}">{{title}}:<\/div>\n<div class="{{col2}}">{{anchors}}<\/div>\n<\/div>',templateLink:'<a href="javascript:;" data-trigger="click" data-pid="{{PID}}" data-cid="{{CID}}" data-identify="{{IDENTIFY}}" data-value="{{VALUE}}">{{TITLE}}<\/a>',useColumns:!1,useOuterClick:!1,render:function(){ecount.layout.layerDropdown.prototype.render.apply(this,arguments)},items:[],addItems:function(){for(var t,f,i=title="",r=0,n,u;r<this.items.length;r++)if(n=this.items[r],u="",this.useColumns==!0){for(t=0;t<n.items.length;t++)f=n.items[t],u+=this._getAnchor(f,n.id);i+=ecount.widget.replaceAttr(this.rowTemplate,{col1:n.columnCss&&n.columnCss[0]||"col-xs-2",col2:n.columnCss&&n.columnCss[1]||"col-xs-10",title:ecount.resource[n.label]||n.label,anchors:u})}else i+=this._getAnchor(n);this.$el.append(i)},_getAnchor:function(n,t){return this.templateLink.replace(/{{PID}}/g,t||"").replace(/{{CID}}/g,this.pcid).replace(/{{IDENTIFY}}/g,n.id).replace(/{{TITLE}}/g,n.label).replace(/{{VALUE}}/g,n.value)},redraw:function(n){this.items=n;this.$el.empty();this.addItems();this.bindEvents()}});ecount.class("ecount.layout.layerDropdown.control","ecount.layout.layerDropdown",{template:'<div class="dropdown-menu dropdown-menu-collapsed-control-click">\n<table class="table table-hover table-th-left table-layout-auto table-border-no-a table-nowrap">\n<tbody>\n{{TBODY}}\n<\/tbody>\n<\/table>\n<\/div>',templateTbody:'<tr rid="row-{{groupId}}"><th data-trigger="click">{{TH}}<\/th><td><\/td><\/tr>',init:function(){this.itemList=[];ecount.layout.layerDropdown.prototype.init.apply(this,arguments);this.initializer=ecount.global.findCallback(this.ecPageID,ecount.widget.initializer);this.dropdownTarget="container";this.events=new ecount.events(this);this.events.on({"control.change":this.transferEvent,"control.openPopup":this.transferEvent,"anchor.click":this.transferEvent,"button.click":this.transferEvent,"dropdown.click":this.transferEvent,onClickControl:this.transferEvent,"control.focusout":this._ON_MOVE_FOCUS,"control.focusin":this.transferEvent,"control.showError":this.transferEvent,"control.hideError":this.transferEvent,"dateControl.display":this.transferEvent,"form.sync":this.transferEvent,"dualMode.addition":this.transferEvent,"dualMode.buttonDisplay":this.transferEvent,"dualMode.setDualStep":this.transferEvent,"dualMode.change":this.transferEvent,"dualMode.toggelDisplay":this.transferEvent,"page.adjustHeaderSearchDimensions":this.transferEvent,"page.showProgressbar":this.transferEvent,"page.hideProgressbar":this.transferEvent,scope:this})},render:function(){this.setTemplate();ecount.layout.layerDropdown.prototype.render.apply(this,arguments)},setTemplate:function(){for(var r,u=[],n={},t,i=0,f=this.items.length;i<f;i++)t=this.items[i],$.isNull(n[t.groupId])&&(n[t.groupId]=t.subTitle);for(r in n)u.push(ecount.widget.replaceAttr(this.templateTbody,{groupId:r,TH:n[r]||""}));this.template=this.template.replace("{{TBODY}}",u.join(""))},addItems:function(){for(var i,n,t=0,r=this.items.length;t<r;t++)n=this.items[t],i=this.$el.find("tr[rid=row-"+n.groupId+"] > td"),this.itemList.push(this.addItem(n,i))},addItem:function(n,t){var u=null,f=null,i=$.extend({},n),r;if(this.initializer){userSettings=widget.generator.control();userSettings.define(i.controlType,i.id,i.name,i.subTitle,i.groupId);this.initializer(i.id,userSettings);userSettings=userSettings.end();for(r in userSettings)r==="data"&&userSettings[r]&&userSettings[r].length===0||(i[r]=userSettings[r])}return i.__type===widget.generator.CONTROL&&(f=ecount.common.createNamespace(i.controlType),i.id?(i.controlType.indexOf("widget.button")>-1||i.controlType.indexOf("widget.link")>-1)&&(i.displayID=this.cID(i.id)):i.id=ecount.common.uuid(i.controlType)),i.__target=this.__target,i.__pnode=this.__type,i.delegator=this.events,i.containerDelegator=this.events,i.ecPageID=this.ecPageID,u=new f(i),u.render(t),u.$el.after(" "),u},bindEvents:function(){this.$el.on("click","th[data-trigger=click]",this.clickHandler.bind(this))},clickHandler:function(n){var i=$(n.target).parent().find("td"),t=this.$el.find("> table");if(t.find("td").removeClass("active"),i.addClass("active"),t.addClass("active"),this.onClick){n.type="dropdown.click";this.onClick(n)}return n.preventDefault(),!1},hide:function(n){var t=this.$el.find("td"),i=this.$el.find("> table");if(n&&$(n.target).attr("data-cid"))return!1;ecount.layout.layerDropdown.prototype.hide.apply(this,arguments);t.removeClass("active");i.removeClass("active")},hideRow:function(n){var i="[rid=row-"+n+"]",t=this.$el.find("tr"+i);t&&t.hide()},showRow:function(n){var i="[rid=row-"+n+"]",t=this.$el.find("tr"+i);t&&t.show()},cID:function(n){return[this.prefix||"btn",this.__target,n].join("-")},transferEvent:function(n){if(n.__eventType){var t=Array.prototype.slice.call(arguments);return this.delegator._triggerEvent.apply(this.delegator,[n.__eventType].concat(t))}this.delegator.triggerEvent(n.type,n)},_ON_MOVE_FOCUS:function(n){for(var i,r,t=0,u=this.itemList.length;t<u;t++){if(r=this.itemList[t],i=this.itemList[t+1],$.isNull(i))return!1;if(r.id===n.cid)return i.setFocus(0),!1}}}),function(){var n=function(n,t){return this.$element=$(n),this._isThisObjectClick=!1,this.$element.find("> button")[0].setAttribute("data-ecselectindex",t.index),t.target=="daterangepicker"?this.$element.find("li").attr("data-function","ecDaterangepickerLayer").attr("data-function-index",t.index):this.$element.find("li").attr("data-function","ecSelectedLayer"),this.$element.find("ul").hasClass("position-fixed")||this.$element.find("ul").addClass("position-fixed"),this.cid=n.getAttribute("data-cid"),this.index=n.getAttribute("data-index"),this._keyStack=[],this.init(t),this.bodyClickHandler=function(n){var t=!0,i;this._isThisObjectClick=!1;n.target==this.getOptions()[0]?t=!1:(this.$element.find(n.target).length>0||this.getOptions().find(n.target).length>0)&&(this._isThisObjectClick=!0);i=this._lastSelectValue||"";t&&this.hide();i!=this.getValue()&&this._ON_CHANGE(n)}.bind(this),{setValue:$.proxy(this.setValue,this),setValueByIndex:$.proxy(this.setValueByIndex,this),getValue:$.proxy(this.getValue,this),getValueByIndex:$.proxy(this.getValueByIndex,this),getSelectedLabel:$.proxy(this.getSelectedLabel,this),initSelectedValue:$.proxy(this.initSelectedValue,this),isContain:$.proxy(this.isContain,this),hasChild:$.proxy(this.hasChild,this),setHandler:$.proxy(this.setHandler,this),bindEvent:$.proxy(this.bindEvent,this),empty:$.proxy(this.empty,this),show:$.proxy(this.show,this),hide:$.proxy(this.hide,this),destroy:$.proxy(this.destroy,this),getOptions:$.proxy(this.getOptions,this),isShow:$.proxy(this.isShow,this),removeIndex:$.proxy(this.removeIndex,this)}};n.prototype.init=function(n){this.options=$.extend(!0,{},n);this.handler=this.handler||{};this.bindEvent();this.render()};n.prototype.bindEvent=function(){this.bindClickHandler();this.bindKeydownHandler();this.bindMousedownHandler()};n.prototype.destroy=function(){this.hide();this.$element.prop("onclick",null).off()};n.prototype.render=function(){this.$element.find("li").length==0?this.$element.find("> button").html("&nbsp;"):this.initSelectedValue()};n.prototype.getOptions=function(){return this.$dropdownOptions||this.$element.find("ul")};n.prototype.initSelectedValue=function(){var n=this.getOptions().find("li.active");n.length==0&&(n=this.getOptions().find("li:first-child"),n.addClass("active"));this.$element.find("> button").html(this.setSelectValue(n.find("a").text().escapeHTML()))};n.prototype.isActive=function(){return!this.$element.hasClass("disabled")};n.prototype.mousedownHandler=function(n){if(n.target.tagName=="A"&&this.isShow())return n.preventDefault(),!1};n.prototype.bindMousedownHandler=function(){var n=this;this.$element.on("mousedown."+this.ecPageID,function(t){n.mousedownHandler(t)})};n.prototype.keydownHandler=function(n){var t,i,r,u;if(this.isActive()){if(t=this.isShow(),n.keyCode==40||n.keyCode==38)return i=n.keyCode==40?this.getOptions().find("li.active").next():this.getOptions().find("li.active").prev(),i.length>0&&(this.setScrollPosition(i,n.keyCode==40),this.setValue(i[0].getAttribute("data-value")),t||this._ON_CHANGE(n)),n.preventDefault(),!1;if(t&&n.keyCode>111&&n.keyCode<121){if(n.keyCode==119)return n.preventDefault(),!1;this.hide()}else if(t&&(n.keyCode==13||n.keyCode==9||n.keyCode==27)&&(r=this._lastSelectValue||"",u=this.getValue(),this.hide(),r!=u&&n.keyCode!=27&&this._ON_CHANGE(n),t))return n.preventDefault(),!1}};n.prototype.bindKeydownHandler=function(){var n=this;this.$element.on("keypress."+this.ecPageID,function(t){n.isActive()&&t.target.tagName=="BUTTON"&&n.seachValueFromKeydown(t)});this.$element.on("keydown."+this.ecPageID,function(t){n.keydownHandler(t)})};n.prototype.clickHandler=function(n){var t,u,f,i,r;if($(n.target).attr("data-action")!="mobile-keydown"){if(n._fakeTarget=this.$element.find("> button")[0],n._fakeEcSelectUlParentElement=this.$element[0],this.handler.click?this.handler.click.priority?(this.handler.click.callback(n),this.options.onclick&&this.options.onclick(n)):(this.options.onclick&&this.options.onclick(n),this.handler.click.callback(n)):this.options.onclick&&this.options.onclick(n),t=$(n.currentTarget),ecount.control.isECSelectbox(t[0])&&!t.hasClass("disabled")&&(this.isShow()?(u=this._lastSelectValue||"",f=this.getValue(),this.hide(),u!=f&&this._ON_CHANGE(n)):this._isThisObjectClick||this.show(),this._isThisObjectClick=!1),n.target.tagName=="A")return i=$(n.target).parent()[0].getAttribute("data-value"),r=t.find("li.active")[0].getAttribute("data-value"),n._fakeOldValue=r,n._fakeTarget.focus(),r!=i&&(this.setValue(i),this._ON_CHANGE(n,i)),!1;n._fakeTarget.focus()}};n.prototype.bindClickHandler=function(){var n=this;this.$element.bind("click",function(t){n.clickHandler(t)})};n.prototype.seachValueFromKeydown=function(n){var i=this,u=String.fromCharCode(n.keyCode),t,f,r;u!=this._keyStack&&(this._keyStack+=u.toLowerCase());this.keyStackID&&window.clearTimeout(this.keyStackID);t=[];this.getOptions().find("li").each(function(n){var r=$(this);r.hasClass("active")&&(f=n);r.find("a").text().toLowerCase().indexOf(i._keyStack)===0&&t.push(n)});t.length>0&&(r=$(t).filter(function(n,t){return t>f}),r.length>0?this.setValueByIndex(r[0]):this.setValueByIndex(t[0]),i._ON_CHANGE(n));this.keyStackID=window.setTimeout(function(){console.log("clear");i.keyStackID=null;i._keyStack=""},300)};n.prototype.setHandler=function(n){$.extend(this.handler,n)};n.prototype.setScrollPosition=function(n,t){var u=n.outerHeight(),i=this.getOptions(),r=i[0].scrollTop,e=i.height(),f=n[0].offsetTop,o=typeof t=="function"?t:t?function(){f-r>e&&i.scrollTop(r+u)}:function(){f-r<0&&i.scrollTop(r-u)};o()};n.prototype.isShow=function(){return this.getOptions().hasClass("show")};n.prototype.show=function(){var r,a,v,o,u,t,s,h,b;if(!this.$dropdownOptions&&!this._isThisObjectClick){this.$dropdownOptions=this.$element.find("ul").detach();this.$dropdownOptions[0].setAttribute("data-role","ecSelect");this.$dropdownOptions.on("mousedown."+this.ecPageID,this.mousedownHandler.bind(this));this.$dropdownOptions.bind("click",function(n){this.clickHandler(n)}.bind(this));$(document.body).append(this.$dropdownOptions)}this._lastSelectValue=this.getValue();var n=this.getOptions(),c=0,l=0,i,f,e;if(!this.isShow()){if(c=$(window).scrollTop(),l=$(window).scrollLeft(),r=function(n){var t=this._lastSelectValue||"";this.hide();t!=this.getValue()&&n.target&&this._ON_CHANGE(n)}.bind(this),this.options.eventContainer&&this.options.eventContainer[0]==document)f=this.options.eventContainer,e=this.options.eventContainer.find(".tab-content");else if(f=this.options.eventContainer.find(".contents"),e=this.options.eventContainer.find(".tab-content"),this.options.popupID&&this.options.popupLevel&&(a=ecount.popup.parent,v=a.ecount.popup.get(this.options.popupID,this.options.popupLevel),i=v[0].parent().css("z-index")),!i)for(t=this.options.eventContainer,o=0;;){if(i=t.filter(".ui-dialog").css("z-index"),i)break;else t=t.parent();if(o++,o>1)break}if(this.$element.addClass("open"),this.getOptions().addClass("show"),u={left:0,top:0},ecount.common.isInApp&&ecount.common.isIOS&&(u={top:c,left:l}),this.$element.offset().top-n.outerHeight()<0||this.options.__target!="footer"&&$(window).height()>this.$element.offset().top+this.$element.outerHeight()+n.outerHeight()-u.top?n.css("top",this.$element.offset().top+this.$element.outerHeight()-u.top):n.css("top",this.$element.offset().top-n.outerHeight()-u.top),n.css("left",this.$element.offset().left-u.left),n.css("min-width",0),$.isEmpty(i)||n.css("z-index",i),!this.$element.hasClass("btn-group-select-inline")){var y=this.$element.outerWidth(),p=n.css("width").replace(/[^0-9]/g,""),w=$.isNumber(p);(!w||w&&y>=Number(p))&&n.css("width",y)}t=this.getOptions().find("li.active");t.length>0?(s=t[0].offsetTop,h=n.height(),t.length>0&&s>h?n.scrollTop(s-h/2):n.scrollTop(0)):n.scrollTop(0);ecount.__isEventCaptureMode()&&(b={type:"showEcSelectLayer",cid:n.find("a[data-cid]").attr("data-cid"),options:this.$dropdownOptions,container:n},ecount.eventLog("showEcSelectLayer",b))}f.bind("scroll.ecSelect",function(n){r(n)}.bind(this));e.bind("scroll.ecSelect",function(n){r(n)}.bind(this));$(window).bind("resize.ecSelect scroll.ecSelect",function(n){r(n)}.bind(this));ecount.common.isMobile&&(f.bind("touchmove.ecSelect",function(n){r(n)}.bind(this)),$(window).bind("touchmove.ecSelect",function(n){r(n)}.bind(this)));window.setTimeout(function(){if(!ecount.__isTRevokeEventMode())$(document).on("mousedown.ecSelect"+this.index,this.bodyClickHandler)}.bind(this))};n.prototype.hide=function(n){var f=this._lastSelectValue||"",e=this.getValue(),t,i,r=this.getOptions(),u;this._lastSelectValue&&delete this._lastSelectValue;r.unbind("scroll");this.$dropdownOptions&&(this.$dropdownOptions.unbind("mousedown."+this.ecPageID),this.$dropdownOptions.unbind("click"),$(document.body).find(this.$dropdownOptions).detach(),this.$element.append(this.$dropdownOptions),this.$dropdownOptions=null,delete this.$dropdownOptions);this.isShow()&&(this.$element.removeClass("open"),r.removeClass("show"),ecount.__isEventCaptureMode()&&(u={type:"hideEcSelectLayer",cid:r.find("a[data-cid]").attr("data-cid")},ecount.eventLog("hideEcSelectLayer",u)));this.options.eventContainer&&this.options.eventContainer[0]==document?(t=this.options.eventContainer,i=this.options.eventContainer.find(".tab-content")):(t=this.options.eventContainer.find(".contents"),i=this.options.eventContainer.find(".tab-content"));$(document).unbind("mousedown.ecSelect"+this.index,this.bodyClickHandler);t.unbind("scroll.ecSelect");i.unbind("scroll.ecSelect");$(window).unbind("resize.ecSelect scroll.ecSelect");ecount.common.isMobile&&(t.unbind("touchmove.ecSelect"),$(window).unbind("touchmove.ecSelect"));n&&(this._isThisObjectClick=!1,f!=e&&this._ON_CHANGE(event))};n.prototype.setValue=function(n,t){var r=this.getOptions().find("li[data-value='"+n+"']"),u,i;r.length>0&&(u=this.getValue(),this.getOptions().find("li.active").removeClass("active"),i=$(r[0]),i.addClass("active"),this.$element.find("> button").html(this.setSelectValue(i.find("a").text().escapeHTML(),n)),t&&this._ON_CHANGE({}))};n.prototype.setSelectValue=function(n,t){return this.options.setSelectValue?this.options.setSelectValue(n,t):n};n.prototype.getValue=function(){return this.getOptions().find("li.active").length>0?(this.getOptions().find("li.active")[0].getAttribute("data-value")||"")+"":""};n.prototype.hasChild=function(){return this.getOptions().find("li").length>0};n.prototype.getValueByIndex=function(n){return(this.getOptions().find("li")[n].getAttribute("data-value")||"")+""};n.prototype.setValueByIndex=function(n){var t=this.getOptions().find("li");this.setValue(this.getValueByIndex(Math.max(0,Math.min(n,t.length-1))))};n.prototype.getSelectedLabel=function(){return(this.getOptions().find("li.active a").text()||"")+""};n.prototype.isContain=function(n){return this.getOptions().find("li[data-value='"+n+"']").length>0};n.prototype.empty=function(){this.getOptions().empty();this.$element.find("> button").html("&nbsp;")};n.prototype.removeIndex=function(n){var t=this.getOptions().find("li");t.eq(n).hasClass("active")&&t.length>1&&(n==0?(t.eq(n+1).addClass("active"),this.setValueByIndex(n+1)):(t.eq(0).addClass("active"),this.setValueByIndex(0)));t.eq(n).remove();t.eq(n).hasClass("active")&&t.length==1&&this.$element.find("> button").html("&nbsp;")};n.prototype._ON_CHANGE=function(n,t){n._fakeValue=this.getValue();n.target=this.getOptions().find("li.active").find("a")[0];n._fakeTarget=this.$element.find("> button")[0];n._fakeEcSelectUlParentElement||(n._fakeEcSelectUlParentElement=this.$element[0]);this.handler.change?this.handler.change.priority?(this.handler.change.callback(n),this.options.onchange&&this.options.onchange(n,t)):(this.options.onchange&&this.options.onchange(n,t),this.handler.change.callback(n)):(this.options.isUnion===!0&&this.$element.trigger("change"),this.options.onchange&&this.options.onchange(n,t))};$.fn.ecSelect=function(t){var i,r=[].slice.call(arguments,1);return this.each(function(u){var f=$.data(this,"ecSelect");if(typeof t=="string")try{i=f[t].apply(f,r)}catch(e){}else $.data(this,"ecSelect",new n(this,$.extend(!0,{index:u},t)))}),$.isNull(i)?this:i}}();ecount.layout.graph||(ecount.layout.graph={});ecount.layout.graph._export=function(){return{prop:{template:'<div id="{{id}}" class="wrapper-chart legend-right legend-middle"> {{chart}} {{legend}} <\/div>',chartTemplate:'<div class="chart"><div id="{{chartLayoutId}}" class="ct-chart"><\/div><\/div>',legendTemplate:'<div class="legend" id="{{chartlegendId}}">{{legendContainer}}<\/div>',legendContainerTemplate:'<ul id="ecChartLegendContainer"><\/ul>',"const":{graphType:{bar:"bar",horizontalBar:"horizontalBar",pie:"pie",line:"line",area:"area"}},init:function(n){this._options=n;ecount.layout.prototype.init.apply(this,arguments)},render:function(){this.ecChartLegendId=String.format("{0}_ecChartLegend",this.id);this.ecChartLayoutId=String.format("{0}_ecChartLayout",this.id);this.legendTemplate=this.legendTemplate.replace("{{chartlegendId}}",this.ecChartLegendId).replace("{{legendContainer}}",this.legendContainerTemplate);this.chartTemplate=this.chartTemplate.replace("{{chartLayoutId}}",this.ecChartLayoutId);this.template=this.template.replace("{{id}}",this.id).replace("{{chart}}",this.chartTemplate).replace("{{legend}}",this.legendTemplate);ecount.layout.prototype.render.apply(this,arguments);var n={target:this.containerName,type:this.__type,gridId:this.id,tabId:this.tabId,isDynamic:this.isDynamic,__self:this};this.containerDelegator?this.containerDelegator.triggerEvent("item.onload",n):this.delegator&&this.delegator.triggerEvent("item.onload",n)},clear:function(){var n=this.$el.find("#"+this.ecChartLayoutId),t=n.find("#ecChartContainer");return t.length>0&&t.find("g").remove(),n.html("")},isShow:function(){return!this.$el.hasClass("hidden")},show:function(){this.$el.hasClass("hidden")&&this.$el.removeClass("hidden")},hide:function(){this.$el.hasClass("hidden")||this.$el.addClass("hidden")},setChartWidth:function(n){var t=this.$el.find("#"+this.ecChartLayoutId);t.css({width:n})},setChartHeight:function(n){var t=this.$el.find("#"+this.ecChartLayoutId);t.css({height:n})},getWidth:function(){return this.$el.width()},getHtml:function(){return this.$el.outerHTML()},getChartRect:function(){var n=this.$el.find("#"+this.ecChartLayoutId);return n.length>0?n.get(0).getBoundingClientRect():{top:0,bottom:0,width:0,height:0}},getChartContainerRect:function(){var n=this.$el.find("#ecChartContainer");return n.length>0?n.get(0).getBoundingClientRect():{top:0,bottom:0,width:0,height:0}},getLegendRect:function(){if(this.isShowLegend()){var n=this.$el.find("#"+this.ecChartLegendId);if(n.length>0)return n.get(0).getBoundingClientRect()}return{top:0,bottom:0,width:0,height:0}},getChartImageData:function(){var n=this.$el.find("#ecChartContainer");return n.length>0?ecount.ECChart.ECCaptureUtil.base64StringFromSvg(n[0]):null},getLegendImageData:function(){var n=this.$el.find("#"+this.ecChartLegendId);return n.length>0?ecount.ECChart.ECCaptureUtil.base64StringFromHtml(n[0]):null},isShowLegend:function(){var n=this.$el.find("#ecChartLegendContainer");return n.length>0&&n.get(0).style.display!="none"?!0:!1},showLegend:function(n){var t=this.$el.find("#ecChartLegendContainer");t.length>0&&(n?t.css("display",""):t.css("display","none"))},setGraphData:function(n){this.graphData=n},setGraphSetting:function(n){this.graphSetting=n},onChartRenderCompleted:function(n,t){var r=document.querySelector(t.layoutSelector),u,f,i;r&&(r.style.width=t.chart.actualWidth+"px",r.style.height=t.chart.actualHeight+"px");this.graphData.width=t.chart.actualWidth>this.graphData.width?t.chart.actualWidth:this.graphData.width;this.graphData.height=t.chart.actualWidth>this.graphData.height?t.chart.actualWidth:this.graphData.height;u=document.querySelector(t.legend.layoutSelector);u&&(f=u.querySelector(t.legend.containerSelector),f&&(f.style["max-height"]=t.chart.actualHeight+"px"));i=i||{};i.target=i.target||{};i.target.id=this.id;i.__eventType="graphEvent.renderComplete";i.type="graphEvent";i.preventDefault=function(){};this.delegator.triggerEvent("graphEvent.renderComplete",i)},onChartMouseOver:function(n,t){switch(this.graphSetting.graphType){case this.const.graphType.bar:case this.const.graphType.horizontalBar:n.showHighlightById(t.id);n.legend.showHighlightById(t.groupId);break;case this.const.graphType.pie:n.showHighlightById(t.id);n.legend.showHighlightById(t.id);break;case this.const.graphType.area:switch(t.shapeType){case"SCATTER":n.showHighlightById(t.name);n.legend.showHighlightById(t.name);break;case"AREA":default:n.showHighlightById(t.id);n.legend.showHighlightById(t.id)}break;case this.const.graphType.line:switch(t.shapeType){case"SCATTER":n.showHighlightByName(t.name);n.legend.showHighlightById(t.name);break;case"LINE":default:n.showHighlightById(t.id);n.legend.showHighlightById(t.groupId)}}},onChartMouseLeave:function(n,t){switch(this.graphSetting.graphType){case this.const.graphType.bar:case this.const.graphType.horizontalBar:n.hideHighlightById(t.id);n.legend.hideHighlightById(t.groupId);break;case this.const.graphType.pie:n.showHighlightById(t.id);n.legend.showHighlightById(t.id);break;case this.const.graphType.area:switch(t.shapeType){case"SCATTER":n.hideHighlightById(t.name);n.legend.hideHighlightById(t.name);break;case"AREA":default:n.hideHighlightById(t.id);n.legend.hideHighlightById(t.id)}break;case this.const.graphType.line:switch(t.shapeType){case"SCATTER":n.hideHighlightByName(t.name);n.legend.hideHighlightById(t.name);break;case"LINE":default:n.hideHighlightById(t.id);n.legend.hideHighlightById(t.groupId)}}},onLegendMouseOver:function(n,t){var i,r;switch(this.graphSetting.graphType){case this.const.graphType.bar:case this.const.graphType.horizontalBar:i=t.groupId||"";n.showHighlightByName(i);n.legend.showHighlightById(i);break;case this.const.graphType.pie:case this.const.graphType.area:case this.const.graphType.line:r=t.groupId||"";n.showHighlightById(r);n.legend.showHighlightById(r)}},onLegendMouseLeave:function(n,t){var i,r;switch(this.graphSetting.graphType){case this.const.graphType.bar:case this.const.graphType.horizontalBar:i=t.groupId||"";n.legend.hideHighlightById(i);n.hideHighlightByName(i);break;case this.const.graphType.pie:case this.const.graphType.area:case this.const.graphType.line:r=t.groupId||"";n.legend.hideHighlightById(r);n.hideHighlightById(r)}},onTooltipMouseOver:function(){switch(this.graphSetting.graphType){case this.const.graphType.bar:this.onTooltipMouseOverBar.apply(this,arguments);break;case this.const.graphType.horizontalBar:this.onTooltipMouseOverHorizontalBar.apply(this,arguments);break;case this.const.graphType.area:case this.const.graphType.line:this.onTooltipMouseOverArea.apply(this,arguments)}},onTooltipMouseMove:function(){switch(this.graphSetting.graphType){case this.const.graphType.pie:this.onTooltipMouseMovePie.apply(this,arguments)}},onTooltipMouseOut:function(n){n.tooltip.hide()},onTooltipMouseMovePie:function(n,t){var u=n.findDataById(t.id),i,r;u&&(i=this.graphData.datas.reduce(function(n,t){return t.values.forEach(function(t){n+=t.value||0}),n},0),t.totalValue=i,r=this._getTooltipHTML(n,t),n.tooltip.show({position:"bottomLeft",standardPoint:{top:t.offsetY+10,left:t.offsetX+10},standardSize:t.shape.size,scroll:t.scroll,dataSet:{refId:t.id},html:r}))},onTooltipMouseOverBar:function(n,t){var r=this.$el.get(0).getBoundingClientRect(),u=r.top,f=r.left,e=n.findDataById(t.id),i;e&&(i=this._getTooltipHTML(n,t),e.value>=0?n.tooltip.show({position:"topCenter",standardPoint:{top:t.shape.clientRect.top-u,left:t.shape.clientRect.left-f,bottom:t.shape.clientRect.bottom,right:t.shape.clientRect.right,width:t.shape.clientRect.width,height:t.shape.clientRect.height},standardSize:t.shape.size,scroll:t.scroll,dataSet:{refId:t.id},html:i}):n.tooltip.show({position:"topCenter",standardPoint:{top:t.shape.clientRect.top-u,left:t.shape.clientRect.left-f,bottom:t.shape.clientRect.bottom,right:t.shape.clientRect.right,width:t.shape.clientRect.width,height:t.shape.clientRect.height},standardSize:t.shape.size,scroll:t.scroll,dataSet:{refId:t.id},html:i}))},onTooltipMouseOverHorizontalBar:function(n,t){var r=this.$el.get(0).getBoundingClientRect(),u=r.top,f=r.left,e=n.findDataById(t.id);if(e){var o=this._getTooltipHTML(n,t),i=n.label.getPositionById(t.id),s=n.label.getSizeById(t.id);e.value>=0?n.tooltip.show({position:"bottomLeft",standardPoint:{top:i.top-u,left:i.left-f,bottom:i.bottom,right:i.right,width:i.width,height:i.height},standardSize:s,scroll:t.scroll,dataSet:{refId:t.id},html:o}):n.tooltip.show({position:"bottomLeft",standardPoint:{top:i.top-u,left:i.left-f,bottom:i.bottom,right:i.right,width:i.width,height:i.height},standardSize:s,scroll:t.scroll,dataSet:{refId:t.id},html:o})}},onTooltipMouseOverArea:function(n,t){var i;if(t.shapeType=="SCATTER"){var r=this.$el.get(0).getBoundingClientRect(),u=r.top,f=r.left,e=n.findDataById(t.id);e&&(i=this._getTooltipHTML(n,t),e.value>=0?n.tooltip.show({position:"BOTTOM_RIGHT",standardPoint:{top:t.shape.clientRect.top-u+10,left:t.shape.clientRect.left-f+10,bottom:t.shape.clientRect.bottom,right:t.shape.clientRect.right,width:t.shape.clientRect.width,height:t.shape.clientRect.height},standardSize:t.shape.size,scroll:t.scroll,dataSet:{refId:t.id},html:i}):n.tooltip.show({position:"BOTTOM_RIGHT",standardPoint:{top:t.shape.clientRect.top-u+10,left:t.shape.clientRect.left-f+10,bottom:t.shape.clientRect.bottom,right:t.shape.clientRect.right,width:t.shape.clientRect.width,height:t.shape.clientRect.height},standardSize:t.shape.size,scroll:t.scroll,dataSet:{refId:t.id},html:i}))}},_getTooltipHTML:function(n,t){var r="",u=n.findDataById(t.id),i,f,s,e,o;if(!u)return r;i="";switch(this.graphSetting.graphType){case this.const.graphType.pie:f=u.value/t.totalValue*100;f=(Math.round(f*2e3-.5)/2e3).toFixed(2);i=f.toString();s=i.split(".");s[1]=="00"&&(i=s[0]);switch(this.graphSetting.tooltipDataType){case"CATEGORY":e=n.findCategoryById(t.id)||"";r=e+", "+i+"%";break;case"LEGEND_TEXT":default:o=n.legend.findTextDataById(u.groupId)||{value:""};r=o.value+", "+i+"%"}break;default:i=u.valueFormatter(u.value);switch(this.graphSetting.tooltipDataType){case"CATEGORY":e=n.findCategoryById(t.id)||"";r=e+", "+i;break;case"LEGEND_TEXT":default:o=n.legend.findTextDataById(u.groupId)||{value:""};r=o.value+", "+i}}return r}},create:function(){var n=$.extend({},this.prop);ecount.layout.graph=$.Class(ecount.layout,n)}}};